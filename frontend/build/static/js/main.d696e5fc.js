/*! For license information please see main.d696e5fc.js.LICENSE.txt */
(()=>{var e={1635:function(e,t,n){e.exports=function(){"use strict";function e(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var i=function(e){try{return!!e()}catch(e){return!0}},o=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),a=o,s=Function.prototype,c=s.call,l=a&&s.bind.bind(c,c),d=a?l:function(e){return function(){return c.apply(e,arguments)}},u=d({}.isPrototypeOf),h=function(e){return e&&e.Math===Math&&e},p=h("object"==typeof globalThis&&globalThis)||h("object"==typeof window&&window)||h("object"==typeof self&&self)||h("object"==typeof t&&t)||h("object"==typeof t&&t)||function(){return this}()||Function("return this")(),f=o,m=Function.prototype,_=m.apply,g=m.call,v="object"==typeof Reflect&&Reflect.apply||(f?g.bind(_):function(){return g.apply(_,arguments)}),y=d,b=y({}.toString),E=y("".slice),S=function(e){return E(b(e),8,-1)},T=S,w=d,C=function(e){if("Function"===T(e))return w(e)},R="object"==typeof document&&document.all,k=void 0===R&&void 0!==R?function(e){return"function"==typeof e||e===R}:function(e){return"function"==typeof e},O={},I=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),N=o,A=Function.prototype.call,x=N?A.bind(A):function(){return A.apply(A,arguments)},P={},D={}.propertyIsEnumerable,L=Object.getOwnPropertyDescriptor,M=L&&!D.call({1:2},1);P.f=M?function(e){var t=L(this,e);return!!t&&t.enumerable}:D;var j,U,V=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},F=i,B=S,W=Object,G=d("".split),H=F((function(){return!W("z").propertyIsEnumerable(0)}))?function(e){return"String"===B(e)?G(e,""):W(e)}:W,z=function(e){return null==e},K=z,q=TypeError,Y=function(e){if(K(e))throw new q("Can't call method on "+e);return e},J=H,X=Y,Q=function(e){return J(X(e))},Z=k,$=function(e){return"object"==typeof e?null!==e:Z(e)},ee={},te=ee,ne=p,re=k,ie=function(e){return re(e)?e:void 0},oe=function(e,t){return arguments.length<2?ie(te[e])||ie(ne[e]):te[e]&&te[e][t]||ne[e]&&ne[e][t]},ae=p.navigator,se=ae&&ae.userAgent,ce=se?String(se):"",le=p,de=ce,ue=le.process,he=le.Deno,pe=ue&&ue.versions||he&&he.version,fe=pe&&pe.v8;fe&&(U=(j=fe.split("."))[0]>0&&j[0]<4?1:+(j[0]+j[1])),!U&&de&&(!(j=de.match(/Edge\/(\d+)/))||j[1]>=74)&&(j=de.match(/Chrome\/(\d+)/))&&(U=+j[1]);var me=U,_e=me,ge=i,ve=p.String,ye=!!Object.getOwnPropertySymbols&&!ge((function(){var e=Symbol("symbol detection");return!ve(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&_e&&_e<41})),be=ye&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ee=oe,Se=k,Te=u,we=Object,Ce=be?function(e){return"symbol"==typeof e}:function(e){var t=Ee("Symbol");return Se(t)&&Te(t.prototype,we(e))},Re=String,ke=function(e){try{return Re(e)}catch(e){return"Object"}},Oe=k,Ie=ke,Ne=TypeError,Ae=function(e){if(Oe(e))return e;throw new Ne(Ie(e)+" is not a function")},xe=Ae,Pe=z,De=function(e,t){var n=e[t];return Pe(n)?void 0:xe(n)},Le=x,Me=k,je=$,Ue=TypeError,Ve={exports:{}},Fe=p,Be=Object.defineProperty,We=p,Ge=function(e,t){try{Be(Fe,e,{value:t,configurable:!0,writable:!0})}catch(r){Fe[e]=t}return t},He="__core-js_shared__",ze=Ve.exports=We[He]||Ge(He,{});(ze.versions||(ze.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"\xa9 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Ke=Ve.exports,qe=Ke,Ye=function(e,t){return qe[e]||(qe[e]=t||{})},Je=Y,Xe=Object,Qe=function(e){return Xe(Je(e))},Ze=Qe,$e=d({}.hasOwnProperty),et=Object.hasOwn||function(e,t){return $e(Ze(e),t)},tt=d,nt=0,rt=Math.random(),it=tt(1..toString),ot=function(e){return"Symbol("+(void 0===e?"":e)+")_"+it(++nt+rt,36)},at=Ye,st=et,ct=ot,lt=ye,dt=be,ut=p.Symbol,ht=at("wks"),pt=dt?ut.for||ut:ut&&ut.withoutSetter||ct,ft=function(e){return st(ht,e)||(ht[e]=lt&&st(ut,e)?ut[e]:pt("Symbol."+e)),ht[e]},mt=x,_t=$,gt=Ce,vt=De,yt=function(e,t){var n,r;if("string"===t&&Me(n=e.toString)&&!je(r=Le(n,e)))return r;if(Me(n=e.valueOf)&&!je(r=Le(n,e)))return r;if("string"!==t&&Me(n=e.toString)&&!je(r=Le(n,e)))return r;throw new Ue("Can't convert object to primitive value")},bt=TypeError,Et=ft("toPrimitive"),St=function(e,t){if(!_t(e)||gt(e))return e;var n,r=vt(e,Et);if(r){if(void 0===t&&(t="default"),n=mt(r,e,t),!_t(n)||gt(n))return n;throw new bt("Can't convert object to primitive value")}return void 0===t&&(t="number"),yt(e,t)},Tt=Ce,wt=function(e){var t=St(e,"string");return Tt(t)?t:t+""},Ct=$,Rt=p.document,kt=Ct(Rt)&&Ct(Rt.createElement),Ot=function(e){return kt?Rt.createElement(e):{}},It=Ot,Nt=!I&&!i((function(){return 7!==Object.defineProperty(It("div"),"a",{get:function(){return 7}}).a})),At=I,xt=x,Pt=P,Dt=V,Lt=Q,Mt=wt,jt=et,Ut=Nt,Vt=Object.getOwnPropertyDescriptor;O.f=At?Vt:function(e,t){if(e=Lt(e),t=Mt(t),Ut)try{return Vt(e,t)}catch(e){}if(jt(e,t))return Dt(!xt(Pt.f,e,t),e[t])};var Ft=i,Bt=k,Wt=/#|\.prototype\./,Gt=function(e,t){var n=zt[Ht(e)];return n===qt||n!==Kt&&(Bt(t)?Ft(t):!!t)},Ht=Gt.normalize=function(e){return String(e).replace(Wt,".").toLowerCase()},zt=Gt.data={},Kt=Gt.NATIVE="N",qt=Gt.POLYFILL="P",Yt=Gt,Jt=Ae,Xt=o,Qt=C(C.bind),Zt=function(e,t){return Jt(e),void 0===t?e:Xt?Qt(e,t):function(){return e.apply(t,arguments)}},$t={},en=I&&i((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),tn=$,nn=String,rn=TypeError,on=function(e){if(tn(e))return e;throw new rn(nn(e)+" is not an object")},an=I,sn=Nt,cn=en,ln=on,dn=wt,un=TypeError,hn=Object.defineProperty,pn=Object.getOwnPropertyDescriptor,fn="enumerable",mn="configurable",_n="writable";$t.f=an?cn?function(e,t,n){if(ln(e),t=dn(t),ln(n),"function"==typeof e&&"prototype"===t&&"value"in n&&_n in n&&!n[_n]){var r=pn(e,t);r&&r[_n]&&(e[t]=n.value,n={configurable:mn in n?n[mn]:r[mn],enumerable:fn in n?n[fn]:r[fn],writable:!1})}return hn(e,t,n)}:hn:function(e,t,n){if(ln(e),t=dn(t),ln(n),sn)try{return hn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new un("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var gn=$t,vn=V,yn=I?function(e,t,n){return gn.f(e,t,vn(1,n))}:function(e,t,n){return e[t]=n,e},bn=p,En=v,Sn=C,Tn=k,wn=O.f,Cn=Yt,Rn=ee,kn=Zt,On=yn,In=et,Nn=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return En(e,this,arguments)};return t.prototype=e.prototype,t},An=function(e,t){var n,r,i,o,a,s,c,l,d,u=e.target,h=e.global,p=e.stat,f=e.proto,m=h?bn:p?bn[u]:bn[u]&&bn[u].prototype,_=h?Rn:Rn[u]||On(Rn,u,{})[u],g=_.prototype;for(o in t)r=!(n=Cn(h?o:u+(p?".":"#")+o,e.forced))&&m&&In(m,o),s=_[o],r&&(c=e.dontCallGetSet?(d=wn(m,o))&&d.value:m[o]),a=r&&c?c:t[o],(n||f||typeof s!=typeof a)&&(l=e.bind&&r?kn(a,bn):e.wrap&&r?Nn(a):f&&Tn(a)?Sn(a):a,(e.sham||a&&a.sham||s&&s.sham)&&On(l,"sham",!0),On(_,o,l),f&&(In(Rn,i=u+"Prototype")||On(Rn,i,{}),On(Rn[i],o,a),e.real&&g&&(n||!g[o])&&On(g,o,a)))},xn=Math.ceil,Pn=Math.floor,Dn=Math.trunc||function(e){var t=+e;return(t>0?Pn:xn)(t)},Ln=Dn,Mn=function(e){var t=+e;return t!=t||0===t?0:Ln(t)},jn=Mn,Un=Math.max,Vn=Math.min,Fn=function(e,t){var n=jn(e);return n<0?Un(n+t,0):Vn(n,t)},Bn=Mn,Wn=Math.min,Gn=function(e){var t=Bn(e);return t>0?Wn(t,9007199254740991):0},Hn=Gn,zn=function(e){return Hn(e.length)},Kn=Q,qn=Fn,Yn=zn,Jn=function(e){return function(t,n,r){var i=Kn(t),o=Yn(i);if(0===o)return!e&&-1;var a,s=qn(r,o);if(e&&n!=n){for(;o>s;)if((a=i[s++])!=a)return!0}else for(;o>s;s++)if((e||s in i)&&i[s]===n)return e||s||0;return!e&&-1}},Xn={includes:Jn(!0),indexOf:Jn(!1)},Qn=Xn.includes;An({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return Qn(this,e,arguments.length>1?arguments[1]:void 0)}});var Zn=p,$n=ee,er=function(e,t){var n=$n[e+"Prototype"],r=n&&n[t];if(r)return r;var i=Zn[e],o=i&&i.prototype;return o&&o[t]},tr=er("Array","includes"),nr=$,rr=S,ir=ft("match"),or=function(e){var t;return nr(e)&&(void 0!==(t=e[ir])?!!t:"RegExp"===rr(e))},ar=or,sr=TypeError,cr={};cr[ft("toStringTag")]="z";var lr="[object z]"===String(cr),dr=lr,ur=k,hr=S,pr=ft("toStringTag"),fr=Object,mr="Arguments"===hr(function(){return arguments}()),_r=dr?hr:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=fr(e),pr))?n:mr?hr(t):"Object"===(r=hr(t))&&ur(t.callee)?"Arguments":r},gr=_r,vr=String,yr=function(e){if("Symbol"===gr(e))throw new TypeError("Cannot convert a Symbol value to a string");return vr(e)},br=ft("match"),Er=An,Sr=function(e){if(ar(e))throw new sr("The method doesn't accept regular expressions");return e},Tr=Y,wr=yr,Cr=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[br]=!1,"/./"[e](t)}catch(e){}}return!1},Rr=d("".indexOf);Er({target:"String",proto:!0,forced:!Cr("includes")},{includes:function(e){return!!~Rr(wr(Tr(this)),wr(Sr(e)),arguments.length>1?arguments[1]:void 0)}});var kr=er("String","includes"),Or=u,Ir=tr,Nr=kr,Ar=Array.prototype,xr=String.prototype,Pr=function(e){var t=e.includes;return e===Ar||Or(Ar,e)&&t===Ar.includes?Ir:"string"==typeof e||e===xr||Or(xr,e)&&t===xr.includes?Nr:t},Dr=r(Pr),Lr=Ae,Mr=Qe,jr=H,Ur=zn,Vr=TypeError,Fr="Reduce of empty array with no initial value",Br=function(e){return function(t,n,r,i){var o=Mr(t),a=jr(o),s=Ur(o);if(Lr(n),0===s&&r<2)throw new Vr(Fr);var c=e?s-1:0,l=e?-1:1;if(r<2)for(;;){if(c in a){i=a[c],c+=l;break}if(c+=l,e?c<0:s<=c)throw new Vr(Fr)}for(;e?c>=0:s>c;c+=l)c in a&&(i=n(i,a[c],c,o));return i}},Wr={left:Br(!1),right:Br(!0)},Gr=i,Hr=function(e,t){var n=[][e];return!!n&&Gr((function(){n.call(null,t||function(){return 1},1)}))},zr=p,Kr=ce,qr=S,Yr=function(e){return Kr.slice(0,e.length)===e},Jr=Yr("Bun/")?"BUN":Yr("Cloudflare-Workers")?"CLOUDFLARE":Yr("Deno/")?"DENO":Yr("Node.js/")?"NODE":zr.Bun&&"string"==typeof Bun.version?"BUN":zr.Deno&&"object"==typeof Deno.version?"DENO":"process"===qr(zr.process)?"NODE":zr.window&&zr.document?"BROWSER":"REST",Xr="NODE"===Jr,Qr=Wr.left;An({target:"Array",proto:!0,forced:!Xr&&me>79&&me<83||!Hr("reduce")},{reduce:function(e){var t=arguments.length;return Qr(this,e,t,t>1?arguments[1]:void 0)}});var Zr=er("Array","reduce"),$r=u,ei=Zr,ti=Array.prototype,ni=function(e){var t=e.reduce;return e===ti||$r(ti,e)&&t===ti.reduce?ei:t},ri=ni,ii=r(ri),oi=S,ai=Array.isArray||function(e){return"Array"===oi(e)},si=An,ci=ai,li=d([].reverse),di=[1,2];si({target:"Array",proto:!0,forced:String(di)===String(di.reverse())},{reverse:function(){return ci(this)&&(this.length=this.length),li(this)}});var ui=er("Array","reverse"),hi=u,pi=ui,fi=Array.prototype,mi=function(e){var t=e.reverse;return e===fi||hi(fi,e)&&t===fi.reverse?pi:t},_i=mi,gi=r(_i),vi=ot,yi=Ye("keys"),bi=function(e){return yi[e]||(yi[e]=vi(e))},Ei=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Si=et,Ti=k,wi=Qe,Ci=Ei,Ri=bi("IE_PROTO"),ki=Object,Oi=ki.prototype,Ii=Ci?ki.getPrototypeOf:function(e){var t=wi(e);if(Si(t,Ri))return t[Ri];var n=t.constructor;return Ti(n)&&t instanceof n?n.prototype:t instanceof ki?Oi:null},Ni=d,Ai=Ae,xi=$,Pi=function(e){return xi(e)||null===e},Di=String,Li=TypeError,Mi=function(e,t,n){try{return Ni(Ai(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}},ji=$,Ui=Y,Vi=function(e){if(Pi(e))return e;throw new Li("Can't set "+Di(e)+" as a prototype")},Fi=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Mi(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Ui(n),Vi(r),ji(n)?(t?e(n,r):n.__proto__=r,n):n}}():void 0),Bi={},Wi={},Gi=et,Hi=Q,zi=Xn.indexOf,Ki=Wi,qi=d([].push),Yi=function(e,t){var n,r=Hi(e),i=0,o=[];for(n in r)!Gi(Ki,n)&&Gi(r,n)&&qi(o,n);for(;t.length>i;)Gi(r,n=t[i++])&&(~zi(o,n)||qi(o,n));return o},Ji=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Xi=Yi,Qi=Ji.concat("length","prototype");Bi.f=Object.getOwnPropertyNames||function(e){return Xi(e,Qi)};var Zi={};Zi.f=Object.getOwnPropertySymbols;var $i=oe,eo=Bi,to=Zi,no=on,ro=d([].concat),io=$i("Reflect","ownKeys")||function(e){var t=eo.f(no(e)),n=to.f;return n?ro(t,n(e)):t},oo=et,ao=io,so=O,co=$t,lo={},uo=Yi,ho=Ji,po=Object.keys||function(e){return uo(e,ho)},fo=I,mo=en,_o=$t,go=on,vo=Q,yo=po;lo.f=fo&&!mo?Object.defineProperties:function(e,t){go(e);for(var n,r=vo(t),i=yo(t),o=i.length,a=0;o>a;)_o.f(e,n=i[a++],r[n]);return e};var bo,Eo=oe("document","documentElement"),So=on,To=lo,wo=Ji,Co=Wi,Ro=Eo,ko=Ot,Oo="prototype",Io="script",No=bi("IE_PROTO"),Ao=function(){},xo=function(e){return"<"+Io+">"+e+"</"+Io+">"},Po=function(e){e.write(xo("")),e.close();var t=e.parentWindow.Object;return e=null,t},Do=function(){try{bo=new ActiveXObject("htmlfile")}catch(e){}var e,t,n;Do="undefined"!=typeof document?document.domain&&bo?Po(bo):(t=ko("iframe"),n="java"+Io+":",t.style.display="none",Ro.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(xo("document.F=Object")),e.close(),e.F):Po(bo);for(var r=wo.length;r--;)delete Do[Oo][wo[r]];return Do()};Co[No]=!0;var Lo=Object.create||function(e,t){var n;return null!==e?(Ao[Oo]=So(e),n=new Ao,Ao[Oo]=null,n[No]=e):n=Do(),void 0===t?n:To.f(n,t)},Mo=$,jo=yn,Uo=Error,Vo=d("".replace),Fo=String(new Uo("zxcasd").stack),Bo=/\n\s*at [^:]*:[^\n]*/,Wo=Bo.test(Fo),Go=V,Ho=!i((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Go(1,7)),7!==e.stack)})),zo=yn,Ko=function(e,t){if(Wo&&"string"==typeof e&&!Uo.prepareStackTrace)for(;t--;)e=Vo(e,Bo,"");return e},qo=Ho,Yo=Error.captureStackTrace,Jo={},Xo=Jo,Qo=ft("iterator"),Zo=Array.prototype,$o=function(e){return void 0!==e&&(Xo.Array===e||Zo[Qo]===e)},ea=_r,ta=De,na=z,ra=Jo,ia=ft("iterator"),oa=function(e){if(!na(e))return ta(e,ia)||ta(e,"@@iterator")||ra[ea(e)]},aa=x,sa=Ae,ca=on,la=ke,da=oa,ua=TypeError,ha=function(e,t){var n=arguments.length<2?da(e):t;if(sa(n))return ca(aa(n,e));throw new ua(la(e)+" is not iterable")},pa=x,fa=on,ma=De,_a=function(e,t,n){var r,i;fa(e);try{if(!(r=ma(e,"return"))){if("throw"===t)throw n;return n}r=pa(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return fa(r),n},ga=Zt,va=x,ya=on,ba=ke,Ea=$o,Sa=zn,Ta=u,wa=ha,Ca=oa,Ra=_a,ka=TypeError,Oa=function(e,t){this.stopped=e,this.result=t},Ia=Oa.prototype,Na=function(e,t,n){var r,i,o,a,s,c,l,d=n&&n.that,u=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),f=!(!n||!n.INTERRUPTED),m=ga(t,d),_=function(e){return r&&Ra(r,"normal",e),new Oa(!0,e)},g=function(e){return u?(ya(e),f?m(e[0],e[1],_):m(e[0],e[1])):f?m(e,_):m(e)};if(h)r=e.iterator;else if(p)r=e;else{if(!(i=Ca(e)))throw new ka(ba(e)+" is not iterable");if(Ea(i)){for(o=0,a=Sa(e);a>o;o++)if((s=g(e[o]))&&Ta(Ia,s))return s;return new Oa(!1)}r=wa(e,i)}for(c=h?e.next:r.next;!(l=va(c,r)).done;){try{s=g(l.value)}catch(e){Ra(r,"throw",e)}if("object"==typeof s&&s&&Ta(Ia,s))return s}return new Oa(!1)},Aa=yr,xa=An,Pa=u,Da=Ii,La=Fi,Ma=function(e,t,n){for(var r=ao(t),i=co.f,o=so.f,a=0;a<r.length;a++){var s=r[a];oo(e,s)||n&&oo(n,s)||i(e,s,o(t,s))}},ja=Lo,Ua=yn,Va=V,Fa=function(e,t){Mo(t)&&"cause"in t&&jo(e,"cause",t.cause)},Ba=function(e,t,n,r){qo&&(Yo?Yo(e,t):zo(e,"stack",Ko(n,r)))},Wa=Na,Ga=function(e,t){return void 0===e?arguments.length<2?"":t:Aa(e)},Ha=ft("toStringTag"),za=Error,Ka=[].push,qa=function(e,t){var n,r=Pa(Ya,this);La?n=La(new za,r?Da(this):Ya):(n=r?this:ja(Ya),Ua(n,Ha,"Error")),void 0!==t&&Ua(n,"message",Ga(t)),Ba(n,qa,n.stack,1),arguments.length>2&&Fa(n,arguments[2]);var i=[];return Wa(e,Ka,{that:i}),Ua(n,"errors",i),n};La?La(qa,za):Ma(qa,za,{name:!0});var Ya=qa.prototype=ja(za.prototype,{constructor:Va(1,qa),message:Va(1,""),name:Va(1,"AggregateError")});xa({global:!0,constructor:!0,arity:2},{AggregateError:qa});var Ja,Xa,Qa,Za=k,$a=p.WeakMap,es=Za($a)&&/native code/.test(String($a)),ts=p,ns=$,rs=yn,is=et,os=Ke,as=bi,ss=Wi,cs="Object already initialized",ls=ts.TypeError,ds=ts.WeakMap;if(es||os.state){var us=os.state||(os.state=new ds);us.get=us.get,us.has=us.has,us.set=us.set,Ja=function(e,t){if(us.has(e))throw new ls(cs);return t.facade=e,us.set(e,t),t},Xa=function(e){return us.get(e)||{}},Qa=function(e){return us.has(e)}}else{var hs=as("state");ss[hs]=!0,Ja=function(e,t){if(is(e,hs))throw new ls(cs);return t.facade=e,rs(e,hs,t),t},Xa=function(e){return is(e,hs)?e[hs]:{}},Qa=function(e){return is(e,hs)}}var ps,fs,ms,_s={set:Ja,get:Xa,has:Qa,enforce:function(e){return Qa(e)?Xa(e):Ja(e,{})},getterFor:function(e){return function(t){var n;if(!ns(t)||(n=Xa(t)).type!==e)throw new ls("Incompatible receiver, "+e+" required");return n}}},gs=I,vs=et,ys=Function.prototype,bs=gs&&Object.getOwnPropertyDescriptor,Es=vs(ys,"name"),Ss={EXISTS:Es,PROPER:Es&&"something"===function(){}.name,CONFIGURABLE:Es&&(!gs||gs&&bs(ys,"name").configurable)},Ts=yn,ws=function(e,t,n,r){return r&&r.enumerable?e[t]=n:Ts(e,t,n),e},Cs=i,Rs=k,ks=$,Os=Lo,Is=Ii,Ns=ws,As=ft("iterator"),xs=!1;[].keys&&("next"in(ms=[].keys())?(fs=Is(Is(ms)))!==Object.prototype&&(ps=fs):xs=!0);var Ps=!ks(ps)||Cs((function(){var e={};return ps[As].call(e)!==e}));Rs((ps=Ps?{}:Os(ps))[As])||Ns(ps,As,(function(){return this}));var Ds={IteratorPrototype:ps,BUGGY_SAFARI_ITERATORS:xs},Ls=_r,Ms=lr?{}.toString:function(){return"[object "+Ls(this)+"]"},js=lr,Us=$t.f,Vs=yn,Fs=et,Bs=Ms,Ws=ft("toStringTag"),Gs=function(e,t,n,r){var i=n?e:e&&e.prototype;i&&(Fs(i,Ws)||Us(i,Ws,{configurable:!0,value:t}),r&&!js&&Vs(i,"toString",Bs))},Hs=Ds.IteratorPrototype,zs=Lo,Ks=V,qs=Gs,Ys=Jo,Js=function(){return this},Xs=function(e,t,n,r){var i=t+" Iterator";return e.prototype=zs(Hs,{next:Ks(+!r,n)}),qs(e,i,!1,!0),Ys[i]=Js,e},Qs=An,Zs=x,$s=Xs,ec=Ii,tc=Gs,nc=ws,rc=Jo,ic=Ds,oc=Ss.PROPER,ac=ic.BUGGY_SAFARI_ITERATORS,sc=ft("iterator"),cc="keys",lc="values",dc="entries",uc=function(){return this},hc=function(e,t,n,r,i,o,a){$s(n,t,r);var s,c,l,d=function(e){if(e===i&&m)return m;if(!ac&&e&&e in p)return p[e];switch(e){case cc:case lc:case dc:return function(){return new n(this,e)}}return function(){return new n(this)}},u=t+" Iterator",h=!1,p=e.prototype,f=p[sc]||p["@@iterator"]||i&&p[i],m=!ac&&f||d(i),_="Array"===t&&p.entries||f;if(_&&(s=ec(_.call(new e)))!==Object.prototype&&s.next&&(tc(s,u,!0,!0),rc[u]=uc),oc&&i===lc&&f&&f.name!==lc&&(h=!0,m=function(){return Zs(f,this)}),i)if(c={values:d(lc),keys:o?m:d(cc),entries:d(dc)},a)for(l in c)(ac||h||!(l in p))&&nc(p,l,c[l]);else Qs({target:t,proto:!0,forced:ac||h},c);return a&&p[sc]!==m&&nc(p,sc,m,{name:i}),rc[t]=m,c},pc=function(e,t){return{value:e,done:t}},fc=Q,mc=Jo,_c=_s;$t.f;var gc=hc,vc=pc,yc="Array Iterator",bc=_c.set,Ec=_c.getterFor(yc);gc(Array,"Array",(function(e,t){bc(this,{type:yc,target:fc(e),index:0,kind:t})}),(function(){var e=Ec(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,vc(void 0,!0);switch(e.kind){case"keys":return vc(n,!1);case"values":return vc(t[n],!1)}return vc([n,t[n]],!1)}),"values"),mc.Arguments=mc.Array;var Sc=$t,Tc=function(e,t,n){return Sc.f(e,t,n)},wc=oe,Cc=Tc,Rc=I,kc=ft("species"),Oc=u,Ic=TypeError,Nc=function(e,t){if(Oc(t,e))return e;throw new Ic("Incorrect invocation")},Ac=k,xc=Ke,Pc=d(Function.toString);Ac(xc.inspectSource)||(xc.inspectSource=function(e){return Pc(e)});var Dc=xc.inspectSource,Lc=d,Mc=i,jc=k,Uc=_r,Vc=Dc,Fc=function(){},Bc=oe("Reflect","construct"),Wc=/^\s*(?:class|function)\b/,Gc=Lc(Wc.exec),Hc=!Wc.test(Fc),zc=function(e){if(!jc(e))return!1;try{return Bc(Fc,[],e),!0}catch(e){return!1}},Kc=function(e){if(!jc(e))return!1;switch(Uc(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Hc||!!Gc(Wc,Vc(e))}catch(e){return!0}};Kc.sham=!0;var qc,Yc,Jc,Xc,Qc=!Bc||Mc((function(){var e;return zc(zc.call)||!zc(Object)||!zc((function(){e=!0}))||e}))?Kc:zc,Zc=Qc,$c=ke,el=TypeError,tl=on,nl=function(e){if(Zc(e))return e;throw new el($c(e)+" is not a constructor")},rl=z,il=ft("species"),ol=function(e,t){var n,r=tl(e).constructor;return void 0===r||rl(n=tl(r)[il])?t:nl(n)},al=d([].slice),sl=TypeError,cl=function(e,t){if(e<t)throw new sl("Not enough arguments");return e},ll=/(?:ipad|iphone|ipod).*applewebkit/i.test(ce),dl=p,ul=v,hl=Zt,pl=k,fl=et,ml=i,_l=Eo,gl=al,vl=Ot,yl=cl,bl=ll,El=Xr,Sl=dl.setImmediate,Tl=dl.clearImmediate,wl=dl.process,Cl=dl.Dispatch,Rl=dl.Function,kl=dl.MessageChannel,Ol=dl.String,Il=0,Nl={},Al="onreadystatechange";ml((function(){qc=dl.location}));var xl=function(e){if(fl(Nl,e)){var t=Nl[e];delete Nl[e],t()}},Pl=function(e){return function(){xl(e)}},Dl=function(e){xl(e.data)},Ll=function(e){dl.postMessage(Ol(e),qc.protocol+"//"+qc.host)};Sl&&Tl||(Sl=function(e){yl(arguments.length,1);var t=pl(e)?e:Rl(e),n=gl(arguments,1);return Nl[++Il]=function(){ul(t,void 0,n)},Yc(Il),Il},Tl=function(e){delete Nl[e]},El?Yc=function(e){wl.nextTick(Pl(e))}:Cl&&Cl.now?Yc=function(e){Cl.now(Pl(e))}:kl&&!bl?(Xc=(Jc=new kl).port2,Jc.port1.onmessage=Dl,Yc=hl(Xc.postMessage,Xc)):dl.addEventListener&&pl(dl.postMessage)&&!dl.importScripts&&qc&&"file:"!==qc.protocol&&!ml(Ll)?(Yc=Ll,dl.addEventListener("message",Dl,!1)):Yc=Al in vl("script")?function(e){_l.appendChild(vl("script"))[Al]=function(){_l.removeChild(this),xl(e)}}:function(e){setTimeout(Pl(e),0)});var Ml={set:Sl,clear:Tl},jl=p,Ul=I,Vl=Object.getOwnPropertyDescriptor,Fl=function(e){if(!Ul)return jl[e];var t=Vl(jl,e);return t&&t.value},Bl=function(){this.head=null,this.tail=null};Bl.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var Wl,Gl,Hl,zl,Kl,ql=Bl,Yl=/ipad|iphone|ipod/i.test(ce)&&"undefined"!=typeof Pebble,Jl=/web0s(?!.*chrome)/i.test(ce),Xl=p,Ql=Fl,Zl=Zt,$l=Ml.set,ed=ql,td=ll,nd=Yl,rd=Jl,id=Xr,od=Xl.MutationObserver||Xl.WebKitMutationObserver,ad=Xl.document,sd=Xl.process,cd=Xl.Promise,ld=Ql("queueMicrotask");if(!ld){var dd=new ed,ud=function(){var e,t;for(id&&(e=sd.domain)&&e.exit();t=dd.get();)try{t()}catch(e){throw dd.head&&Wl(),e}e&&e.enter()};td||id||rd||!od||!ad?!nd&&cd&&cd.resolve?((zl=cd.resolve(void 0)).constructor=cd,Kl=Zl(zl.then,zl),Wl=function(){Kl(ud)}):id?Wl=function(){sd.nextTick(ud)}:($l=Zl($l,Xl),Wl=function(){$l(ud)}):(Gl=!0,Hl=ad.createTextNode(""),new od(ud).observe(Hl,{characterData:!0}),Wl=function(){Hl.data=Gl=!Gl}),ld=function(e){dd.head||Wl(),dd.add(e)}}var hd=ld,pd=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},fd=p.Promise,md=p,_d=fd,gd=k,vd=Yt,yd=Dc,bd=ft,Ed=Jr,Sd=me,Td=_d&&_d.prototype,wd=bd("species"),Cd=!1,Rd=gd(md.PromiseRejectionEvent),kd=vd("Promise",(function(){var e=yd(_d),t=e!==String(_d);if(!t&&66===Sd)return!0;if(!Td.catch||!Td.finally)return!0;if(!Sd||Sd<51||!/native code/.test(e)){var n=new _d((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[wd]=r,!(Cd=n.then((function(){}))instanceof r))return!0}return!(t||"BROWSER"!==Ed&&"DENO"!==Ed||Rd)})),Od={CONSTRUCTOR:kd,REJECTION_EVENT:Rd,SUBCLASSING:Cd},Id={},Nd=Ae,Ad=TypeError,xd=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw new Ad("Bad Promise constructor");t=e,n=r})),this.resolve=Nd(t),this.reject=Nd(n)};Id.f=function(e){return new xd(e)};var Pd,Dd,Ld=An,Md=Xr,jd=p,Ud=x,Vd=ws,Fd=Gs,Bd=function(e){var t=wc(e);Rc&&t&&!t[kc]&&Cc(t,kc,{configurable:!0,get:function(){return this}})},Wd=Ae,Gd=k,Hd=$,zd=Nc,Kd=ol,qd=Ml.set,Yd=hd,Jd=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}},Xd=pd,Qd=ql,Zd=_s,$d=fd,eu=Od,tu=Id,nu="Promise",ru=eu.CONSTRUCTOR,iu=eu.REJECTION_EVENT,ou=Zd.getterFor(nu),au=Zd.set,su=$d&&$d.prototype,cu=$d,lu=su,du=jd.TypeError,uu=jd.document,hu=jd.process,pu=tu.f,fu=pu,mu=!!(uu&&uu.createEvent&&jd.dispatchEvent),_u="unhandledrejection",gu=function(e){var t;return!(!Hd(e)||!Gd(t=e.then))&&t},vu=function(e,t){var n,r,i,o=t.value,a=1===t.state,s=a?e.ok:e.fail,c=e.resolve,l=e.reject,d=e.domain;try{s?(a||(2===t.rejection&&Tu(t),t.rejection=1),!0===s?n=o:(d&&d.enter(),n=s(o),d&&(d.exit(),i=!0)),n===e.promise?l(new du("Promise-chain cycle")):(r=gu(n))?Ud(r,n,c,l):c(n)):l(o)}catch(e){d&&!i&&d.exit(),l(e)}},yu=function(e,t){e.notified||(e.notified=!0,Yd((function(){for(var n,r=e.reactions;n=r.get();)vu(n,e);e.notified=!1,t&&!e.rejection&&Eu(e)})))},bu=function(e,t,n){var r,i;mu?((r=uu.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),jd.dispatchEvent(r)):r={promise:t,reason:n},!iu&&(i=jd["on"+e])?i(r):e===_u&&Jd("Unhandled promise rejection",n)},Eu=function(e){Ud(qd,jd,(function(){var t,n=e.facade,r=e.value;if(Su(e)&&(t=Xd((function(){Md?hu.emit("unhandledRejection",r,n):bu(_u,n,r)})),e.rejection=Md||Su(e)?2:1,t.error))throw t.value}))},Su=function(e){return 1!==e.rejection&&!e.parent},Tu=function(e){Ud(qd,jd,(function(){var t=e.facade;Md?hu.emit("rejectionHandled",t):bu("rejectionhandled",t,e.value)}))},wu=function(e,t,n){return function(r){e(t,r,n)}},Cu=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,yu(e,!0))},Ru=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new du("Promise can't be resolved itself");var r=gu(t);r?Yd((function(){var n={done:!1};try{Ud(r,t,wu(Ru,n,e),wu(Cu,n,e))}catch(t){Cu(n,t,e)}})):(e.value=t,e.state=1,yu(e,!1))}catch(t){Cu({done:!1},t,e)}}};ru&&(lu=(cu=function(e){zd(this,lu),Wd(e),Ud(Pd,this);var t=ou(this);try{e(wu(Ru,t),wu(Cu,t))}catch(e){Cu(t,e)}}).prototype,(Pd=function(e){au(this,{type:nu,done:!1,notified:!1,parent:!1,reactions:new Qd,rejection:!1,state:0,value:null})}).prototype=Vd(lu,"then",(function(e,t){var n=ou(this),r=pu(Kd(this,cu));return n.parent=!0,r.ok=!Gd(e)||e,r.fail=Gd(t)&&t,r.domain=Md?hu.domain:void 0,0===n.state?n.reactions.add(r):Yd((function(){vu(r,n)})),r.promise})),Dd=function(){var e=new Pd,t=ou(e);this.promise=e,this.resolve=wu(Ru,t),this.reject=wu(Cu,t)},tu.f=pu=function(e){return e===cu||void 0===e?new Dd(e):fu(e)}),Ld({global:!0,constructor:!0,wrap:!0,forced:ru},{Promise:cu}),Fd(cu,nu,!1,!0),Bd(nu);var ku=ft("iterator"),Ou=!1;try{var Iu=0,Nu={next:function(){return{done:!!Iu++}},return:function(){Ou=!0}};Nu[ku]=function(){return this},Array.from(Nu,(function(){throw 2}))}catch(e){}var Au=fd,xu=function(e,t){try{if(!t&&!Ou)return!1}catch(e){return!1}var n=!1;try{var r={};r[ku]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Pu=Od.CONSTRUCTOR||!xu((function(e){Au.all(e).then(void 0,(function(){}))})),Du=x,Lu=Ae,Mu=Id,ju=pd,Uu=Na;An({target:"Promise",stat:!0,forced:Pu},{all:function(e){var t=this,n=Mu.f(t),r=n.resolve,i=n.reject,o=ju((function(){var n=Lu(t.resolve),o=[],a=0,s=1;Uu(e,(function(e){var c=a++,l=!1;s++,Du(n,t,e).then((function(e){l||(l=!0,o[c]=e,--s||r(o))}),i)})),--s||r(o)}));return o.error&&i(o.value),n.promise}});var Vu=An,Fu=Od.CONSTRUCTOR;fd&&fd.prototype,Vu({target:"Promise",proto:!0,forced:Fu,real:!0},{catch:function(e){return this.then(void 0,e)}});var Bu=x,Wu=Ae,Gu=Id,Hu=pd,zu=Na;An({target:"Promise",stat:!0,forced:Pu},{race:function(e){var t=this,n=Gu.f(t),r=n.reject,i=Hu((function(){var i=Wu(t.resolve);zu(e,(function(e){Bu(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Ku=Id;An({target:"Promise",stat:!0,forced:Od.CONSTRUCTOR},{reject:function(e){var t=Ku.f(this);return(0,t.reject)(e),t.promise}});var qu=on,Yu=$,Ju=Id,Xu=function(e,t){if(qu(e),Yu(t)&&t.constructor===e)return t;var n=Ju.f(e);return(0,n.resolve)(t),n.promise},Qu=An,Zu=fd,$u=Od.CONSTRUCTOR,eh=Xu,th=oe("Promise"),nh=!$u;Qu({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return eh(nh&&this===th?Zu:this,e)}});var rh=x,ih=Ae,oh=Id,ah=pd,sh=Na;An({target:"Promise",stat:!0,forced:Pu},{allSettled:function(e){var t=this,n=oh.f(t),r=n.resolve,i=n.reject,o=ah((function(){var n=ih(t.resolve),i=[],o=0,a=1;sh(e,(function(e){var s=o++,c=!1;a++,rh(n,t,e).then((function(e){c||(c=!0,i[s]={status:"fulfilled",value:e},--a||r(i))}),(function(e){c||(c=!0,i[s]={status:"rejected",reason:e},--a||r(i))}))})),--a||r(i)}));return o.error&&i(o.value),n.promise}});var ch=x,lh=Ae,dh=oe,uh=Id,hh=pd,ph=Na,fh="No one promise resolved";An({target:"Promise",stat:!0,forced:Pu},{any:function(e){var t=this,n=dh("AggregateError"),r=uh.f(t),i=r.resolve,o=r.reject,a=hh((function(){var r=lh(t.resolve),a=[],s=0,c=1,l=!1;ph(e,(function(e){var d=s++,u=!1;c++,ch(r,t,e).then((function(e){u||l||(l=!0,i(e))}),(function(e){u||l||(u=!0,a[d]=e,--c||o(new n(a,fh)))}))})),--c||o(new n(a,fh))}));return a.error&&o(a.value),r.promise}});var mh=An,_h=v,gh=al,vh=Id,yh=Ae,bh=pd,Eh=p.Promise,Sh=!1;mh({target:"Promise",stat:!0,forced:!Eh||!Eh.try||bh((function(){Eh.try((function(e){Sh=8===e}),8)})).error||!Sh},{try:function(e){var t=arguments.length>1?gh(arguments,1):[],n=vh.f(this),r=bh((function(){return _h(yh(e),void 0,t)}));return(r.error?n.reject:n.resolve)(r.value),n.promise}});var Th=Id;An({target:"Promise",stat:!0},{withResolvers:function(){var e=Th.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var wh=An,Ch=fd,Rh=i,kh=oe,Oh=k,Ih=ol,Nh=Xu,Ah=Ch&&Ch.prototype;wh({target:"Promise",proto:!0,real:!0,forced:!!Ch&&Rh((function(){Ah.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=Ih(this,kh("Promise")),n=Oh(e);return this.then(n?function(n){return Nh(t,e()).then((function(){return n}))}:e,n?function(n){return Nh(t,e()).then((function(){throw n}))}:e)}});var xh=d,Ph=Mn,Dh=yr,Lh=Y,Mh=xh("".charAt),jh=xh("".charCodeAt),Uh=xh("".slice),Vh=function(e){return function(t,n){var r,i,o=Dh(Lh(t)),a=Ph(n),s=o.length;return a<0||a>=s?e?"":void 0:(r=jh(o,a))<55296||r>56319||a+1===s||(i=jh(o,a+1))<56320||i>57343?e?Mh(o,a):r:e?Uh(o,a,a+2):i-56320+(r-55296<<10)+65536}},Fh={codeAt:Vh(!1),charAt:Vh(!0)},Bh=Fh.charAt,Wh=yr,Gh=_s,Hh=hc,zh=pc,Kh="String Iterator",qh=Gh.set,Yh=Gh.getterFor(Kh);Hh(String,"String",(function(e){qh(this,{type:Kh,string:Wh(e),index:0})}),(function(){var e,t=Yh(this),n=t.string,r=t.index;return r>=n.length?zh(void 0,!0):(e=Bh(n,r),t.index+=e.length,zh(e,!1))}));var Jh=ee.Promise,Xh={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Qh=p,Zh=Gs,$h=Jo;for(var ep in Xh)Zh(Qh[ep],ep),$h[ep]=$h.Array;var tp=Jh,np=r(tp),rp=er("Array","values"),ip=_r,op=et,ap=u,sp=rp,cp=Array.prototype,lp={DOMTokenList:!0,NodeList:!0},dp=function(e){var t=e.values;return e===cp||ap(cp,e)&&t===cp.values||op(lp,ip(e))?sp:t},up=r(dp),hp=ke,pp=TypeError,fp=al,mp=Math.floor,_p=function(e,t){var n=e.length;if(n<8)for(var r,i,o=1;o<n;){for(i=o,r=e[o];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==o++&&(e[i]=r)}else for(var a=mp(n/2),s=_p(fp(e,0,a),t),c=_p(fp(e,a),t),l=s.length,d=c.length,u=0,h=0;u<l||h<d;)e[u+h]=u<l&&h<d?t(s[u],c[h])<=0?s[u++]:c[h++]:u<l?s[u++]:c[h++];return e},gp=_p,vp=ce.match(/firefox\/(\d+)/i),yp=!!vp&&+vp[1],bp=/MSIE|Trident/.test(ce),Ep=ce.match(/AppleWebKit\/(\d+)\./),Sp=!!Ep&&+Ep[1],Tp=An,wp=d,Cp=Ae,Rp=Qe,kp=zn,Op=function(e,t){if(!delete e[t])throw new pp("Cannot delete property "+hp(t)+" of "+hp(e))},Ip=yr,Np=i,Ap=gp,xp=Hr,Pp=yp,Dp=bp,Lp=me,Mp=Sp,jp=[],Up=wp(jp.sort),Vp=wp(jp.push),Fp=Np((function(){jp.sort(void 0)})),Bp=Np((function(){jp.sort(null)})),Wp=xp("sort"),Gp=!Np((function(){if(Lp)return Lp<70;if(!(Pp&&Pp>3)){if(Dp)return!0;if(Mp)return Mp<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)jp.push({k:t+r,v:n})}for(jp.sort((function(e,t){return t.v-e.v})),r=0;r<jp.length;r++)t=jp[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));Tp({target:"Array",proto:!0,forced:Fp||!Bp||!Wp||!Gp},{sort:function(e){void 0!==e&&Cp(e);var t=Rp(this);if(Gp)return void 0===e?Up(t):Up(t,e);var n,r,i=[],o=kp(t);for(r=0;r<o;r++)r in t&&Vp(i,t[r]);for(Ap(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Ip(t)>Ip(n)?1:-1}}(e)),n=kp(i),r=0;r<n;)t[r]=i[r++];for(;r<o;)Op(t,r++);return t}});var Hp=er("Array","sort"),zp=u,Kp=Hp,qp=Array.prototype,Yp=function(e){var t=e.sort;return e===qp||zp(qp,e)&&t===qp.sort?Kp:t},Jp=r(Yp),Xp=An,Qp=d,Zp=Fn,$p=RangeError,ef=String.fromCharCode,tf=String.fromCodePoint,nf=Qp([].join);Xp({target:"String",stat:!0,arity:1,forced:!!tf&&1!==tf.length},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],Zp(t,1114111)!==t)throw new $p(t+" is not a valid code point");n[i]=t<65536?ef(t):ef(55296+((t-=65536)>>10),t%1024+56320)}return nf(n,"")}});var rf=i,of=ft("iterator"),af=!rf((function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[of]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("https://a#\u0431").hash||"a1c3"!==r||"x"!==new URL("https://x",void 0).host})),sf=ws,cf=An,lf=p,df=Fl,uf=oe,hf=x,pf=d,ff=I,mf=af,_f=ws,gf=Tc,vf=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:sf(e,r,t[r],n);return e},yf=Gs,bf=Xs,Ef=_s,Sf=Nc,Tf=k,wf=et,Cf=Zt,Rf=_r,kf=on,Of=$,If=yr,Nf=Lo,Af=V,xf=ha,Pf=oa,Df=pc,Lf=cl,Mf=gp,jf=ft("iterator"),Uf="URLSearchParams",Vf=Uf+"Iterator",Ff=Ef.set,Bf=Ef.getterFor(Uf),Wf=Ef.getterFor(Vf),Gf=df("fetch"),Hf=df("Request"),zf=df("Headers"),Kf=Hf&&Hf.prototype,qf=zf&&zf.prototype,Yf=lf.TypeError,Jf=lf.encodeURIComponent,Xf=String.fromCharCode,Qf=uf("String","fromCodePoint"),Zf=parseInt,$f=pf("".charAt),em=pf([].join),tm=pf([].push),nm=pf("".replace),rm=pf([].shift),im=pf([].splice),om=pf("".split),am=pf("".slice),sm=pf(/./.exec),cm=/\+/g,lm=/^[0-9a-f]+$/i,dm=function(e,t){var n=am(e,t,t+2);return sm(lm,n)?Zf(n,16):NaN},um=function(e){for(var t=0,n=128;n>0&&0!=(e&n);n>>=1)t++;return t},hm=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},pm=function(e){for(var t=(e=nm(e,cm," ")).length,n="",r=0;r<t;){var i=$f(e,r);if("%"===i){if("%"===$f(e,r+1)||r+3>t){n+="%",r++;continue}var o=dm(e,r+1);if(o!=o){n+=i,r++;continue}r+=2;var a=um(o);if(0===a)i=Xf(o);else{if(1===a||a>4){n+="\ufffd",r++;continue}for(var s=[o],c=1;c<a&&!(3+ ++r>t||"%"!==$f(e,r));){var l=dm(e,r+1);if(l!=l){r+=3;break}if(l>191||l<128)break;tm(s,l),r+=2,c++}if(s.length!==a){n+="\ufffd";continue}var d=hm(s);null===d?n+="\ufffd":i=Qf(d)}}n+=i,r++}return n},fm=/[!'()~]|%20/g,mm={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},_m=function(e){return mm[e]},gm=function(e){return nm(Jf(e),fm,_m)},vm=bf((function(e,t){Ff(this,{type:Vf,target:Bf(e).entries,index:0,kind:t})}),Uf,(function(){var e=Wf(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Df(void 0,!0);var r=t[n];switch(e.kind){case"keys":return Df(r.key,!1);case"values":return Df(r.value,!1)}return Df([r.key,r.value],!1)}),!0),ym=function(e){this.entries=[],this.url=null,void 0!==e&&(Of(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===$f(e,0)?am(e,1):e:If(e)))};ym.prototype={type:Uf,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,o,a,s,c=this.entries,l=Pf(e);if(l)for(n=(t=xf(e,l)).next;!(r=hf(n,t)).done;){if(o=(i=xf(kf(r.value))).next,(a=hf(o,i)).done||(s=hf(o,i)).done||!hf(o,i).done)throw new Yf("Expected sequence with length 2");tm(c,{key:If(a.value),value:If(s.value)})}else for(var d in e)wf(e,d)&&tm(c,{key:d,value:If(e[d])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=om(e,"&"),o=0;o<i.length;)(t=i[o++]).length&&(n=om(t,"="),tm(r,{key:pm(rm(n)),value:pm(em(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],tm(n,gm(e.key)+"="+gm(e.value));return em(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var bm=function(){Sf(this,Em);var e=Ff(this,new ym(arguments.length>0?arguments[0]:void 0));ff||(this.size=e.entries.length)},Em=bm.prototype;if(vf(Em,{append:function(e,t){var n=Bf(this);Lf(arguments.length,2),tm(n.entries,{key:If(e),value:If(t)}),ff||this.length++,n.updateURL()},delete:function(e){for(var t=Bf(this),n=Lf(arguments.length,1),r=t.entries,i=If(e),o=n<2?void 0:arguments[1],a=void 0===o?o:If(o),s=0;s<r.length;){var c=r[s];if(c.key!==i||void 0!==a&&c.value!==a)s++;else if(im(r,s,1),void 0!==a)break}ff||(this.size=r.length),t.updateURL()},get:function(e){var t=Bf(this).entries;Lf(arguments.length,1);for(var n=If(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Bf(this).entries;Lf(arguments.length,1);for(var n=If(e),r=[],i=0;i<t.length;i++)t[i].key===n&&tm(r,t[i].value);return r},has:function(e){for(var t=Bf(this).entries,n=Lf(arguments.length,1),r=If(e),i=n<2?void 0:arguments[1],o=void 0===i?i:If(i),a=0;a<t.length;){var s=t[a++];if(s.key===r&&(void 0===o||s.value===o))return!0}return!1},set:function(e,t){var n=Bf(this);Lf(arguments.length,1);for(var r,i=n.entries,o=!1,a=If(e),s=If(t),c=0;c<i.length;c++)(r=i[c]).key===a&&(o?im(i,c--,1):(o=!0,r.value=s));o||tm(i,{key:a,value:s}),ff||(this.size=i.length),n.updateURL()},sort:function(){var e=Bf(this);Mf(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=Bf(this).entries,r=Cf(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new vm(this,"keys")},values:function(){return new vm(this,"values")},entries:function(){return new vm(this,"entries")}},{enumerable:!0}),_f(Em,jf,Em.entries,{name:"entries"}),_f(Em,"toString",(function(){return Bf(this).serialize()}),{enumerable:!0}),ff&&gf(Em,"size",{get:function(){return Bf(this).entries.length},configurable:!0,enumerable:!0}),yf(bm,Uf),cf({global:!0,constructor:!0,forced:!mf},{URLSearchParams:bm}),!mf&&Tf(zf)){var Sm=pf(qf.has),Tm=pf(qf.set),wm=function(e){if(Of(e)){var t,n=e.body;if(Rf(n)===Uf)return t=e.headers?new zf(e.headers):new zf,Sm(t,"content-type")||Tm(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Nf(e,{body:Af(0,If(n)),headers:Af(0,t)})}return e};if(Tf(Gf)&&cf({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Gf(e,arguments.length>1?wm(arguments[1]):{})}}),Tf(Hf)){var Cm=function(e){return Sf(this,Kf),new Hf(e,arguments.length>1?wm(arguments[1]):{})};Kf.constructor=Cm,Cm.prototype=Kf,cf({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Cm})}}var Rm,km={URLSearchParams:bm,getState:Bf},Om=ee.URLSearchParams,Im=I,Nm=d,Am=x,xm=i,Pm=po,Dm=Zi,Lm=P,Mm=Qe,jm=H,Um=Object.assign,Vm=Object.defineProperty,Fm=Nm([].concat),Bm=!Um||xm((function(){if(Im&&1!==Um({b:1},Um(Vm({},"a",{enumerable:!0,get:function(){Vm(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!==Um({},e)[n]||Pm(Um({},t)).join("")!==r}))?function(e,t){for(var n=Mm(e),r=arguments.length,i=1,o=Dm.f,a=Lm.f;r>i;)for(var s,c=jm(arguments[i++]),l=o?Fm(Pm(c),o(c)):Pm(c),d=l.length,u=0;d>u;)s=l[u++],Im&&!Am(a,c,s)||(n[s]=c[s]);return n}:Um,Wm=on,Gm=_a,Hm=I,zm=$t,Km=V,qm=function(e,t,n){Hm?zm.f(e,t,Km(0,n)):e[t]=n},Ym=Zt,Jm=x,Xm=Qe,Qm=function(e,t,n,r){try{return r?t(Wm(n)[0],n[1]):t(n)}catch(t){Gm(e,"throw",t)}},Zm=$o,$m=Qc,e_=zn,t_=qm,n_=ha,r_=oa,i_=Array,o_=d,a_=2147483647,s_=/[^\0-\u007E]/,c_=/[.\u3002\uFF0E\uFF61]/g,l_="Overflow: input needs wider integers to process",d_=RangeError,u_=o_(c_.exec),h_=Math.floor,p_=String.fromCharCode,f_=o_("".charCodeAt),m_=o_([].join),__=o_([].push),g_=o_("".replace),v_=o_("".split),y_=o_("".toLowerCase),b_=function(e){return e+22+75*(e<26)},E_=function(e,t,n){var r=0;for(e=n?h_(e/700):e>>1,e+=h_(e/t);e>455;)e=h_(e/35),r+=36;return h_(r+36*e/(e+38))},S_=function(e){var t=[];e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=f_(e,n++);if(i>=55296&&i<=56319&&n<r){var o=f_(e,n++);56320==(64512&o)?__(t,((1023&i)<<10)+(1023&o)+65536):(__(t,i),n--)}else __(t,i)}return t}(e);var n,r,i=e.length,o=128,a=0,s=72;for(n=0;n<e.length;n++)(r=e[n])<128&&__(t,p_(r));var c=t.length,l=c;for(c&&__(t,"-");l<i;){var d=a_;for(n=0;n<e.length;n++)(r=e[n])>=o&&r<d&&(d=r);var u=l+1;if(d-o>h_((a_-a)/u))throw new d_(l_);for(a+=(d-o)*u,o=d,n=0;n<e.length;n++){if((r=e[n])<o&&++a>a_)throw new d_(l_);if(r===o){for(var h=a,p=36;;){var f=p<=s?1:p>=s+26?26:p-s;if(h<f)break;var m=h-f,_=36-f;__(t,p_(b_(f+m%_))),h=h_(m/_),p+=36}__(t,p_(b_(h))),s=E_(a,u,l===c),a=0,l++}}a++,o++}return m_(t,"")},T_=An,w_=I,C_=af,R_=p,k_=Zt,O_=d,I_=ws,N_=Tc,A_=Nc,x_=et,P_=Bm,D_=function(e){var t=Xm(e),n=$m(this),r=arguments.length,i=r>1?arguments[1]:void 0,o=void 0!==i;o&&(i=Ym(i,r>2?arguments[2]:void 0));var a,s,c,l,d,u,h=r_(t),p=0;if(!h||this===i_&&Zm(h))for(a=e_(t),s=n?new this(a):i_(a);a>p;p++)u=o?i(t[p],p):t[p],t_(s,p,u);else for(s=n?new this:[],d=(l=n_(t,h)).next;!(c=Jm(d,l)).done;p++)u=o?Qm(l,i,[c.value,p],!0):c.value,t_(s,p,u);return s.length=p,s},L_=al,M_=Fh.codeAt,j_=function(e){var t,n,r=[],i=v_(g_(y_(e),c_,"."),".");for(t=0;t<i.length;t++)n=i[t],__(r,u_(s_,n)?"xn--"+S_(n):n);return m_(r,".")},U_=yr,V_=Gs,F_=cl,B_=km,W_=_s,G_=W_.set,H_=W_.getterFor("URL"),z_=B_.URLSearchParams,K_=B_.getState,q_=R_.URL,Y_=R_.TypeError,J_=R_.parseInt,X_=Math.floor,Q_=Math.pow,Z_=O_("".charAt),$_=O_(/./.exec),eg=O_([].join),tg=O_(1..toString),ng=O_([].pop),rg=O_([].push),ig=O_("".replace),og=O_([].shift),ag=O_("".split),sg=O_("".slice),cg=O_("".toLowerCase),lg=O_([].unshift),dg="Invalid scheme",ug="Invalid host",hg="Invalid port",pg=/[a-z]/i,fg=/[\d+-.a-z]/i,mg=/\d/,_g=/^0x/i,gg=/^[0-7]+$/,vg=/^\d+$/,yg=/^[\da-f]+$/i,bg=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Eg=/[\0\t\n\r #/:<>?@[\\\]^|]/,Sg=/^[\u0000-\u0020]+/,Tg=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,wg=/[\t\n\r]/g,Cg=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)lg(t,e%256),e=X_(e/256);return eg(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,o=0;o<8;o++)0!==e[o]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=o),++i);return i>n?r:t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=tg(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},Rg={},kg=P_({},Rg,{" ":1,'"':1,"<":1,">":1,"`":1}),Og=P_({},kg,{"#":1,"?":1,"{":1,"}":1}),Ig=P_({},Og,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Ng=function(e,t){var n=M_(e,0);return n>32&&n<127&&!x_(t,e)?e:encodeURIComponent(e)},Ag={ftp:21,file:null,http:80,https:443,ws:80,wss:443},xg=function(e,t){var n;return 2===e.length&&$_(pg,Z_(e,0))&&(":"===(n=Z_(e,1))||!t&&"|"===n)},Pg=function(e){var t;return e.length>1&&xg(sg(e,0,2))&&(2===e.length||"/"===(t=Z_(e,2))||"\\"===t||"?"===t||"#"===t)},Dg=function(e){return"."===e||"%2e"===cg(e)},Lg={},Mg={},jg={},Ug={},Vg={},Fg={},Bg={},Wg={},Gg={},Hg={},zg={},Kg={},qg={},Yg={},Jg={},Xg={},Qg={},Zg={},$g={},ev={},tv={},nv=function(e,t,n){var r,i,o,a=U_(e);if(t){if(i=this.parse(a))throw new Y_(i);this.searchParams=null}else{if(void 0!==n&&(r=new nv(n,!0)),i=this.parse(a,null,r))throw new Y_(i);(o=K_(new z_)).bindURL(this),this.searchParams=o}};nv.prototype={type:"URL",parse:function(e,t,n){var r,i,o,a,s,c=this,l=t||Lg,d=0,u="",h=!1,p=!1,f=!1;for(e=U_(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=ig(e,Sg,""),e=ig(e,Tg,"$1")),e=ig(e,wg,""),r=D_(e);d<=r.length;){switch(i=r[d],l){case Lg:if(!i||!$_(pg,i)){if(t)return dg;l=jg;continue}u+=cg(i),l=Mg;break;case Mg:if(i&&($_(fg,i)||"+"===i||"-"===i||"."===i))u+=cg(i);else{if(":"!==i){if(t)return dg;u="",l=jg,d=0;continue}if(t&&(c.isSpecial()!==x_(Ag,u)||"file"===u&&(c.includesCredentials()||null!==c.port)||"file"===c.scheme&&!c.host))return;if(c.scheme=u,t)return void(c.isSpecial()&&Ag[c.scheme]===c.port&&(c.port=null));u="","file"===c.scheme?l=Yg:c.isSpecial()&&n&&n.scheme===c.scheme?l=Ug:c.isSpecial()?l=Wg:"/"===r[d+1]?(l=Vg,d++):(c.cannotBeABaseURL=!0,rg(c.path,""),l=$g)}break;case jg:if(!n||n.cannotBeABaseURL&&"#"!==i)return dg;if(n.cannotBeABaseURL&&"#"===i){c.scheme=n.scheme,c.path=L_(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,l=tv;break}l="file"===n.scheme?Yg:Fg;continue;case Ug:if("/"!==i||"/"!==r[d+1]){l=Fg;continue}l=Gg,d++;break;case Vg:if("/"===i){l=Hg;break}l=Zg;continue;case Fg:if(c.scheme=n.scheme,i===Rm)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=L_(n.path),c.query=n.query;else if("/"===i||"\\"===i&&c.isSpecial())l=Bg;else if("?"===i)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=L_(n.path),c.query="",l=ev;else{if("#"!==i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=L_(n.path),c.path.length--,l=Zg;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=L_(n.path),c.query=n.query,c.fragment="",l=tv}break;case Bg:if(!c.isSpecial()||"/"!==i&&"\\"!==i){if("/"!==i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,l=Zg;continue}l=Hg}else l=Gg;break;case Wg:if(l=Gg,"/"!==i||"/"!==Z_(u,d+1))continue;d++;break;case Gg:if("/"!==i&&"\\"!==i){l=Hg;continue}break;case Hg:if("@"===i){h&&(u="%40"+u),h=!0,o=D_(u);for(var m=0;m<o.length;m++){var _=o[m];if(":"!==_||f){var g=Ng(_,Ig);f?c.password+=g:c.username+=g}else f=!0}u=""}else if(i===Rm||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()){if(h&&""===u)return"Invalid authority";d-=D_(u).length+1,u="",l=zg}else u+=i;break;case zg:case Kg:if(t&&"file"===c.scheme){l=Xg;continue}if(":"!==i||p){if(i===Rm||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()){if(c.isSpecial()&&""===u)return ug;if(t&&""===u&&(c.includesCredentials()||null!==c.port))return;if(a=c.parseHost(u))return a;if(u="",l=Qg,t)return;continue}"["===i?p=!0:"]"===i&&(p=!1),u+=i}else{if(""===u)return ug;if(a=c.parseHost(u))return a;if(u="",l=qg,t===Kg)return}break;case qg:if(!$_(mg,i)){if(i===Rm||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()||t){if(""!==u){var v=J_(u,10);if(v>65535)return hg;c.port=c.isSpecial()&&v===Ag[c.scheme]?null:v,u=""}if(t)return;l=Qg;continue}return hg}u+=i;break;case Yg:if(c.scheme="file","/"===i||"\\"===i)l=Jg;else{if(!n||"file"!==n.scheme){l=Zg;continue}switch(i){case Rm:c.host=n.host,c.path=L_(n.path),c.query=n.query;break;case"?":c.host=n.host,c.path=L_(n.path),c.query="",l=ev;break;case"#":c.host=n.host,c.path=L_(n.path),c.query=n.query,c.fragment="",l=tv;break;default:Pg(eg(L_(r,d),""))||(c.host=n.host,c.path=L_(n.path),c.shortenPath()),l=Zg;continue}}break;case Jg:if("/"===i||"\\"===i){l=Xg;break}n&&"file"===n.scheme&&!Pg(eg(L_(r,d),""))&&(xg(n.path[0],!0)?rg(c.path,n.path[0]):c.host=n.host),l=Zg;continue;case Xg:if(i===Rm||"/"===i||"\\"===i||"?"===i||"#"===i){if(!t&&xg(u))l=Zg;else if(""===u){if(c.host="",t)return;l=Qg}else{if(a=c.parseHost(u))return a;if("localhost"===c.host&&(c.host=""),t)return;u="",l=Qg}continue}u+=i;break;case Qg:if(c.isSpecial()){if(l=Zg,"/"!==i&&"\\"!==i)continue}else if(t||"?"!==i)if(t||"#"!==i){if(i!==Rm&&(l=Zg,"/"!==i))continue}else c.fragment="",l=tv;else c.query="",l=ev;break;case Zg:if(i===Rm||"/"===i||"\\"===i&&c.isSpecial()||!t&&("?"===i||"#"===i)){if(".."===(s=cg(s=u))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(c.shortenPath(),"/"===i||"\\"===i&&c.isSpecial()||rg(c.path,"")):Dg(u)?"/"===i||"\\"===i&&c.isSpecial()||rg(c.path,""):("file"===c.scheme&&!c.path.length&&xg(u)&&(c.host&&(c.host=""),u=Z_(u,0)+":"),rg(c.path,u)),u="","file"===c.scheme&&(i===Rm||"?"===i||"#"===i))for(;c.path.length>1&&""===c.path[0];)og(c.path);"?"===i?(c.query="",l=ev):"#"===i&&(c.fragment="",l=tv)}else u+=Ng(i,Og);break;case $g:"?"===i?(c.query="",l=ev):"#"===i?(c.fragment="",l=tv):i!==Rm&&(c.path[0]+=Ng(i,Rg));break;case ev:t||"#"!==i?i!==Rm&&("'"===i&&c.isSpecial()?c.query+="%27":c.query+="#"===i?"%23":Ng(i,Rg)):(c.fragment="",l=tv);break;case tv:i!==Rm&&(c.fragment+=Ng(i,kg))}d++}},parseHost:function(e){var t,n,r;if("["===Z_(e,0)){if("]"!==Z_(e,e.length-1))return ug;if(t=function(e){var t,n,r,i,o,a,s,c=[0,0,0,0,0,0,0,0],l=0,d=null,u=0,h=function(){return Z_(e,u)};if(":"===h()){if(":"!==Z_(e,1))return;u+=2,d=++l}for(;h();){if(8===l)return;if(":"!==h()){for(t=n=0;n<4&&$_(yg,h());)t=16*t+J_(h(),16),u++,n++;if("."===h()){if(0===n)return;if(u-=n,l>6)return;for(r=0;h();){if(i=null,r>0){if(!("."===h()&&r<4))return;u++}if(!$_(mg,h()))return;for(;$_(mg,h());){if(o=J_(h(),10),null===i)i=o;else{if(0===i)return;i=10*i+o}if(i>255)return;u++}c[l]=256*c[l]+i,2!=++r&&4!==r||l++}if(4!==r)return;break}if(":"===h()){if(u++,!h())return}else if(h())return;c[l++]=t}else{if(null!==d)return;u++,d=++l}}if(null!==d)for(a=l-d,l=7;0!==l&&a>0;)s=c[l],c[l--]=c[d+a-1],c[d+--a]=s;else if(8!==l)return;return c}(sg(e,1,-1)),!t)return ug;this.host=t}else if(this.isSpecial()){if(e=j_(e),$_(bg,e))return ug;if(t=function(e){var t,n,r,i,o,a,s,c=ag(e,".");if(c.length&&""===c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(n=[],r=0;r<t;r++){if(""===(i=c[r]))return e;if(o=10,i.length>1&&"0"===Z_(i,0)&&(o=$_(_g,i)?16:8,i=sg(i,8===o?1:2)),""===i)a=0;else{if(!$_(10===o?vg:8===o?gg:yg,i))return e;a=J_(i,o)}rg(n,a)}for(r=0;r<t;r++)if(a=n[r],r===t-1){if(a>=Q_(256,5-t))return null}else if(a>255)return null;for(s=ng(n),r=0;r<n.length;r++)s+=n[r]*Q_(256,3-r);return s}(e),null===t)return ug;this.host=t}else{if($_(Eg,e))return ug;for(t="",n=D_(e),r=0;r<n.length;r++)t+=Ng(n[r],Rg);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return x_(Ag,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&xg(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,a=e.path,s=e.query,c=e.fragment,l=t+":";return null!==i?(l+="//",e.includesCredentials()&&(l+=n+(r?":"+r:"")+"@"),l+=Cg(i),null!==o&&(l+=":"+o)):"file"===t&&(l+="//"),l+=e.cannotBeABaseURL?a[0]:a.length?"/"+eg(a,"/"):"",null!==s&&(l+="?"+s),null!==c&&(l+="#"+c),l},setHref:function(e){var t=this.parse(e);if(t)throw new Y_(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new rv(e.path[0]).origin}catch(e){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+Cg(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(U_(e)+":",Lg)},getUsername:function(){return this.username},setUsername:function(e){var t=D_(U_(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Ng(t[n],Ig)}},getPassword:function(){return this.password},setPassword:function(e){var t=D_(U_(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Ng(t[n],Ig)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?Cg(e):Cg(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,zg)},getHostname:function(){var e=this.host;return null===e?"":Cg(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Kg)},getPort:function(){var e=this.port;return null===e?"":U_(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=U_(e))?this.port=null:this.parse(e,qg))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+eg(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Qg))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=U_(e))?this.query=null:("?"===Z_(e,0)&&(e=sg(e,1)),this.query="",this.parse(e,ev)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=U_(e))?("#"===Z_(e,0)&&(e=sg(e,1)),this.fragment="",this.parse(e,tv)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var rv=function(e){var t=A_(this,iv),n=F_(arguments.length,1)>1?arguments[1]:void 0,r=G_(t,new nv(e,!1,n));w_||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},iv=rv.prototype,ov=function(e,t){return{get:function(){return H_(this)[e]()},set:t&&function(e){return H_(this)[t](e)},configurable:!0,enumerable:!0}};if(w_&&(N_(iv,"href",ov("serialize","setHref")),N_(iv,"origin",ov("getOrigin")),N_(iv,"protocol",ov("getProtocol","setProtocol")),N_(iv,"username",ov("getUsername","setUsername")),N_(iv,"password",ov("getPassword","setPassword")),N_(iv,"host",ov("getHost","setHost")),N_(iv,"hostname",ov("getHostname","setHostname")),N_(iv,"port",ov("getPort","setPort")),N_(iv,"pathname",ov("getPathname","setPathname")),N_(iv,"search",ov("getSearch","setSearch")),N_(iv,"searchParams",ov("getSearchParams")),N_(iv,"hash",ov("getHash","setHash"))),I_(iv,"toJSON",(function(){return H_(this).serialize()}),{enumerable:!0}),I_(iv,"toString",(function(){return H_(this).serialize()}),{enumerable:!0}),q_){var av=q_.createObjectURL,sv=q_.revokeObjectURL;av&&I_(rv,"createObjectURL",k_(av,q_)),sv&&I_(rv,"revokeObjectURL",k_(sv,q_))}V_(rv,"URL"),T_({global:!0,constructor:!0,forced:!C_,sham:!w_},{URL:rv});var cv=An,lv=i,dv=cl,uv=yr,hv=af,pv=oe("URL"),fv=hv&&lv((function(){pv.canParse()})),mv=lv((function(){return 1!==pv.canParse.length}));cv({target:"URL",stat:!0,forced:!fv||mv},{canParse:function(e){var t=dv(arguments.length,1),n=uv(e),r=t<2||void 0===arguments[1]?void 0:uv(arguments[1]);try{return!!new pv(n,r)}catch(e){return!1}}});var _v=An,gv=cl,vv=yr,yv=af,bv=oe("URL");_v({target:"URL",stat:!0,forced:!yv},{parse:function(e){var t=gv(arguments.length,1),n=vv(e),r=t<2||void 0===arguments[1]?void 0:vv(arguments[1]);try{return new bv(n,r)}catch(e){return null}}});var Ev=r(ee.URL);let Sv=!0,Tv=!0;function wv(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Cv(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Rv(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Sv=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function kv(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Tv=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Ov(){if("object"==typeof window){if(Sv)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Iv(e,t){Tv&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Nv(e){return"[object Object]"===Object.prototype.toString.call(e)}function Av(e){var t;return Nv(e)?ii(t=Object.keys(e)).call(t,(function(t,n){const r=Nv(e[n]),i=r?Av(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})}),{}):e}function xv(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?xv(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((t=>{xv(e,e.get(t),n)}))})))}function Pv(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&xv(e,n,i)}))})),i}const Dv=Ov;function Lv(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>{var n;return Dr(n=e.label.toLowerCase()).call(n,t)}))));return!a&&n.length&&Dr(t).call(t,"back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=r(e.video),Dv("chrome: "+JSON.stringify(e)),i(e)}))}e.video=r(e.video)}return Dv("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>np.reject(o(e))))))}}}function Mv(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function jv(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Cv(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function Uv(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Vv(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){n(o(i(e)))};return t.apply(this,[r,e])}return new np(((e,n)=>{t.apply(this,[function(t){e(o(i(t)))},n])})).then(n,r)}}function Fv(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>Pv(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Cv(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>Pv(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?np.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():np.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Bv(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function Wv(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Bv(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find((e=>e.track===t));if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[n.id];if(o)o.addTrack(t),np.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Gv(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function Hv(e,t){Cv(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var zv=Object.freeze({__proto__:null,fixNegotiationNeeded:Hv,shimAddTrackRemoveTrack:Wv,shimAddTrackRemoveTrackWithNative:Bv,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Uv,shimGetStats:Vv,shimGetUserMedia:Lv,shimMediaStream:Mv,shimOnTrack:jv,shimPeerConnection:Gv,shimSenderReceiverGetStats:Fv});function Kv(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){Iv("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function qv(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Yv(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,o]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,o)}}function Jv(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):np.resolve(new Map)}}function Xv(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Cv(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Qv(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Iv("removeStream","removeTrack"),this.getSenders().forEach((t=>{var n;t.track&&Dr(n=e.getTracks()).call(n,t.track)&&this.removeTrack(t)}))})}function Zv(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function $v(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function ey(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function ty(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?np.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function ny(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?np.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var ry=Object.freeze({__proto__:null,shimAddTransceiver:$v,shimCreateAnswer:ny,shimCreateOffer:ty,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,np.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:ey,shimGetUserMedia:Kv,shimOnTrack:qv,shimPeerConnection:Yv,shimRTCDataChannel:Zv,shimReceiverGetStats:Xv,shimRemoveStream:Qv,shimSenderGetStats:Jv});function iy(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n;this._localStreams||(this._localStreams=[]),Dr(n=this._localStreams).call(n,e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r&&r.forEach((e=>{var t;this._localStreams?Dr(t=this._localStreams).call(t,e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{Dr(n).call(n,e.track)&&this.removeTrack(e)}))})}}function oy(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{var t;if(this._remoteStreams||(this._remoteStreams=[]),Dr(t=this._remoteStreams).call(t,e))return;this._remoteStreams.push(e);const n=new Event("addstream");n.stream=e,this.dispatchEvent(n)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function ay(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),np.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),np.resolve()):i};let s=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),np.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),np.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),np.resolve()):r},t.addIceCandidate=s}function sy(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(cy(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function cy(e){return e&&void 0!==e.video?Object.assign({},e,{video:Av(e.video)}):e}function ly(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(Iv("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function dy(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function uy(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function hy(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var py=Object.freeze({__proto__:null,shimAudioContext:hy,shimCallbacksAPI:ay,shimConstraints:cy,shimCreateOfferLegacy:uy,shimGetUserMedia:sy,shimLocalStreamsAPI:iy,shimRTCIceServerUrls:ly,shimRemoteStreamsAPI:oy,shimTrackEventTransceiver:dy}),fy="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",my=Y,_y=yr,gy=fy,vy=d("".replace),yy=RegExp("^["+gy+"]+"),by=RegExp("(^|[^"+gy+"])["+gy+"]+$"),Ey=function(e){return function(t){var n=_y(my(t));return 1&e&&(n=vy(n,yy,"")),2&e&&(n=vy(n,by,"$1")),n}},Sy={start:Ey(1),end:Ey(2),trim:Ey(3)},Ty=Ss.PROPER,wy=i,Cy=fy,Ry=Sy.trim;An({target:"String",proto:!0,forced:function(e){return wy((function(){return!!Cy[e]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[e]()||Ty&&Cy[e].name!==e}))}("trim")},{trim:function(){return Ry(this)}});var ky=er("String","trim"),Oy=u,Iy=ky,Ny=String.prototype,Ay=function(e){var t=e.trim;return"string"==typeof e||e===Ny||Oy(Ny,e)&&t===Ny.trim?Iy:t},xy=r(Ay),Py={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:void 0===n[t[r]]&&(n[t[r]]=t[r+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substring(e.indexOf(" ")+1).split(";");for(let i=0;i<r.length;i++)n=r[i].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let o=3;o<r.length;o++){const i=r[o],a=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(a){const r=t.parseRtpMap(a),o=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(r.parameters=o.length?t.parseFmtp(o[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{i.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let i=0;return n.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=a.length>0&&a[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===s&&(c=l[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&s&&n.push({ssrc:s});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=d}))),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let i;const o=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let t=0;t<r.length;t++)switch(r[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(Py);var Dy=Py.exports,Ly=r(Dy),My=e({__proto__:null,default:Ly},[Dy]);function jy(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Ly.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Cv(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Uy(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Cv(e,"icecandidate",(e=>{if(e.candidate){const t=Ly.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Vy(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=Ly.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Ly.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=Ly.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=i(e),n=o(arguments[0],e);let a;a=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>a}),this._sctp=s}return a.apply(this,arguments)}}function Fy(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},Cv(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function By(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function Wy(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==xy(e).call(e))).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Gy(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?np.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),np.resolve())})}function Hy(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var zy=Object.freeze({__proto__:null,removeExtmapAllowMixed:Wy,shimAddIceCandidateNullOrEmpty:Gy,shimConnectionState:By,shimMaxMessageSize:Vy,shimParameterlessSetLocalDescription:Hy,shimRTCIceCandidate:jy,shimRTCIceCandidateRelayProtocol:Uy,shimSendThrowTypeError:Fy});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Ov,r=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=wv(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=wv(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=wv(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:r,commonShim:zy,extractVersion:wv,disableLog:Rv,disableWarnings:kv,sdp:My};switch(r.browser){case"chrome":if(!zv||!Gv||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=zv,Gy(e,r),Hy(e),Lv(e,r),Mv(e),Gv(e,r),jv(e),Wv(e,r),Uv(e),Vv(e),Fv(e),Hv(e,r),jy(e),Uy(e),By(e),Vy(e,r),Fy(e),Wy(e,r);break;case"firefox":if(!ry||!Yv||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=ry,Gy(e,r),Hy(e),Kv(e,r),Yv(e,r),qv(e),Qv(e),Jv(e),Xv(e),Zv(e),$v(e),ey(e),ty(e),ny(e),jy(e),By(e),Vy(e,r),Fy(e);break;case"safari":if(!py||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=py,Gy(e,r),Hy(e),ly(e),uy(e),ay(e),iy(e),oy(e),dy(e),sy(e),hy(e),jy(e),Uy(e),Vy(e,r),Fy(e),Wy(e,r);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var Ky=p;An({global:!0,forced:Ky.globalThis!==Ky},{globalThis:Ky});var qy=r(p),Yy={exports:{}};!function(e,n){!function(t,r){var i="function",o="undefined",a="object",s="string",c="major",l="model",d="name",u="type",h="vendor",p="version",f="architecture",m="console",_="mobile",g="tablet",v="smarttv",y="wearable",b="embedded",E="Amazon",S="Apple",T="ASUS",w="BlackBerry",C="Browser",R="Chrome",k="Firefox",O="Google",I="Huawei",N="LG",A="Microsoft",x="Motorola",P="Opera",D="Samsung",L="Sharp",M="Sony",j="Xiaomi",U="Zebra",V="Facebook",F="Chromium OS",B="Mac OS",W=" Browser",G=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},H=function(e,t){return typeof e===s&&-1!==z(t).indexOf(z(e))},z=function(e){return e.toLowerCase()},K=function(e,t){if(typeof e===s)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,500)},q=function(e,t){for(var n,o,s,c,l,d,u=0;u<t.length&&!l;){var h=t[u],p=t[u+1];for(n=o=0;n<h.length&&!l&&h[n];)if(l=h[n++].exec(e))for(s=0;s<p.length;s++)d=l[++o],typeof(c=p[s])===a&&c.length>0?2===c.length?typeof c[1]==i?this[c[0]]=c[1].call(this,d):this[c[0]]=c[1]:3===c.length?typeof c[1]!==i||c[1].exec&&c[1].test?this[c[0]]=d?d.replace(c[1],c[2]):r:this[c[0]]=d?c[1].call(this,d,c[2]):r:4===c.length&&(this[c[0]]=d?c[3].call(this,d.replace(c[1],c[2])):r):this[c]=d||r;u+=2}},Y=function(e,t){for(var n in t)if(typeof t[n]===a&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(H(t[n][i],e))return"?"===n?r:n}else if(H(t[n],e))return"?"===n?r:n;return t.hasOwnProperty("*")?t["*"]:e},J={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},X={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,p],[/opios[\/ ]+([\w\.]+)/i],[p,[d,P+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[p,[d,P+" GX"]],[/\bopr\/([\w\.]+)/i],[p,[d,P]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[p,[d,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[p,[d,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[d,p],[/quark(?:pc)?\/([-\w\.]+)/i],[p,[d,"Quark"]],[/\bddg\/([\w\.]+)/i],[p,[d,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[d,"UC"+C]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[p,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[d,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[p,[d,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[p,[d,"Smart Lenovo "+C]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure "+C],p],[/\bfocus\/([\w\.]+)/i],[p,[d,k+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[d,P+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[d,P+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[d,"MIUI"+W]],[/fxios\/([\w\.-]+)/i],[p,[d,k]],[/\bqihoobrowser\/?([\w\.]*)/i],[p,[d,"360"]],[/\b(qq)\/([\w\.]+)/i],[[d,/(.+)/,"$1Browser"],p],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1"+W],p],[/samsungbrowser\/([\w\.]+)/i],[p,[d,D+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[p,[d,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[d,"Sogou Mobile"],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[d,p],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[d],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[p,d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,V],p],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[d,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[d,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[p,[d,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[d,R+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,R+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[d,"Android "+C]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[p,Y,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],p],[/(wolvic|librewolf)\/([\w\.]+)/i],[d,p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[d,k+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[d,[p,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[d,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,z]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[f,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[f,"armhf"]],[/windows (ce|mobile); ppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[f,/ower/,"",z]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[f,z]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[h,D],[u,g]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[l,[h,D],[u,_]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[l,[h,S],[u,_]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[h,S],[u,g]],[/(macintosh);/i],[l,[h,S]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[h,L],[u,_]],[/(?:honor)([-\w ]+)[;\)]/i],[l,[h,"Honor"],[u,_]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[h,I],[u,g]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[h,I],[u,_]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[l,/_/g," "],[h,j],[u,_]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[h,j],[u,g]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[h,"OPPO"],[u,_]],[/\b(opd2\d{3}a?) bui/i],[l,[h,"OPPO"],[u,g]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[h,"Vivo"],[u,_]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[l,[h,"Realme"],[u,_]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[h,x],[u,_]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[h,x],[u,g]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[h,N],[u,g]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[h,N],[u,_]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[h,"Lenovo"],[u,g]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[h,"Nokia"],[u,_]],[/(pixel c)\b/i],[l,[h,O],[u,g]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[h,O],[u,_]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[h,M],[u,_]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[h,M],[u,g]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[h,"OnePlus"],[u,_]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[h,E],[u,g]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[h,E],[u,_]],[/(playbook);[-\w\),; ]+(rim)/i],[l,h,[u,g]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[h,w],[u,_]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[h,T],[u,g]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[h,T],[u,_]],[/(nexus 9)/i],[l,[h,"HTC"],[u,g]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[l,/_/g," "],[u,_]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[l,[h,"TCL"],[u,g]],[/(itel) ((\w+))/i],[[h,z],l,[u,Y,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[h,"Acer"],[u,g]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[h,"Meizu"],[u,_]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[l,[h,"Ulefone"],[u,_]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[l,[h,"Energizer"],[u,_]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[l,[h,"Cat"],[u,_]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[l,[h,"Smartfren"],[u,_]],[/droid.+; (a(?:015|06[35]|142p?))/i],[l,[h,"Nothing"],[u,_]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,l,[u,_]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,l,[u,g]],[/(surface duo)/i],[l,[h,A],[u,g]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[h,"Fairphone"],[u,_]],[/(u304aa)/i],[l,[h,"AT&T"],[u,_]],[/\bsie-(\w*)/i],[l,[h,"Siemens"],[u,_]],[/\b(rct\w+) b/i],[l,[h,"RCA"],[u,g]],[/\b(venue[\d ]{2,7}) b/i],[l,[h,"Dell"],[u,g]],[/\b(q(?:mv|ta)\w+) b/i],[l,[h,"Verizon"],[u,g]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[h,"Barnes & Noble"],[u,g]],[/\b(tm\d{3}\w+) b/i],[l,[h,"NuVision"],[u,g]],[/\b(k88) b/i],[l,[h,"ZTE"],[u,g]],[/\b(nx\d{3}j) b/i],[l,[h,"ZTE"],[u,_]],[/\b(gen\d{3}) b.+49h/i],[l,[h,"Swiss"],[u,_]],[/\b(zur\d{3}) b/i],[l,[h,"Swiss"],[u,g]],[/\b((zeki)?tb.*\b) b/i],[l,[h,"Zeki"],[u,g]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],l,[u,g]],[/\b(ns-?\w{0,9}) b/i],[l,[h,"Insignia"],[u,g]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[h,"NextBook"],[u,g]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],l,[u,_]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],l,[u,_]],[/\b(ph-1) /i],[l,[h,"Essential"],[u,_]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[h,"Envizen"],[u,g]],[/\b(trio[-\w\. ]+) b/i],[l,[h,"MachSpeed"],[u,g]],[/\btu_(1491) b/i],[l,[h,"Rotor"],[u,g]],[/(shield[\w ]+) b/i],[l,[h,"Nvidia"],[u,g]],[/(sprint) (\w+)/i],[h,l,[u,_]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[h,A],[u,_]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[h,U],[u,g]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[h,U],[u,_]],[/smart-tv.+(samsung)/i],[h,[u,v]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[h,D],[u,v]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,N],[u,v]],[/(apple) ?tv/i],[h,[l,S+" TV"],[u,v]],[/crkey/i],[[l,R+"cast"],[h,O],[u,v]],[/droid.+aft(\w+)( bui|\))/i],[l,[h,E],[u,v]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[h,L],[u,v]],[/(bravia[\w ]+)( bui|\))/i],[l,[h,M],[u,v]],[/(mitv-\w{5}) bui/i],[l,[h,j],[u,v]],[/Hbbtv.*(technisat) (.*);/i],[h,l,[u,v]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,K],[l,K],[u,v]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u,v]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,l,[u,m]],[/droid.+; (shield) bui/i],[l,[h,"Nvidia"],[u,m]],[/(playstation [345portablevi]+)/i],[l,[h,M],[u,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[h,A],[u,m]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[l,[h,D],[u,y]],[/((pebble))app/i],[h,l,[u,y]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[l,[h,S],[u,y]],[/droid.+; (glass) \d/i],[l,[h,O],[u,y]],[/droid.+; (wt63?0{2,3})\)/i],[l,[h,U],[u,y]],[/droid.+; (glass) \d/i],[l,[h,O],[u,y]],[/(pico) (4|neo3(?: link|pro)?)/i],[h,l,[u,y]],[/; (quest( \d| pro)?)/i],[l,[h,V],[u,y]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[u,b]],[/(aeobc)\b/i],[l,[h,E],[u,b]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[l,[u,_]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[u,g]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u,g]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u,_]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[d,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[d,p],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[d,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,p],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[d,[p,Y,J]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,Y,J],[d,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,B],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,p],[/\(bb(10);/i],[p,[d,w]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[d,k+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[d,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[d,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[d,R+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[d,F],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,p],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[d,p]]},Q=function(e,n){if(typeof e===a&&(n=e,e=r),!(this instanceof Q))return new Q(e,n).getResult();var m=typeof t!==o&&t.navigator?t.navigator:r,v=e||(m&&m.userAgent?m.userAgent:""),y=m&&m.userAgentData?m.userAgentData:r,b=n?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(X,n):X,E=m&&m.userAgent==v;return this.getBrowser=function(){var e={};return e[d]=r,e[p]=r,q.call(e,v,b.browser),e[c]=function(e){return typeof e===s?e.replace(/[^\d\.]/g,"").split(".")[0]:r}(e[p]),E&&m&&m.brave&&typeof m.brave.isBrave==i&&(e[d]="Brave"),e},this.getCPU=function(){var e={};return e[f]=r,q.call(e,v,b.cpu),e},this.getDevice=function(){var e={};return e[h]=r,e[l]=r,e[u]=r,q.call(e,v,b.device),E&&!e[u]&&y&&y.mobile&&(e[u]=_),E&&"Macintosh"==e[l]&&m&&typeof m.standalone!==o&&m.maxTouchPoints&&m.maxTouchPoints>2&&(e[l]="iPad",e[u]=g),e},this.getEngine=function(){var e={};return e[d]=r,e[p]=r,q.call(e,v,b.engine),e},this.getOS=function(){var e={};return e[d]=r,e[p]=r,q.call(e,v,b.os),E&&!e[d]&&y&&y.platform&&"Unknown"!=y.platform&&(e[d]=y.platform.replace(/chrome os/i,F).replace(/macos/i,B)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return v},this.setUA=function(e){return v=typeof e===s&&e.length>500?K(e,500):e,this},this.setUA(v),this};Q.VERSION="0.7.40",Q.BROWSER=G([d,p,c]),Q.CPU=G([f]),Q.DEVICE=G([l,h,u,m,_,v,g,y,b]),Q.ENGINE=Q.OS=G([d,p]),e.exports&&(n=e.exports=Q),n.UAParser=Q;var Z=typeof t!==o&&(t.jQuery||t.Zepto);if(Z&&!Z.ua){var $=new Q;Z.ua=$.getResult(),Z.ua.get=function(){return $.getUA()},Z.ua.set=function(e){$.setUA(e);var t=$.getResult();for(var n in t)Z.ua[n]=t[n]}}}("object"==typeof window?window:t)}(Yy,Yy.exports);var Jy=r(Yy.exports),Xy=Ml.clear;An({global:!0,bind:!0,enumerable:!0,forced:p.clearImmediate!==Xy},{clearImmediate:Xy});var Qy=p,Zy=v,$y=k,eb=Jr,tb=ce,nb=al,rb=cl,ib=Qy.Function,ob=/MSIE .\./.test(tb)||"BUN"===eb&&function(){var e=Qy.Bun.version.split(".");return e.length<3||"0"===e[0]&&(e[1]<3||"3"===e[1]&&"0"===e[2])}(),ab=An,sb=p,cb=Ml.set,lb=function(e,t){var n=t?2:1;return ob?function(r,i){var o=rb(arguments.length,1)>n,a=$y(r)?r:ib(r),s=o?nb(arguments,n):[],c=o?function(){Zy(a,this,s)}:a;return t?e(c,i):e(c)}:e},db=sb.setImmediate?lb(cb,!1):cb;ab({global:!0,bind:!0,enumerable:!0,forced:sb.setImmediate!==db},{setImmediate:db});var ub=r(ee.setImmediate),hb=p,pb=hd,fb=Ae,mb=cl,_b=I;An({global:!0,enumerable:!0,dontCallGetSet:!0,forced:i((function(){return _b&&1!==Object.getOwnPropertyDescriptor(hb,"queueMicrotask").value.length}))},{queueMicrotask:function(e){mb(arguments.length,1),pb(fb(e))}});var gb=r(ee.queueMicrotask);function vb(e,t){return function(){return e.apply(t,arguments)}}const{toString:yb}=Object.prototype,{getPrototypeOf:bb}=Object,{iterator:Eb,toStringTag:Sb}=Symbol,Tb=(wb=Object.create(null),e=>{const t=yb.call(e);return wb[t]||(wb[t]=t.slice(8,-1).toLowerCase())});var wb;const Cb=e=>(e=e.toLowerCase(),t=>Tb(t)===e),Rb=e=>t=>typeof t===e,{isArray:kb}=Array,Ob=Rb("undefined"),Ib=Cb("ArrayBuffer"),Nb=Rb("string"),Ab=Rb("function"),xb=Rb("number"),Pb=e=>null!==e&&"object"==typeof e,Db=e=>{if("object"!==Tb(e))return!1;const t=bb(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Sb in e||Eb in e)},Lb=Cb("Date"),Mb=Cb("File"),jb=Cb("Blob"),Ub=Cb("FileList"),Vb=Cb("URLSearchParams"),[Fb,Bb,Wb,Gb]=["ReadableStream","Request","Response","Headers"].map(Cb);function Hb(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e)if("object"!=typeof e&&(e=[e]),kb(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const r=i?Object.getOwnPropertyNames(e):Object.keys(e),o=r.length;let a;for(n=0;n<o;n++)a=r[n],t.call(null,e[a],a,e)}}function zb(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const Kb=void 0!==qy?qy:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,qb=e=>!Ob(e)&&e!==Kb,Yb=(Jb="undefined"!=typeof Uint8Array&&bb(Uint8Array),e=>Jb&&e instanceof Jb);var Jb;const Xb=Cb("HTMLFormElement"),Qb=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),Zb=Cb("RegExp"),$b=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};Hb(n,((n,i)=>{let o;!1!==(o=t(n,i,e))&&(r[i]=o||n)})),Object.defineProperties(e,r)},eE=Cb("AsyncFunction"),tE=(nE="function"==typeof ub,rE=Ab(Kb.postMessage),nE?ub:rE?(iE="axios@".concat(Math.random()),oE=[],Kb.addEventListener("message",(e=>{let{source:t,data:n}=e;t===Kb&&n===iE&&oE.length&&oE.shift()()}),!1),e=>{oE.push(e),Kb.postMessage(iE,"*")}):e=>setTimeout(e));var nE,rE,iE,oE;const aE=void 0!==gb?gb.bind(Kb):"undefined"!=typeof process&&process.nextTick||tE;var sE={isArray:kb,isArrayBuffer:Ib,isBuffer:function(e){return null!==e&&!Ob(e)&&null!==e.constructor&&!Ob(e.constructor)&&Ab(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||Ab(e.append)&&("formdata"===(t=Tb(e))||"object"===t&&Ab(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Ib(e.buffer),t},isString:Nb,isNumber:xb,isBoolean:e=>!0===e||!1===e,isObject:Pb,isPlainObject:Db,isReadableStream:Fb,isRequest:Bb,isResponse:Wb,isHeaders:Gb,isUndefined:Ob,isDate:Lb,isFile:Mb,isBlob:jb,isRegExp:Zb,isFunction:Ab,isStream:e=>Pb(e)&&Ab(e.pipe),isURLSearchParams:Vb,isTypedArray:Yb,isFileList:Ub,forEach:Hb,merge:function e(){const{caseless:t}=qb(this)&&this||{},n={},r=(r,i)=>{const o=t&&zb(n,i)||i;Db(n[o])&&Db(r)?n[o]=e(n[o],r):Db(r)?n[o]=e({},r):kb(r)?n[o]=r.slice():n[o]=r};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&Hb(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Hb(t,((t,r)=>{n&&Ab(t)?e[r]=vb(t,n):e[r]=t}),{allOwnKeys:r}),e},trim:e=>xy(e)?xy(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,o,a;const s={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)a=i[o],r&&!r(a,e,t)||s[a]||(t[a]=e[a],s[a]=!0);e=!1!==n&&bb(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Tb,kindOfTest:Cb,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(kb(e))return e;let t=e.length;if(!xb(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Eb]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:Xb,hasOwnProperty:Qb,hasOwnProp:Qb,reduceDescriptors:$b,freezeMethods:e=>{$b(e,((t,n)=>{if(Ab(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];Ab(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return kb(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:zb,global:Kb,isContextDefined:qb,isSpecCompliantForm:function(e){return!!(e&&Ab(e.append)&&"FormData"===e[Sb]&&e[Eb])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(Pb(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const i=kb(e)?[]:{};return Hb(e,((e,t)=>{const o=n(e,r+1);!Ob(o)&&(i[t]=o)})),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:eE,isThenable:e=>e&&(Pb(e)||Ab(e))&&Ab(e.then)&&Ab(e.catch),setImmediate:tE,asap:aE,isIterable:e=>null!=e&&Ab(e[Eb])};function cE(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}sE.inherits(cE,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:sE.toJSONObject(this.config),code:this.code,status:this.status}}});const lE=cE.prototype,dE={};function uE(e){return sE.isPlainObject(e)||sE.isArray(e)}function hE(e){return sE.endsWith(e,"[]")?e.slice(0,-2):e}function pE(e,t,n){return e?e.concat(t).map((function(e,t){return e=hE(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{dE[e]={value:e}})),Object.defineProperties(cE,dE),Object.defineProperty(lE,"isAxiosError",{value:!0}),cE.from=(e,t,n,r,i,o)=>{const a=Object.create(lE);return sE.toFlatObject(e,a,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),cE.call(a,e.message,t,n,r,i),a.cause=e,a.name=e.name,o&&Object.assign(a,o),a};const fE=sE.toFlatObject(sE,{},null,(function(e){return/^is[A-Z]/.test(e)}));function mE(e,t,n){if(!sE.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=sE.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!sE.isUndefined(t[e])}))).metaTokens,i=n.visitor||l,o=n.dots,a=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&sE.isSpecCompliantForm(t);if(!sE.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(sE.isDate(e))return e.toISOString();if(!s&&sE.isBlob(e))throw new cE("Blob is not supported. Use a Buffer instead.");return sE.isArrayBuffer(e)||sE.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,i){let s=e;if(e&&!i&&"object"==typeof e)if(sE.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(sE.isArray(e)&&function(e){return sE.isArray(e)&&!e.some(uE)}(e)||(sE.isFileList(e)||sE.endsWith(n,"[]"))&&(s=sE.toArray(e)))return n=hE(n),s.forEach((function(e,r){!sE.isUndefined(e)&&null!==e&&t.append(!0===a?pE([n],r,o):null===a?n:n+"[]",c(e))})),!1;return!!uE(e)||(t.append(pE(i,n,o),c(e)),!1)}const d=[],u=Object.assign(fE,{defaultVisitor:l,convertValue:c,isVisitable:uE});if(!sE.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!sE.isUndefined(n)){if(-1!==d.indexOf(n))throw Error("Circular reference detected in "+r.join("."));d.push(n),sE.forEach(n,(function(n,o){!0===(!(sE.isUndefined(n)||null===n)&&i.call(t,n,sE.isString(o)?xy(o).call(o):o,r,u))&&e(n,r?r.concat(o):[o])})),d.pop()}}(e),t}function _E(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function gE(e,t){this._pairs=[],e&&mE(e,this,t)}const vE=gE.prototype;function yE(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function bE(e,t,n){if(!t)return e;const r=n&&n.encode||yE;sE.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let o;if(o=i?i(t,n):sE.isURLSearchParams(t)?t.toString():new gE(t,n).toString(r),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}vE.append=function(e,t){this._pairs.push([e,t])},vE.toString=function(e){const t=e?function(t){return e.call(this,t,_E)}:_E;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var EE=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){sE.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},SE={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},TE={exports:{}},wE=An,CE=I,RE=$t.f;wE({target:"Object",stat:!0,forced:Object.defineProperty!==RE,sham:!CE},{defineProperty:RE});var kE=ee.Object,OE=TE.exports=function(e,t,n){return kE.defineProperty(e,t,n)};kE.defineProperty.sham&&(OE.sham=!0);var IE=r(TE.exports),NE=TypeError,AE=ai,xE=Qc,PE=$,DE=ft("species"),LE=Array,ME=function(e){var t;return AE(e)&&(t=e.constructor,(xE(t)&&(t===LE||AE(t.prototype))||PE(t)&&null===(t=t[DE]))&&(t=void 0)),void 0===t?LE:t},jE=function(e,t){return new(ME(e))(0===t?0:t)},UE=i,VE=me,FE=ft("species"),BE=function(e){return VE>=51||!UE((function(){var t=[];return(t.constructor={})[FE]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},WE=An,GE=i,HE=ai,zE=$,KE=Qe,qE=zn,YE=function(e){if(e>9007199254740991)throw NE("Maximum allowed index exceeded");return e},JE=qm,XE=jE,QE=BE,ZE=me,$E=ft("isConcatSpreadable"),eS=ZE>=51||!GE((function(){var e=[];return e[$E]=!1,e.concat()[0]!==e})),tS=function(e){if(!zE(e))return!1;var t=e[$E];return void 0!==t?!!t:HE(e)};WE({target:"Array",proto:!0,arity:1,forced:!eS||!QE("concat")},{concat:function(e){var t,n,r,i,o,a=KE(this),s=XE(a,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(tS(o=-1===t?a:arguments[t]))for(i=qE(o),YE(c+i),n=0;n<i;n++,c++)n in o&&JE(s,c,o[n]);else YE(c+1),JE(s,c++,o);return s.length=c,s}});var nS={},rS=S,iS=Q,oS=Bi.f,aS=al,sS="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];nS.f=function(e){return sS&&"Window"===rS(e)?function(e){try{return oS(e)}catch(e){return aS(sS)}}(e):oS(iS(e))};var cS={},lS=ft;cS.f=lS;var dS=ee,uS=et,hS=cS,pS=$t.f,fS=function(e){var t=dS.Symbol||(dS.Symbol={});uS(t,e)||pS(t,e,{value:hS.f(e)})},mS=x,_S=oe,gS=ft,vS=ws,yS=function(){var e=_S("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=gS("toPrimitive");t&&!t[r]&&vS(t,r,(function(e){return mS(n,this)}),{arity:1})},bS=Zt,ES=H,SS=Qe,TS=zn,wS=jE,CS=d([].push),RS=function(e){var t=1===e,n=2===e,r=3===e,i=4===e,o=6===e,a=7===e,s=5===e||o;return function(c,l,d,u){for(var h,p,f=SS(c),m=ES(f),_=TS(m),g=bS(l,d),v=0,y=u||wS,b=t?y(c,_):n||a?y(c,0):void 0;_>v;v++)if((s||v in m)&&(p=g(h=m[v],v,f),e))if(t)b[v]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return v;case 2:CS(b,h)}else switch(e){case 4:return!1;case 7:CS(b,h)}return o?-1:r||i?i:b}},kS={forEach:RS(0),map:RS(1),filter:RS(2),some:RS(3),every:RS(4),find:RS(5),findIndex:RS(6),filterReject:RS(7)},OS=An,IS=p,NS=x,AS=d,xS=I,PS=ye,DS=i,LS=et,MS=u,jS=on,US=Q,VS=wt,FS=yr,BS=V,WS=Lo,GS=po,HS=Bi,zS=nS,KS=Zi,qS=O,YS=$t,JS=lo,XS=P,QS=ws,ZS=Tc,$S=Ye,eT=Wi,tT=ot,nT=ft,rT=cS,iT=fS,oT=yS,aT=Gs,sT=_s,cT=kS.forEach,lT=bi("hidden"),dT="Symbol",uT="prototype",hT=sT.set,pT=sT.getterFor(dT),fT=Object[uT],mT=IS.Symbol,_T=mT&&mT[uT],gT=IS.RangeError,vT=IS.TypeError,yT=IS.QObject,bT=qS.f,ET=YS.f,ST=zS.f,TT=XS.f,wT=AS([].push),CT=$S("symbols"),RT=$S("op-symbols"),kT=$S("wks"),OT=!yT||!yT[uT]||!yT[uT].findChild,IT=function(e,t,n){var r=bT(fT,t);r&&delete fT[t],ET(e,t,n),r&&e!==fT&&ET(fT,t,r)},NT=xS&&DS((function(){return 7!==WS(ET({},"a",{get:function(){return ET(this,"a",{value:7}).a}})).a}))?IT:ET,AT=function(e,t){var n=CT[e]=WS(_T);return hT(n,{type:dT,tag:e,description:t}),xS||(n.description=t),n},xT=function(e,t,n){e===fT&&xT(RT,t,n),jS(e);var r=VS(t);return jS(n),LS(CT,r)?(n.enumerable?(LS(e,lT)&&e[lT][r]&&(e[lT][r]=!1),n=WS(n,{enumerable:BS(0,!1)})):(LS(e,lT)||ET(e,lT,BS(1,WS(null))),e[lT][r]=!0),NT(e,r,n)):ET(e,r,n)},PT=function(e,t){jS(e);var n=US(t),r=GS(n).concat(jT(n));return cT(r,(function(t){xS&&!NS(DT,n,t)||xT(e,t,n[t])})),e},DT=function(e){var t=VS(e),n=NS(TT,this,t);return!(this===fT&&LS(CT,t)&&!LS(RT,t))&&(!(n||!LS(this,t)||!LS(CT,t)||LS(this,lT)&&this[lT][t])||n)},LT=function(e,t){var n=US(e),r=VS(t);if(n!==fT||!LS(CT,r)||LS(RT,r)){var i=bT(n,r);return!i||!LS(CT,r)||LS(n,lT)&&n[lT][r]||(i.enumerable=!0),i}},MT=function(e){var t=ST(US(e)),n=[];return cT(t,(function(e){LS(CT,e)||LS(eT,e)||wT(n,e)})),n},jT=function(e){var t=e===fT,n=ST(t?RT:US(e)),r=[];return cT(n,(function(e){!LS(CT,e)||t&&!LS(fT,e)||wT(r,CT[e])})),r};PS||(mT=function(){if(MS(_T,this))throw new vT("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?FS(arguments[0]):void 0,t=tT(e),n=function(e){var r=void 0===this?IS:this;r===fT&&NS(n,RT,e),LS(r,lT)&&LS(r[lT],t)&&(r[lT][t]=!1);var i=BS(1,e);try{NT(r,t,i)}catch(e){if(!(e instanceof gT))throw e;IT(r,t,i)}};return xS&&OT&&NT(fT,t,{configurable:!0,set:n}),AT(t,e)},QS(_T=mT[uT],"toString",(function(){return pT(this).tag})),QS(mT,"withoutSetter",(function(e){return AT(tT(e),e)})),XS.f=DT,YS.f=xT,JS.f=PT,qS.f=LT,HS.f=zS.f=MT,KS.f=jT,rT.f=function(e){return AT(nT(e),e)},xS&&ZS(_T,"description",{configurable:!0,get:function(){return pT(this).description}})),OS({global:!0,constructor:!0,wrap:!0,forced:!PS,sham:!PS},{Symbol:mT}),cT(GS(kT),(function(e){iT(e)})),OS({target:dT,stat:!0,forced:!PS},{useSetter:function(){OT=!0},useSimple:function(){OT=!1}}),OS({target:"Object",stat:!0,forced:!PS,sham:!xS},{create:function(e,t){return void 0===t?WS(e):PT(WS(e),t)},defineProperty:xT,defineProperties:PT,getOwnPropertyDescriptor:LT}),OS({target:"Object",stat:!0,forced:!PS},{getOwnPropertyNames:MT}),oT(),aT(mT,dT),eT[lT]=!0;var UT=ye&&!!Symbol.for&&!!Symbol.keyFor,VT=An,FT=oe,BT=et,WT=yr,GT=Ye,HT=UT,zT=GT("string-to-symbol-registry"),KT=GT("symbol-to-string-registry");VT({target:"Symbol",stat:!0,forced:!HT},{for:function(e){var t=WT(e);if(BT(zT,t))return zT[t];var n=FT("Symbol")(t);return zT[t]=n,KT[n]=t,n}});var qT=An,YT=et,JT=Ce,XT=ke,QT=UT,ZT=Ye("symbol-to-string-registry");qT({target:"Symbol",stat:!0,forced:!QT},{keyFor:function(e){if(!JT(e))throw new TypeError(XT(e)+" is not a symbol");if(YT(ZT,e))return ZT[e]}});var $T=ai,ew=k,tw=S,nw=yr,rw=d([].push),iw=An,ow=oe,aw=v,sw=x,cw=d,lw=i,dw=k,uw=Ce,hw=al,pw=function(e){if(ew(e))return e;if($T(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];"string"==typeof i?rw(n,i):"number"!=typeof i&&"Number"!==tw(i)&&"String"!==tw(i)||rw(n,nw(i))}var o=n.length,a=!0;return function(e,t){if(a)return a=!1,t;if($T(this))return t;for(var r=0;r<o;r++)if(n[r]===e)return t}}},fw=ye,mw=String,_w=ow("JSON","stringify"),gw=cw(/./.exec),vw=cw("".charAt),yw=cw("".charCodeAt),bw=cw("".replace),Ew=cw(1..toString),Sw=/[\uD800-\uDFFF]/g,Tw=/^[\uD800-\uDBFF]$/,ww=/^[\uDC00-\uDFFF]$/,Cw=!fw||lw((function(){var e=ow("Symbol")("stringify detection");return"[null]"!==_w([e])||"{}"!==_w({a:e})||"{}"!==_w(Object(e))})),Rw=lw((function(){return'"\\udf06\\ud834"'!==_w("\udf06\ud834")||'"\\udead"'!==_w("\udead")})),kw=function(e,t){var n=hw(arguments),r=pw(t);if(dw(r)||void 0!==e&&!uw(e))return n[1]=function(e,t){if(dw(r)&&(t=sw(r,this,mw(e),t)),!uw(t))return t},aw(_w,null,n)},Ow=function(e,t,n){var r=vw(n,t-1),i=vw(n,t+1);return gw(Tw,e)&&!gw(ww,i)||gw(ww,e)&&!gw(Tw,r)?"\\u"+Ew(yw(e,0),16):e};_w&&iw({target:"JSON",stat:!0,arity:3,forced:Cw||Rw},{stringify:function(e,t,n){var r=hw(arguments),i=aw(Cw?kw:_w,null,r);return Rw&&"string"==typeof i?bw(i,Sw,Ow):i}});var Iw=Zi,Nw=Qe;An({target:"Object",stat:!0,forced:!ye||i((function(){Iw.f(1)}))},{getOwnPropertySymbols:function(e){var t=Iw.f;return t?t(Nw(e)):[]}}),fS("asyncIterator"),fS("hasInstance"),fS("isConcatSpreadable"),fS("iterator"),fS("match"),fS("matchAll"),fS("replace"),fS("search"),fS("species"),fS("split");var Aw=yS;fS("toPrimitive"),Aw();var xw=oe,Pw=Gs;fS("toStringTag"),Pw(xw("Symbol"),"Symbol"),fS("unscopables"),Gs(p.JSON,"JSON",!0);var Dw=ee.Symbol,Lw=ft,Mw=$t.f,jw=Lw("metadata"),Uw=Function.prototype;void 0===Uw[jw]&&Mw(Uw,jw,{value:null}),fS("asyncDispose"),fS("dispose"),fS("metadata");var Vw=Dw,Fw=d,Bw=oe("Symbol"),Ww=Bw.keyFor,Gw=Fw(Bw.prototype.valueOf),Hw=Bw.isRegisteredSymbol||function(e){try{return void 0!==Ww(Gw(e))}catch(e){return!1}};An({target:"Symbol",stat:!0},{isRegisteredSymbol:Hw});for(var zw=Ye,Kw=oe,qw=d,Yw=Ce,Jw=ft,Xw=Kw("Symbol"),Qw=Xw.isWellKnownSymbol,Zw=Kw("Object","getOwnPropertyNames"),$w=qw(Xw.prototype.valueOf),eC=zw("wks"),tC=0,nC=Zw(Xw),rC=nC.length;tC<rC;tC++)try{var iC=nC[tC];Yw(Xw[iC])&&Jw(iC)}catch(e){}var oC=function(e){if(Qw&&Qw(e))return!0;try{for(var t=$w(e),n=0,r=Zw(eC),i=r.length;n<i;n++)if(eC[r[n]]==t)return!0}catch(e){}return!1};An({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:oC}),fS("customMatcher"),fS("observable"),An({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Hw}),An({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:oC}),fS("matcher"),fS("metadataKey"),fS("patternMatch"),fS("replaceAll");var aC=r(Vw),sC=r(cS.f("iterator"));function cC(e){return cC="function"==typeof aC&&"symbol"==typeof sC?function(e){return typeof e}:function(e){return e&&"function"==typeof aC&&e.constructor===aC&&e!==aC.prototype?"symbol":typeof e},cC(e)}var lC=r(cS.f("toPrimitive"));function dC(e){var t=function(e,t){if("object"!=cC(e)||!e)return e;var n=e[lC];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=cC(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==cC(t)?t:t+""}function uC(e,t,n){return(t=dC(t))in e?IE(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var hC=r(Om),pC={isBrowser:!0,classes:{URLSearchParams:void 0!==hC?hC:gE,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const fC="undefined"!=typeof window&&"undefined"!=typeof document,mC="object"==typeof navigator&&navigator||void 0,_C=fC&&(!mC||["ReactNative","NativeScript","NS"].indexOf(mC.product)<0),gC="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,vC=fC&&window.location.href||"http://localhost";function yC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yC(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yC(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var EC=bC(bC({},Object.freeze({__proto__:null,hasBrowserEnv:fC,hasStandardBrowserEnv:_C,hasStandardBrowserWebWorkerEnv:gC,navigator:mC,origin:vC})),pC),SC=on,TC=x,wC=et,CC=u,RC=function(){var e=SC(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},kC=RegExp.prototype,OC=function(e){var t=e.flags;return void 0!==t||"flags"in kC||wC(e,"flags")||!CC(kC,e)?t:TC(RC,e)},IC=Fh.charAt,NC=x,AC=on,xC=k,PC=S,DC=/./.exec,LC=TypeError,MC=An,jC=x,UC=C,VC=Xs,FC=pc,BC=Y,WC=Gn,GC=yr,HC=on,zC=$,KC=S,qC=or,YC=OC,JC=De,XC=i,QC=ol,ZC=function(e,t,n){return t+(n?IC(e,t).length:1)},$C=function(e,t){var n=e.exec;if(xC(n)){var r=NC(n,e,t);return null!==r&&AC(r),r}if("RegExp"===PC(e))return NC(DC,e,t);throw new LC("RegExp#exec called on incompatible receiver")},eR=_s,tR=ft("matchAll"),nR="RegExp String",rR=nR+" Iterator",iR=eR.set,oR=eR.getterFor(rR),aR=TypeError,sR=UC("".indexOf),cR=UC("".matchAll),lR=!!cR&&!XC((function(){cR("a",/./)})),dR=VC((function(e,t,n,r){iR(this,{type:rR,regexp:e,string:t,global:n,unicode:r,done:!1})}),nR,(function(){var e=oR(this);if(e.done)return FC(void 0,!0);var t=e.regexp,n=e.string,r=$C(t,n);return null===r?(e.done=!0,FC(void 0,!0)):e.global?(""===GC(r[0])&&(t.lastIndex=ZC(n,WC(t.lastIndex),e.unicode)),FC(r,!1)):(e.done=!0,FC(r,!1))})),uR=function(e){var t,n,r,i=HC(this),o=GC(e),a=QC(i,RegExp),s=GC(YC(i));return t=new a(a===RegExp?i.source:i,s),n=!!~sR(s,"g"),r=!!~sR(s,"u"),t.lastIndex=WC(i.lastIndex),new dR(t,o,n,r)};MC({target:"String",proto:!0,forced:lR},{matchAll:function(e){var t,n,r,i,o=BC(this);if(zC(e)){if(qC(e)&&(t=GC(BC(YC(e))),!~sR(t,"g")))throw new aR("`.matchAll` does not allow non-global regexes");if(lR)return cR(o,e);if(void 0===(r=JC(e,tR))&&"RegExp"===KC(e)&&(r=uR),r)return jC(r,e,o)}else if(lR)return cR(o,e);return n=GC(o),i=new RegExp(e,"g"),jC(uR,i,n)}});var hR=er("String","matchAll"),pR=u,fR=hR,mR=String.prototype,_R=function(e){var t=e.matchAll;return"string"==typeof e||e===mR||pR(mR,e)&&t===mR.matchAll?fR:t},gR=r(_R);function vR(e){function t(e,n,r,i){let o=e[i++];if("__proto__"===o)return!0;const a=Number.isFinite(+o),s=i>=e.length;return o=!o&&sE.isArray(r)?r.length:o,s?(sE.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!a):(r[o]&&sE.isObject(r[o])||(r[o]=[]),t(e,n,r[o],i)&&sE.isArray(r[o])&&(r[o]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let o;for(r=0;r<i;r++)o=n[r],t[o]=e[o];return t}(r[o])),!a)}if(sE.isFormData(e)&&sE.isFunction(e.entries)){const n={};return sE.forEachEntry(e,((e,r)=>{t(function(e){return gR(sE).call(sE,/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null}const yR={transitional:SE,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=sE.isObject(e);if(i&&sE.isHTMLForm(e)&&(e=new FormData(e)),sE.isFormData(e))return r?JSON.stringify(vR(e)):e;if(sE.isArrayBuffer(e)||sE.isBuffer(e)||sE.isStream(e)||sE.isFile(e)||sE.isBlob(e)||sE.isReadableStream(e))return e;if(sE.isArrayBufferView(e))return e.buffer;if(sE.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return mE(e,new EC.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return EC.isNode&&sE.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((o=sE.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return mE(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e,t,n){if(sE.isString(e))try{return(t||JSON.parse)(e),xy(sE).call(sE,e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||yR.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(sE.isResponse(e)||sE.isReadableStream(e))return e;if(e&&sE.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw cE.from(e,cE.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:EC.classes.FormData,Blob:EC.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};sE.forEach(["delete","get","head","post","put","patch"],(e=>{yR.headers[e]={}}));var bR=yR;const ER=sE.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),SR=Symbol("internals");function TR(e){var t;return e&&xy(t=String(e)).call(t).toLowerCase()}function wR(e){return!1===e||null==e?e:sE.isArray(e)?e.map(wR):String(e)}function CR(e,t,n,r,i){return sE.isFunction(r)?r.call(this,t,n):(i&&(t=n),sE.isString(t)?sE.isString(r)?-1!==t.indexOf(r):sE.isRegExp(r)?r.test(t):void 0:void 0)}class RR{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=TR(t);if(!i)throw new Error("header name must be a non-empty string");const o=sE.findKey(r,i);(!o||void 0===r[o]||!0===n||void 0===n&&!1!==r[o])&&(r[o||t]=wR(e))}const o=(e,t)=>sE.forEach(e,((e,n)=>i(e,n,t)));if(sE.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(sE.isString(e)&&(e=xy(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(xy(a=e).call(a)))o((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach((function(e){var o,a;i=e.indexOf(":"),n=xy(o=e.substring(0,i)).call(o).toLowerCase(),r=xy(a=e.substring(i+1)).call(a),!n||t[n]&&ER[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t);else if(sE.isObject(e)&&sE.isIterable(e)){let n,r,i={};for(const t of e){if(!sE.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[r=t[0]]=(n=i[r])?sE.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}o(i,t)}else null!=e&&i(t,e,n);var a;return this}get(e,t){if(e=TR(e)){const n=sE.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(sE.isFunction(t))return t.call(this,e,n);if(sE.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=TR(e)){const n=sE.findKey(this,e);return!(!n||void 0===this[n]||t&&!CR(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=TR(e)){const i=sE.findKey(n,e);!i||t&&!CR(0,n[i],i,t)||(delete n[i],r=!0)}}return sE.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!CR(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return sE.forEach(this,((r,i)=>{var o;const a=sE.findKey(n,i);if(a)return t[a]=wR(r),void delete t[i];const s=e?function(e){return xy(e).call(e).toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(i):xy(o=String(i)).call(o);s!==i&&delete t[i],t[s]=wR(r),n[s]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return sE.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&sE.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((e=>{let[t,n]=e;return t+": "+n})).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach((e=>t.set(e))),t}static accessor(e){const t=(this[SR]=this[SR]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=TR(e);t[r]||(function(e,t){const n=sE.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[r]=!0)}return sE.isArray(e)?e.forEach(r):r(e),this}}RR.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),sE.reduceDescriptors(RR.prototype,((e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}})),sE.freezeMethods(RR);var kR=RR;function OR(e,t){const n=this||bR,r=t||n,i=kR.from(r.headers);let o=r.data;return sE.forEach(e,(function(e){o=e.call(n,o,i.normalize(),t?t.status:void 0)})),i.normalize(),o}function IR(e){return!(!e||!e.__CANCEL__)}function NR(e,t,n){cE.call(this,null==e?"canceled":e,cE.ERR_CANCELED,t,n),this.name="CanceledError"}function AR(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new cE("Request failed with status code "+n.status,[cE.ERR_BAD_REQUEST,cE.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}sE.inherits(NR,cE,{__CANCEL__:!0});const xR=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0;const i=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,o=0,a=0;return t=void 0!==t?t:1e3,function(s){const c=Date.now(),l=r[a];i||(i=c),n[o]=s,r[o]=c;let d=a,u=0;for(;d!==o;)u+=n[d++],d%=e;if(o=(o+1)%e,o===a&&(a=(a+1)%e),c-i<t)return;const h=l&&c-l;return h?Math.round(1e3*u/h):void 0}}(50,250);return function(e,t){let n,r,i=0,o=1e3/t;const a=function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();i=o,n=null,r&&(clearTimeout(r),r=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-i;for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];t>=o?a(c,e):(n=c,r||(r=setTimeout((()=>{r=null,a(n)}),o-t)))},()=>n&&a(n)]}((n=>{const o=n.loaded,a=n.lengthComputable?n.total:void 0,s=o-r,c=i(s);r=o,e({loaded:o,total:a,progress:a?o/a:void 0,bytes:s,rate:c||void 0,estimated:c&&a&&o<=a?(a-o)/c:void 0,event:n,lengthComputable:null!=a,[t?"download":"upload"]:!0})}),n)},PR=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},DR=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return sE.asap((()=>e(...n)))};var LR=EC.hasStandardBrowserEnv?((e,t)=>n=>(n=new Ev(n,EC.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new Ev(EC.origin),EC.navigator&&/(msie|trident)/i.test(EC.navigator.userAgent)):()=>!0,MR=EC.hasStandardBrowserEnv?{write(e,t,n,r,i,o){const a=[e+"="+encodeURIComponent(t)];sE.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),sE.isString(r)&&a.push("path="+r),sE.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function jR(e,t,n){let r=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}function UR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const VR=e=>e instanceof kR?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UR(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e):e;function FR(e,t){t=t||{};const n={};function r(e,t,n,r){return sE.isPlainObject(e)&&sE.isPlainObject(t)?sE.merge.call({caseless:r},e,t):sE.isPlainObject(t)?sE.merge({},t):sE.isArray(t)?t.slice():t}function i(e,t,n,i){return sE.isUndefined(t)?sE.isUndefined(e)?void 0:r(void 0,e,0,i):r(e,t,0,i)}function o(e,t){if(!sE.isUndefined(t))return r(void 0,t)}function a(e,t){return sE.isUndefined(t)?sE.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,i,o){return o in t?r(n,i):o in e?r(void 0,n):void 0}const c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(e,t,n)=>i(VR(e),VR(t),0,!0)};return sE.forEach(Object.keys(Object.assign({},e,t)),(function(r){const o=c[r]||i,a=o(e[r],t[r],r);sE.isUndefined(a)&&o!==s||(n[r]=a)})),n}var BR=e=>{const t=FR({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:o,xsrfCookieName:a,headers:s,auth:c}=t;if(t.headers=s=kR.from(s),t.url=bE(jR(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&s.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),sE.isFormData(r))if(EC.hasStandardBrowserEnv||EC.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(!1!==(n=s.getContentType())){const[e,...t]=n?n.split(";").map((e=>xy(e).call(e))).filter(Boolean):[];s.setContentType([e||"multipart/form-data",...t].join("; "))}if(EC.hasStandardBrowserEnv&&(i&&sE.isFunction(i)&&(i=i(t)),i||!1!==i&&LR(t.url))){const e=o&&a&&MR.read(a);e&&s.set(o,e)}return t},WR="undefined"!=typeof XMLHttpRequest&&function(e){return new np((function(t,n){const r=BR(e);let i=r.data;const o=kR.from(r.headers).normalize();let a,s,c,l,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=r;function f(){l&&l(),d&&d(),r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}let m=new XMLHttpRequest;function _(){if(!m)return;const r=kR.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());AR((function(e){t(e),f()}),(function(e){n(e),f()}),{data:u&&"text"!==u&&"json"!==u?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:r,config:e,request:m}),m=null}m.open(r.method.toUpperCase(),r.url,!0),m.timeout=r.timeout,"onloadend"in m?m.onloadend=_:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(_)},m.onabort=function(){m&&(n(new cE("Request aborted",cE.ECONNABORTED,e,m)),m=null)},m.onerror=function(){n(new cE("Network Error",cE.ERR_NETWORK,e,m)),m=null},m.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const i=r.transitional||SE;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new cE(t,i.clarifyTimeoutError?cE.ETIMEDOUT:cE.ECONNABORTED,e,m)),m=null},void 0===i&&o.setContentType(null),"setRequestHeader"in m&&sE.forEach(o.toJSON(),(function(e,t){m.setRequestHeader(t,e)})),sE.isUndefined(r.withCredentials)||(m.withCredentials=!!r.withCredentials),u&&"json"!==u&&(m.responseType=r.responseType),p&&([c,d]=xR(p,!0),m.addEventListener("progress",c)),h&&m.upload&&([s,l]=xR(h),m.upload.addEventListener("progress",s),m.upload.addEventListener("loadend",l)),(r.cancelToken||r.signal)&&(a=t=>{m&&(n(!t||t.type?new NR(null,e,m):t),m.abort(),m=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));const g=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);g&&-1===EC.protocols.indexOf(g)?n(new cE("Unsupported protocol "+g+":",cE.ERR_BAD_REQUEST,e)):m.send(i||null)}))},GR=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const i=function(e){if(!n){n=!0,a();const t=e instanceof Error?e:this.reason;r.abort(t instanceof cE?t:new NR(t instanceof Error?t.message:t))}};let o=t&&setTimeout((()=>{o=null,i(new cE("timeout ".concat(t," of ms exceeded"),cE.ETIMEDOUT))}),t);const a=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach((e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)})),e=null)};e.forEach((e=>e.addEventListener("abort",i)));const{signal:s}=r;return s.unsubscribe=()=>sE.asap(a),s}},HR=r(tp),zR=cS.f("asyncIterator"),KR=r(zR);function qR(e,t){this.v=e,this.k=t}function YR(e){return function(){return new JR(e.apply(this,arguments))}}function JR(e){var t,n;function r(t,n){try{var o=e[t](n),a=o.value,s=a instanceof qR;HR.resolve(s?a.v:a).then((function(n){if(s){var c="return"===t?"return":"next";if(!a.k||n.done)return r(c,n);n=e[c](n).value}i(o.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new HR((function(o,a){var s={key:e,arg:i,resolve:o,reject:a,next:null};n?n=n.next=s:(t=n=s,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function XR(e){return new qR(e,0)}function QR(e){var t={},n=!1;function r(t,r){return n=!0,r=new HR((function(n){n(e[t](r))})),{done:!1,value:new qR(r,1)}}return t[void 0!==aC&&sC||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}JR.prototype["function"==typeof aC&&KR||"@@asyncIterator"]=function(){return this},JR.prototype.next=function(e){return this._invoke("next",e)},JR.prototype.throw=function(e){return this._invoke("throw",e)},JR.prototype.return=function(e){return this._invoke("return",e)};var ZR=r(zR);function $R(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=ZR,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new ek(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function ek(e){function t(e){if(Object(e)!==e)return np.reject(new TypeError(e+" is not an object."));var t=e.done;return np.resolve(e.value).then((function(e){return{value:e,done:t}}))}return ek=function(e){this.s=e,this.n=e.next},ek.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?np.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?np.reject(e):t(n.apply(this.s,arguments))}},new ek(e)}const tk=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},nk=function(){var e=YR((function*(e,t){var n,r=!1,i=!1;try{for(var o,a=$R(rk(e));r=!(o=yield XR(a.next())).done;r=!1){const e=o.value;yield*QR($R(tk(e,t)))}}catch(e){i=!0,n=e}finally{try{r&&null!=a.return&&(yield XR(a.return()))}finally{if(i)throw n}}}));return function(t,n){return e.apply(this,arguments)}}(),rk=function(){var e=YR((function*(e){if(e[ZR])return void(yield*QR($R(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield XR(t.read());if(e)break;yield n}}finally{yield XR(t.cancel())}}));return function(t){return e.apply(this,arguments)}}(),ik=(e,t,n,r)=>{const i=nk(e,t);let o,a=0,s=e=>{o||(o=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await i.next();if(t)return s(),void e.close();let o=r.byteLength;if(n){let e=a+=o;n(e)}e.enqueue(new Uint8Array(r))}catch(e){throw s(e),e}},cancel:e=>(s(e),i.return())},{highWaterMark:2})};function ok(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ak(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ok(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ok(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const sk="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,ck=sk&&"function"==typeof ReadableStream,lk=sk&&("function"==typeof TextEncoder?(dk=new TextEncoder,e=>dk.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var dk;const uk=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch(e){return!1}},hk=ck&&uk((()=>{let e=!1;const t=new Request(EC.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),pk=ck&&uk((()=>sE.isReadableStream(new Response("").body))),fk={stream:pk&&(e=>e.body)};var mk;sk&&(mk=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!fk[e]&&(fk[e]=sE.isFunction(mk[e])?t=>t[e]():(t,n)=>{throw new cE("Response type '".concat(e,"' is not supported"),cE.ERR_NOT_SUPPORT,n)})})));const _k=async(e,t)=>{const n=sE.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(sE.isBlob(e))return e.size;if(sE.isSpecCompliantForm(e)){const t=new Request(EC.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return sE.isArrayBufferView(e)||sE.isArrayBuffer(e)?e.byteLength:(sE.isURLSearchParams(e)&&(e+=""),sE.isString(e)?(await lk(e)).byteLength:void 0)})(t):n};var gk=sk&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:o,timeout:a,onDownloadProgress:s,onUploadProgress:c,responseType:l,headers:d,withCredentials:u="same-origin",fetchOptions:h}=BR(e);l=l?(l+"").toLowerCase():"text";let p,f=GR([i,o&&o.toAbortSignal()],a);const m=f&&f.unsubscribe&&(()=>{f.unsubscribe()});let _;try{if(c&&hk&&"get"!==n&&"head"!==n&&0!==(_=await _k(d,r))){let e,n=new Request(t,{method:"POST",body:r,duplex:"half"});if(sE.isFormData(r)&&(e=n.headers.get("content-type"))&&d.setContentType(e),n.body){const[e,t]=PR(_,xR(DR(c)));r=ik(n.body,65536,e,t)}}sE.isString(u)||(u=u?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,ak(ak({},h),{},{signal:f,method:n.toUpperCase(),headers:d.normalize().toJSON(),body:r,duplex:"half",credentials:i?u:void 0}));let o=await fetch(p);const a=pk&&("stream"===l||"response"===l);if(pk&&(s||a&&m)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=o[t]}));const t=sE.toFiniteNumber(o.headers.get("content-length")),[n,r]=s&&PR(t,xR(DR(s),!0))||[];o=new Response(ik(o.body,65536,n,(()=>{r&&r(),m&&m()})),e)}l=l||"text";let g=await fk[sE.findKey(fk,l)||"text"](o,e);return!a&&m&&m(),await new np(((t,n)=>{AR(t,n,{data:g,headers:kR.from(o.headers),status:o.status,statusText:o.statusText,config:e,request:p})}))}catch(t){if(m&&m(),t&&"TypeError"===t.name&&/Load failed|fetch/i.test(t.message))throw Object.assign(new cE("Network Error",cE.ERR_NETWORK,e,p),{cause:t.cause||t});throw cE.from(t,t&&t.code,e,p)}});const vk={http:null,xhr:WR,fetch:gk};sE.forEach(vk,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const yk=e=>"- ".concat(e),bk=e=>sE.isFunction(e)||null===e||!1===e;var Ek={getAdapter:e=>{e=sE.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let o=0;o<t;o++){let t;if(n=e[o],r=n,!bk(n)&&(r=vk[(t=String(n)).toLowerCase()],void 0===r))throw new cE("Unknown adapter '".concat(t,"'"));if(r)break;i[t||"#"+o]=r}if(!r){const e=Object.entries(i).map((e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")}));throw new cE("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(yk).join("\n"):" "+yk(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:vk};function Sk(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new NR(null,e)}function Tk(e){return Sk(e),e.headers=kR.from(e.headers),e.data=OR.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Ek.getAdapter(e.adapter||bR.adapter)(e).then((function(t){return Sk(e),t.data=OR.call(e,e.transformResponse,t),t.headers=kR.from(t.headers),t}),(function(t){return IR(t)||(Sk(e),t&&t.response&&(t.response.data=OR.call(e,e.transformResponse,t.response),t.response.headers=kR.from(t.response.headers))),np.reject(t)}))}const wk="1.9.0",Ck={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{Ck[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const Rk={};Ck.transitional=function(e,t,n){function r(e,t){return"[Axios v"+wk+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,o)=>{if(!1===e)throw new cE(r(i," has been removed"+(t?" in "+t:"")),cE.ERR_DEPRECATED);return t&&!Rk[i]&&(Rk[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}},Ck.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var kk={assertOptions:function(e,t,n){if("object"!=typeof e)throw new cE("options must be an object",cE.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const o=r[i],a=t[o];if(a){const t=e[o],n=void 0===t||a(t,o,e);if(!0!==n)throw new cE("option "+o+" must be "+n,cE.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new cE("Unknown option "+o,cE.ERR_BAD_OPTION)}},validators:Ck};const Ok=kk.validators;let Ik=class{constructor(e){this.defaults=e||{},this.interceptors={request:new EE,response:new EE}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const n=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+n):e.stack=n}catch(e){}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=FR(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&kk.assertOptions(n,{silentJSONParsing:Ok.transitional(Ok.boolean),forcedJSONParsing:Ok.transitional(Ok.boolean),clarifyTimeoutError:Ok.transitional(Ok.boolean)},!1),null!=r&&(sE.isFunction(r)?t.paramsSerializer={serialize:r}:kk.assertOptions(r,{encode:Ok.function,serialize:Ok.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),kk.assertOptions(t,{baseUrl:Ok.spelling("baseURL"),withXsrfToken:Ok.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&sE.merge(i.common,i[t.method]);i&&sE.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=kR.concat(o,i);const a=[];let s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,a.unshift(e.fulfilled,e.rejected))}));const c=[];let l;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let d,u=0;if(!s){const e=[Tk.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,c),d=e.length,l=np.resolve(t);u<d;)l=l.then(e[u++],e[u++]);return l}d=a.length;let h=t;for(u=0;u<d;){const t=a[u++],n=a[u++];try{h=t(h)}catch(e){n.call(this,e);break}}try{l=Tk.call(this,h)}catch(e){return np.reject(e)}for(u=0,d=c.length;u<d;)l=l.then(c[u++],c[u++]);return l}getUri(e){return bE(jR((e=FR(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};sE.forEach(["delete","get","head","options"],(function(e){Ik.prototype[e]=function(t,n){return this.request(FR(n||{},{method:e,url:t,data:(n||{}).data}))}})),sE.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(FR(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Ik.prototype[e]=t(),Ik.prototype[e+"Form"]=t(!0)}));var Nk=Ik;class Ak{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new np((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new np((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new NR(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Ak((function(t){e=t})),cancel:e}}}var xk=Ak;const Pk={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Pk).forEach((e=>{let[t,n]=e;Pk[n]=t}));var Dk=Pk;const Lk=function e(t){const n=new Nk(t),r=vb(Nk.prototype.request,n);return sE.extend(r,Nk.prototype,n,{allOwnKeys:!0}),sE.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(FR(t,n))},r}(bR);Lk.Axios=Nk,Lk.CanceledError=NR,Lk.CancelToken=xk,Lk.isCancel=IR,Lk.VERSION=wk,Lk.toFormData=mE,Lk.AxiosError=cE,Lk.Cancel=Lk.CanceledError,Lk.all=function(e){return np.all(e)},Lk.spread=function(e){return function(t){return e.apply(null,t)}},Lk.isAxiosError=function(e){return sE.isObject(e)&&!0===e.isAxiosError},Lk.mergeConfig=FR,Lk.AxiosHeaders=kR,Lk.formToJSON=e=>vR(sE.isHTMLForm(e)?new FormData(e):e),Lk.getAdapter=Ek.getAdapter,Lk.HttpStatusCode=Dk,Lk.default=Lk;var Mk=Lk;const jk=()=>{};function Uk(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:jk};return e.promise=new np(((t,n)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(t))}})),e}const Vk=new Map,Fk=new Map,Bk=new Map;let Wk=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Gk=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const Hk=new Jy;let zk=Hk.getResult(),Kk=null;function qk(e){if(!Kk){e&&Hk.setUA(e),zk=Hk.getResult();const t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return Gk.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Gk.CHROME;case"Safari":case"Mobile Safari":return Gk.SAFARI;case"Edge":return Gk.EDGE;case"Firefox":return Gk.FIREFOX;case"QQ":case"QQBrowser":return Gk.QQ;case"Opera":return Gk.OPERA;case"WeChat":return Gk.WECHAT;default:return e.browser.name||""}}(zk),n=Yk(zk),r=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(zk),i=zk.os.version,o=Yk(zk,!1),a=zk.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:o,deviceType:a};Kk={name:t,version:n,os:r,osVersion:i,browserVersion:o,deviceType:a}}return Kk}function Yk(e){let t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function Jk(){return qk().os}function Xk(){const e=qk();return"".concat(e.os," ").concat(e.osVersion)}function Qk(){const e=qk();return!!("WebKit"===zk.engine.name&&e.os===Wk.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Gk.SAFARI||nO()&&e.name!==Gk.SAFARI)}function Zk(){return qk().name===Gk.CHROME}function $k(){return qk().name===Gk.SAFARI}function eO(){return qk().name===Gk.EDGE}function tO(){return qk().name===Gk.FIREFOX}function nO(){return qk().os===Wk.IOS}function rO(e){const t=qk();return!(t.name!==Gk.CHROME||!t.osVersion)&&Number(t.version)>=e}function iO(e){const t=qk();return!(t.name!==Gk.CHROME||!t.osVersion)&&Number(t.version)<e}function oO(e,t,n){const r=qk();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function aO(e){const t=qk();return!(t.name!==Gk.EDGE||!t.osVersion)&&Number(t.version)>=e}function sO(e){const t=qk();return!(t.name!==Gk.SAFARI||!t.osVersion)&&Number(t.version)>=e}function cO(e,t,n){const r=qk();if(r.os!==Wk.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function lO(e,t,n){const r=qk();if(r.name!==Gk.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function dO(e){const t=qk();return!(t.name!==Gk.OPERA||!t.osVersion)&&Number(t.version)>=e}function uO(){const e=qk();if(e.os!==Wk.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function hO(){const e=qk();if(e.os!==Wk.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])}function pO(){const e=qk();if(e.os!==Wk.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])}function fO(){const e=qk();if(e.os!==Wk.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function mO(){return $k()&&navigator.maxTouchPoints>0}function _O(){return qk().name===Gk.WECHAT}function gO(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function vO(){const e=Jk();return function(){const{deviceType:e}=qk();return"mobile"===e||"tablet"===e}()||e===Wk.ANDROID||e===Wk.IOS||e===Wk.HARMONY_OS}function yO(){const e=qk();return e.name!==Gk.EDGE&&e.name!==Gk.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function bO(){return Jk()===Wk.ANDROID}function EO(){const e=qk();return bO()&&(e.name===Gk.CHROME||e.name===Gk.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function SO(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function TO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TO(Object(n),!0).forEach((function(t){SO(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let CO=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),RO=class extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),SO(this,"code",void 0),SO(this,"message",void 0),SO(this,"data",void 0),SO(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,"\ndata: ").concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function kO(e,t){if("boolean"!=typeof e)throw new RO(CO.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function OO(e,t,n){if(!Dr(n).call(n,e))throw new RO(CO.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function IO(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function(e){return"number"==typeof e&&e%1==0}(e))throw new RO(CO.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function NO(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new RO(CO.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&IO(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&IO(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&IO(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&IO(e.ideal,"".concat(t,".ideal"),1,1/0)}else IO(e,t,1,1/0)}function AO(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new RO(CO.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!DO(e,n,r,i))throw new RO(CO.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function xO(e,t){if(!Array.isArray(e))throw new RO(CO.INVALID_PARAMS,"".concat(t," should be an array"))}function PO(e){return null==e}function DO(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!r||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}(e))}var LO=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(LO||{}),MO=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(MO||{});const jO=new class{constructor(){SO(this,"_clientSize",null),SO(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),SO(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),SO(this,"getStyle",(e=>window.getComputedStyle(e,null))),SO(this,"checkCssVisibleProperty",(e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:o,opacity:a,filter:s}=r;return("none"===i||Dr(t=["hidden","collapse"]).call(t,o)||Number(a)<.1)&&(n=!1),!!n&&(s&&s.split(" ").filter((e=>{var t;const n=e.split("(")[0];return Dr(t=["brightness","blur","opacity"]).call(t,n)})).map((e=>{const[t,n]=e.split(/\(|\)/);return[t,Number(n.match(/^[0-9\.]+/))]})).forEach((e=>{const[t,r]=e;switch(t){case"brightness":(r<.1||r>3)&&(n=!1);break;case"blur":r>3&&(n=!1);break;case"opacity":r<.1&&(n=!1)}})),n)})),SO(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let n=!0,r=!0;const i=e=>t(e);let o=e;for(;o&&r;)i(o)||(n=!1,r=!1),o=o.parentElement,o||(r=!1);return n})),SO(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),SO(this,"getSizeAboutClient",(e=>{const{width:t,height:n,left:r,right:i,top:o,bottom:a}=e.getBoundingClientRect(),s=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:o,bottom:a,clientWidth:s,clientHeight:c,clientMin:Math.min(s,c)}})),SO(this,"checkActualSize",(()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)})),SO(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),SO(this,"checkCoverForAPoint",((e,t,n)=>{const r=this.elementFromPoint(e,t);return null!==r&&r!==n})),SO(this,"getPointPositionList",(()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,o=t/6,a=[],s=10**6;for(let c=0;c<5;c++)for(let e=0;e<5;e++){const t=(n*s+(0===c?.1:4===c?(i*c*s-1e5)/s:i*c)*s)/s,l=(r*s+(0===e?.1:4===e?(o*e*s-1e5)/s:o*e)*s)/s;a.push({x:t,y:l})}return[...a]})),SO(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((e=>!!e)).length>6)),SO(this,"checkSizeIsVisible",((e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10))),SO(this,"checkSizeOfPartInClient",(()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:o,clientMin:a}=this._clientSize;let s,c,l,d;if(e<0)s=0;else{if(!(e<o))return!1;s=e}if(t<0)return!1;if(c=t<o?t:o,n<0)l=0;else{if(!(n<i))return!1;l=n}if(r<0)return!1;d=r<i?r:i;const u=c-s,h=d-l;return this.checkSizeIsVisible(u,h,a)})),SO(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),SO(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(LO.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(LO.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(LO.SIZE)}}return this.returnHiddenResult(LO.STYLE)}return this.returnHiddenResult(MO.UNMOUNTED)}return this.returnHiddenResult(MO.INVALID_HTML_ELEMENT)})),SO(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))))}};function UO(e){return(new TextEncoder).encode(e)}const VO=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},FO=async e=>function(e,t){let n="";return new Uint8Array(e).forEach((e=>{n+=e.toString(t).padStart(2,"0")})),n}(await crypto.subtle.digest("SHA-256",UO(e)),16);let BO=class{constructor(){SO(this,"_events",{}),SO(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map((e=>e.listener)):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map((e=>e));for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let o=0;o<t.length;o+=1){const n=t[o];n.once&&this.off(e,n.listener),n.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach((t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,n)}catch(t){console.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}}))}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},WO=null;function GO(){if(WO)return WO;if(window.electron)return WO=window.electron;if(!window.require)return null;try{return WO=window.require("electron"),WO}catch(e){return null}}let HO=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),zO=function(e){return e.TRACER="tracer",e}({});function KO(e){return IO(e.timeout,"config.timeout",0,1e5),IO(e.timeoutFactor,"config.timeoutFactor",0,100,!1),IO(e.maxRetryCount,"config.maxRetryConfig",0,1/0),IO(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let qO=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),YO=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function JO(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((e=>{if(!e.urls)throw Error()}))}catch(e){return!1}return!0}function XO(e){return AO(e.turnServerURL,"turnServerURL"),AO(e.username,"username"),AO(e.password,"password"),e.udpport&&IO(e.udpport,"udpport",1,99999,!0),e.forceturn&&kO(e.forceturn,"forceturn"),e.security&&kO(e.security,"security"),e.tcpport&&IO(e.tcpport,"tcpport",1,99999,!0),!0}function QO(e){return void 0!==e.level&&OO(e.level,"level",[1,2,3]),void 0!==e.delay&&IO(e.delay,"delay",0,3e3,!0),!0}let ZO=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),$O=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),eI=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),tI=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function nI(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===e.getListeners(t).length?np.reject(new RO(CO.UNEXPECTED_ERROR,"can not emit promise")):new np(((n,i)=>{e.emit(t,...r,n,i)}))}function rI(e,t){if(0===e.getListeners(t).length)return np.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return nI(e,t,...r)}function iI(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return oI(e,t,...r)}function oI(e,t){let n=null,r=null;for(var i=arguments.length,o=new Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];if(e.emit(t,...o,(e=>{n=e}),(e=>{r=e})),null!==r)throw r;if(null===n)throw new RO(CO.UNEXPECTED_ERROR,"handler is not sync");return n}const aI=new class extends BO{set networkState(e){this.emit(tI.NETWORK_STATE_CHANGE,e,this._networkState),e===eI.ONLINE?this.emit(tI.ONLINE):e===eI.OFFLINE&&(this.onlineWaiter=new np((e=>{this.once(tI.ONLINE,(()=>{this.onlineWaiter=void 0,e(eI.ONLINE)}))})),this.emit(tI.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===eI.ONLINE}constructor(){super(),SO(this,"_moduleName","network-indicator"),SO(this,"_networkState",eI.ONLINE),SO(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=eI.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=eI.OFFLINE}))}};function sI(e,t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}function cI(e){const t=[];return e.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),t}function lI(e){void 0!==np?np.resolve().then(e):setTimeout(e,0)}function dI(e){return JSON.parse(JSON.stringify(e))}function uI(e){try{return dI(e)}catch(t){return e}}const hI={};function pI(e,t){hI[t]||(hI[t]=!0,e())}function fI(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function mI(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function _I(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=(new TextEncoder).encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const e=new Uint8Array(t);e.set(n),n=e}return n}function gI(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=ii(t).call(t,((e,t)=>e+t.length),0),i=new Uint8Array(new ArrayBuffer(r));let o=0;return t.forEach((e=>{i.set(e,o),o+=e.length})),i}function vI(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function yI(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach((e=>{t+="string"==typeof e?vI(e):e.size})),t+138}function bI(e){const t=new RO(CO.TIMEOUT,"timeout");return new np(((n,r)=>{window.setTimeout((()=>r(t)),e)}))}function EI(e){return new np((t=>{window.setTimeout(t,e)}))}function SI(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+SI(e-n.length,"")}function TI(){return SI(32,"").toUpperCase()}const wI=()=>{},CI=new class{constructor(){SO(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,o=new Array(i>4?i-4:0),a=4;a<i;a++)o[a-4]=arguments[a];if(this.fnMap.has(t)){const i=this.fnMap.get(t);if(i.threshold!==n){i.fn(...i.args),clearTimeout(i.timer);const a=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:a,args:o,skipFn:r})}else i.skipFn&&i.skipFn(...i.args),this.fnMap.set(t,wO(wO({},i),{},{fn:e,args:o,skipFn:r}))}else{const i=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:i,args:o,skipFn:r})}}},RI=CI.throttleByKey.bind(CI);function kI(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function OI(e,t){if(!kI(e)||!kI(t))return t;if(Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=OI(e[r],t[r]);return n}{const n=wO({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=OI(e[r],t[r]):n[r]=t[r]);return n}}function II(e,t){let n=[0];if(t&&(n=new Array(t).fill(0)),0===e)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,!t||r!==t););return n}function NI(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function AI(e){return ii(e).call(e,((e,t)=>e+t),0)}function xI(e){const t="0123456789abcdef";function n(e){let n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,o,a){return r(function(e,t){return e<<t|e>>>32-t}(r(r(t,e),r(i,a)),o),n)}function o(e,t,n,r,o,a,s){return i(t&n|~t&r,e,t,o,a,s)}function a(e,t,n,r,o,a,s){return i(t&r|n&~r,e,t,o,a,s)}function s(e,t,n,r,o,a,s){return i(t^n^r,e,t,o,a,s)}function c(e,t,n,r,o,a,s){return i(n^(t|~r),e,t,o,a,s)}const l=function(e){let t;const n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e);let d,u,h,p,f,m=1732584193,_=-271733879,g=-1732584194,v=271733878;for(d=0;d<l.length;d+=16)u=m,h=_,p=g,f=v,m=o(m,_,g,v,l[d+0],7,-680876936),v=o(v,m,_,g,l[d+1],12,-389564586),g=o(g,v,m,_,l[d+2],17,606105819),_=o(_,g,v,m,l[d+3],22,-1044525330),m=o(m,_,g,v,l[d+4],7,-176418897),v=o(v,m,_,g,l[d+5],12,1200080426),g=o(g,v,m,_,l[d+6],17,-1473231341),_=o(_,g,v,m,l[d+7],22,-45705983),m=o(m,_,g,v,l[d+8],7,1770035416),v=o(v,m,_,g,l[d+9],12,-1958414417),g=o(g,v,m,_,l[d+10],17,-42063),_=o(_,g,v,m,l[d+11],22,-1990404162),m=o(m,_,g,v,l[d+12],7,1804603682),v=o(v,m,_,g,l[d+13],12,-40341101),g=o(g,v,m,_,l[d+14],17,-1502002290),_=o(_,g,v,m,l[d+15],22,1236535329),m=a(m,_,g,v,l[d+1],5,-165796510),v=a(v,m,_,g,l[d+6],9,-1069501632),g=a(g,v,m,_,l[d+11],14,643717713),_=a(_,g,v,m,l[d+0],20,-373897302),m=a(m,_,g,v,l[d+5],5,-701558691),v=a(v,m,_,g,l[d+10],9,38016083),g=a(g,v,m,_,l[d+15],14,-660478335),_=a(_,g,v,m,l[d+4],20,-405537848),m=a(m,_,g,v,l[d+9],5,568446438),v=a(v,m,_,g,l[d+14],9,-1019803690),g=a(g,v,m,_,l[d+3],14,-187363961),_=a(_,g,v,m,l[d+8],20,1163531501),m=a(m,_,g,v,l[d+13],5,-1444681467),v=a(v,m,_,g,l[d+2],9,-51403784),g=a(g,v,m,_,l[d+7],14,1735328473),_=a(_,g,v,m,l[d+12],20,-1926607734),m=s(m,_,g,v,l[d+5],4,-378558),v=s(v,m,_,g,l[d+8],11,-2022574463),g=s(g,v,m,_,l[d+11],16,1839030562),_=s(_,g,v,m,l[d+14],23,-35309556),m=s(m,_,g,v,l[d+1],4,-1530992060),v=s(v,m,_,g,l[d+4],11,1272893353),g=s(g,v,m,_,l[d+7],16,-155497632),_=s(_,g,v,m,l[d+10],23,-1094730640),m=s(m,_,g,v,l[d+13],4,681279174),v=s(v,m,_,g,l[d+0],11,-358537222),g=s(g,v,m,_,l[d+3],16,-722521979),_=s(_,g,v,m,l[d+6],23,76029189),m=s(m,_,g,v,l[d+9],4,-640364487),v=s(v,m,_,g,l[d+12],11,-421815835),g=s(g,v,m,_,l[d+15],16,530742520),_=s(_,g,v,m,l[d+2],23,-995338651),m=c(m,_,g,v,l[d+0],6,-198630844),v=c(v,m,_,g,l[d+7],10,1126891415),g=c(g,v,m,_,l[d+14],15,-1416354905),_=c(_,g,v,m,l[d+5],21,-57434055),m=c(m,_,g,v,l[d+12],6,1700485571),v=c(v,m,_,g,l[d+3],10,-1894986606),g=c(g,v,m,_,l[d+10],15,-1051523),_=c(_,g,v,m,l[d+1],21,-2054922799),m=c(m,_,g,v,l[d+8],6,1873313359),v=c(v,m,_,g,l[d+15],10,-30611744),g=c(g,v,m,_,l[d+6],15,-1560198380),_=c(_,g,v,m,l[d+13],21,1309151649),m=c(m,_,g,v,l[d+4],6,-145523070),v=c(v,m,_,g,l[d+11],10,-1120210379),g=c(g,v,m,_,l[d+2],15,718787259),_=c(_,g,v,m,l[d+9],21,-343485551),m=r(m,u),_=r(_,h),g=r(g,p),v=r(v,f);return n(m)+n(_)+n(g)+n(v)}let PI=1,DI=console,LI=class{static setLogger(e){DI=e}constructor(e,t){SO(this,"id",void 0),SO(this,"lockingPromise",np.resolve()),SO(this,"locks",0),SO(this,"name",""),SO(this,"lockId",void 0),this.lockId=PI++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r="created"===e?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(null!=t?t:"");DI.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new np((n=>{t=()=>{this.locks-=1,this.logger("unlocked",e),n()}})),r=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>n)),r}};function MI(e,t){return function(n,r,i){const o=i.value;if("function"!=typeof o)throw new Error("Cannot use mutex on object property.");return i.value=async function(){const n=this[t];if(!n)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const i=await n.lock("From ".concat(e,".").concat(r));try{for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return await o.apply(this,s)}finally{i()}},i}}const jI={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function UI(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function VI(e,t,n,r){const i=Object.assign({},jI,r);let o=i.timeout;const a=async()=>{await function(e){return new np((t=>{window.setTimeout(t,e)}))}(o),o*=i.timeoutFactor,o=Math.min(i.maxRetryTimeout,o)};let s=!1;const c=new np((async(r,o)=>{t=t||(()=>!1),n=n||(()=>!0);for(let c=0;c<i.maxRetryCount;c+=1){if(s)return o(new RO(CO.OPERATION_ABORTED));try{const n=await e();if(!t(n,c))return r(n);if(c+1===i.maxRetryCount)return r(n);await a()}catch(e){if(!n(e,c))return o(e);if(c+1===i.maxRetryCount)return o(e);await a()}}}));return c.cancel=()=>s=!0,c}let FI,BI=class{constructor(e){SO(this,"input",[]),SO(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:ii(e=this.input).call(e,((e,t)=>e+t))/this.input.length}},WI=0,GI=0;function HI(e,t,n,r){return new np(((i,o)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),WI+=vI(t.data)):n&&(t.data.size?WI+=t.data.size:t.data instanceof FormData?WI+=yI(t.data):WI+=vI(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Mk.request(t).then((e=>{"string"==typeof e.data?GI+=vI(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?GI+=e.data.byteLength:GI+=vI(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((e=>{Mk.isCancel(e)?o(new RO(CO.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new RO(CO.NETWORK_TIMEOUT,e.message)):e.response?o(new RO(CO.NETWORK_RESPONSE_ERROR,e.response.status)):o(new RO(CO.NETWORK_ERROR,e.message))}))}))}async function zI(e,t){const n=new Blob([t.data],{type:"buffer"});return await HI(e,wO(wO({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const KI=()=>void 0!==window.isSecureContext;function qI(e){if(Array.isArray(e))return e.map((e=>e));if(!YI(e))return e;const t={};for(const n in e){const r=e[n];YI(r)||Array.isArray(r)?t[n]=qI(r):t[n]=r}return t}function YI(e){return!("object"!=typeof e||Array.isArray(e)||!e)}let JI=class{constructor(e){SO(this,"input",[]),SO(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const XI={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},QI={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:XI,remoteCandidate:XI},updateInterval:0},ZI={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},$I={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},eN={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},tN={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let nN=class{constructor(e,t){SO(this,"onFirstVideoReceived",void 0),SO(this,"onFirstVideoDecoded",void 0),SO(this,"onFirstAudioReceived",void 0),SO(this,"onFirstVideoDecodedTimeout",void 0),SO(this,"onFirstAudioDecoded",void 0),SO(this,"onSelectedLocalCandidateChanged",void 0),SO(this,"onSelectedRemoteCandidateChanged",void 0),SO(this,"videoIsReady",!1),SO(this,"videoIsReady2",{}),SO(this,"pc",void 0),SO(this,"options",void 0),SO(this,"intervalTimer",void 0),SO(this,"stats",qI(QI)),SO(this,"isFirstVideoReceived",{}),SO(this,"isFirstVideoDecoded",{}),SO(this,"isFirstAudioReceived",{}),SO(this,"isFirstAudioDecoded",{}),SO(this,"isFirstVideoDecodedTimeout",{}),SO(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new np((e=>{e({local:wO({},XI),remote:wO({},XI)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,o=0,a=0;for(const s of n)e[s].forEach(((e,n)=>{if(!this.lossRateWindowStats[t-1][s][n]||!this.lossRateWindowStats[0][s][n])return;const c=this.lossRateWindowStats[t-1][s][n].packets-this.lossRateWindowStats[0][s][n].packets,l=this.lossRateWindowStats[t-1][s][n].packetsLost-this.lossRateWindowStats[0][s][n].packetsLost;"videoSend"===s||"audioSend"===s?(r+=c,o+=l):(i+=c,a+=l),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||l<=0?0:l/(c+l)}));e.sendPacketLossRate=r<=0||o<=0?0:o/(r+o),e.recvPacketLossRate=i<=0||a<=0?0:a/(i+a)}},rN=class extends nN{constructor(){super(...arguments),SO(this,"_stats",QI),SO(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=qI(QI);const n=t.filter((e=>"ssrc"===e.type));this.processSSRCStats(n);const r=t.find((e=>"VideoBwe"===e.type));r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((e=>{var t;const n=Dr(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(n?"send":"recv")){case"video_send":{const t=qI($I);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{const t=qI(ZI),n=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),n){const r=n.stats,i=Date.now()-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<n.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:wO({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{const t=qI(tN);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{const t=qI(eN);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}}))}_getStats(){return new np(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){const t=[];return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t.push(n)})),t}},iN=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),oN=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),aN=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),sN=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var cN=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(cN||{});function lN(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:cN.kNone;if(!t)return;const o=Number(t[n]);if("number"!=typeof o)return;const a=Number(t[r]);if("number"!=typeof a)return;if(!e)return a?o/a*i:void 0;const s=Number(e[n]);if("number"!=typeof s)return;const c=Number(e[r]);if("number"!=typeof c)return;const l=a-c;return l?(o-s)/l*i:void 0}let dN=class extends nN{constructor(){super(...arguments),SO(this,"_stats",QI),SO(this,"report",void 0),SO(this,"lastDecodeVideoReceiverStats",new Map),SO(this,"lastVideoFramesRecv",new Map),SO(this,"lastVideoFramesSent",new Map),SO(this,"lastVideoFramesDecode",new Map),SO(this,"lastVideoFramesOutput",new Map),SO(this,"lastVideoJBDelay",new Map),SO(this,"lastAudioJBDelay",new Map),SO(this,"mediaBytesSent",new Map),SO(this,"mediaBytesRetransmit",new Map),SO(this,"mediaBytesTargetEncode",new Map),SO(this,"lastDecodeAudioReceiverStats",new Map),SO(this,"lastAudioConcealment",new Map),SO(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=qI(QI),this.report.forEach((e=>{switch(e.type){case sN.OUTBOUND:case sN.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===sN.OUTBOUND?"audio"===t||r?this.processAudioOutboundStats(e):("video"===t||n)&&this.processVideoOutboundStats(e):e.type===sN.INBOUND&&("audio"===t||r?this.processAudioInboundStats(e):("video"===t||n)&&this.processVideoInboundStats(e));break}case sN.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case sN.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:wO({},XI),remote:wO({},XI)};return e.forEach((n=>{let r;if(n.type===sN.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===sN.CANDIDATE_PAIR&&n.selected&&(r=n),r){const n=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(r.localCandidateId){const i=e.get(r.localCandidateId);i&&n(t.local,i)}if(r.remoteCandidateId){const i=e.get(r.remoteCandidateId);i&&n(t.remote,i)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===sN.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===sN.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===sN.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(wO({},t),wO({},this.stats.selectedCandidatePair.localCandidate)),e.type===sN.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(wO({},t),wO({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((t=>t.ssrc===e.ssrc));t||(t=qI(tN),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=lN(n,t,"totalProcessingDelay","jitterBufferEmittedCount",cN.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,wO({},t))}calculateAudioFreeze(e,t,n){const r=this.lastAudioConcealment.get(e.ssrc);if(null!=t&&null!=r){const i=r.lts,o=n.timestamp,a=o-i;if(a<=0)return;const s=e.concealedSamples-t.concealedSamples-0,c=r.nonSilent+s,l=e.totalSamplesReceived-t.totalSamplesReceived;if(l<=0)return;const d=80*l/a,u=200*l/a,h=a/l;let p=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,c>d&&(r.plc80>0?(e.freezeSamples80+=s,e.freezeMs80+=Math.round(s*h)):(e.freezeSamples80+=c,e.freezeMs80+=Math.round(c*h)),p=r.plc80+1);let f=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,c>u&&(r.plc200>0?(e.freezeSamples200+=s,e.freezeMs200+=Math.round(s*h)):(e.freezeSamples200+=c,e.freezeMs200+=Math.round(c*h)),f=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:s,lts:o,plc80:p,plc200:f})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find((t=>t.ssrc===e.ssrc));t||(t=qI(ZI),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),o=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const e=t.decodedFrame?t.decodedFrame.width:0,n=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,n),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const r=n.stats,i=o-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&i>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<r.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=lN(null==n?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=lN(null==n?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",cN.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=lN(null==n?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",cN.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=lN(null==n?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",cN.kMillisecondsFromSeconds),r&&o-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((o-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&o-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:wO({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((t=>t.ssrc===e.ssrc));t||(t=qI($I),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const t=new JI(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){const t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{const t=new JI(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){const t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{const t=new JI(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const r=e.framesEncoded-n.lastFrameCount,i=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*i/r}}if(e.framesEncoded&&e.qpSum){const n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,sN.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((t=>t.ssrc===e.ssrc));if(t||(t=qI(eN),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,sN.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(up(n=this.report).call(n)).find((n=>n.type===t&&n.ssrc===e));return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,o,a;const s=t?this.report.get(t):void 0,c=null!==(r=null==s?void 0:s.framesSent)&&void 0!==r?r:e.framesSent;if("number"!=typeof c)return;let l=null!==(i=null==s?void 0:s.frameWidth)&&void 0!==i?i:e.frameWidth,d=null!==(o=null==s?void 0:s.frameHeight)&&void 0!==o?o:e.frameHeight,u=null!==(a=null==s?void 0:s.framesPerSecond)&&void 0!==a?a:e.framesPerSecond;if("number"==typeof l&&"number"==typeof d||(l=0,d=0),null==u){const e=Date.now(),t=this.lastVideoFramesSent.get(n.ssrc);t&&e-t.lts>=800?(u=Math.round((c-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:u})):t?u=t.rate:this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:0})}n.sentFrame={width:l,height:d,frameRate:Math.max(0,u)}}processVideoTrackReceiverStats(e,t,n){var r,i,o,a,s;const c=t?this.report.get(t):void 0,l=null!==(r=null==c?void 0:c.framesReceived)&&void 0!==r?r:e.framesReceived,d=null!==(i=null==c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,u=null!==(o=null==c?void 0:c.frameHeight)&&void 0!==o?o:e.frameHeight,h=null!==(a=null==c?void 0:c.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,p=null!==(s=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount;if("number"==typeof l){const e=this.lastVideoFramesRecv.get(n.ssrc),t=Date.now();n.framesReceivedCount=l;let r=0;e&&t-e.lts>=800?(r=Math.round((l-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:r})):e?r=e.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:0}),n.receivedFrame={width:d||0,height:u||0,frameRate:r||0},n.decodedFrame={width:d||0,height:u||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:d||0,height:u||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(h&&p){const e=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const r=p-e.jitterBufferEmittedCount;r>0&&(t=1e3*(h-e.jitterBufferDelay)/r),n.jitterBufferMs=t,n.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,o,a;const s=t?this.report.get(t):void 0,c=null!==(r=null!==(i=null==s?void 0:s.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==r?r:0,l=null!==(o=null!==(a=null==s?void 0:s.echoReturnLossEnhancement)&&void 0!==a?a:e.echoReturnLossEnhancement)&&void 0!==o?o:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(e,t,n){var r,i,o,a,s,c,l,d,u;const h=t?this.report.get(t):void 0,p=null!==(r=null==h?void 0:h.removedSamplesForAcceleration)&&void 0!==r?r:e.removedSamplesForAcceleration,f=null!==(i=null==h?void 0:h.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,m=null!==(o=null==h?void 0:h.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,_=null!==(a=null==h?void 0:h.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount,g=null!==(s=null==h?void 0:h.audioLevel)&&void 0!==s?s:null==e?void 0:e.audioLevel,v=null!==(c=null==h?void 0:h.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,y=null!==(l=null==h?void 0:h.concealedSamples)&&void 0!==l?l:e.concealedSamples,b=null!==(d=null==h?void 0:h.silentConcealedSamples)&&void 0!==d?d:e.silentConcealedSamples,E=null!==(u=null==h?void 0:h.concealmentEvents)&&void 0!==u?u:e.concealmentEvents;if("number"==typeof f&&(n.totalSamplesReceived=f),"number"==typeof b&&(n.silentConcealedSamples=b),"number"==typeof E&&(n.concealmentEvents=E),"number"==typeof y&&(n.concealedSamples=y),p&&f&&(n.accelerateRate=p/f),m&&_){const e=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const r=_-e.jitterBufferEmittedCount;r>0&&(t=1e3*(m-e.jitterBufferDelay)/r),n.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:m,jitterBufferEmittedCount:_,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=g;let S=1920;v&&f&&(S=f/v/50,n.receivedFrames=Math.round(f/S)),y&&(n.droppedFrames=Math.round(y/S))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach((t=>{e+=t.diffMean()})),this.mediaBytesRetransmit.forEach((e=>{t=null===t?e.diffMean():t+e.diffMean()})),this.mediaBytesTargetEncode.forEach((e=>{n=null===n?e.diffMean():n+e.diffMean()}));const r=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},uN=class extends nN{updateStats(){return np.resolve()}};function hN(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const o=function(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return o?o<76?new rN(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new dN(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(e){if(!window.RTCStatsReport)return!1;const t=e.getStats();return!!(t instanceof np||function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}(t))}(e)?new dN(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new uN(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}const pN="websdk_ng_install_id";function fN(){try{if(CN("INSTALL_ID"))return CN("INSTALL_ID");let e=window.localStorage.getItem(pN);return e||(e=TI(),window.localStorage.setItem(pN,e)),wN("INSTALL_ID",e),e}catch(e){return}}const mN=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const e=t[1],n=t[2];return"".concat(e,".").concat(n)}return"4.0.0.999"}("4.23.4"),_N=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}();let gN=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const vN=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let s=0;s<6;s++)i.push("1");const o=i.join(""),a={};return a[e]=r,a[t]=o,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=vN;const yN={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},bN={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},EN="v4.23.4-0-g17410532-dirty(6/5/2025, 4:24:52 PM)",SN={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1},TN=wO(wO(wO(wO({},SN),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:bN,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},yN),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:void 0,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function wN(e,t,n){var r,i,o;Dr(r=Object.keys(TN)).call(r,e)&&(!n&&Dr(i=Object.keys(kN)).call(i,e)||(TN[e]=t,"ENABLE_VIDEO_SEI"!==e&&"ENABLE_AUDIO_TOPN"!==e&&"ENABLE_AUDIO_METADATA"!==e&&"ENABLE_AUDIO_PTS_METADATA"!==e||!0!==t||(TN.ENABLE_ENCODED_TRANSFORM=!0,"ENABLE_AUDIO_PTS_METADATA"===e&&(TN.ENABLE_AUDIO_METADATA=!0)),"USE_NEW_NETWORK_CONFIG"===e&&t&&(o=!!t,TN.USE_NEW_NETWORK_CONFIG=o,o&&(TN.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],TN.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],TN.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],TN.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],TN.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",TN.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",TN.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===e&&t&&(TN.ENABLE_INSTANT_VIDEO=!0,TN.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===e&&t&&(TN.ENABLE_AUT_CC=!0),"NEW_FORCE_TURN"===e&&t&&(TN.NEW_TURN_MODE||(TN.NEW_TURN_MODE=4))))}function CN(e){return TN[e]}_N||(TN.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],TN.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],TN.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],TN.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],TN.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],TN.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],TN.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",TN.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",TN.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",TN.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",TN.AREAS=["NORTH_AMERICA","OVERSEA"]);let RN=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const kN={};var ON=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ON||{});let IN=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});!function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"}({});const NN=128,AN=96,xN=1e3,PN=10;let DN=0;var LN=(()=>{var e={8:(e,t,n)=>{n.r(t),n.d(t,{Parser:()=>S,Printer:()=>k,parse:()=>A,print:()=>x});const r="\n",i="".concat("\r").concat(r),o=" ";let a;function s(e){return e>="0"&&e<="9"}function c(e){return e>="!"&&e<="~"}function l(e){return c(e)||e>="\x80"&&e<="\xff"}function d(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function u(e){return e>="1"&&e<="9"}function h(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function p(e){return"d"===e||"h"===e||"m"===e||"s"===e}function f(e){return e>"\x01"&&e<"\t"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function m(e){return h(e)||s(e)||"+"===e||"/"===e}function _(e){return s(e)||h(e)||"+"===e||"/"===e||"-"===e||"_"===e}function g(e){return h(e)||s(e)||"+"===e||"/"===e}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){b(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(a||(a={}));class E{consumeText(e,t){let n=t;for(;n<e.length;){const t=e[n];if("\0"===t||"\r"===t||t===r)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}consumeUnicastAddress(e,t,n){return this.consumeTill(e,t,o)}consumeOneOrMore(e,t,n){let r=t;for(;n(e[r]);)r++;if(r-t==0)throw new Error("Invalid rule at ".concat(t,"."));return r}consumeSpace(e,t){if(e[t]===o)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let n=t;for(let r=0;r<4;r++)if(n=this.consumeDecimalUChar(e,n),3!==r){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}consumeDecimalUChar(e,t){let n=t;for(let i=0;i<3&&s(e[n]);i++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");const r=parseInt(e.slice(t,n));if(r>=0&&r<=255)return n;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let n=this.consumeHexpart(e,t);return":"===e[n]?(n+=1,n=this.consumeIP4Address(e,n),n):n}consumeHexpart(e,t){let n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}if(n=this.consumeHexseq(e,n),":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}return n}consumeHexseq(e,t){let n=t;for(;n=this.consumeHex4(e,n),":"===e[n]&&":"!==e[n+1];)n+=1;return n}consumeHex4(e,t){let n=0;for(;n<4;n++)if(!((r=e[t+n])>="0"&&r<="9"||r>="a"&&r<="f"||r>="A"&&r<="F")){if(0===n)throw new Error("Invalid hex 4");break}var r;return t+n}consumeFQDN(e,t){let n=t;for(;s(e[n])||h(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,l)}consumeMulticastAddress(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(n){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){const n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}consumeIP4MulticastAddress(e,t){let n=t+3;const r=e.slice(t,n),i=parseInt(r);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let o=0;o<3;o++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),n=this.consumeTTL(e,n),"/"===e[n]&&(n=this.consumeInteger(e,n)),n}consumeInteger(e,t){if(!u(e[t]))throw new Error("Invalid integer.");for(t+=1;s(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!u(e[t]))throw new Error("Invalid TTL.");t+=1;for(let n=0;n<2&&s(e[t]);n++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,d)}consumeTime(e,t){let n=t;if("0"===e[n])return n+1;for(u(e[n])&&(n+=1);s(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}consumeAddress(e,t){return this.consumeTill(e,t,o)}consumeTypedTime(e,t){let n=t;return n=this.consumeOneOrMore(e,n,s),p(e[n])?n+1:n}consumeRepeatInterval(e,t){if(!u(e[t]))throw new Error("Invalid repeat interval");for(t+=1;s(e[t]);)t+=1;return p(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,s)}consume(e,t,n){for(let r=0;r<n.length;r++){if(t+r>=e.length)throw new Error("consume exceeding value length");if(e[t+r]!==n[r])throw new Error("consume ".concat(n," failed at ").concat(r))}return t+n.length}consumeTill(e,t,n){let r=t;for(;r<e.length&&("string"!=typeof n||e[r]!==n)&&("function"!=typeof n||!n(e[r]));)r++;return r}}class S extends E{constructor(){super(),b(this,"records",[]),b(this,"currentLine",0)}parse(e){const t=this.probeEOL(e);this.records=e.split(t).filter((e=>!!xy(e).call(e))).map(this.parseLine),this.currentLine=0;const n=this.parseVersion(),r=this.parseOrigin(),i=this.parseSessionName(),o=this.parseInformation(),a=this.parseUri(),s=this.parseEmail(),c=this.parsePhone(),l=this.parseConnection(),d=this.parseBandWidth(),u=this.parseTimeFields(),h=this.parseKey(),p=this.parseSessionAttribute(),f=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:r,sessionName:i,information:o,uri:a,emails:s,phones:c,connection:l,bandwidths:d,timeFields:u,key:h,attributes:p,mediaDescriptions:f}}getCurrentRecord(){const e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===r)return"\r"===e[t-1]?i:r;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){const e=new w;for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==a.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(t,(e=>d(e)&&":"!==e)),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,f)),e.parse(n),this.currentLine++}return e.digest()}parseMediaAttributes(e){const t=new C(e);for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==a.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(e,(e=>d(e)&&":"!==e)),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,n.attValue=this.extractOneOrMore(e,f)),t.parse(n),this.currentLine++}return t.digest()}parseKey(){const e=this.getCurrentRecord();if(e.type===a.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const e=this.getCurrentRecord();if(e.type===a.ZONE_ADJUSTMENTS){const t=[];for(;;)try{const n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let r=!1;"-"===e.value[e.cur]&&(r=!0,e.cur+=1);const i=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:i,back:r})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.REPEAT)break;{const n=this.extract(t,this.consumeRepeatInterval),r=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:r}),this.currentLine++}}return e}parseTypedTime(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);const n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}parseBandWidth(){const e=[];for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==a.BANDWIDTH)break;{const n=this.extractOneOrMore(t,d);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;const r=this.extractOneOrMore(t,s);e.push({bwtype:n,bandwidth:r}),this.currentLine++}}return e}parseVersion(){const e=this.getCurrentRecord();if(e.type!==a.VERSION)throw new Error("first sdp record must be version");const t=e.value.slice(0,this.consumeOneOrMore(e.value,0,s));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){const e=this.getCurrentRecord();if(e.type!==a.ORIGIN)throw new Error("second line of sdp must be origin");const t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,s);this.consumeSpaceForRecord(e);const r=this.extractOneOrMore(e,s);this.consumeSpaceForRecord(e);const i=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const o=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const c=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:r,nettype:i,addrtype:o,unicastAddress:c}}parseSessionName(){const e=this.getCurrentRecord();if(e.type===a.SESSION_NAME){const t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){const e=this.getCurrentRecord();if(e.type!==a.INFORMATION)return;const t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){const e=this.getCurrentRecord();if(e.type===a.URI)return this.currentLine++,e.value}parseEmail(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){const e=this.getCurrentRecord();if(e.type===a.CONNECTION){const t=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const r=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:r}}}parseMedia(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);const r=[];for(r.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,r.push(this.extract(e,this.consumeToken));if(0===r.length)throw new Error("Invalid proto");const i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:r,fmts:i}}parseTimeFields(){const e=[];for(;this.getCurrentRecord().type===a.TIME;){const t=this.parseTime(),n=this.parseRepeat(),r=this.parseZone();e.push({time:t,repeats:n,zones:r})}return e}parseMediaDescription(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===a.MEDIA;){const t=this.parseMedia(),n=this.parseInformation(),r=this.parseConnections(),i=this.parseBandWidth(),o=this.parseKey(),a=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:r,bandwidths:i,key:o,attributes:a})}return e}parseConnections(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===a.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const o=t.call(this,e.value,e.cur,...r),a=e.value.slice(e.cur,o);return e.cur=o,a}extractOneOrMore(e,t){const n=this.consumeOneOrMore(e.value,e.cur,t),r=e.value.slice(e.cur,n);return e.cur=n,r}consumeSpaceForRecord(e){if(e.value[e.cur]!==o)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class T extends E{constructor(){super(...arguments),b(this,"attributes",void 0),b(this,"digested",!1)}extractOneOrMore(e,t,n){const r=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,r),[o,a]=n||[];if("number"==typeof o&&i.length<o)throw new Error("error in length, should be more or equal than ".concat(o," characters."));if("number"==typeof a&&i.length>a)throw new Error("error in length, should be less or equal than ".concat(a," characters."));return e._cur=r,i}consumeAttributeSpace(e){if(e.attValue[e._cur]!==o)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const o=t.call(this,e.attValue,e._cur,...r),a=e.attValue.slice(e._cur,o);return e._cur=o,a}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,m,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,m,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,m));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}parseExtmap(e){const t=this.extractOneOrMore(e,s);let n;"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),n=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeTill,o),i=y(y({entry:parseInt(t,10)},n&&{direction:n}),{},{extensionName:r});this.peekChar(e)===o&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class w extends T{constructor(){super(...arguments),b(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,_)}parseIdentity(e){const t=this.extractOneOrMore(e,g),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");const r=this.extractOneOrMore(e,(e=>e!==o&&f(e)));n.push({name:t,value:r})}this.attributes.identities.push({assertionValue:t,extensions:n})}parseMsidSemantic(e){this.peekChar(e)===o&&this.consumeAttributeSpace(e);const t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{const n=this.extract(e,this.consumeTill,o);t.identifierList.push(n)}}this.attributes.msidSemantic=t}}class C extends T{constructor(e){super(),b(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){const t=this.extractOneOrMore(e,m,[1,32]);this.consumeAttributeSpace(e);const n=this.extractOneOrMore(e,s,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const i=this.extractOneOrMore(e,s,[1,10]);this.consumeAttributeSpace(e);const a=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const l=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);const d={foundation:t,componentId:n,transport:r,priority:i,connectionAddress:a,port:l,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),d.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),d.relPort=this.extract(e,this.consumePort));this.peekChar(e)===o;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),d.extension[t]=this.extractOneOrMore(e,c)}this.attributes.candidates.push(d)}parseRemoteCandidate(e){const t=[];for(;;){const n=this.extractOneOrMore(e,s,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const i=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:r,port:i});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");const r={encodingName:n,clockRate:this.extractOneOrMore(e,s)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),r.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.rtpMap=r:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:r,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){const t=this.extractOneOrMore(e,s);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,":");let r;":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),r=this.extract(e,this.consumeTill));const i=this.attributes.ssrcs.find((e=>e.ssrcId===parseInt(t,10)));i?i.attributes[n]=r:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[n]:r}})}parseFmtp(e){const t=this.extract(e,this.consumeTill,o);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill),r={};n.split(";").forEach((e=>{let[t,n]=e.split("=");t=xy(t).call(t);const i="string"==typeof n?xy(n).call(n):null;"string"==typeof t&&t.length>0&&(r[t]=i)}));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.fmtp={parameters:r}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:r}})}parseFmtParameters(e){const t={},n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");for(t[n]=r;";"===e.attValue[e._cur];){const n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");t[n]=r}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,o),this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,o);let r;if("trr-int"===n)r={type:n,interval:this.extract(e,this.consumeTill)};else{const t={type:n};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===o&&(t.additional=this.extract(e,this.consumeTill))),r=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(r);else{const e=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));e?e.rtcpFeedbacks.push(r):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[r]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const t={port:this.extract(e,this.consumePort)};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){const t={id:this.extractOneOrMore(e,d,[1,64])};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,d,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){const t=this.extractOneOrMore(e,(e=>h(e)||s(e)||"_"===e||"-"===e));this.consumeAttributeSpace(e);const n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===o){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");const t=[];for(;;){const n=this.extract(e,this.consumeToken);t.push(n);try{this.extract(e,this.consume,",")}catch(e){break}}n.payloads=t,this.peekChar(e)===o&&this.extract(e,this.consume,o)}for(;;){const t=this.extract(e,this.consumeToken);switch(t){case"depend":{const r={type:t,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(r);break}default:{const r={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),r.val=this.extract(e,this.consumeTill,";")),n.params.push(r)}}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(n)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,s,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,s,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;;)try{this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeInteger);n.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class k{constructor(){R(this,"eol",i)}print(e,t){let n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions),n}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printPhone(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(const n of e)t+="b=".concat(n.bwtype,":").concat(n.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(const n of e){t+="t=".concat(n.time.startTime," ").concat(n.time.startTime).concat(this.eol);for(const e of n.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);n.zoneAdjustments&&(t+="z=",t+="z=".concat(n.zoneAdjustments.map((e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime))).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(const n of e)t+="a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(const n of e)t+=this.printMedia(n.media),t+=this.printInformation(n.information),t+=this.printConnections(n.connections),t+=this.printBandwidth(n.bandwidths),t+=this.printKey(n.key),t+=this.printMediaAttributes(n);return t}printConnections(e){let t="";for(const n of e)t+=this.printConnection(n);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new I(this.eol).print(e)}printMediaAttributes(e){return new N(this.eol).print(e)}}class O{constructor(e){R(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(o)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map((e=>"a=fingerprint:".concat(e.hashFunction).concat(o).concat(e.fingerprint))).join(this.eol)+this.eol:""}printExtmap(e){return e.map((e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(o).concat(e.extensionName).concat(e.extensionAttributes?"".concat(o).concat(e.extensionAttributes):"").concat(this.eol))).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map((e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol))).join("")}}class I extends O{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map((e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map((e=>"".concat(o).concat(e))).join("")).concat(this.eol))).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map((e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map((e=>"".concat(o).concat(e.name).concat(e.value?"=".concat(e.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(o,"*"):e.identifierList.length>0&&(t+=e.identifierList.map((e=>"".concat(o).concat(e)))),t+this.eol}}class N extends O{print(e){const t=e.attributes;let n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized),n}printCandidates(e){return e.map((e=>"a=candidate:".concat(e.foundation).concat(o).concat(e.componentId).concat(o).concat(e.transport).concat(o).concat(e.priority).concat(o).concat(e.connectionAddress).concat(o).concat(e.port).concat(o,"typ").concat(o).concat(e.type).concat(e.relAddr?"".concat(o,"raddr").concat(o).concat(e.relAddr):"").concat(e.relPort?"".concat(o,"rport").concat(o).concat(e.relPort):"").concat(Object.keys(e.extension).map((t=>"".concat(o).concat(t).concat(o).concat(e.extension[t]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(e){return e.map((e=>"a=remote-candidates:".concat(e.join(o)).concat(this.eol))).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";const t=e.payloads;let n="";n+=e.rtcpFeedbackWildcards.map((e=>this.printRTCPFeedback("*",e))).join("");for(const r of t)n+=this.printRtpMap(r.payloadType,r.rtpMap),n+=this.printFmtp(r.payloadType,r.fmtp),n+=r.rtcpFeedbacks.map((e=>this.printRTCPFeedback(r.payloadType,e))).join("");return n}printFmtp(e,t){if(!t)return"";const n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(o).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(o).concat(Object.keys(t.parameters).map((e=>"".concat(e,"=").concat(t.parameters[e]))).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(o).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let n="a=rtcp-fb:".concat(e).concat(o),r=t;return"trr-int"===r.type?n+="ttr-int".concat(o).concat(r.interval):(n+="".concat(r.type),r.parameter&&(n+="".concat(o).concat(r.parameter),r.additional&&(n+="".concat(o).concat(r.additional)))),n+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map((e=>Object.keys(e.attributes).map((t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(o).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(o).concat(e.netType)),e.addressType&&(t+="".concat(o).concat(e.addressType)),e.address&&(t+="".concat(o).concat(e.address)),t+this.eol}printMSId(e){return e.map((e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(o).concat(e.appdata):"").concat(this.eol))).join("")}printImageattr(e){return e.map((e=>"a=imageattr:".concat(e).concat(this.eol))).join("")}printRid(e){return e.map((e=>{let t="a=rid:".concat(e.id).concat(o).concat(e.direction);return e.payloads&&(t+="".concat(o,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(o).concat(e.params.map((e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val))).join(";"))),t+this.eol})).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map((e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map((e=>"".concat(o).concat(e.toString(10)))).join("")).concat(this.eol))).join("")}}function A(e){return(new S).parse(e)}function x(e,t){return(new k).print(e,t)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)})();function MN(e){return LN.parse(e)}function jN(e,t){return LN.print(e,t)}var UN=er("Array","keys"),VN=_r,FN=et,BN=u,WN=UN,GN=Array.prototype,HN={DOMTokenList:!0,NodeList:!0},zN=function(e){var t=e.keys;return e===GN||BN(GN,e)&&t===GN.keys||FN(HN,VN(e))?WN:t},KN=r(zN);function qN(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function YN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function JN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?YN(Object(n),!0).forEach((function(t){qN(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const XN=new class extends BO{constructor(){super(...arguments),qN(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class QN{constructor(e){qN(this,"logger",void 0),qN(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function ZN(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function $N(){const e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const eA={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},tA=Date.now(),nA=e=>{for(const t in eA)if(Object.prototype.hasOwnProperty.call(eA,t)&&eA[t]===e)return t;return"DEFAULT"},rA=new class{constructor(){qN(this,"proxyServerURL",void 0),qN(this,"logLevel",eA.DEBUG),qN(this,"uploadState","collecting"),qN(this,"uploadLogWaitingList",[]),qN(this,"uploadLogUploadingList",[]),qN(this,"uploadErrorCount",0),qN(this,"currentLogID",0),qN(this,"url",void 0),qN(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[eA.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[eA.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[eA.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[eA.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[eA.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){wN("UPLOAD_LOG",!0)}disableLogUpload(){wN("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new QN(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-tA<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-tA);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=ZN()+" Agora-SDK [".concat(nA(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=ZN()+" %cAgora-SDK [".concat(nA(r),"]:");let o=[];if(!CN("USE_NEW_LOG"))switch(r){case eA.DEBUG:o=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case eA.INFO:o=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case eA.WARNING:o=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case eA.ERROR:o=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-tA<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-tA);const r=Math.max(0,Math.min(4,t[0]));t[0]=ZN()+" Agora-SDK [".concat(nA(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!CN("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=$N()+" Agora-SDK [".concat(nA(e),"]:"):n[0]=$N()+" Agora-SDK [".concat(nA(e),"]:");let i="";n.forEach((e=>{"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")})),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:mN,process_id:CN("PROCESS_ID"),payload:JSON.stringify(e)};return VI((async()=>{const e=await Mk.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(CN("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(CN("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){const t=new Error("unexpected upload log response");throw t.response=e,t}}),(()=>(this.uploadLogUploadingList=[],!1)),(t=>{const n={status:-1,message:t.message,errorRange:e.map((e=>e.log_item_id))};return t.response?(n.status=t.response.status,n.data=t.response.data,n.headers=t.response.headers):t.request&&(n.status=t.request.status),XN.reportLogUploadError(n),!0}),{timeout:CN("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:CN("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,CN("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),CN("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),CN("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),CN("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var iA;function oA(e){return AO(e.reportId,"params.reportId",0,100,!1),AO(e.category,"params.category",0,100,!1),AO(e.event,"params.event",0,100,!1),AO(e.label,"params.label",0,100,!1),IO(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(iA={}).FREE="free",iA.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const aA={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let sA=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),cA=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});!function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}({});let lA=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function dA(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,r){const i=r.value;if("function"==typeof i){const o=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);r.value=function(){for(var t,r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];let c=a;if(e.argsMap)try{c=e.argsMap(this,...a)}catch(e){rA.warning(e),c=[]}try{JSON.stringify(c)}catch(e){rA.warning("arguments for method ".concat(o,".").concat(String(n)," not serializable for apiInvoke.")),c=[]}const l=(e.report||uA).reportApiInvoke(this._sessionId||null,{id:this._clientId||(null===(t=this.store)||void 0===t?void 0:t.clientId)||this._ID,name:"".concat(o,".").concat(String(n)),options:c,tag:zO.TRACER,reportResult:e.reportResult},e.throttleTime);try{const t=i.apply(this,a);return t instanceof np?t.then((t=>(l.onSuccess(e.reportResult&&t),t))).catch((e=>{throw l.onError(e),e})):(l.onSuccess(e.reportResult&&t),t)}catch(e){throw l.onError(e),e}}}return r}}const uA=new class{constructor(){qN(this,"baseInfoMap",new Map),qN(this,"proxyServer",void 0),qN(this,"eventUploadTimer",void 0),qN(this,"setSessionIdTimer",void 0),qN(this,"url",void 0),qN(this,"sids",new Set),qN(this,"backupUrl",void 0),qN(this,"_appId",void 0),qN(this,"_aid",0),qN(this,"keyEventUploadPendingItems",[]),qN(this,"normalEventUploadPendingItems",[]),qN(this,"apiInvokeUploadPendingItems",[]),qN(this,"apiInvokeCount",0),qN(this,"apiInvokeLoggedCount",0),qN(this,"ltsList",[]),qN(this,"lastSendNormalEventTime",Date.now()),qN(this,"customReportCounterTimer",void 0),qN(this,"customReportCount",0),qN(this,"extApiInvoke",(async e=>{for(const t of e){const e=JN(JN({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:zO.TRACER});this.sendApiInvoke(e)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),CN("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),CN("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,(e=>{let[t,n]=e;return t+n})),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,o=!!CN("SHOW_REPORT_INVOKER_LOG"),a=!!CN("SHOW_REPORT_USER_INVOKER_LOG"),s=o||a&&t.id;s&&(this.apiInvokeLoggedCount+=1);const c=this.apiInvokeLoggedCount;function l(e,n){if(s){let r="[apiInvoke-".concat(c,"]");if(t.id&&(r+="[".concat(t.id,"]")),t.name&&(r+="[".concat(t.name,"]"),t.name===HO.JOIN))return rA.info("".concat(r," ").concat(e));rA.info("".concat(r," ").concat(e),"start"===e?t.options:n||"")}}const d=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});l("start");let u=!1;EI(t.timeout).then((()=>{u||(this.sendApiInvoke(JN(JN({},d()),{},{error:CO.API_INVOKE_TIMEOUT,success:!1})),l("timeout"))}));const h=new RO(CO.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{const r=()=>{if(u)throw h;return u=!0,this.sendApiInvoke(JN(JN({},d()),{},{success:!0},t.reportResult&&{result:e})),l("onSuccess"),e};return n?RI(r,t.name+"Success",n,(()=>u=!0)):r()},onError:e=>{const r=()=>{if(u)throw e;u=!0,this.sendApiInvoke(JN(JN({},d()),{},{success:!1,error:e})),l("onFailure",e.toString())};return n?RI(r,t.name+"Error",n,(()=>u=!0)):r()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:CN("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:_N?"global":"oversea",areas:CN("AREAS")&&CN("AREAS").join(",")},t.extend),{stringUid:o,channelProfile:a,channelMode:s,isABTestSuccess:c,lsid:l,clientRole:d}=t,u=Date.now(),h=JN(JN({},r),{},{eventType:sA.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:EN,lts:u,elapse:u-n,extend:JSON.stringify(i),mode:t.mode,process:CN("PROCESS_ID"),appType:CN("APP_TYPE"),success:!0,version:mN,stringUid:o,channelProfile:a,channelMode:s,isABTestSuccess:c,lsid:l,clientType:Dr(p=window.navigator.userAgent).call(p,"AgoraWebView")?42:20,clientRole:d,serviceId:CN("PROCESS_ID"),extensionID:CN("PLUGIN_INFO").join(",")||""});var p;this.send({type:cA.SESSION,data:h},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=JN(JN({},r),{},{role:t.role,eventType:sA.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:cA.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=JN(JN({},r),{},{eventType:sA.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:cA.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:o,addr:a,isProxy:s}=t,c=i-n.startTime,l=JN(JN({},r),{},{eventType:sA.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:c,eventElapse:i-t.lts,firstSuccess:o,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:fN(),isABTestSuccess:t.isABTestSuccess?1:0}),d=l.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),o)this.send({type:cA.JOIN_GATEWAY,data:l},!0);else{let e;if(a)if(s){const t=a.match(/h=(\d{1,3}-){3}\d{1,3}/g),n=a.match(/p=[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("=")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split("=")[1]:"",isProxy:s?1:0}}else{const t=a.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),n=a.match(/(:|p=)[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("//")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split(/:|p=/g)[1]:"",isProxy:s?1:0}}else e={isSuccess:d,gatewayIp:"",port:"",isProxy:s?1:0};delete l.success,delete l.eventType,delete l.firstSuccess,l.vid=Number(l.vid);const t=Object.assign({},l,e,{eventType:sA.REJOIN_GATEWAY});this.send({type:cA.RE_JOIN_GATEWAY,data:t},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=JN(JN({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:cA.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=JN(JN({},r),{},{eventType:sA.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:cA.PUBLISH,data:o},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,o=Date.now(),a=JN(JN({},i),{},{eventType:sA.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?a.peerSuid=t.peerid:a.peer=t.peerid,this.send({type:cA.SUBSCRIBE,data:a},!0)}wsCompressorInit(e){var t;const n=[...KN(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const o=i.info,a=Date.now(),s=JN(JN({},o),{},{eventType:sA.WS_COMPRESSOR_INIT,lts:a,eventElapse:e.eventElapse,elapse:a-i.startTime,status:e.status?1:2});this.send({type:cA.WS_COMPRESSOR_INIT,data:s},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),s=JN(JN(JN({},o),r),{},{elapse:a-i.startTime,eventType:t,lts:a,firstDecodeFrame:Math.max((r.firstFrame||a)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:s},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),s=JN(JN(JN({},o),r),{},{elapse:a-i.startTime,eventType:t,lts:a});this.send({type:n,data:s},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=JN(JN(JN({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:sA.AB_TEST,lts:i});this.send({type:cA.AB_TEST,data:o},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=JN(JN(JN({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:sA.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:cA.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=JN(JN(JN({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),eventType:sA.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:cA.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),s=JN(JN(JN({},o),r),{},{eventType:t,lts:a});this.send({type:n,data:s},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=JN(JN({},r),{},{eventType:sA.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:cA.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=JN(JN({},r),{},{eventType:sA.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:cA.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=JN(JN({},r),{},{eventType:sA.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:cA.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,e?rA.debug("reportProxyServerurl: ".concat(e)):rA.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=JN(JN({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:cA.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(e,t,n){const r=e[t];if(!r||"string"!=typeof r)return[e];e[t]="";const i=vI(JSON.stringify(e));let o=0;const a=[];let s=0;for(let c=0;c<r.length;c++)s+=r.charCodeAt(c)<=127?1:3,s<=n-i||(a[a.length]=wO(wO({},e),{},{[t]:r.substring(o,c)}),o=c,s=r.charCodeAt(c)<=127?1:3);return o!==r.length-1&&(a[a.length]=wO(wO({},e),{},{[t]:r.substring(o)})),a})(JN(JN(JN({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach((e=>this.send({type:cA.WORKER_EVENT,data:e},!0)))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=JN(JN(JN({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:cA.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=JN(JN(JN({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:cA.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=JN(JN(JN({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:cA.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>CN("CUSTOM_REPORT_LIMIT"))throw new RO(CO.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const n=Date.now(),r=t.map((t=>({type:cA.USER_ANALYTICS,data:JN(JN({sid:e},t),{},{lts:n})})));try{CN("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(e){throw rA.error("send custom report message failed",e.toString()),new RO(CO.CUSTOM_REPORT_SEND_FAILED,e.message)}}sendApiInvoke(e){const t=CN("NOT_REPORT_EVENT");if(e.tag&&Dr(t)&&Dr(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:o}=n.info;let a;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof RO){const{code:t,message:n}=e.error;a=t||n||e.error.toString()}else a=e.error.toString();const s={invokeId:e.invokeId,sid:e.sid,cname:r,cid:o,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?a:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:cA.API_INVOKE,data:s},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(0===e.length)return;const t=Array.from(this.sids).find((e=>null!==e));t&&e.forEach((e=>{e&&(e.sid=t,this.sendApiInvoke(Object.assign({},e)))})),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>CN("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const t=e.shift();n.length<20?n.push(t):r.push(t)}e.push(...r);for(const o of[...n]){var i;-1!==this.ltsList.indexOf(o.data.lts)?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),Jp(i=this.ltsList).call(i,((e,t)=>e-t)))}return t||(this.lastSendNormalEventTime=Date.now()),CN("ENABLE_EVENT_REPORT")?(n.length&&(CN("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((e=>n=>{CN("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(e):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(e),this.normalEventUploadPendingItems.length>CN("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-CN("NORMAL_EVENT_QUEUE_CAPACITY")),rA.warning("report: drop normal events"))))})(n)),e):e}async postDataToStatsCollector2(e){aI.networkState===eI.OFFLINE&&await np.race([aI.onlineWaiter,EI(2*jI.maxRetryTimeout)]);const t=e=>{let t=new Uint8Array;return e.forEach((e=>{const n=UO(JSON.stringify(e.data)),r=new ArrayBuffer(5),i=(e=>{let t=0;return Object.entries(cA).forEach((n=>{let[r,i]=n;i===e.type&&(t=lA[r])})),t})(e),o=new DataView(r);o.setUint16(0,n.byteLength,!0),o.setUint8(2,255&i),o.setUint8(3,i>>>8&255),o.setUint8(4,i>>>16&255),t=VO(t,new Uint8Array(r)),t=VO(t,n)})),t},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(CN("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(CN("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){1===i&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(CN("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(CN("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await HI(r,{timeout:1e4,data:t(e),headers:JN(JN({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(e){if(1===i)throw e;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(e=>{const t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0]),r=n?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((e=>JSON.stringify(e))),vid:n,aid:r};aI.networkState===eI.OFFLINE&&await np.race([aI.onlineWaiter,EI(2*jI.maxRetryTimeout)]);const o=t?"/events/proto-raws":"/events/messages";let a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(CN("EVENT_REPORT_DOMAIN"),"&p=").concat(CN("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(CN("EVENT_REPORT_DOMAIN"),":").concat(CN("STATS_COLLECTOR_PORT")).concat(o));for(let s=0;s<2;s+=1){1===s&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(CN("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(CN("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(CN("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(CN("STATS_COLLECTOR_PORT")).concat(o)));try{t?await zI(a,{timeout:1e4,data:i}):await HI(a,{timeout:1e4,data:i})}catch(t){if(1===s)throw t;continue}return}}createBaseInfo(e,t){const n=Object.assign({},aA);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:zO.TRACER}).onSuccess()}};XN.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=aI.networkState,uA.reportApiInvoke(null,{name:"logUploadError",options:e,tag:zO.TRACER}).onSuccess("logUploadError")}));class hA extends RO{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),qN(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return super.print(e,rA)}throw(){super.throw(rA)}}const pA={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function fA(){return pA}function mA(){return"setSinkId"in HTMLAudioElement.prototype&&(!CN("RESTRICTION_SET_PLAYBACK_DEVICE")||(Zk()||eO())&&!vO())}function _A(){return!pA.supportUnifiedPlan||CN("CHROME_FORCE_PLAN_B")&&yO()}let gA=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function vA(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function yA(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function bA(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function EA(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const SA={"90p":yA(160,90),"90p_1":yA(160,90),"120p":yA(160,120,15,30,65),"120p_1":yA(160,120,15,30,65),"120p_3":yA(120,120,15,30,50),"120p_4":yA(212,120),"180p":yA(320,180,15,30,140),"180p_1":yA(320,180,15,30,140),"180p_3":yA(180,180,15,30,100),"180p_4":yA(240,180,15,30,120),"240p":yA(320,240,15,40,200),"240p_1":yA(320,240,15,40,200),"240p_3":yA(240,240,15,40,140),"240p_4":yA(424,240,15,40,220),"360p":yA(640,360,15,80,400),"360p_1":yA(640,360,15,80,400),"360p_3":yA(360,360,15,80,260),"360p_4":yA(640,360,30,80,600),"360p_6":yA(360,360,30,80,400),"360p_7":yA(480,360,15,80,320),"360p_8":yA(480,360,30,80,490),"360p_9":yA(640,360,15,80,800),"360p_10":yA(640,360,24,80,800),"360p_11":yA(640,360,24,80,1e3),"480p":yA(640,480,15,100,500),"480p_1":yA(640,480,15,100,500),"480p_2":yA(640,480,30,100,1e3),"480p_3":yA(480,480,15,100,400),"480p_4":yA(640,480,30,100,750),"480p_6":yA(480,480,30,100,600),"480p_8":yA(848,480,15,100,610),"480p_9":yA(848,480,30,100,930),"480p_10":yA(640,480,10,100,400),"720p":yA(1280,720,15,120,1130),"720p_auto":yA(1280,720,30,900,3e3),"720p_1":yA(1280,720,15,120,1130),"720p_2":yA(1280,720,30,120,2e3),"720p_3":yA(1280,720,30,120,1710),"720p_5":yA(960,720,15,120,910),"720p_6":yA(960,720,30,120,1380),"1080p":yA(1920,1080,15,120,2080),"1080p_1":yA(1920,1080,15,120,2080),"1080p_2":yA(1920,1080,30,120,3e3),"1080p_3":yA(1920,1080,30,120,3150),"1080p_5":yA(1920,1080,60,120,4780),"1440p":yA(2560,1440,30,120,4850),"1440p_1":yA(2560,1440,30,120,4850),"1440p_2":yA(2560,1440,60,120,7350),"4k":yA(3840,2160,30,120,8910),"4k_1":yA(3840,2160,30,120,8910),"4k_3":yA(3840,2160,60,120,13500)},TA={"480p":bA(640,480,5),"480p_1":bA(640,480,5),"480p_2":bA(640,480,30),"480p_3":bA(640,480,15),"720p":bA(1280,720,5),"720p_auto":yA(1280,720,30,900,3e3),"720p_1":bA(1280,720,5),"720p_2":bA(1280,720,30),"720p_3":bA(1280,720,15),"1080p":bA(1920,1080,5),"1080p_1":bA(1920,1080,5),"1080p_2":bA(1920,1080,30),"1080p_3":bA(1920,1080,15)},wA={"1SL1TL":EA(1,1),"3SL3TL":EA(3,3),"2SL3TL":EA(2,3)};function CA(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},SA[e]):e}function RA(e){return"string"==typeof e?Object.assign({},TA[e]):e}function kA(e){return"string"==typeof e?Object.assign({},wA[e]):e}const OA={speech_low_quality:vA(16e3,!1),speech_standard:vA(32e3,!1,18),music_standard:vA(48e3,!1),standard_stereo:vA(48e3,!0,56),high_quality:vA(48e3,!1,128),high_quality_stereo:vA(48e3,!0,192)};function IA(e){return"string"==typeof e?Object.assign({},OA[e]):e}const NA=[];function AA(e){return OO(e,"mediaSource",["screen","window","application"]),!0}let xA=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),PA=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),DA=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),LA=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),MA=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),jA=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),UA=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),VA=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),FA=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),BA=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});const WA={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},GA={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},HA={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},zA={uplinkNetworkQuality:0,downlinkNetworkQuality:0},KA={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let qA=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),YA=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),JA=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),XA=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),QA=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),ZA=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const $A={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let ex=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function tx(e,t,n,r,i){var o,a,s={};return Object.keys(r).forEach((function(e){s[e]=r[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=ii(o=gi(a=n.slice()).call(a)).call(o,(function(n,r){return r(e,t,n)||n}),s),i&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(i):void 0,s.initializer=void 0),void 0===s.initializer?(Object.defineProperty(e,t,s),null):s}function nx(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ix(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rx(Object(n),!0).forEach((function(t){nx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class ox extends BO{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(jA.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),nx(this,"trackMediaType",void 0),nx(this,"_ID",void 0),nx(this,"_rtpTransceiver",void 0),nx(this,"_lowRtpTransceiver",void 0),nx(this,"_hints",[]),nx(this,"_isClosed",!1),nx(this,"_originMediaStreamTrack",void 0),nx(this,"mediaStreamTrack",void 0),nx(this,"_external",{}),this._ID=t||SI(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(e){Dr(NA).call(NA,e)||NA.push(e)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||pI((()=>{var e;uA.reportApiInvoke(null,{name:HO.GET_MEDIA_STREAM_TRACK,options:[],tag:zO.TRACER}).onSuccess((null===(e=this._mediaStreamTrack)||void 0===e?void 0:e.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===DA.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const t=NA.indexOf(e);-1!==t&&NA.splice(t,1)}(this),this.emit(UA.CLOSED),this.removeAllListeners(jA.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===DA.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(jA.TRANSCEIVER_UPDATED,e,t)}}class ax extends ox{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),nx(this,"_enabled",!0),nx(this,"_muted",!1),nx(this,"_isExternalTrack",!1),nx(this,"_isClosed",!1),nx(this,"_enabledMutex",void 0),nx(this,"processor",void 0),nx(this,"_processorContext",void 0),nx(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new LI("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,rA.debug("[".concat(this.getTrackId(),"] close")),this.emit(xA.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=n,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await rI(this,xA.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){rA.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(UA.TRACK_ENDED)}stateCheck(e,t){if(rA.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),kO(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new RO(CO.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",rA);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new RO(CO.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",rA)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():np.resolve([])}}const sx=window.AudioContext||window.webkitAudioContext;let cx=null;const lx=new class extends BO{constructor(){super(...arguments),nx(this,"prevState",void 0),nx(this,"curState",void 0),nx(this,"currentTime",void 0),nx(this,"currentTimeStuckAt",void 0),nx(this,"interruptDetectorTrack",void 0),nx(this,"onLocalAudioTrackMute",(()=>{rA.info("ios15-interruption-start"),this.emit(gA.IOS_15_16_INTERRUPTION_START)})),nx(this,"onLocalAudioTrackUnmute",(async()=>{rA.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?rA.info("ios15-interruption-end-canceled"):(cx&&await cx.suspend(),this.emit(gA.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){rA.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){rA.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function dx(){if(!cx){if(function(){if(!sx)return void rA.error("your browser is not support web audio");rA.info("create audio context");const e=ix({},CN("WEBAUDIO_INIT_OPTIONS"));rA.debug("audio context init option:",JSON.stringify(e)),cx=new sx(e),lx.curState=cx.state,cx.onstatechange=()=>{lx.prevState=lx.curState,lx.curState=cx?cx.state:void 0;const{prevState:e,curState:t}=lx,n="running"===t,r="interrupted"===t,i="running"===e,o="suspended"===e,a="interrupted"===e,s=qk().osVersion;(nO()||mO())&&i&&r&&(rA.info("ios".concat(s,"-interruption-start")),lx.emit(gA.IOS_INTERRUPTION_START)),(nO()||mO())&&(o||a)&&n&&(rA.info("ios".concat(s,"-interruption-end")),lx.emit(gA.IOS_INTERRUPTION_END)),e!==t&&lx.emit(gA.STATE_CHANGE,t,e)},setInterval((()=>{var e;const t=null===(e=cx)||void 0===e?void 0:e.currentTime;lx.currentTime!==t?(lx.currentTimeStuckAt&&(rA.debug("AudioContext current time resume at ".concat(t)),lx.currentTimeStuckAt=void 0),lx.currentTime=t):(t!==lx.currentTimeStuckAt&&(uA.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:zO.TRACER}).onSuccess(),rA.warning("AudioContext current time stuck at ".concat(t))),lx.currentTimeStuckAt=t)}),5e3),async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,r=!1,i=!1,o=!1;function a(t){"running"===e.state?s(!1):nO()||mO()?"suspended"===e.state&&(s(!0),t&&e.resume().then(c,c)):"closed"!==e.state&&(s(!0),t&&e.resume().then(c,c))}function s(e){if(r!==e){r=e;for(let n=0,r=t;n<r.length;n+=1){const t=r[n];e?window.addEventListener(t,l,{capture:!0,passive:!0}):window.removeEventListener(t,l,{capture:!0,passive:!0})}}}function c(){a(!1)}function l(){a(!0)}function d(e){if(!o)if(n.paused)if(e){let t;u(!1),o=!0;try{t=n.play(),t?t.then(h,h):(n.addEventListener("playing",h),n.addEventListener("abort",h),n.addEventListener("error",h))}catch(e){h()}}else u(!0);else u(!1)}function u(e){if(i!==e){i=e;for(let n=0,r=t;n<r.length;n++){const t=r[n];e?window.addEventListener(t,p,{capture:!0,passive:!0}):window.removeEventListener(t,p,{capture:!0,passive:!0})}}}function h(){n.removeEventListener("playing",h),n.removeEventListener("abort",h),n.removeEventListener("error",h),o=!1,d(!1)}function p(){d(!0)}if(nO()){const t=e.createMediaStreamDestination(),r=document.createElement("div");r.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=r.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=t.stream,d(!0)}lx.on(gA.STATE_CHANGE,(function(){a(!0)})),a(!1)}(cx)}(),!cx)throw new RO(CO.NOT_SUPPORTED,"can not create audio context");return cx}return cx}function ux(e){if(function(){if(null!==hx)return hx;const e=dx(),t=e.createBufferSource(),n=e.createGain(),r=e.createGain();t.connect(n),t.connect(r),t.disconnect(n);let i=!1;try{t.disconnect(n)}catch(e){i=!0}return t.disconnect(),hx=i,i}())return;const t=e.connect,n=e.disconnect;e.connect=(n,r,i)=>{var o;return e._inputNodes||(e._inputNodes=[]),Dr(o=e._inputNodes).call(o,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=(r,i,o)=>{n.call(e),r?sI(e._inputNodes,r):e._inputNodes=[];for(const n of e._inputNodes)t.call(e,n)}}let hx=null;function px(e,t){let n=!1;const r=1/t;if(CN("DISABLE_WEBAUDIO")){const t=window.setInterval((()=>{n?window.clearInterval(t):e(performance.now()/1e3)}),1e3*r)}else{const t=dx();let i=t.createGain();i.gain.value=0,i.connect(t.destination);const o=()=>{if(n)return void(i=null);const a=t.createOscillator();a.onended=o,a.connect(i),a.start(0),a.stop(t.currentTime+r),e(t.currentTime)};o()}return()=>{n=!0}}class fx{constructor(){nx(this,"context",void 0),nx(this,"analyserNode",void 0),nx(this,"sourceNode",void 0),this.context=dx(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode)return 0;if(!this.context||nO()||mO()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let n=0;n<e.length;++n)e[n]=t[n]/128-1}const t=ii(e).call(e,((e,t)=>e+t*t),0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){rA.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class mx extends BO{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),nx(this,"outputNode",void 0),nx(this,"outputTrack",void 0),nx(this,"isPlayed",!1),nx(this,"sourceNode",void 0),nx(this,"context",void 0),nx(this,"audioBufferNode",void 0),nx(this,"destNode",void 0),nx(this,"audioOutputLevel",0),nx(this,"volumeLevelAnalyser",void 0),nx(this,"_processedNode",void 0),nx(this,"playNode",void 0),nx(this,"isDestroyed",!1),nx(this,"onNoAudioInput",void 0),nx(this,"isNoAudioInput",!1),nx(this,"_noAudioInputCount",0),this.context=dx(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),ux(this.outputNode),this.volumeLevelAnalyser=new fx}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(BA.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){const n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!fA().webAudioMediaStreamDest)throw new RO(CO.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&lI((()=>{lx.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;nO()||mO()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();const t=this.volumeLevelAnalyser.getAnalyserNode();let n;t.getFloatTimeDomainData?(n=new Float32Array(t.fftSize),t.getFloatTimeDomainData(n)):(n=new Uint8Array(t.fftSize),t.getByteTimeDomainData(n));let r=!1;for(let i=0;i<n.length;i++)0!==n[i]&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await EI(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class _x extends mx{get isFreeze(){return!1}constructor(e,t,n){var r;if(super(),nx(this,"sourceNode",void 0),nx(this,"track",void 0),nx(this,"clonedTrack",void 0),nx(this,"audioElement",void 0),nx(this,"isCurrentTrackCloned",!1),nx(this,"isRemoteTrack",!1),nx(this,"originVolumeLevelAnalyser",void 0),nx(this,"rebuildWebAudio",(async()=>{if(rA.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void rA.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>rA.info("resume success"))),rA.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;const t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),ux(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const n=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(n,this.context.currentTime),ux(this.outputNode),this.emit(BA.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),"audio"!==e.kind)throw new RO(CO.UNEXPECTED_ERROR);this.track=e;const i=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(i),ux(this.sourceNode),n){const e=n.clone();e.enabled=!0,this.clonedTrack=e,rA.debug("create an unmuted track ".concat(e.id," from the original track ").concat(n.id," to get the volume"));const t=this.context.createMediaStreamSource(new MediaStream([e]));ux(t),this.originVolumeLevelAnalyser=new fx,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=i;const o=qk();t&&o.os===Wk.IOS&&Number(null===(r=o.osVersion)||void 0===r?void 0:r.split(".")[0])<15&&(lx.on(gA.STATE_CHANGE,(()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),ux(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(BA.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),lx.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),rA.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));const n=this.context.createMediaStreamSource(new MediaStream([t]));ux(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function gx(e,t,n){const r=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function vx(e,t){const n=await yx(e.mediaSource),{sourceId:r,audio:i}=await function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new np(((n,r)=>{const i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const o=document.createElement("div");o.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const a=document.createElement("div");a.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",a.setAttribute("style","height: 12%;");const s=document.createElement("div");s.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const l=document.createElement("button");l.innerHTML="cancel",l.setAttribute("style","width: 85px;"),l.onclick=()=>{document.body.removeChild(h);const e=new Error("NotAllowedError");e.name="NotAllowedError",r(e)};let d=t;const u=document.createElement("div");if(t){const e=document.createElement("input");e.setAttribute("type","checkbox");const t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=d,e.onchange=()=>{d=e.checked},u.appendChild(e),u.appendChild(t)}c.appendChild(u),c.appendChild(l),o.appendChild(a),o.appendChild(s),o.appendChild(c);const h=document.createElement("div");h.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),h.appendChild(i),h.appendChild(o),document.body.appendChild(h),e.map((e=>{if(e.id){const t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let r=e.thumbnail;try{const{width:e}=r.getSize();e>1920&&(r=r.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))+"</span>",t.onclick=()=>{document.body.removeChild(h),n({sourceId:e.id,audio:d})},s.appendChild(t)}}))}))}(n,t);return await gx(r,e,i)}async function yx(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);const n=GO();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new RO(CO.ELECTRON_IS_NULL);let r=null;try{var i;r=(null===(i=n.desktopCapturer)||void 0===i?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(e){r=null}r&&r.then||(r=new np(((e,r)=>{n.desktopCapturer.getSources({types:t},((t,n)=>{t?r(t):e(n)}))})));try{return await r}catch(e){throw new RO(CO.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}const bx=new LI("safari");let Ex=!1,Sx=!1;async function Tx(e,t){let n=0,r=null;for(;n<2;)try{r=await wx(e,t,n>0);break}catch(e){if(e instanceof RO)throw rA.error("[".concat(t,"] ").concat(e.toString())),e;const r=Cx(e.name||e.code||e,e.message);if(r.code===CO.MEDIA_OPTION_INVALID){rA.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await EI(500);continue}throw rA.error("[".concat(t,"] ").concat(r.toString())),r}if(!r)throw new RO(CO.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function wx(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new RO(CO.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=fA(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return rA.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(GO())e.screen.sourceId?Rx(i,await gx(e.screen.sourceId,e.screen,!!e.screenAudio)):Rx(i,await vx(e.screen,!!e.screenAudio));else if(Zk()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new RO(CO.NOT_SUPPORTED,"This browser does not support screen sharing");rA.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const n=await(a=e.screen.extensionId,s=t,new np(((e,t)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},(n=>{if(!n||!n.streamId)return rA.error("[".concat(s,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new RO(CO.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)}))}catch(e){rA.error("[".concat(s,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),e.toString()),t(new RO(CO.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=n,Rx(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var o;e.screen.mediaSource&&AA(e.screen.mediaSource);const n={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(o=e.screen.displaySurface)&&void 0!==o?o:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:r,surfaceSwitching:a,systemAudio:s,preferCurrentTab:c}=e.screen,l={selfBrowserSurface:r,surfaceSwitching:a,systemAudio:s,preferCurrentTab:c};!r&&delete l.selfBrowserSurface,!a&&delete l.surfaceSwitching,!s&&delete l.systemAudio,!c&&delete l.preferCurrentTab,rA.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:n,audio:e.screenAudio,controls:l})),Rx(i,await navigator.mediaDevices.getDisplayMedia(ix({video:n,audio:e.screenAudio},l)))}else{if(!tO())throw rA.error("[".concat(t,"] This browser does not support screenSharing")),new RO(CO.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&AA(e.screen.mediaSource);const n={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};rA.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(n))),Rx(i,await navigator.mediaDevices.getUserMedia(n))}}var a,s;if(!e.video&&!e.audio)return i;let c={video:e.video,audio:e.audio},l=CN("MEDIA_DEVICE_CONSTRAINTS");if(l)try{"string"==typeof l&&(l=JSON.parse(l)),c=OI(c,l)}catch(e){}rA.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),qk();let d,u=null;($k()||nO()||Qk())&&(u=await bx.lock());try{d=await navigator.mediaDevices.getUserMedia(c)}catch(e){throw u&&u(),e}return c.audio&&(Ex=!0),c.video&&(Sx=!0),Rx(i,d),u&&u(),i}function Cx(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new RO(CO.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new RO(CO.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new RO(CO.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new RO(CO.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new RO(CO.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new RO(CO.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return rA.error("getUserMedia unexpected error",e),new RO(CO.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Rx(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(r&&e.removeTrack(r),e.addTrack(o)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const kx=new class extends BO{get state(){return this._state}set state(e){e!==this._state&&(this.emit(XA.STATE_CHANGE,e),this._state=e)}constructor(){super(),nx(this,"_state",JA.IDLE),nx(this,"isAccessMicrophonePermission",!1),nx(this,"isAccessCameraPermission",!1),nx(this,"lastAccessMicrophonePermission",!1),nx(this,"lastAccessCameraPermission",!1),nx(this,"checkdeviceMatched",!1),nx(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(CN("ENUMERATE_DEVICES_INTERVAL")||(bO()||Jk()===Wk.HARMONY_OS)&&yO())&&this.updateDevicesInfo()}),CN("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>rA.error(e.toString())))}async enumerateDevices(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new RO(CO.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let o=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;i.audio&&(o=!1),i.video&&(a=!1);let s=null,c=null,l=null;if(!n&&(o||a)){if(bx.isLocked&&(rA.debug("[device manager] wait GUM lock"),(await bx.lock())(),rA.debug("[device manager] GUM unlock")),Ex&&(o=!1,this.isAccessMicrophonePermission=!0),Sx&&(a=!1,this.isAccessCameraPermission=!0),rA.debug("[device manager] check media device permissions",e,t,o,a),o&&a){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(e){const t=Cx(e.name||e.code||e,e.message);if(t.code===CO.PERMISSION_DENIED)throw t;rA.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{s=await navigator.mediaDevices.getUserMedia({audio:e})}catch(e){const t=Cx(e.name||e.code||e,e.message);if(t.code===CO.PERMISSION_DENIED)throw t;rA.warning("getUserMedia failed in getDevices",t)}this.isAccessMicrophonePermission=!0}else if(a){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(e){const t=Cx(e.name||e.code||e,e.message);if(t.code===CO.PERMISSION_DENIED)throw t;rA.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0}rA.debug("[device manager] mic permission",e,"cam permission",t)}try{const e=await navigator.mediaDevices.enumerateDevices();return s&&s.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),l&&l.getTracks().forEach((e=>e.stop())),s=null,c=null,l=null,e}catch(e){return s&&s.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),l&&l.getTracks().forEach((e=>e.stop())),s=null,c=null,l=null,new RO(CO.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audioinput"===e.kind))}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((e=>"videoinput"===e.kind))}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audiooutput"===e.kind))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((n=>{n.device.label===e&&(t=n.device.deviceId)})),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find((t=>t.deviceId===e));if(!t)throw new RO(CO.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=JA.INITING;try{await this.updateDevicesInfo(),this.state=JA.INITEND}catch(e){throw rA.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=JA.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new RO(CO.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;const t=e.find((e=>"audioinput"===e.kind&&"default"===e.deviceId)),n=e.find((e=>"audiooutput"===e.kind&&"default"===e.deviceId));t&&n?n.groupId===t.groupId?rA.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is the same group")):rA.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is not the same group")):rA.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((e=>{if(!e.deviceId)return;const r=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(r?r.state:"INACTIVE")){const r={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),r),n.push(r)}r&&(r.updateAt=t)})),this.deviceInfoMap.forEach(((e,r)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",n.push(e))})),this.state!==JA.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach((e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(XA.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(XA.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(XA.PLAYOUT_DEVICE_CHANGED,e)}})),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter((e=>"audioinput"===e.kind)),n=e.filter((e=>"videoinput"===e.kind)),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let Ox=!1;const Ix=new class extends BO{constructor(){super(...arguments),nx(this,"onAutoplayFailed",void 0),nx(this,"onAudioAutoplayFailed",void 0)}};function Nx(){if(qk(),!Ox){const e=t=>{t.preventDefault(),Ox=!1,EO()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Ox=!0,EO()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),rA.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Ix.onAutoplayFailed?Ix.onAutoplayFailed():Ix.onAudioAutoplayFailed?rA.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):rA.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),Ix.emit("autoplay-failed")}}function Ax(e,t,n,r){if(!e)return;const i=uA.getBaseInfoBySessionId(e);if(!i)return;const o=i.info,a=Date.now(),s=ix(ix({},o),{},{vid:void 0===o.vid?0:Number(o.vid),lts:a,elapse:a-i.startTime,cbRegistered:Ix.onAutoplayFailed||Ix.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});uA.send({type:cA.AUTOPLAY_FAILED,data:s},!0)}const xx=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Px=new class{constructor(){nx(this,"onAutoplayFailed",void 0),nx(this,"elementMap",new Map),nx(this,"elementStateMap",new Map),nx(this,"elementsNeedToResume",[]),nx(this,"sinkIdMap",new Map),nx(this,"autoResumeAfterInterruption",(e=>{Array.from(this.elementMap.entries()).forEach((t=>{let[n,r]=t;const i=this.elementStateMap.get(n),o=r.srcObject.getAudioTracks()[0],a=o&&o.readyState;if(rA.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(a," ").concat(e)),"live"===a){if(e)return r.pause(),void r.play();if("running"===lx.curState)return hO()?(r.pause(),void r.play()):void(i&&"paused"===i&&r.play())}}))})),nx(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&"live"===r.readyState&&(rA.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),lx.on(gA.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),lx.on(gA.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),lx.on(gA.STATE_CHANGE,(()=>{nO()&&"suspended"===lx.prevState&&"running"===lx.curState&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(e){throw new RO(CO.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,QA.INIT),this.setVolume(t,n);const o=this.sinkIdMap.get(t);if(o)try{i.setSinkId(o).catch((e=>{rA.warning("[".concat(t,"] set sink id failed"),e.toString())}))}catch(e){rA.warning("[".concat(t,"] set sink id failed"),e.toString())}const a=i.play();a&&a.then&&a.catch((e=>{r&&Ax(r,"audio",e.message,t),rA.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(rA.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),lI((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Nx()})))}))}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){xx.forEach((n=>{t.addEventListener(n,(n=>{const r=this.elementStateMap.get(e),i="pause"===n.type?"paused":n.type;if(rA.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(i)),"error"===n.type){const n=null==t?void 0:t.error;n&&rA.error("[".concat(e,"] media error, code: ").concat(n.code,", message: ").concat(n.message))}this.elementStateMap.set(e,i)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach((e=>{e.play().then((e=>{rA.debug("Auto resume audio element success")})).catch((e=>{rA.warning("Auto resume audio element failed!",e)}))})),this.elementsNeedToResume=[]};new np((e=>{document.body?e():window.addEventListener("load",(()=>e()))})).then((()=>{EO()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function Dx(){return function(e,t,n){const r=n.value;return"function"==typeof r&&(n.value=function(){this._isClosed&&new RO(CO.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",rA);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=r.apply(this,t);return i instanceof np?new np(((e,t)=>{i.then(e).catch(t)})):i}),n}}class Lx extends BO{constructor(e){super(),nx(this,"name","VideoProcessorDestination"),nx(this,"ID","0"),nx(this,"_source",void 0),nx(this,"videoContext",void 0),nx(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new RO(CO.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new RO(CO.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(qA.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(qA.ON_TRACK,void 0)}}class Mx extends BO{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),nx(this,"constraintsMap",new Map),nx(this,"statsRegistry",[]),nx(this,"usageRegistry",[]),nx(this,"trackId",void 0),nx(this,"direction",void 0),nx(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await nI(this,YA.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var n;return rA.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),rI(this,YA.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return rA.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),rI(this,YA.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const o=i();e.push({processorID:t,processorName:n,type:r,stats:o})}catch(e){rA.error(new RO(CO.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof np&&(n=await n),e.push(ix(ix({},n),{},{direction:this.direction}))}catch(e){rA.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class jx extends BO{constructor(e){super(),nx(this,"name","AudioProcessorDestination"),nx(this,"ID","0"),nx(this,"inputTrack",void 0),nx(this,"inputNode",void 0),nx(this,"audioProcessorContext",void 0),nx(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new RO(CO.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new RO(CO.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(qA.ON_TRACK,void 0),this.emit(qA.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(qA.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(qA.ON_NODE,this.inputNode))}}class Ux extends BO{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,n){super(),nx(this,"constraintsMap",new Map),nx(this,"statsRegistry",[]),nx(this,"audioContext",void 0),nx(this,"trackId",void 0),nx(this,"direction",void 0),nx(this,"usageRegistry",[]),nx(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=n}async getConstraints(){return nI(this,YA.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var n;return rA.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),rI(this,YA.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),rI(this,YA.REQUEST_UPDATE_CONSTRAINTS,Array.from(up(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const o=i();e.push({processorID:t,processorName:n,type:r,stats:o})}catch(e){rA.error(new RO(CO.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof np&&(n=await n),e.push(ix(ix({},n),{},{direction:this.direction}))}catch(e){rA.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class Vx extends BO{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),nx(this,"context",void 0),nx(this,"processSourceNode",void 0),nx(this,"outputTrack",void 0),nx(this,"processedNode",void 0),nx(this,"clonedTrack",void 0),nx(this,"outputNode",void 0),this.outputNode=new Fx}setVolume(){}createOutputTrack(){throw new RO(CO.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Fx{disconnect(){}connect(){}}function Bx(e){return new np(((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const o=nO()?"canplay":"playing";i.addEventListener(o,(()=>{const e=i.videoWidth,n=i.videoHeight;!e&&tO()||(r=!0,i.srcObject=null,i.remove(),t([e,n]))})),i.srcObject=new MediaStream([e]),i.play().catch(wI),setTimeout((()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))}),4e3)}))}function Wx(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=CA(e.encoderConfig);return null!=n.width&&(t.width=n.width),null!=n.height&&(t.height=n.height),!gO()&&n.frameRate&&(t.frameRate=n.frameRate),eO()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),tO()&&(t.frameRate={ideal:30,max:30}),t}function Gx(e){const t={};return gO()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,Zk()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function Hx(e){const t=Gx(e);if(e.encoderConfig){const n=IA(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),bO()&&(t.sampleRate=void 0),t}const zx=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:o=n,width:a=r,height:s=i}=t;if(!o||!a||!s)return;a=NI(a),s=NI(s),o=NI(o);const{max:c,min:l}=function(e,t,n){const r=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75);return{min:Math.floor(r),max:Math.floor(4*r)}}(a,s,o),{bitrateMax:d,bitrateMin:u}=t||{};d||rA.debug("calculate bitrate: [w: ".concat(a,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(d,", brMin: ").concat(u,"]"));const{maxFramerate:h}=CN("ENCODER_CONFIG_LIMIT");return h&&"number"==typeof h&&(o=Math.min(o,h)),{frameRate:o,bitrateMax:d||c,bitrateMin:u||l,scaleResolutionDownBy:1,scale:0}},Kx=async(e,t,n)=>await(async(e,t,n)=>{const r=function(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(xI(""+t+n)).slice(0,16),i=r.slice(0,12),o=await window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,e))})(e.buffer,t,n),qx=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new np(((n,r)=>{t.toBlob((async e=>{if(t.remove(),e){const r=await Yx(e);n({buffer:r,width:t.width,height:t.height})}else r(new RO(CO.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},Yx=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var Jx,Xx,Qx,Zx,$x,eP,tP,nP,rP,iP,oP,aP,sP,cP,lP,dP,uP,hP,pP,fP,mP,_P,gP,vP,yP,bP,EP,SP,TP,wP,CP,RP,kP,OP,IP,NP,AP,xP,PP,DP;let LP=(Jx=dA({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Xx=dA({argsMap:(e,t)=>[e.getTrackId(),t]}),Qx=Dx(),Zx=MI("LocalAudioTrack","_enabledMutex"),$x=dA({argsMap:(e,t)=>[e.getTrackId(),t]}),eP=Dx(),tP=MI("LocalAudioTrack","_enabledMutex"),nP=dA({argsMap:(e,t)=>[e.getTrackId(),t]}),rP=Dx(),iP=Dx(),oP=Dx(),aP=dA({argsMap:e=>[e.getTrackId()]}),sP=Dx(),cP=dA({argsMap:e=>[e.getTrackId()]}),lP=Dx(),dP=dA({argsMap:e=>[e.getTrackId()]}),uP=dA({argsMap:(e,t)=>[e.getTrackId(),t.name]}),hP=dA({argsMap:e=>[e.getTrackId()]}),tx((pP=class extends ax{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Px.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),nx(this,"trackMediaType",FA.AUDIO),nx(this,"_encoderConfig",void 0),nx(this,"_trackSource",void 0),nx(this,"metadata",[]),nx(this,"_enabled",!0),nx(this,"_volume",100),nx(this,"_useAudioElement",!0),nx(this,"_bypassWebAudio",!1),nx(this,"processor",void 0),nx(this,"_processorContext",void 0),nx(this,"_processorDestination",void 0),nx(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new Vx,CN("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),CN("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),$k()&&!cx?setTimeout((()=>this.initWebAudio())):this.initWebAudio()}setVolume(e){IO(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Px.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void rA.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,rI(this,xA.NEED_REPLACE_TRACK,this).then((()=>{rA.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((e=>{rA.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)})))}catch(e){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!mA())throw new RO(CO.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Px.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(rA.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await rI(this,xA.NEED_ENABLE_TRACK,this),rA.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(e){throw n||(this._enabled=!1),rA.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await rI(this,xA.NEED_DISABLE_TRACK,this)}catch(e){throw n||(this._enabled=!0),rA.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,rA.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await rI(this,xA.NEED_MUTE_TRACK,this):await rI(this,xA.NEED_UNMUTE_TRACK,this))}getStats(){return pI((()=>{rA.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),iI(this,xA.GET_STATS)||ix({},WA)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(BA.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(BA.ON_AUDIO_BUFFER),this._source.on(BA.ON_AUDIO_BUFFER,(t=>e(t)))}play(){rA.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(rA.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Px.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){rA.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Px.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];rA.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Px.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await rI(this,xA.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return np.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new RO(CO.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new RO(CO.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(qA.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await rI(this,xA.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await rI(this,xA.NEED_REPLACE_TRACK,this))})),e.on(qA.ON_NODE,(e=>{this._source.processedNode=e}))}unbindProcessorDestinationEvents(e){e.removeAllListeners(qA.ON_TRACK),e.removeAllListeners(qA.ON_NODE)}bindProcessorContextEvents(e){e.on(YA.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(e){e.removeAllListeners(YA.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Vx&&(this._trackSource=new _x(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new Ux(this._source.context,this.getTrackId(),"local"),t=new jx(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(BA.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Px.stop(this.getTrackId()),this._source.play()),rI(this,xA.NEED_REPLACE_MIXING_TRACK,this).then((()=>{rA.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))})).catch((e=>{rA.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),e)}))),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[Jx],Object.getOwnPropertyDescriptor(pP.prototype,"setVolume"),pP.prototype),tx(pP.prototype,"setPlaybackDevice",[Xx,Qx],Object.getOwnPropertyDescriptor(pP.prototype,"setPlaybackDevice"),pP.prototype),tx(pP.prototype,"setEnabled",[Zx,$x,eP],Object.getOwnPropertyDescriptor(pP.prototype,"setEnabled"),pP.prototype),tx(pP.prototype,"setMuted",[tP,nP,rP],Object.getOwnPropertyDescriptor(pP.prototype,"setMuted"),pP.prototype),tx(pP.prototype,"getStats",[iP],Object.getOwnPropertyDescriptor(pP.prototype,"getStats"),pP.prototype),tx(pP.prototype,"setAudioFrameCallback",[oP],Object.getOwnPropertyDescriptor(pP.prototype,"setAudioFrameCallback"),pP.prototype),tx(pP.prototype,"play",[aP,sP],Object.getOwnPropertyDescriptor(pP.prototype,"play"),pP.prototype),tx(pP.prototype,"stop",[cP,lP],Object.getOwnPropertyDescriptor(pP.prototype,"stop"),pP.prototype),tx(pP.prototype,"close",[dP],Object.getOwnPropertyDescriptor(pP.prototype,"close"),pP.prototype),tx(pP.prototype,"pipe",[uP],Object.getOwnPropertyDescriptor(pP.prototype,"pipe"),pP.prototype),tx(pP.prototype,"unpipe",[hP],Object.getOwnPropertyDescriptor(pP.prototype,"unpipe"),pP.prototype),pP),MP=(fP=dA({argsMap:(e,t)=>[e.getTrackId(),t]}),mP=Dx(),_P=MI("MicrophoneAudioTrack","_enabledMutex"),gP=dA({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),vP=Dx(),yP=dA({argsMap:e=>[e.getTrackId()]}),tx((bP=class extends LP{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?IA(t.encoderConfig):{},r,CN("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),nx(this,"_config",void 0),nx(this,"_deviceName","default"),nx(this,"_constraints",void 0),nx(this,"_originalConstraints",void 0),nx(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(hO()||pO())&&lx.bindInterruptDetectorTrack(this)}async setDevice(e){if(rA.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await kx.getDeviceById(e),n={};n.audio=ix({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await Tx(n,this.getTrackId())}catch(e){throw rA.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await Tx({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw rA.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await kx.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw rA.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}rA.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return rA.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(rA.info("[".concat(this.getTrackId(),"] start setEnabled"),e),CN("AUTO_RESET_AUDIO_ROUTE")&&(nO()||mO())){const t=navigator.audioSession;t&&(e||(t.type="playback"),t.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(r=this._source.clonedTrack)||void 0===r||r.stop(),n||(this._enabled=!1);try{await rI(this,xA.NEED_DISABLE_TRACK,this)}catch(e){throw rA.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),e}return}const i=ix({},this._constraints),o=kx.searchDeviceIdByName(this._deviceName);o&&!i.deviceId&&(i.deviceId=o);try{n||(this._enabled=!0);const e=await Tx({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await rI(this,xA.NEED_ENABLE_TRACK,this)}catch(e){throw n||(this._enabled=!1),rA.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}rA.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(hO()||pO())&&lx.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((nO()||mO())&&this._enabled&&!this._isClosed&&lx.duringInterruption){const e=async()=>{lx.off(gA.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(rA.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};lx.on(gA.IOS_INTERRUPTION_END,e)}else rA.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(UA.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=kx.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const e=await Tx({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(YA.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}}))}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(YA.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[fP,mP],Object.getOwnPropertyDescriptor(bP.prototype,"setDevice"),bP.prototype),tx(bP.prototype,"setEnabled",[_P,gP,vP],Object.getOwnPropertyDescriptor(bP.prototype,"setEnabled"),bP.prototype),tx(bP.prototype,"close",[yP],Object.getOwnPropertyDescriptor(bP.prototype,"close"),bP.prototype),bP),jP=(EP=dA({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),SP=Dx(),TP=dA({argsMap:e=>[e.getTrackId()]}),wP=Dx(),CP=dA({argsMap:e=>[e.getTrackId()]}),RP=Dx(),kP=dA({argsMap:e=>[e.getTrackId()]}),OP=Dx(),IP=dA({argsMap:e=>[e.getTrackId()]}),NP=Dx(),AP=dA({argsMap:e=>[e.getTrackId()]}),xP=dA({argsMap:e=>[e.getTrackId()]}),PP=Dx(),tx((DP=class extends LP{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),nx(this,"source",void 0),nx(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(BA.AUDIO_SOURCE_STATE_CHANGE,(e=>{this.safeEmit(UA.SOURCE_STATE_CHANGE,e)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){IO(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[EP,SP],Object.getOwnPropertyDescriptor(DP.prototype,"startProcessAudioBuffer"),DP.prototype),tx(DP.prototype,"pauseProcessAudioBuffer",[TP,wP],Object.getOwnPropertyDescriptor(DP.prototype,"pauseProcessAudioBuffer"),DP.prototype),tx(DP.prototype,"seekAudioBuffer",[CP,RP],Object.getOwnPropertyDescriptor(DP.prototype,"seekAudioBuffer"),DP.prototype),tx(DP.prototype,"resumeProcessAudioBuffer",[kP,OP],Object.getOwnPropertyDescriptor(DP.prototype,"resumeProcessAudioBuffer"),DP.prototype),tx(DP.prototype,"stopProcessAudioBuffer",[IP,NP],Object.getOwnPropertyDescriptor(DP.prototype,"stopProcessAudioBuffer"),DP.prototype),tx(DP.prototype,"close",[AP],Object.getOwnPropertyDescriptor(DP.prototype,"close"),DP.prototype),tx(DP.prototype,"setAudioBufferPlaybackSpeed",[xP,PP],Object.getOwnPropertyDescriptor(DP.prototype,"setAudioBufferPlaybackSpeed"),DP.prototype),DP);class UP extends LP{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=dx().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,SI(8,"track-mix-")),nx(this,"trackList",void 0),nx(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return-1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(rA.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):rA.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){rA.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}sI(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach((t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))})),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach((t=>{t instanceof UP?t.emit(jA.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)})))}}class VP extends mx{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(BA.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),nx(this,"audioBuffer",void 0),nx(this,"sourceNode",void 0),nx(this,"startPlayTime",0),nx(this,"startPlayOffset",0),nx(this,"pausePlayTime",0),nx(this,"options",void 0),nx(this,"currentLoopCount",0),nx(this,"currentPlaybackSpeed",100),nx(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):rA.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const FP=new Map;function BP(e,t){if(0===e.length||0===t.length)return 1/0;const n=AI(e),r=AI(t);return Math.floor(r/n)}class WP{get rendFrameRate(){const e=Math.max(1,BP(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/e)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(rA.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,null===(t=this.onVideoStateChanged)||void 0===t||t.call(this,this.videoState))}constructor(e){nx(this,"trackId",void 0),nx(this,"config",void 0),nx(this,"onFirstVideoFrameDecoded",void 0),nx(this,"onVideoStateChanged",void 0),nx(this,"freezeTimeCounterList",[]),nx(this,"renderFreezeAccTime",0),nx(this,"renderFreezeAccTime2",0),nx(this,"isKeepLastFrame",!1),nx(this,"timeUpdatedCount",0),nx(this,"freezeTime",0),nx(this,"playbackTime",0),nx(this,"lastTimeUpdatedTime",0),nx(this,"autoplayFailed",!1),nx(this,"videoTrack",void 0),nx(this,"videoElement",void 0),nx(this,"cacheVideoElement",void 0),nx(this,"_render_interframe_delays",[]),nx(this,"_render_interframe_delays_sizes",[]),nx(this,"_videoState",ZA.VideoStateStopped),nx(this,"videoElementCheckInterval",void 0),nx(this,"videoElementFreezeTimeout",void 0),nx(this,"_videoElementStatus",QA.NONE),nx(this,"isGettingVideoDimensions",!1),nx(this,"startGetVideoDimensions",(()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return rA.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()})),nx(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===lx.curState&&(rA.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Xk())),fO()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),nx(this,"handleVideoEvents",(e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=QA.PLAYING;break;case"loadeddata":if(this.videoState=ZA.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(e){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=QA.CANPLAY;break;case"stalled":this.videoElementStatus=QA.STALLED;break;case"suspend":this.videoElementStatus=QA.SUSPEND;break;case"pause":this.videoElementStatus=QA.PAUSED,nO()||mO()||$k()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(rA.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=QA.WAITING;break;case"abort":this.videoElementStatus=QA.ABORT;break;case"ended":this.videoElementStatus=QA.ENDED;break;case"emptied":this.videoElementStatus=QA.EMPTIED;break;case"error":{const e=this.videoElement.error;e&&(this.videoElementStatus=QA.ERROR,rA.error("[".concat(this.trackId,"] media error: ").concat(e.message," (").concat(e.code,")")));break}case"timeupdate":{const e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);const t=e-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,zD.lastVisibleTime<zD.lastHiddenTime||n<zD.lastHiddenTime||n<zD.lastVisibleTime)return;for(t>CN("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;const e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),nx(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(rA.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Xk())),fO()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),lx.on(gA.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),lx.on(gA.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const t=this.videoElement.play();t&&t.catch&&t.catch((t=>{e&&Ax(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(rA.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):rA.warning("[".concat(this.trackId,"] play warning: "),t)}));const n=qk();if(("Safari"===n.name&&15===Number(n.version)||hO())&&t&&t.then){const e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const t=e.getContext("2d");if(!t)return rA.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);const n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const r=n.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,n.width,n.height),new np(((r,i)=>{n.toBlob((async e=>{if(n.remove(),e){const t=await Yx(e);r({buffer:t,width:n.width,height:n.height})}else i(new RO(CO.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,t<0?.1:t>1?1:t)}))):await qx(e)}destroy(){lx.off(gA.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),lx.off(gA.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=ZA.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=QA.INIT,!this.videoElementCheckInterval&&(GP.forEach((e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{(function(e){return e!==document.body&&document.body.contains(e)})(this.videoElement)||(this.videoElementStatus=QA.DESTROYED)}),1e3),CN("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let n;const r=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",r),this.videoElementFreezeTimeout=window.setTimeout(i,CN("VIDEO_FREEZE_DURATION")))},i=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===ZA.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=ZA.VideoStateFrozen:document.addEventListener("visibilitychange",r))},o=(e,t)=>{if(this.videoElementStatus===QA.PLAYING){if(n){const e=t.presentationTime-n.presentationTime,r=t.presentedFrames-n.presentedFrames;this._render_interframe_delays_sizes.push(r),this._render_interframe_delays.push(e);const o=AI(this._render_interframe_delays_sizes),a=o-this._render_interframe_delays_sizes[0];if(o>30&&a>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===ZA.VideoStateStarting&&(this.videoState=ZA.VideoStateDecoding),this.videoState===ZA.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(i,CN("VIDEO_FREEZE_DURATION"))),e<CN("VIDEO_FREEZE_DURATION")&&this.videoState===ZA.VideoStateFrozen&&(this.videoState=ZA.VideoStateDecoding),e>CN("VIDEO_FREEZE_DURATION")&&zD.lastVisibleTime>=zD.lastHiddenTime&&n.timestamp>zD.lastVisibleTime&&n.timestamp>zD.lastHiddenTime){const t=Math.min(66,BP(this._render_interframe_delays_sizes,this._render_interframe_delays)),n=Math.max(0,e-(r-1)*t);this.renderFreezeAccTime2+=n>t?n:0,this.renderFreezeAccTime+=e}}n=ix(ix({},t),{},{timestamp:e})}var r,a;CN("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(r=(a=this.videoElement).requestVideoFrameCallback)||void 0===r||r.call(a,o))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,o)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),bO()&&!CN("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const n=qk();"Safari"===n.name&&15===Number(n.version)||hO()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,tO()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,tO()&&this.videoElement.load());const r=this.videoElement.play();void 0!==r&&r.catch((e=>{rA.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())}))}resetVideoElement(){GP.forEach((e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=QA.NONE}handleAutoPlayFailed(){const e=t=>{t.preventDefault(),this.videoElement.play().then((()=>{rA.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((e=>{rA.error(e)})),this.autoplayFailed=!1,EO()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};EO()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),Nx()}}const GP=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class HP extends WP{constructor(e){super(e),nx(this,"container",void 0),nx(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await qx(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",CN("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var zP,KP,qP,YP,JP,XP,QP,ZP,$P,eD,tD,nD,rD,iD,oD,aD,sD,cD,lD,dD,uD,hD,pD,fD,mD,_D,gD,vD,yD,bD,ED,SD,TD,wD,CD,RD;let kD=(zP=dA({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),KP=Dx(),qP=dA({argsMap:e=>[e.getTrackId()]}),YP=MI("LocalVideoTrack","_enabledMutex"),JP=dA({argsMap:(e,t)=>[e.getTrackId(),t]}),XP=Dx(),QP=MI("LocalVideoTrack","_enabledMutex"),ZP=dA({argsMap:(e,t)=>[e.getTrackId(),t]}),$P=Dx(),eD=dA({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),tD=Dx(),nD=dA({argsMap:(e,t)=>[e.getTrackId(),t]}),rD=Dx(),iD=Dx(),oD=dA({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),aD=Dx(),sD=Dx(),cD=Dx(),lD=Dx(),dD=Dx(),uD=Dx(),hD=Dx(),pD=dA({argsMap:(e,t)=>[e.getTrackId(),t.name]}),fD=dA({argsMap:e=>[e.getTrackId()]}),mD=dA({argsMap:e=>[e.getTrackId()]}),_D=dA({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),gD=class e extends ax{get videoHeight(){if($k()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if($k()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==QA.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,n,r,i,o){if(super(e,i),nx(this,"trackMediaType",FA.VIDEO),nx(this,"_player",void 0),nx(this,"isUseScaleResolutionDownBy",!1),nx(this,"_videoVisibleTimer",null),nx(this,"_previousVideoVisibleStatus",void 0),nx(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),nx(this,"_encoderConfig",void 0),nx(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),nx(this,"_optimizationMode",void 0),nx(this,"_saveEncodeBitrateRatio",1),nx(this,"_videoHeight",void 0),nx(this,"_videoWidth",void 0),nx(this,"_forceBitrateLimit",void 0),nx(this,"_enabled",!0),nx(this,"_processorDestination",void 0),nx(this,"_processorContext",void 0),$k()){const{width:t,height:n}=e.getSettings();this._videoWidth=t,this._videoHeight=n}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=n,this._optimizationMode=r,this._hints=o||[],t&&-1!==this._hints.indexOf(PA.CUSTOM_TRACK)?this._encoderConfig=dI(t):this._encoderConfig=t,-1===this._hints.indexOf(PA.SCREEN_TRACK))this.updateBitrateFromProfile();else if(oO(Gk.CHROME,115)&&-1!==Jk().indexOf("Windows")){const t=function(e,t){if("VideoFrame"in window&&"TransformStream"in window&&fA().supportWebRTCInsertableStream){const n=new MediaStreamTrackProcessor(e),r=new MediaStreamTrackGenerator({kind:"video"});let i,o,a=Date.now();const s=()=>{c&&(clearInterval(c),c=void 0),i&&(i.close(),i=void 0),e.stop(),o=void 0,r.removeEventListener("ended",s)};let c=window.setInterval((()=>{if(o&&i&&Date.now()-a>(null!=t?t:1e3))try{"live"===r.readyState?o.enqueue(i.clone()):s()}catch(e){s()}}),null!=t?t:1e3);const l=new TransformStream({transform:(e,t)=>{"live"===r.readyState?(o=t,a=Date.now(),void 0===i?(i=e,t.enqueue(e.clone())):(t.enqueue(i),i=e)):e.close()}});return r.addEventListener("ended",s),n.readable.pipeThrough(l).pipeTo(r.writable),r}}(e);t&&(rA.info("local screen video track begin to inject frame"),this._mediaStreamTrack=t)}t&&-1!==this._hints.indexOf(PA.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this._processorContext=new Mx(this.getTrackId(),"local"),this._processorDestination=new Lx(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(rA.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}rA.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=ix(ix(ix({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new WP(n):this._player=new HP(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(UA.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),CN("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,rA.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(rA.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await rI(this,xA.NEED_DISABLE_TRACK,this)}catch(e){throw rA.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}return t||(this._enabled=!1),void rA.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await rI(this,xA.NEED_ENABLE_TRACK,this)}catch(e){throw rA.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}rA.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,rA.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await rI(this,xA.NEED_MUTE_TRACK,this):await rI(this,xA.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._saveEncodeBitrateRatio;if(1!==this._saveEncodeBitrateRatio&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*e),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*e),rA.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(e)),this._saveEncodeBitrateRatio=1;try{await rI(this,xA.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(rA)}}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new RO(CO.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=CA(e),CN("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const t=Wx({encoderConfig:e});($k()||nO()||mO())&&(t.deviceId=void 0),rA.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(e){const t=new RO(CO.UNEXPECTED_ERROR,e.toString());throw rA.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}}this._encoderConfig=e,-1===this._hints.indexOf(PA.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await rI(this,xA.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(rA)}}getStats(){return pI((()=>{rA.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),iI(this,xA.GET_STATS)||ix({},GA)}async setBeautyEffect(e){rA.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await qx(e)}async setBitrateLimit(e){rA.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void rA.error(CO.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const t=this._optimizationMode;try{this._optimizationMode=e,await rI(this,xA.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(e){throw this._optimizationMode=t,rA.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.toString()),e}rA.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return rA.error(CO.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,rA.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){Bx(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(wI)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new RO(CO.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");rA.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=CA(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,-1===this._hints.indexOf(PA.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await rI(this,xA.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(rA)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!t||!n)return;const{bitrateMax:r,bitrateMin:i}=this._encoderConfig;if(null==i||null==r){const{max:o,min:a}=function(e,t,n,r,i){const o=CN("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===o)return{min:r,max:i};if(void 0===i){const a=Math.floor(200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75));i="STANDARD_BITRATE"===o?4*a:2*a,r=null!=r?r:a}else r=null!=r?r:Math.floor(i/10);return{min:r,max:i}}(e,t,n,i,r);if(this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=o,CN("VIDEO_STANDARD_BITRATE_VERSION")&&null==i&&null==r){const[r,i]=function(e,t,n){const r=4*Math.floor(2e5*Math.pow(n/15,.6)*Math.pow(e*t/230400,.75)),i=e*t,o=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),a=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let s=up(o).call(o).next().value,c=1;if(o.has(i))s=o.get(i);else{var l;const e=Jp(l=Array.from(o.entries())).call(l,((e,t)=>{let[n]=e,[r]=t;return n-r})),t=e.find((e=>{let[t]=e;return t>i}));if(t){const n=e.indexOf(t);if(n>0){const r=e[n-1],o=(i-r[0])/(t[0]-r[0]);s=r[1]+o*(t[1]-r[1])}else s=t[1]}else s=e[e.length-1][1]}if(a.has(i))c=a.get(i);else{var d;const e=Jp(d=Array.from(a.entries())).call(d,((e,t)=>{let[n]=e,[r]=t;return n-r})),t=e.find((e=>{let[t]=e;return t>i}));if(t){const n=e.indexOf(t);if(n>0){const r=e[n-1],o=(i-r[0])/(t[0]-r[0]);c=r[1]+o*(t[1]-r[1])}else c=t[1]}else c=e[e.length-1][1]}const u=CN("VIDEO_NEW_BITRATE_RATIO");u&&u>0&&(s=u/100);const h=Math.floor(r*s),p=Math.floor(65e4*Math.pow(e*t/230400,.5)*Math.pow(n/15,.69));let f=h;const m=CN("VIDEO_STANDARD_BITRATE_VERSION");return m&&m>0&&(1===m?f=r:2===m?f=h:3===m&&(f=p)),[Math.floor(f/1e3),c]}(e,t,n);this._encoderConfig.bitrateMax=r,this._encoderConfig.bitrateMin=a?Math.min(a,r):r,this._saveEncodeBitrateRatio=i,rA.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else rA.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(o,", brMin: ").concat(a,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const e=jO.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=uA.reportApiInvoke(null,{tag:zO.TRACER,name:HO.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new RO(CO.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new RO(CO.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=ix(ix({},r),CA(t))),r=uI(r);const i=SI(8,"track-video-cloned-"),o=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,uI(this._scalabilityMode),this._optimizationMode,i,uI(this._hints));return t&&r&&o.setEncoderConfiguration(r),rA.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),o}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new RO(CO.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new RO(CO.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(pI((()=>{uA.reportApiInvoke(null,{name:HO.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:zO.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),!CN("ENABLE_VIDEO_SEI")||!CN("ENABLE_ENCODED_TRANSFORM"))return void rA.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new RO(CO.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const t=this.getRTCRtpTransceiver();if(!t)return void rA.warning("Video track is not published, SEI can not be send");const n=t.sender.getParameters();if(0===n.codecs.length)return;const r=n.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===r?this.safeEmit("sei-to-send",e):rA.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(qA.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await rI(this,xA.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await rI(this,xA.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qA.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(YA.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(YA.REQUEST_CONSTRAINTS)}},tx(gD.prototype,"play",[zP,KP],Object.getOwnPropertyDescriptor(gD.prototype,"play"),gD.prototype),tx(gD.prototype,"stop",[qP],Object.getOwnPropertyDescriptor(gD.prototype,"stop"),gD.prototype),tx(gD.prototype,"setEnabled",[YP,JP,XP],Object.getOwnPropertyDescriptor(gD.prototype,"setEnabled"),gD.prototype),tx(gD.prototype,"setMuted",[QP,ZP,$P],Object.getOwnPropertyDescriptor(gD.prototype,"setMuted"),gD.prototype),tx(gD.prototype,"setSaveEncodeBitrateRatio",[eD,tD],Object.getOwnPropertyDescriptor(gD.prototype,"setSaveEncodeBitrateRatio"),gD.prototype),tx(gD.prototype,"setEncoderConfiguration",[nD,rD],Object.getOwnPropertyDescriptor(gD.prototype,"setEncoderConfiguration"),gD.prototype),tx(gD.prototype,"getStats",[iD],Object.getOwnPropertyDescriptor(gD.prototype,"getStats"),gD.prototype),tx(gD.prototype,"setBeautyEffect",[oD,aD],Object.getOwnPropertyDescriptor(gD.prototype,"setBeautyEffect"),gD.prototype),tx(gD.prototype,"getCurrentFrameData",[sD],Object.getOwnPropertyDescriptor(gD.prototype,"getCurrentFrameData"),gD.prototype),tx(gD.prototype,"getCurrentFrameImage",[cD],Object.getOwnPropertyDescriptor(gD.prototype,"getCurrentFrameImage"),gD.prototype),tx(gD.prototype,"setBitrateLimit",[lD],Object.getOwnPropertyDescriptor(gD.prototype,"setBitrateLimit"),gD.prototype),tx(gD.prototype,"setOptimizationMode",[dD],Object.getOwnPropertyDescriptor(gD.prototype,"setOptimizationMode"),gD.prototype),tx(gD.prototype,"setScalabiltyMode",[uD],Object.getOwnPropertyDescriptor(gD.prototype,"setScalabiltyMode"),gD.prototype),tx(gD.prototype,"updateMediaStreamTrackResolution",[hD],Object.getOwnPropertyDescriptor(gD.prototype,"updateMediaStreamTrackResolution"),gD.prototype),tx(gD.prototype,"pipe",[pD],Object.getOwnPropertyDescriptor(gD.prototype,"pipe"),gD.prototype),tx(gD.prototype,"unpipe",[fD],Object.getOwnPropertyDescriptor(gD.prototype,"unpipe"),gD.prototype),tx(gD.prototype,"close",[mD],Object.getOwnPropertyDescriptor(gD.prototype,"close"),gD.prototype),tx(gD.prototype,"replaceTrack",[_D],Object.getOwnPropertyDescriptor(gD.prototype,"replaceTrack"),gD.prototype),gD),OD=(vD=dA({argsMap:(e,t)=>[e.getTrackId(),t]}),yD=Dx(),bD=MI("CameraVideoTrack","_enabledMutex"),ED=dA({argsMap:(e,t)=>[e.getTrackId(),t]}),SD=Dx(),TD=dA({argsMap:(e,t)=>[e.getTrackId(),t]}),wD=Dx(),CD=dA({argsMap:e=>[e.getTrackId()]}),RD=class e extends kD{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,r,i,o){super(e,CA(t.encoderConfig),r,i,o),nx(this,"_config",void 0),nx(this,"_originalConstraints",void 0),nx(this,"_constraints",void 0),nx(this,"_enabled",!0),nx(this,"_deviceName","default"),nx(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(hO()||pO())&&!function(){const e=qk();if(e.os!==Wk.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&_O()&&this._enabled&&!this._isClosed&&(rA.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=CA(this._config.encoderConfig),lx.on(gA.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),lx.on(gA.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return"string"==typeof e?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(rA.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await kx.getDeviceById(e),n={};n.video=ix({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await Tx(n,this.getTrackId())}catch(e){throw rA.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await Tx({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw rA.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await kx.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw rA.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}rA.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){rA.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const t={video:ix(ix({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let e=null;try{e=await Tx(t,this.getTrackId())}catch(t){throw rA.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),t.toString()),e=await Tx({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=ix({},t.video),rA.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(rA.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const e=await Tx({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await rI(this,xA.NEED_ENABLE_TRACK,this)}catch(e){throw rA.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),e}this.updateMediaStreamTrackResolution(),rA.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await rI(this,xA.NEED_DISABLE_TRACK,this)}catch(e){throw rA.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}rA.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new RO(CO.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=CA(e),CN("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const n=dI(this._config);n.encoderConfig=e;const r=Wx(n);($k()||nO()||mO())&&(r.deviceId=void 0),rA.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(e){const t=new RO(CO.UNEXPECTED_ERROR,e.toString());throw rA.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}this._config=n,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,-1===this._hints.indexOf(PA.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await rI(this,xA.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(rA)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((nO()||mO())&&this._enabled&&!this._isClosed&&lx.duringInterruption){const e=async()=>{lx.off(gA.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(rA.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};lx.on(gA.IOS_INTERRUPTION_END,e)}else rA.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(UA.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=kx.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const e=await Tx({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),lx.off(gA.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),lx.off(gA.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=ix(ix({},r),CA(t))),r=uI(r);const i=SI(8,"track-cam-cloned-"),o=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,uI(ix(ix({},this._config),{},{encoderConfig:r})),uI(this._constraints),uI(this._scalabilityMode),this._optimizationMode,i);return t&&r&&o.setEncoderConfiguration(r),rA.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),o}bindProcessorContextEvents(){this.processorContext.on(YA.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}})),this.processorContext.on(YA.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}},tx(RD.prototype,"setDevice",[vD,yD],Object.getOwnPropertyDescriptor(RD.prototype,"setDevice"),RD.prototype),tx(RD.prototype,"setEnabled",[bD,ED,SD],Object.getOwnPropertyDescriptor(RD.prototype,"setEnabled"),RD.prototype),tx(RD.prototype,"setEncoderConfiguration",[TD,wD],Object.getOwnPropertyDescriptor(RD.prototype,"setEncoderConfiguration"),RD.prototype),tx(RD.prototype,"close",[CD],Object.getOwnPropertyDescriptor(RD.prototype,"close"),RD.prototype),RD);function ID(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=ix(ix({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?rA.debug("[".concat(e,"] set content hint to"),n.optimizationMode):rA.debug("[".concat(e,"] set content hint failed")))):rA.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var ND,AD,xD,PD,DD,LD,MD,jD,UD,VD,FD,BD;class WD extends ox{getUserId(){return this._userId}constructor(e,t,n,r){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(r.clientId,"_").concat(SI(5,""))),nx(this,"_userId",void 0),nx(this,"_uintId",void 0),nx(this,"_isDestroyed",!1),nx(this,"store",void 0),nx(this,"processor",void 0),nx(this,"processorContext",void 0),this._userId=t,this._uintId=n,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,rA.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let GD=(ND=dA({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),AD=dA({argsMap:e=>[e.getTrackId()]}),xD=dA({argsMap:(e,t)=>[e.getTrackId(),t.name]}),PD=dA({argsMap:e=>[e.getTrackId()]}),tx((DD=class extends WD{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==QA.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),nx(this,"_videoVisibleTimer",null),nx(this,"_previousVideoVisibleStatus",void 0),nx(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),nx(this,"trackMediaType",FA.VIDEO),nx(this,"_videoWidth",void 0),nx(this,"_videoHeight",void 0),nx(this,"_player",void 0),nx(this,"processorDestination",void 0),nx(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Mx(this.getTrackId(),"remote"),this.processorDestination=new Lx(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return pI((()=>{rA.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),iI(this,xA.GET_STATS)||ix({},KA)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(rA.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}rA.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=ix(ix({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new WP(n):this._player=new HP(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(VA.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=e=>{this.safeEmit(VA.VIDEO_STATE_CHANGED,e)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(VA.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),CN("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,rA.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Bx(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(wI)}_updatePlayerSource(){rA.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const e=jO.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=uA.reportApiInvoke(null,{tag:zO.TRACER,name:HO.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new RO(CO.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new RO(CO.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(qA.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qA.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(jA.SEI_RECEIVED,e)}}).prototype,"play",[ND],Object.getOwnPropertyDescriptor(DD.prototype,"play"),DD.prototype),tx(DD.prototype,"stop",[AD],Object.getOwnPropertyDescriptor(DD.prototype,"stop"),DD.prototype),tx(DD.prototype,"pipe",[xD],Object.getOwnPropertyDescriptor(DD.prototype,"pipe"),DD.prototype),tx(DD.prototype,"unpipe",[PD],Object.getOwnPropertyDescriptor(DD.prototype,"unpipe"),DD.prototype),DD),HD=(LD=dA({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),MD=dA({argsMap:(e,t)=>[e.getTrackId(),t]}),jD=dA({argsMap:e=>[e.getTrackId()]}),UD=dA({argsMap:e=>[e.getTrackId()]}),VD=dA({argsMap:(e,t)=>[e.getTrackId(),t.name]}),FD=dA({argsMap:e=>[e.getTrackId()]}),tx((BD=class extends WD{get isPlaying(){return this._useAudioElement?Px.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),nx(this,"trackMediaType",FA.AUDIO),nx(this,"_source",void 0),nx(this,"_useAudioElement",!0),nx(this,"_volume",100),nx(this,"processorContext",void 0),nx(this,"processorDestination",void 0),nx(this,"_played",!1),nx(this,"_bypassWebAudio",!1),CN("DISABLE_WEBAUDIO")?(this._source=new Vx,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new _x(e,!0),CN("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(BA.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(VA.FIRST_FRAME_DECODED)})),this.processorContext=new Ux(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new jx(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(BA.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(BA.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(BA.ON_AUDIO_BUFFER),this._source.on(BA.ON_AUDIO_BUFFER,(t=>e(t)))}setVolume(e){this._volume=e,this._useAudioElement?Px.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!mA())throw new RO(CO.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Px.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return pI((()=>{rA.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),iI(this,xA.GET_STATS)||ix({},HA)}play(){rA.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(rA.debug("[".concat(this.getTrackId(),"] use audio element to play")),Px.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){rA.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Px.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];rA.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Px.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new RO(CO.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new RO(CO.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new RO(CO.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(qA.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(qA.ON_NODE,(e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qA.ON_TRACK),this.processorDestination.removeAllListeners(qA.ON_NODE)}}).prototype,"setVolume",[LD],Object.getOwnPropertyDescriptor(BD.prototype,"setVolume"),BD.prototype),tx(BD.prototype,"setPlaybackDevice",[MD],Object.getOwnPropertyDescriptor(BD.prototype,"setPlaybackDevice"),BD.prototype),tx(BD.prototype,"play",[jD],Object.getOwnPropertyDescriptor(BD.prototype,"play"),BD.prototype),tx(BD.prototype,"stop",[UD],Object.getOwnPropertyDescriptor(BD.prototype,"stop"),BD.prototype),tx(BD.prototype,"pipe",[VD],Object.getOwnPropertyDescriptor(BD.prototype,"pipe"),BD.prototype),tx(BD.prototype,"unpipe",[FD],Object.getOwnPropertyDescriptor(BD.prototype,"unpipe"),BD.prototype),BD);const zD=new class extends BO{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),nx(this,"_lastHiddenTime",0),nx(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),rA.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};class KD extends BO{constructor(e,t){super(),nx(this,"trackMediaType",FA.DATA),nx(this,"_version",1),nx(this,"_type",3),nx(this,"_config",void 0),nx(this,"_originDataChannel",void 0),nx(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),nx(this,"_dataStreamPacketHandler",{serialize:e=>e,deserialize:e=>e}),nx(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return CN("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}get _originDataChannelId(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new np(((e,t)=>{if(this._originDataChannel){"open"===this._originDataChannel.readyState&&e();const n=setTimeout((()=>{var e;t(new RO(CO.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=this._originDataChannel)||void 0===e?void 0:e.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new RO(CO.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new RO(CO.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[ex.OPEN,ex.CLOSE,ex.ERROR].forEach((t=>{const n=()=>{this.emit(t)};this._datachannelEventMap.set(t,n),e.addEventListener(t,n)}))}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach((t=>{let[n,r]=t;e.removeEventListener(n,r)})),this._datachannelEventMap.clear()}}class qD extends KD{constructor(e){super(e),nx(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const t=e.data.slice(0,this._dataStreamPacketHeader.byteLength),n=new DataView(t).getUint8(3);if(n!==this.id)return void(CN("SHOW_DATASTREAM2_LOG")&&rA.debug("invalid datachannel id: ".concat(n," !== ").concat(this.id)));let r=e.data.slice(this._dataStreamPacketHeader.byteLength);r=this._dataStreamPacketHandler.deserialize(r),this.emit(ex.MESSAGE,r)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class YD extends KD{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);const n=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}function JD(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout((()=>Ev.revokeObjectURL(e)),0),new Worker(Ev.createObjectURL(e))}const XD=71,QD=1,ZD=2,$D=1,eL=2;var tL=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(tL||{});function nL(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.getUint8(0);if(n!==XD)return;const r=e.getUint16(1),i=QD+ZD+r,o=new Uint8Array(e.byteLength-i);o.set(new Uint8Array(e.buffer,i,e.byteLength-i));const a={m:n,tlvLen:r,tlv:[],frame:o};let s=QD+ZD;for(;s<i;){const n=e.getUint8(s),r=e.getUint16(s+$D),i=$D+eL;if(n===tL.AUDIO_LEVEL){let o=e.getUint8(s+i);for(let t=1;t<r;t++)o=o<<8|e.getUint8(s+i+t);a.tlv.push({tag:n,length:r,value:t?127^o>>1:127&o})}else if(n===tL.METADATA||n===tL.AUDIO_64_BIT_PTS){const t=new Uint8Array(r);for(let n=0;n<r;n++)t[n]=e.getUint8(s+i+n);a.tlv.push({tag:n,length:r,value:t})}s+=i+r}return a}const rL=new Map,iL=127,oL=1e-10,aL=139/13,sL=new Map;function cL(e,t,n){const r="".concat(e,"-").concat(t,"-").concat(n);let i=0;if(sL.has(r))i=sL.get(r);else{const o=.5;i=Math.log(function(e,t){const n=e-t;t<n&&(t=n);let r=1;for(let i=e,o=1;i>t;i--,o++)r=r*i/o;return r}(t,e))+e*Math.log(o)+(t-e)*Math.log(1-o)-Math.log(n)+n*e,sL.set(r,i)}return i<oL&&(i=oL),i}function lL(e,t,n){const r=t.length,i=e.length/r;let o=!1;for(let a=0,s=0;a<r;a++){let r=0;for(let t=s+i;s<t;s++)e[s]>n&&r++;t[a]!==r&&(t[a]=r,o=!0)}return o}window.cache=sL;let dL=0;class uL{constructor(e){nx(this,"id",void 0),nx(this,"immediates",[]),nx(this,"lastNonSilence",-1),nx(this,"immediateSpeechActivityScore",oL),nx(this,"lastLevelChangedTime",Date.now()),nx(this,"levels",[]),nx(this,"longs",[]),nx(this,"longSpeechActivityScore",oL),nx(this,"mediums",[]),nx(this,"mediumSpeechActivityScore",oL),nx(this,"minLevel",0),nx(this,"nextMinLevel",0),nx(this,"nextMinLevelWindowLength",0),nx(this,"energyScore",0),this.id=e||"".concat(dL++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,t=this.levels,n=this.minLevel+aL;let r=!1;for(let i=0;i<e.length;++i){let o=t[i];o<n&&(o=0);const a=Math.floor(o/aL);e[i]!==a&&(e[i]=a,r=!0)}return r}computeLongs(){return lL(this.mediums,this.longs,4)}computeMediums(){return lL(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=cL(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=cL(this.longs[0],10,47),this.longSpeechActivityScore>oL&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=cL(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(gi(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,t){if(this.lastLevelChangedTime<=t){this.lastLevelChangedTime=t;let n=e;return e<0&&(n=0),e>iL&&(n=iL),this.levels.unshift(n),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(n),n>=this.minLevel+aL?n:n/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(0!==e){if(0===this.minLevel||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(0===this.nextMinLevel)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let e=Math.sqrt(this.minLevel*this.nextMinLevel);e<0?e=0:e>iL&&(e=iL),this.minLevel=e,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class hL{constructor(e){nx(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const t=this.algorithm.runInDecisionMaker(this);t<=0?e=!0:setTimeout(this.execute.bind(this),t)}catch(t){e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class pL{constructor(e,t,n){nx(this,"isDominant",void 0),nx(this,"energyRanking",void 0),nx(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=t,this.energyScore=n}}class fL extends BO{constructor(e){super(),nx(this,"dominantId",null),nx(this,"lastDecisionTime",0),nx(this,"lastLevelChangedTime",0),nx(this,"lastLevelIdleTime",0),nx(this,"relativeSpeechActivities",[]),nx(this,"speakers",new Map),nx(this,"enableSilence",!1),nx(this,"timeoutToSilenceInterval",0),nx(this,"decisionMaker",null),nx(this,"loudest",[]),nx(this,"numLoudestToTrack",3),nx(this,"energyExpireTimeMs",250),nx(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,null!=t&&(this.energyExpireTimeMs=t),null!=n&&(this.energyAlphaPct=n),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some((t=>t.id===e))}levelChanged(e,t){const n=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<n&&(this.lastLevelChangedTime=n,this.maybeStartDecisionMaker());const i=r.levelChanged(t,n);return this.updateLoudestList(r,i,n)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach((e=>{this.speakers.has(e.id)||this.speakers.set(e.id,e)}))}removeSpeakers(e){e.forEach((e=>{this.speakers.delete(e.id)}))}getOrCreateSpeaker(e){let t=this.speakers.get(e);return t||(t=new uL(e),this.speakers.set(e,t),this.maybeStartDecisionMaker()),t}updateLoudestList(e,t,n){const r=e.id===this.dominantId;if(t<0){let t=0;for(;t<this.loudest.length&&this.loudest[t]!==e;)++t;return new pL(r,t,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*t+(100-this.energyAlphaPct)*e.energyScore+50)/100),0===this.numLoudestToTrack)return new pL(r,0,e.energyScore);const i=n-this.energyExpireTimeMs;let o=0;for(;o<this.loudest.length;){const t=this.loudest[o];if(t.getLastLevelChangedTime()<i&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(o,1);else if(t.id!==e.id)++o;else if(this.loudest.splice(o,1),this.loudest.length<this.numLoudestToTrack)break}let a=0;for(;a<this.loudest.length&&!(this.loudest[a].energyScore<e.energyScore);)++a;return a<this.numLoudestToTrack&&(this.loudest.splice(a,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new pL(r,a,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new hL(this),this.decisionMaker.execute())}makeDecision(e){let t=null,n=null;const r=this.speakers.size;let i=null;if(0===r)i=null;else if(1===r){var o;const t=up(o=this.speakers).call(o).next().value;this.enableSilence&&t&&(i=t.id,t.evaluateSpeechActivityScores(e),e-t.lastNonSilence>this.timeoutToSilenceInterval&&(i=null))}else{let t=null==this.dominantId?null:this.speakers.get(this.dominantId);if(null==t){const e=this.speakers.entries().next();e.value&&(i=e.value[0],t=e.value[1])}else i=t.id;null!=t&&t.evaluateSpeechActivityScores(e);const n=this.relativeSpeechActivities;let r=2;for(const o of this.speakers.entries()){const[a,s]=o;if(s===t)continue;s.evaluateSpeechActivityScores(e);for(let e=0;e<n.length;++e){const r=null==t?oL:t.getSpeechActivityScore(e);n[e]=Math.log(s.getSpeechActivityScore(e)/r)}const c=n[0],l=n[1],d=n[2];c>3&&l>2&&d>0&&l>r&&(r=l,i=a)}this.enableSilence&&null!=t&&i===t.id&&e-t.lastNonSilence>this.timeoutToSilenceInterval&&(i=null)}null==i&&!this.enableSilence||i===this.dominantId||(t=this.dominantId,this.dominantId=i,n=this.dominantId),null==n&&!this.enableSilence||n===t||this.emit("ActiveSpeakerChanged",n)}_runInDecisionMaker(){const e=Date.now(),t=300-(e-this.lastLevelIdleTime);let n=0;t<=0?(0!==this.lastLevelIdleTime&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):n=t;let r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&n>r&&(n=r),n}timeoutIdleLevels(e){const t=[];for(const r of up(n=this.speakers).call(n)){var n;const i=e-r.getLastLevelChangedTime();36e5<i&&(null==this.dominantId||r.id!==this.dominantId)?t.push(r.id):300<i&&r.levelTimedOut()}t.forEach((e=>this.speakers.delete(e)))}}const mL=new Map;let _L=null,gL=null;const vL=3;let yL=[];const bL=new Map,EL=new Map;class SL{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,t){nx(this,"id",void 0),nx(this,"track",void 0),nx(this,"score",0),nx(this,"active",!0),nx(this,"muted",!1),nx(this,"timer",0),nx(this,"actives",0),nx(this,"inactives",0),this.id=e,this.track=t,this.setActive(bL.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:t,inactives:n}=function(){const e=[],t=[];return Array.from(up(bL).call(bL)).forEach((n=>{n.active?e.push(n):t.push(n)})),{actives:e,inactives:t}}();if(t.length>3){let e;t.forEach((t=>{(!e||e.score>t.score)&&(e=t)})),e&&e.setActive(!1)}if(t.length<3&&n.length>0){let t;n.forEach((e=>{(!t||t.score<e.score)&&e.id!==this.id&&(t=e)})),t&&e&&!this.active&&(t.samples>40&&t.activeRate-this.activeRate>.4?t.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(e){let t;return Array.from(up(bL).call(bL)).forEach((n=>{!n.active||n.id===e||n.samples<40||(!t||n.score<t.score)&&(t=n)})),t}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(e){let t;return Array.from(up(bL).call(bL)).forEach((n=>{n.active||n.id===e||n.samples<40||(!t||n.score>t.score)&&(t=n)})),t}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout((()=>{if(0!==this.samples)return this.samples<50?this.resetTimer():void this.autoCheckActive()}),1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let TL;function wL(e){const t=bL.get(e);t&&(bL.delete(e),t.clearTimer())}const CL=new Map,RL=new Map;function kL(e,t,n){let r=new Uint8Array(e,t,n),i=[],o=0;for(;i.length<n;)o+3<n&&0===r[o]&&0===r[o+1]&&3===r[o+2]&&(0===r[o+3]||1===r[o+3]||2===r[o+3]||3===r[o+3])?(i.push(r[o],r[o+1],r[o+3]),o+=4):(i.push(r[o]),o++);return new Uint8Array(i)}const OL=new Map,IL=new Map;!function(){const e=qk();pA.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),pA.getStreamFromExtension=e.name===Gk.CHROME&&Number(e.version)>34,pA.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),pA.supportMinBitrate=e.name===Gk.CHROME||e.name===Gk.EDGE,pA.supportSetRtpSenderParameters=function(){const e=qk();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!yO()||!(!$k()&&!Qk())||e.name===Gk.FIREFOX&&Number(e.version)>=64)}(),e.name===Gk.SAFARI&&(Number(e.version)>=14?pA.supportDualStream=!0:pA.supportDualStream=!1),pA.webAudioMediaStreamDest=function(){const e=qk();return!(e.name===Gk.SAFARI&&Number(e.version)<12)}(),pA.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,pA.supportWebGL="undefined"!=typeof WebGLRenderingContext,pA.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,yO()||(pA.webAudioWithAEC=!0),pA.supportShareAudio=function(){const e=qk();return(e.os===Wk.WIN_10||e.os===Wk.WIN_81||e.os===Wk.WIN_7||e.os===Wk.LINUX||e.os===Wk.MAC_OS||e.os===Wk.CHROMIUM_OS)&&e.name===Gk.CHROME&&Number(e.version)>=74}(),pA.supportDataChannel=!!(rO(76)||function(e){const t=qk();return!(t.name!==Gk.FIREFOX||!t.osVersion)&&Number(t.version)>=e}(68)||sO(14)),pA.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!tO()&&!!e&&e.prototype.setConfiguration instanceof Function}(),pA.supportWebRTCEncodedTransform=function(){const e=qk();return"Chrome"===e.name&&Number(e.version)>=87||"Safari"===e.name&&Number(e.version)>=15}(),pA.supportWebRTCInsertableStream=function(){const e=qk();return(e.name===Gk.CHROME||e.name===Gk.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),pA.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,pA.supportWebCrypto="undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle,lI((()=>{pA.supportDualStreamEncoding=function(){const e=qk();return!!CN("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&CN("CHROME_DUAL_STREAM_USE_ENCODING"))}(),rA.debug("browser ua: ",navigator.userAgent),rA.info("browser info: ",e),rA.info("browser compatibility: ",pA)}))}();const NL=["CHINA","GLOBAL"],AL=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],xL=[],PL=[];function DL(e,t){return!!t&&xL.some((n=>n.uid===e&&n.channelName===t))}function LL(){return PL.length>0}var ML=kS.forEach,jL=Hr("forEach")?[].forEach:function(e){return ML(this,e,arguments.length>1?arguments[1]:void 0)};An({target:"Array",proto:!0,forced:[].forEach!==jL},{forEach:jL});var UL=er("Array","forEach"),VL=_r,FL=et,BL=u,WL=UL,GL=Array.prototype,HL={DOMTokenList:!0,NodeList:!0},zL=function(e){var t=e.forEach;return e===GL||BL(GL,e)&&t===GL.forEach||FL(HL,VL(e))?WL:t},KL=r(zL),qL=Qe,YL=po;An({target:"Object",stat:!0,forced:i((function(){YL(1)}))},{keys:function(e){return YL(qL(e))}});var JL=r(ee.Object.keys),XL=r(ri),QL=r(_i),ZL=An,$L=ai,eM=Qc,tM=$,nM=Fn,rM=zn,iM=Q,oM=qm,aM=ft,sM=al,cM=BE("slice"),lM=aM("species"),dM=Array,uM=Math.max;ZL({target:"Array",proto:!0,forced:!cM},{slice:function(e,t){var n,r,i,o=iM(this),a=rM(o),s=nM(e,a),c=nM(void 0===t?a:t,a);if($L(o)&&(n=o.constructor,(eM(n)&&(n===dM||$L(n.prototype))||tM(n)&&null===(n=n[lM]))&&(n=void 0),n===dM||void 0===n))return sM(o,s,c);for(r=new(void 0===n?dM:n)(uM(c-s,0)),i=0;s<c;s++,i++)s in o&&oM(r,i,o[s]);return r.length=i,r}});var hM=er("Array","slice"),pM=u,fM=hM,mM=Array.prototype,_M=function(e){var t=e.slice;return e===mM||pM(mM,e)&&t===mM.slice?fM:t},gM=r(_M);function vM(e,t,n,r,i){var o,a,s,c={};return KL(o=JL(r)).call(o,(function(e){c[e]=r[e]})),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=XL(a=QL(s=gM(n).call(n)).call(s)).call(a,(function(n,r){return r(e,t,n)||n}),c),i&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),void 0===c.initializer?(IE(e,t,c),null):c}let yM=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),bM=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),EM=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),SM=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),TM=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),wM=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),CM=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),RM=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),kM=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),OM=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),IM=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),NM=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function AM(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw rA.error("Invalid Channel Name ".concat(e)),new hA(CO.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function xM(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295||DO(e,1,255)))throw new hA(CO.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&rA.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let PM=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const DM={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},LM={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function MM(e,t){AO(e.url,"".concat(t,".url"),1,1e3,!1),PO(e.x)||IO(e.x,"".concat(t,".x"),0,1e4),PO(e.y)||IO(e.y,"".concat(t,".y"),0,1e4),PO(e.width)||IO(e.width,"".concat(t,".width"),0,1e4),PO(e.height)||IO(e.height,"".concat(t,".height"),0,1e4),PO(e.zOrder)||IO(e.zOrder,"".concat(t,".zOrder"),0,255),PO(e.alpha)||IO(e.alpha,"".concat(t,".alpha"),0,1,!1)}const jM={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let UM=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),VM=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),FM=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function BM(e){if(!e.channelName)throw new hA(CO.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new hA(CO.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&AO(e.token,"info.token",1,2047),xM(e.uid),AM(e.channelName),!0}let WM=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),GM=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),HM=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),zM=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),KM=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),qM=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),YM=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),JM=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),XM=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const QM=[XM.AFRICA,XM.ASIA,XM.CHINA,XM.EUROPE,XM.GLOBAL,XM.INDIA,XM.JAPAN,XM.NORTH_AMERICA,XM.OCEANIA,XM.OVERSEA,XM.SOUTH_AMERICA];let ZM=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const $M={CHINA:{},ASIA:{CODE:ZM.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ZM.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ZM.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ZM.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ZM.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ZM.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ZM.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ZM.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ZM.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ZM.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ZM.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ZM.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ZM.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};_N&&($M.CHINA={CODE:ZM.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let ej=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function tj(e){return!!e&&!(!e.uplink||!e.id)&&void 0!==e.uplink.max_bitrate&&void 0!==e.uplink.min_bitrate}class nj extends BO{constructor(e,t){super(),uC(this,"onICEConnectionStateChange",void 0),uC(this,"onConnectionStateChange",void 0),uC(this,"onDTLSTransportStateChange",void 0),uC(this,"onDTLSTransportError",void 0),uC(this,"onICETransportStateChange",void 0),uC(this,"onFirstAudioReceived",void 0),uC(this,"onFirstVideoReceived",void 0),uC(this,"onFirstAudioDecoded",void 0),uC(this,"onFirstVideoDecoded",void 0),uC(this,"onFirstVideoDecodedTimeout",void 0),uC(this,"onSelectedLocalCandidateChanged",void 0),uC(this,"onSelectedRemoteCandidateChanged",void 0),uC(this,"onICECandidateError",void 0),uC(this,"getLocalVideoStats",void 0)}}class rj extends nj{constructor(e,t){super(e,t),uC(this,"establishPromise",void 0)}}let ij=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),oj=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),aj=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const sj=["disconnected","failed"];let cj=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),lj=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),dj=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),uj=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),hj=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),pj=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),fj=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),mj=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),_j=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),gj=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),vj=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),yj=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),bj=function(e){return e.ABORT="abort",e}({}),Ej=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Sj=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Tj={[yM.ACCESS_POINT]:{[SM.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[SM.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[SM.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[SM.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[SM.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[SM.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[SM.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[SM.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[SM.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[SM.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[SM.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[SM.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[SM.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[SM.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[SM.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[SM.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[SM.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[SM.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[yM.UNILBS]:{[EM.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[EM.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[EM.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[EM.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[EM.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[EM.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[EM.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[EM.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[EM.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[EM.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[EM.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[EM.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[yM.STRING_UID_ALLOCATOR]:{[bM.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[bM.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[bM.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function wj(e){const t=Tj[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===yM.ACCESS_POINT){const t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const Cj={[TM.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[TM.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[TM.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[TM.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[TM.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[TM.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[TM.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[TM.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[TM.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[TM.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[TM.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[TM.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[TM.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[TM.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[TM.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[TM.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[TM.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[TM.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[TM.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[TM.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[TM.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[TM.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[TM.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[TM.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[TM.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[TM.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[TM.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[TM.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[TM.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[TM.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[TM.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[TM.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[TM.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[TM.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[TM.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[TM.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[TM.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[TM.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[TM.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[TM.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[TM.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[TM.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[TM.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[TM.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[TM.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[TM.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[TM.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[TM.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[TM.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[TM.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[TM.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[TM.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[TM.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[TM.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[TM.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[TM.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[TM.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[TM.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[TM.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[TM.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[TM.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[TM.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[TM.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[TM.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Rj(e){return Cj[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function kj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oj(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kj(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kj(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ij(e,t){if("string"==typeof e)return e;const{proxy:n,host:r,port:i}=e;if(t){const e=CN("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===e?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(e,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const Nj=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Aj=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,xj=/wss:\/\/(.+):([0-9]+)\/?/,Pj=/wss:\/\/(.[^\/]+)\/?/;let Dj=0;class Lj{constructor(e,t){uC(this,"id",0),uC(this,"store",void 0),uC(this,"recordIndex",void 0),uC(this,"websockets",[]),uC(this,"try443PortDuration",2e3),uC(this,"forceCloseWSDuration",5e3),uC(this,"try443PortTimeout",null),uC(this,"forceCloseTimeout",null),uC(this,"isTry443PortFailed",!1),uC(this,"isNormalPortFailed",!1),uC(this,"useDoubleDomain",!1),uC(this,"useProxy",!1),uC(this,"startTime",Date.now()),this.id=++Dj,this.try443PortDuration=CN("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach((e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const t=Date.now()-this.startTime;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];rA.debug("[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...r)}createWebSocket(e,t,n){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:n});const r=CN("GATEWAY_DOMAINS"),i=Date.now(),o=[],a=r.find((t=>{var n;return Dr(n=e.host).call(n,t)}));a||(this.useDoubleDomain=!1);const s=[];if(this.useDoubleDomain)r.forEach((n=>{s.push(Ij(Oj(Oj({},e),{},{host:e.host.replace(a,n)}),t))}));else{const n=Oj({},e);if(t&&a){const e=r.find((e=>e!==a));e&&(n.host=n.host.replace(a,e))}s.push(Ij(n,t))}try{s.forEach((e=>{const t=new WebSocket(e);t.binaryType="arraybuffer",o.push(t),this.logger("ws is connecting:",t.url)}))}catch(r){if(this.logger("ws create failed"),o.forEach((e=>e.close())),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,n);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,n);throw new hA(CO.WS_ERR,"init websocket failed! Error: ".concat(r.toString()))}const c=Uk();this.store&&this.store.recordJoinChannelService({urls:o.map((e=>e.url)),service:"gateway"},this.recordIndex),o.forEach((e=>{e.onopen=()=>{this.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-i,"ms")),this.websockets.forEach((t=>{t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),this.logger("close backup websocket: ".concat(t.url)))})),this.websockets.length=0,c.resolve(e)},e.onclose=n=>{this.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-i,"ms state: ").concat(e.readyState));const r=o.every((e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING));this.logger("".concat(t?"443":"47xx"," websocket closed, all failed: ").concat(r)),r&&(t||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(n.reason)),c.reject({code:n.code,reason:YM.A_ROUND_WS_FAILED})):!t&&r&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),d()),t?this.isTry443PortFailed=r:this.isNormalPortFailed=r},e.onmessage=t=>this.logger("".concat(e.url," onmessage: ").concat(t.data))})),this.websockets.push(...o);const l=()=>{this.websockets.forEach((e=>e.readyState!==WebSocket.OPEN&&e.close()))},d=()=>{if(c.isResolved)return l();qk().os===Wk.MAC_OS&&tO()&&l(),this.createWebSocket(e,!0,!0).then((e=>{c.resolve(e)})).catch((e=>{this.isNormalPortFailed&&c.reject(e),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout((()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.forceCloseTimeout=null,l()}),this.forceCloseWSDuration)};return n||(()=>{if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout((()=>{this.forceCloseTimeout=null,l()}),this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{this.logger("2s timeout, isWebsocket created: ",c.isResolved),this.try443PortTimeout=null,d()}),this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,n,r){return this.useDoubleDomain=!!t,"string"==typeof e&&(e=function(e){let t,n,r;return[,t,n,r]=e.match(Nj)||[],t||([,n,r]=e.match(Aj)||[]),n&&r||([,n,r]=e.match(xj)||[]),n&&r||([,n]=e.match(Pj)||[]),n||rA.warning("un-destructible url: ",e),{proxy:t,host:n,port:r||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,n&&this.useProxy&&(rA.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally((()=>this.clearTimeout()))}}function Mj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class jj extends BO{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Dr(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(NM.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(NM.CONNECTED):"closed"===this._state?this.emit(NM.CLOSED):"failed"===this._state&&this.emit(NM.FAILED))}resetReconnectCount(e){rA.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),uC(this,"_websocketUrl",null),uC(this,"connectionID",0),uC(this,"currentURLIndex",0),uC(this,"urls",[]),uC(this,"_reconnectMode","tryNext"),uC(this,"reconnectReason",void 0),uC(this,"_initMutex",void 0),uC(this,"name",void 0),uC(this,"_state","closed"),uC(this,"reconnectInterrupter",void 0),uC(this,"websocket",void 0),uC(this,"retryConfig",void 0),uC(this,"reconnectCount",0),uC(this,"forceCloseTimeout",5e3),uC(this,"onlineReconnectListener",void 0),uC(this,"useCompress",void 0),uC(this,"tryDoubleDomain",!1),uC(this,"use443PortOnly",!1),uC(this,"wsInflateLength",0),uC(this,"wsDeflateLength",0),uC(this,"closeEstablishingWs",(()=>{})),uC(this,"store",void 0),uC(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mj(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mj(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),this.useCompress=n,this.tryDoubleDomain=r,this.use443PortOnly=i,this._initMutex=new LI("websocket",o?o.clientId:void 0);const{timeout:a,timeoutFactor:s}=t,c=Math.max(300,Math.floor(3*a/5)),l=Math.max(1.2,Math.floor(8*s)/10);eI.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l),aI.on(tI.NETWORK_STATE_CHANGE,((e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===eI.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=s))}))}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{const e=Uk(),t=this.urls[this.currentURLIndex];CN("ENABLE_PREALLOC_PC")&&this.emit(fj.PRE_CONNECT_PC),this.createWebSocketConnection(t).then(e.resolve).catch(e.reject),this.once(NM.CLOSED,(()=>{e.reject(new RO(CO.WS_DISCONNECT))})),this.once(NM.CONNECTED,e.resolve),await e.promise}catch(e){}finally{n()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const e=this.websocket;t?setTimeout((()=>e.close()),500):e.close(),this.websocket=void 0,this._websocketUrl=null}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void rA.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==e&&(this.reconnectMode=e),rA.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);const n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new RO(CO.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new RO(CO.WS_ERR,"send websocket message error"+e.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;const n=Uk();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),rA.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},i=async e=>{var t;if(rA.debug("[".concat(this.name,"] websocket close ").concat(null===(t=this.websocket)||void 0===t?void 0:t.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new RO(CO.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const t=iI(this,NM.WILL_RECONNECT,this.reconnectMode,e.reason)||this.reconnectMode,r=await this.reconnectWithAction(t);if("closed"===this.state)return void rA.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!r)return n.reject(new RO(CO.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),this.close(!0);n.resolve()}},o=e=>{this.emit(NM.ON_MESSAGE,e)},a=e=>{rA.warn("[".concat(this.connectionID,"] ws open error ").concat(e))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),CN("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=CN("GATEWAY_WSS_ADDRESS")),rA.debug("[".concat(this.name,"] start connect, url:"),e);const s=null===(t=this.store)||void 0===t?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c;this._websocketUrl=Ij(e);const t=await this.chooseBestWebsocketConnection(e);this.websocket=t,r&&r(this.websocket.url),this.websocket.onclose=i,this.websocket.onmessage=o,this.websocket.onerror=a,null===(c=this.store)||void 0===c||c.recordJoinChannelService({endTs:Date.now(),status:"success"},s),this.joinGatewayRecordIndex=s}catch(e){const t="closed"===this.state,r=e instanceof RO,o=r&&e.code===CO.WS_ABORT,a=r&&e.code===CO.WS_ERR,c=r?e.message:e&&(e.reason||e.toString());rA.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(c)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:o?"aborted":"error",errors:[e]},s),t||a?(n.reject(t?new RO(CO.WS_DISCONNECT,"websocket is closed: ".concat(c)):new RO(CO.WS_ERR,"init websocket failed: ".concat(c))),a&&rA.error("[".concat(this.name,"] init websocket failed: ").concat(c))):i&&i(e)}return n.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount)return!1;if(0===this.urls.length)return!1;if("closed"===this.state)return!1;rA.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||aI.isOnline||!aI.onlineWaiter||(this.onlineReconnectListener=aI.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let n=!0;if(this.reconnectInterrupter=()=>n=!1,t){const t=UI(this.reconnectCount,this.retryConfig);rA.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await np.race([EI(t),this.onlineReconnectListener||new np((()=>{}))])}if("closed"===this._state||!n)return!1;this.reconnectCount+=1;const r=async(e,t)=>{this.emit(NM.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e)await r(this.urls[this.currentURLIndex],e);else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);rA.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],e)}else"recover"===e&&(rA.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await nI(this,NM.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(n){var i;rA.error("[".concat(this.name,"] reconnect failed ").concat(n&&n.toString()));const r=null==n||null===(i=n.data)||void 0===i?void 0:i.desc;return Array.isArray(r)&&Dr(r).call(r,"dynamic key expired")?(this.emit(NM.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class Uj extends jj{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){const n=Uk(),r=function(e,t){return new Lj(e,t)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{rA.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),n.reject(new RO(CO.WS_ABORT,"choose best websocket aborted"))};const i=CN("GATEWAY_DOMAINS");return rA.debug("[choose-best-ws] currentDomain: ",e,", domains: ",i,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(n.resolve).catch(n.reject),n.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class Vj extends jj{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new np(((n,r)=>{let i=!1;const o=[];this.closeEstablishingWs=()=>{rA.debug("[choose-best-ws] close establishing websockets"),o.forEach((e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()})),r(new RO(CO.WS_ABORT,"choose best websocket aborted"))};const a=CN("GATEWAY_DOMAINS");let s;const c=e.indexOf("?h="),l=a.find((t=>-1!==c?Dr(e).call(e,t,c):Dr(e).call(e,t)));rA.debug("[choose-best-ws] currentDomain: ",l,", domains: ",a);let d=!this.tryDoubleDomain||!l;if(!d&&l){var u;const h=Date.now();try{a.forEach((t=>{const n=-1===c?e.replace(l,t):e.substr(0,c)+e.substr(c).replace(l,t),r=new WebSocket(n);r.binaryType="arraybuffer",o.push(r),rA.debug("[choose-best-ws] ws is connecting:",r.url)}))}catch(e){for(rA.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach((e=>e.close()));o.length;)o.pop();d=!0}null===(u=this.store)||void 0===u||u.recordJoinChannelService({urls:o.map((e=>e.url)),service:"gateway"},t),o.forEach((e=>{e.onopen=()=>{if(i)return;const t=Date.now()-h;rA.debug("[choose-best-ws] ws open cost ".concat(t,"ms")),o.filter((t=>t!==e)).forEach((e=>{rA.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()})),i=!0,n(e)},e.onclose=e=>{s=e,i||o.find((e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)))||(rA.debug("[choose-best-ws] all websocket is closed"),i=!0,r(s))},e.onmessage=t=>{rA.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}})),EI(this.forceCloseTimeout).then((()=>{o.forEach((e=>{e.readyState!==WebSocket.OPEN&&e.close()}))}))}if(d){var h;let i;rA.debug("[choose-best-ws] use single url: ",e),null===(h=this.store)||void 0===h||h.recordJoinChannelService({urls:[e],service:"gateway"},t);try{i=new WebSocket(e),o.push(i),i.binaryType="arraybuffer"}catch(e){const n=new RO(CO.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return rA.error("[".concat(this.name,"]").concat(n)),void r(n)}i.onopen=()=>{n(i)},i.onclose=e=>{r(e)},i.onmessage=e=>{rA.debug("[choose-best-ws]".concat(i.url," onmessage: ").concat(e.data))},EI(this.forceCloseTimeout).then((()=>{i&&i.readyState!==WebSocket.OPEN&&i.close()}))}})).then((e=>(this.closeEstablishingWs=void 0,e))).catch((e=>{throw this.closeEstablishingWs=void 0,e}))}}class Fj extends BO{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===wM.CONNECTED?this.emit(CM.WS_CONNECTED):e===wM.RECONNECTING?this.emit(CM.WS_RECONNECTING,this._websocketReconnectReason):e===wM.CLOSED&&this.emit(CM.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),uC(this,"_disconnectedReason",void 0),uC(this,"_websocketReconnectReason",void 0),uC(this,"_connectionState",wM.CLOSED),uC(this,"reconnectToken",void 0),uC(this,"websocket",void 0),uC(this,"openConnectionTime",void 0),uC(this,"clientId",void 0),uC(this,"lastMsgTime",Date.now()),uC(this,"uploadCache",[]),uC(this,"uploadCacheInterval",void 0),uC(this,"rttRolling",new BI(5)),uC(this,"pingpongTimer",void 0),uC(this,"wsInflateDataTimer",void 0),uC(this,"pingpongTimeoutCount",0),uC(this,"joinResponse",void 0),uC(this,"multiIpOption",void 0),uC(this,"initError",void 0),uC(this,"spec",void 0),uC(this,"store",void 0),uC(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(CM.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===OM.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===OM.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(YO.UID_BANNED);break;case 15:this.close(YO.IP_BANNED);break;case 16:this.close(YO.CHANNEL_BANNED)}if(t._type===OM.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case TM.ERR_LICENSE_MISSING:this.close(YO.LICENSE_MISSING);break;case TM.ERR_LICENSE_EXPIRED:this.close(YO.LICENSE_EXPIRED);break;case TM.ERR_LICENSE_MINUTES_EXCEEDED:this.close(YO.LICENSE_MINUTES_EXCEEDED);break;case TM.ERR_LICENSE_PERIOD_INVALID:this.close(YO.LICENSE_PERIOD_INVALID);break;case TM.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(YO.LICENSE_MULTIPLE_SDK_SERVICE);break;case TM.ERR_LICENSE_ILLEGAL:this.close(YO.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new Uj("gateway-".concat(this.clientId),this.spec.retryConfig,!0,CN("JOIN_GATEWAY_USE_DUAL_DOMAIN"),CN("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===wM.CONNECTED&&this.reconnect("retry",$O.OFFLINE)}))}async request(e,t,n,r){const i=SI(6,""),o={_id:i,_type:e,_message:t},a=this.websocket.connectionID,s=()=>new np(((t,n)=>{if(this.connectionState===wM.CONNECTED)return t();const r=()=>{this.off(CM.WS_CLOSED,i),t()},i=()=>{this.off(CM.WS_CONNECTED,r),n(new hA(CO.WS_ABORT))};this.once(CM.WS_CONNECTED,r),this.once(CM.WS_CLOSED,i),e!==RM.PUBLISH&&e!==RM.PUBLISH_DATASTREAM&&e!==RM.SUBSCRIBE&&e!==RM.SUBSCRIBE_DATASTREAM&&e!==RM.UNSUBSCRIBE&&e!==RM.UNSUBSCRIBE_DATASTREAM&&e!==RM.UNPUBLISH&&e!==RM.UNPUBLISH_DATASTREAM&&e!==RM.CONTROL&&e!==RM.RESTART_ICE||this.once(CM.DISCONNECT_P2P,(()=>{n(new hA(CO.DISCONNECT_P2P))})),e!==RM.PUBLISH&&e!==RM.RESTART_ICE||this.once(CM.ABORT_P2P_EXECUTION,(()=>{n(new hA(CO.DISCONNECT_P2P))}))}));if(this.connectionState!==wM.CONNECTING&&this.connectionState!==wM.RECONNECTING||e===RM.JOIN||e===RM.REJOIN||await s(),this.websocket.sendMessage(o,!0),r)return;const c=new np(((n,r)=>{let o=!1;const s=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(CM.WS_CLOSED,c),this.off(CM.WS_RECONNECTING,c),this.emit(CM.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),s);const c=()=>{r(new hA(CO.WS_ABORT,"type: ".concat(e))),this.off(CM.WS_CLOSED,c),this.off(CM.WS_RECONNECTING,c),this.off("res-@".concat(i),s)};this.once(CM.WS_CLOSED,c),this.once(CM.WS_RECONNECTING,c),EI(CN("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==a||o||(rA.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(CM.REQUEST_TIMEOUT,e,t))}))}));let l=null;try{l=await c}catch(r){if(this.connectionState===wM.CLOSED||e===RM.LEAVE)throw new hA(CO.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===RM.JOIN||e===RM.REJOIN?null:(await s(),await this.request(e,t))}if(l.isSuccess)return l.message;const d=Number(l.message.error_code||l.message.code),u=Rj(d),h=new hA(CO.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message,desc:u.desc});return"success"===u.action?l.message:(rA.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===TM.ERR_TOO_MANY_BROADCASTERS?e===RM.JOIN||e===RM.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===u.action?h.throw():"quit"===u.action?(this.initError=h,this.close(),h.throw()):(d===TM.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,rA.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",$O.MULTI_IP)):this.reconnect(u.action,$O.SERVER_ERROR),e===RM.JOIN||e===RM.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new np((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}uploadWRTCStats(e){if(!this.store.sessionId)return void rA.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(kM.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=CN("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==wM.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),CN("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new np(((t,n)=>{this.once(CM.WS_CONNECTED,(()=>t(this.joinResponse))),this.once(CM.WS_CLOSED,(e=>n(this.initError||new hA(CO.WS_ABORT,e)))),this.connectionState=wM.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||YO.LEAVE,this.connectionState=wM.CLOSED,rA.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(CM.ABORT_P2P_EXECUTION);const e=await nI(this,CM.REQUEST_JOIN_INFO),t=await this.request(RM.JOIN,e);if(!t)return this.emit(CM.REPORT_JOIN_GATEWAY,YM.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(CM.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=wM.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new hA(CO.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=oI(this,CM.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(RM.REJOIN,e);return!!t&&(this.connectionState=wM.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach((e=>{this.emit(OM.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(OM.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(OM.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(OM.MUTE_AUDIO,{uid:e.uid}):this.emit(OM.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(OM.MUTE_VIDEO,{uid:e.uid}):this.emit(OM.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(OM.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(OM.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(OM.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(OM.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(OM.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){rA.debug("[".concat(this.clientId,"] receive notification: "),e);const t=Rj(e.code);if(28===e.code&&"detail"in e&&(rA.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(CM.RECOVER_NOTIFICATION,e.detail)),"success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(YO.UID_BANNED),void this.close()):void this.reconnect(t.action,$O.SERVER_ERROR);rA.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=CN("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(rA.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>CN("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",$O.TIMEOUT):this.request(RM.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),CN("REPORT_STATS")&&this.send(RM.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(kM.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(NM.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(CM.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(NM.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(NM.CLOSED,(()=>{this.connectionState=wM.CLOSED})),this.websocket.on(NM.FAILED,(()=>{this._disconnectedReason=YO.NETWORK_ERROR,this.connectionState=wM.CLOSED})),this.websocket.on(NM.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===wM.CONNECTED?this.connectionState=wM.RECONNECTING:this.connectionState=wM.CONNECTING})),this.websocket.on(NM.WILL_RECONNECT,((e,t,n)=>{const r=oI(this,CM.IS_P2P_DISCONNECTED),i=r||"retry"!==e;r&&"retry"===e&&(rA.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=YM.P2P_DISCONNECTED),i&&(rA.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(CM.REPORT_JOIN_GATEWAY,t||YM.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(CM.DISCONNECT_P2P)),n(e)})),this.websocket.on(NM.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{rA.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",$O.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(CM.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof hA){if(e.code===CO.UNEXPECTED_RESPONSE&&e.data.code===TM.ERR_NO_AUTHORIZED)return this.initError=new hA(CO.TOKEN_EXPIRE,"dynamic key expired"),void this.close(YO.TOKEN_EXPIRE);rA.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",$O.SERVER_ERROR):(this.initError=e,this.close())}}))})),this.websocket.on(NM.REQUEST_NEW_URLS,((e,t)=>{nI(this,CM.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(NM.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(OM.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(fj.PRE_CONNECT_PC,(()=>{this.emit(CM.PRE_CONNECT_PC)}))}}let Bj=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Wj=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function Gj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Hj(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gj(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gj(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zj(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(CN("TURN_DOMAIN")):(rA.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function Kj(e,t){e.addresses||(e.addresses=[]);const n=function(e,t){if(CN("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return e.map((e=>{let{ip:t,port:n}=e;return{address:"".concat(t,":").concat(n)}}));const n=CN("GATEWAY_DOMAINS");let r=n[1]&&Dr(t).call(t,n[1])?1:0;return e.map((e=>{let{domain_prefix:t,port:i,ip:o}=e;if(t)return{address:"".concat(t,".").concat(n[r++%n.length],":").concat(i)};const a=/^[\.\:\d]+$/.test(o),s=a?"".concat(o.replace(/[^\d]/g,"-"),".").concat(n[r++%n.length],":").concat(i):"".concat(o,":").concat(i);return a||rA.debug("Cannot recognized as ip address: ".concat(o,", use as host")),{ip:o,port:i,address:s}}))}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&"string"==typeof r){const e=r.split(";");for(let t=0;t<e.length;t++){var i;const r=xy(i=e[t]).call(i);n[t]&&r&&(n[t].ip6=r)}}const o=e.detail&&e.detail.candidate;let a;if(o){const[e,t]=o.split(":");e&&t&&(a={port:Number(t),ip:e,address:"".concat(e,":").concat(t)})}return{gatewayAddrs:n,apGatewayAddress:a,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function qj(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function Yj(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(qj(t.width),"x").concat(qj(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function Jj(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Xj(e,t){let n,r,i;switch(t){case Wj.CHOOSE_SERVER:r=4096,i="choose server";break;case Wj.CLOUD_PROXY:r=1048576,i="proxy";break;case Wj.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case Wj.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new hA(CO.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((t=>{t.buffer&&t.buffer.flag===r&&(n={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map((e=>Hj(Hj({},e),{},{ticket:t.buffer.cert}))),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:Hj(Hj({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})})),!n)throw new hA(CO.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function Qj(e,t){return await np.all(e.addresses.map((async e=>({address:CN("USE_TURN_IP")?e.ip:zj(e.ip),tcpport:e.port,udpport:e.port,username:t&&CN("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():vN.username,password:t&&CN("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await FO(t.toString()):vN.password}))))}function Zj(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(qj(e.height),qj(e.width)),1):(rA.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function $j(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:o,protocol:a}=e;const s={candidateType:t,relayProtocol:n,protocol:a};if("local-candidate"!==r){const e=i.split(".");e.length>=4&&(e[1]="*",e[2]="*"),s.address=e.join("."),s.port=o}return s}function eU(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:CN("SVC_MODE");if(CN("ENABLE_SVC"))return function(e){return e in oN}(e)?e:oN.L1T3}const tU={[ij.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[ij.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function nU(e,t,n){t.forEach((t=>{var r;const i=tU[e].find((e=>{var n;let{key:r}=e;return Dr(n=t.extensionName).call(n,r)}));if(!i)return;const o=n.find((e=>{let{extensionName:t}=e;return Dr(t).call(t,i.key)}));o&&Dr(r=o.extensionName).call(r,"gdpr_forbidden")&&(t.extensionName=o.extensionName)}))}function rU(e,t){t.forEach((t=>{var n;const r=tU[e].find((e=>{var n;let{key:r}=e;return Dr(n=t.extensionName).call(n,r)}));Dr(n=t.extensionName).call(n,"gdpr_forbidden")&&r&&(t.extensionName=r.extensionName)}))}function iU(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e||Dr(e).call(e,"abs-send-time")}function oU(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e||Dr(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function aU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function sU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aU(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aU(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function cU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:o,filterAudioFec:a,filterAudioCodec:s,filterVideoCodec:c}=t,{useXR:l}=n;let d=[],u=[],h=[],p=[],f=!1,m=!1;if(MN(e).mediaDescriptions.forEach((e=>{r&&r!==e.attributes.direction||("video"!==e.media.mediaType||f||(u=e.attributes.payloads,p=e.attributes.extmaps,f=!0),"audio"!==e.media.mediaType||m||(d=e.attributes.payloads,h=e.attributes.extmaps,m=!0))})),!p||0===u.length)throw new Error("Cannot get video capabilities from SDP.");if(!h||0===d.length)throw new Error("Cannot get audio capabilities from SDP.");if(u.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),l&&e.rtcpFeedbacks.push({type:"rrtr"})})),d.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),l&&e.rtcpFeedbacks.push({type:"rrtr"})})),i&&(d=d.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),u=u.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}))),o&&(u=u.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),a&&(d=d.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),s&&(null==s?void 0:s.length)>0&&(d=d.filter((e=>{var t;return Dr(s).call(s,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),c&&(null==c?void 0:c.length)>0){const e=u.filter((e=>{var t;return Dr(c).call(c,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}));u=e.concat(i?[]:RU(e,u))}const _=CN("UNSUPPORTED_VIDEO_CODEC");return _&&_.length>0&&(u=u.filter((e=>!(e.rtpMap&&Dr(_).call(_,e.rtpMap.encodingName.toLowerCase()))))),{audioCodecs:d,videoCodecs:u,audioExtensions:h,videoExtensions:p}}function lU(e){const t=MN(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const e=i.attributes.iceUfrag,t=i.attributes.icePwd;if(!e||!t)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:e,icePwd:t}}if(!r){const e=i.attributes.fingerprints;e.length>0&&(r={fingerprints:e})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function dU(e,t){const n=[],r=e.attributes.ssrcGroups.filter((e=>"FID"===e.semantic)),i=e.attributes.ssrcGroups.find((e=>"SIM"===e.semantic)),o=e.attributes.ssrcs;if(i)i.ssrcIds.forEach((e=>{var i;const o=null===(i=r.find((t=>t.ssrcIds[0]===e)))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?o:void 0})}));else if(r.length>0){const e=r[0].ssrcIds[0],i=r[0].ssrcIds[1];n.push({ssrcId:e,rtx:t?i:void 0})}else{if(0===o.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function uU(e,t,n){const{cname:r}=e;let i=[];t&&(i=hU(t)),0===i.length&&(i=e.iceParameters.candidates.map((e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}}))),rA.debug("Using candidates from gateway."));const o={fingerprints:e.dtlsParameters.fingerprints.map((e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint})))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let s;switch(e.dtlsParameters.role){case"server":s="passive";break;case"client":s="active";break;case"auto":s="actpass"}const c=TU(e.rtpCapabilities),l=[];return Array.isArray(n)&&n.length>0&&n.forEach((e=>{l.push({kind:ij.VIDEO,ssrcId:e.v,rtx:e.v_rtx,mslabel:"".concat(e.v,"_").concat(e.a)},{kind:ij.AUDIO,ssrcId:e.a,mslabel:"".concat(e.v,"_").concat(e.a)})})),{dtlsParameters:o,iceParameters:a,candidates:i,rtpCapabilities:c,setup:s,cname:r,preSSRCs:l}}function hU(e){let t=[];return e.ip&&"number"==typeof e.port&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],rA.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),rA.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function pU(e,t,n){const r=[],i=[];return e.forEach((e=>{let{ssrcId:o,rtx:a}=e;const s=SI(8,"track-"),c={ssrcId:o,attributes:sU({label:s,mslabel:n=n||SI(10,""),msid:"".concat(n," ").concat(s)},t&&{cname:t})};if(r.push(c),void 0!==a){const e={ssrcId:a,attributes:sU({label:s,mslabel:n,msid:"".concat(n," ").concat(s)},t&&{cname:t})};r.push(e),i.push({semantic:"FID",ssrcIds:[o,a]})}})),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map((e=>{let{ssrcId:t}=e;return t}))}),{ssrcs:r,ssrcGroups:i}}function fU(e,t){t instanceof LP&&e.attributes.payloads.forEach((e=>{var n;const r=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(!r||-1===["opus","pcmu","pcma","g722"].indexOf(r))return;e.fmtp||(e.fmtp={parameters:{}}),"opus"===r&&"number"==typeof CN("OPUS_PTIME")?e.fmtp.parameters.ptime=CN("OPUS_PTIME"):e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const i=t._encoderConfig;i&&("pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(i.bitrate&&!tO()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1")),t instanceof MP&&"opus"===r&&t._config.DTX&&(e.fmtp.parameters.usedtx="1"))}))}function mU(e){const t=e.attributes.unrecognized.findIndex((e=>"x-google-flag"===e.attField&&"conference"===e.attValue));-1!==t&&e.attributes.unrecognized.splice(t,1)}function _U(e,t){var n;if(!(t instanceof kD&&t._encoderConfig&&-1===t._hints.indexOf(PA.SCREEN_TRACK)))return;const r=t._encoderConfig;fA().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach((e=>{var t,n;Dr(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))})),fA().supportMinBitrate&&!Dr(n=t._hints).call(n,PA.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach((e=>{var t,n;Dr(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(CN("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))}))}function gU(e){if("video"!==e.media.mediaType)return;const t=qk();if(t.name!==Gk.SAFARI&&t.os!==Wk.IOS)return;const n=e.attributes.extmaps.findIndex((e=>/video-orientation/g.test(e.extensionName)));-1!==n&&e.attributes.extmaps.splice(n,1)}function vU(e,t,n){if(!t)return;let r,i;if("video"===e.media.mediaType?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){const t=r.find((e=>oU(e.extensionName)));if(t){const n=t.extensionName;e.attributes.extmaps.find((e=>oU(e.extensionName)))||e.attributes.extmaps.push({entry:t.entry,extensionName:n});const r=function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))))))}(i,e.attributes.payloads);r.forEach((e=>{e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))||e.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(!1===t.twcc){const t=e.attributes.extmaps.findIndex((e=>oU(e.extensionName)));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}if(!0===t.remb){const t=r.find((e=>iU(e.extensionName)));if(t){const n=t.extensionName;e.attributes.extmaps.find((e=>e.extensionName===n))||e.attributes.extmaps.push({entry:t.entry,extensionName:n});const r=function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))))))}(i,e.attributes.payloads);r.forEach((e=>{e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))||e.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(!1===t.remb){const t=e.attributes.extmaps.findIndex((e=>iU(e.extensionName)));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"goog-remb"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}}function yU(e,t,n){if(tO())return;if("video"!==e.media.mediaType)return;if(!(t instanceof kD))return;if("vp9"!==n&&"vp8"!==n)return;if("vp8"===n&&!CN("SIMULCAST"))return;if("vp9"===n&&CN("ENABLE_SVC"))return;if(void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;const r="vp8"===n?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find((e=>"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId)),a={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let s=1;s<r;s++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+s,attributes:dI(i.attributes)}),a.ssrcIds.push(i.ssrcId+s),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+s,attributes:dI(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+s,o.ssrcIds[1]+s]}));e.attributes.ssrcGroups.unshift(a)}async function bU(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:o,sendrecv:a}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=cU(n,e,t,"sendonly"),i=cU(n,e,t,"recvonly"),o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(SU(r,i,"videoExtensions",o,a,s),SU(r,i,"videoCodecs",o,a,s),SU(r,i,"audioExtensions",o,a,s),SU(r,i,"audioCodecs",o,a,s),CN("RAISE_H264_BASELINE_PRIORITY")){const e=[],t=[];s.videoCodecs.forEach(((n,r)=>{var i;if("h264"===(null===(i=n.rtpMap)||void 0===i?void 0:i.encodingName.toLocaleLowerCase())){var o,a;const i=s.videoCodecs[r+1],c=i&&AU(n,i),l=null===(o=n.fmtp)||void 0===o?void 0:o.parameters["profile-level-id"],d=null===(a=n.fmtp)||void 0===a?void 0:a.parameters["packetization-mode"];!l||l!==CN("FIRST_H264_PROFILE_LEVEL_ID")||CN("FIRST_PACKETIZATION_MODE")&&d!==CN("FIRST_PACKETIZATION_MODE")?c?t.push([n,i]):t.push([n]):c?e.push([n,i]):e.push([n])}})),e.length>0&&t.length>0&&(rA.debug("raising H264 baseline profile priority"),s.videoCodecs.forEach(((n,r)=>{var i;if("h264"===(null===(i=n.rtpMap)||void 0===i?void 0:i.encodingName.toLocaleLowerCase())){const i=AU(n,s.videoCodecs[r+1]),o=e.shift()||t.shift()||[];o.length>0&&(i?s.videoCodecs.splice(r,2,...o):s.videoCodecs.splice(r,1,...o))}})),a.videoCodecs=a.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])!==CN("FIRST_H264_PROFILE_LEVEL_ID"))})),CN("FILTER_SEND_H264_BASELINE")&&(o.videoCodecs=o.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])!==CN("FIRST_H264_PROFILE_LEVEL_ID"))}))))}return{send:o,recv:a,sendrecv:s}}(e,t,r);try{n.close()}catch(e){}return{send:i,recv:o,sendrecv:a}}function EU(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=cU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(SU(e,t,"videoExtensions",n,r,i),SU(e,t,"videoCodecs",n,r,i),SU(e,t,"audioExtensions",n,r,i),SU(e,t,"audioCodecs",n,r,i),CN("RAISE_H264_BASELINE_PRIORITY")){const e=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]));if(-1!==e){const t=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()));if(t<e){rA.debug("raising H264 baseline profile priority");const n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&(r.videoCodecs=r.videoCodecs.filter((e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"]))))}}return{send:n,recv:r,sendrecv:i}}function SU(e,t,n,r,i,o){if("videoExtensions"===n||"audioExtensions"===n){const a=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return a.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===a.indexOf(t)&&i[n].push(e)}))}if("videoCodecs"===n||"audioCodecs"===n){const a=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return a.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===a.indexOf(t)&&i[n].push(e)}))}}function TU(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,o;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...n.audioCodecs,...r.audioCodecs],o.videoCodecs=[...n.videoCodecs,...r.videoCodecs],o.audioExtensions=[...n.audioExtensions,...r.audioExtensions],o.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):o=r,{send:i,recv:o}}function wU(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter((e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})).forEach((e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"}))}function CU(e,t,n,r){let i=[];if(e===ij.VIDEO){if(CN("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(i=t.videoCodecs.filter((e=>{var t;return Dr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===CN("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(i)||0===i.length){let e=[];const o=[],a=[],s=[];if(n.videoCodecs.forEach((t=>{const n=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"";Dr(n).call(n,r)?e.push(t):Dr(n).call(n,"vp9")?o.push(t):Dr(n).call(n,"vp8")?a.push(t):Dr(n).call(n,"h264")&&s.push(t)})),0===e.length){let t="";0!==o.length?(e=o,t="vp9"):0!==a.length?(e=a,t="vp8"):0!==s.length&&(e=s,t="h264"),rA.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t))}0!==e.length&&(i=t.videoCodecs.filter((t=>e.some((e=>e.payloadType===t.payloadType)))))}if(0===i.length&&(rA.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),CN("USE_PUB_RTX")||CN("USE_SUB_RTX")){const e=RU(i,t.videoCodecs);i=[...i,...e]}}else{i=t.audioCodecs.filter((e=>{var t;return Dr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)}));const e=t.audioCodecs.filter((e=>{var t;return Dr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"red")}));0===i.length&&(rA.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter((e=>{var t;return Dr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"opus")}))),CN("ENABLE_AUDIO_RED")&&0!==e.length&&(i=[...e,...i])}return i}function RU(e,t){const n=e.map((e=>e.payloadType.toString()));return t.filter((e=>e.rtpMap&&"rtx"===e.rtpMap.encodingName&&e.fmtp&&e.fmtp.parameters.apt&&Dr(n).call(n,e.fmtp&&e.fmtp.parameters.apt)))}async function kU(e,t,n){const r=t.toString(),i=IU(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const o=await e.createAnswer();if(!o.sdp)throw new Error("cannot get answer sdp");let a=o.sdp;a=OU(a,n||{}),null==i||i(a||""),await e.setLocalDescription({type:"answer",sdp:a})}function OU(e,t,n){const r=MN(e),{useXR:i}=t;return r.mediaDescriptions.forEach((e=>{var t;e.attributes.mid&&(Array.isArray(n)&&!Dr(n).call(n,e.attributes.mid)||("audio"===e.media.mediaType&&wU(e),i&&Dr(t=["audio","video"]).call(t,e.media.mediaType)&&e.attributes.payloads.forEach((e=>{-1===e.rtcpFeedbacks.findIndex((e=>"rrtr"===e.type))&&e.rtcpFeedbacks.push({type:"rrtr"})}))))})),jN(r)}function IU(e,t,n,r){if(CN("SDP_LOGGING"))return rA.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{IU(e,"answer","local"===n?"remote":"local",r)}:void 0}function NU(e){const t=CN("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some((t=>Dr(e).call(e,t)))}function AU(e,t){try{var n;return(null===(n=e.fmtp)||void 0===n?void 0:n.parameters.apt)===t.payloadType.toString()}catch(e){return!1}}function xU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function PU(e,t){return typeof CN(e)===t?CN(e):void 0}function DU(){try{const e=CN("EXPERIMENTS")||{};return"string"==typeof e||Array.isArray(e)?{}:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xU(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xU(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e)}catch(e){return rA.debug("handle gateway attributes failed: ",e),{}}}const LU={};function MU(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&rA.debug("install service ".concat(e.name)),LU[e.name]=e}function jU(e){const t=LU[e];if(!t)throw new RO(CO.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function UU(e,t){return jU("DataStream").create(e,t)}function VU(){return jU("InterceptFrame").create()}function FU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function BU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?FU(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FU(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const WU=new Map;class GU extends BO{get state(){return this._state}set state(e){if(e===this._state)return;const t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(qM.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(qM.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){rA.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){var n,r,i;super(),uC(this,"store",void 0),uC(this,"joinInfo",void 0),uC(this,"key",void 0),uC(this,"ntpOffset",0),uC(this,"signal",void 0),uC(this,"role",void 0),uC(this,"inChannelInfo",{joinAt:null,duration:0}),uC(this,"spec",void 0),uC(this,"_state","DISCONNECTED"),uC(this,"_statsCollector",void 0),uC(this,"_disconnectedReason",void 0),uC(this,"isSignalRecover",!1),uC(this,"hasChangeBGPAddress",!1),uC(this,"trafficStatsInterval",void 0),uC(this,"networkQualityInterval",void 0),uC(this,"_joinGatewayStartTime",0),uC(this,"_signalTimeout",!1),uC(this,"_clientRoleOptions",void 0),uC(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?(n={spec:BU(BU({},t),{},{retryConfig:t.websocketRetryConfig}),store:e},null===(r=(i=jU("P2PChannel")).createSubmodule)||void 0===r?void 0:r.call(i,n)):new Fj(BU(BU({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,n){this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);const r=Date.now();let i=WU.get(e.cname);if(i||(i=new Map,WU.set(e.cname,i)),this._isProactiveJoin=!0,i.has(e.uid)){const t=new hA(CO.UID_CONFLICT);throw uA.joinGateway(e.sid,{lts:r,succ:!1,ec:t.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),t}i.set(e.uid,!0),this.joinInfo=e,this.key=t;let o=0;this.joinGatewayStartTime=r;const a=e.proxyServer;try{rA.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));const t=e.gatewayAddrs.map((t=>{let{address:n}=t;const[r,i]=n.split(":"),o={host:r,port:i};return e.proxyServer&&(o.proxy=e.proxyServer),o}));o=(await this.signal.init(t)).uid,rA.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(t){var s;throw rA.error("[".concat(this.store.clientId,"] User join failed"),t.toString()),uA.joinGateway(e.sid,{lts:r,succ:!1,ec:(null===(s=t.data)||void 0===s?void 0:s.desc)||t.code,errorMsg:t.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!a,signalChannel:"0",preload:e.preload}),i.delete(e.uid),this.signal.close(),t}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),rA.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((e=>{rA.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(qM.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(qM.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(qM.NETWORK_QUALITY,{uplinkNetworkQuality:Jj(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Jj(this._statsCollector.trafficStats.B_dnq)}):this.emit(qM.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==YO.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==wM.CONNECTED||await function(e,t){return t===1/0?e:np.race([e,bI(t)])}(this.signal.request(RM.LEAVE,void 0,!0),3e3)}catch(e){rA.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e)}this.signal.close(t),t!==YO.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new hA(CO.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:CN("PUB_EXTEND"),twcc:!!CN("PUBLISH_TWCC"),rtx:!!CN("USE_PUB_RTX")};try{return(await this.signal.request(RM.PUBLISH,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===TM.ERR_PUBLISH_REQUEST_INVALID)return rA.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),r.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw r}}async publishDataChannel(e,t,n){var r;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new hA(CO.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:null!==(r=t.maxRetransmits)&&void 0!==r?r:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(RM.PUBLISH_DATASTREAM,i,!0)}catch(r){if(n&&r.data&&r.data.code===TM.ERR_PUBLISH_REQUEST_INVALID)return rA.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),r.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw r}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new hA(CO.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(RM.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(e){rA.warning("[".concat(this.store.clientId,"] unpublish warning: "),e)}}async unpublishDataChannel(e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new hA(CO.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await np.all(e.map((e=>this.signal.request(RM.UNPUBLISH_DATASTREAM,{channel_id:e},!0))))}catch(e){rA.warning("unpublish datachannels warning: ",e)}}async presubscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new hA(CO.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!CN("SUBSCRIBE_TWCC"),rtx:!!CN("USE_SUB_RTX")||void 0,extend:CN("SUB_EXTEND"),svc:Array.isArray(CN("SVC"))&&0!==CN("SVC").length?CN("SVC"):void 0};try{return await this.signal.request(RM.PRE_SUBSCRIBE,r,!0)}catch(r){if(n&&r.data&&r.data.code===TM.ERR_SUBSCRIBE_REQUEST_INVALID)return rA.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),r.toString()),this.presubscribe(e,t,!1);throw r}}async subscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new hA(CO.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!CN("SUBSCRIBE_TWCC"),rtx:!!CN("USE_SUB_RTX"),extend:CN("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(CN("SVC"))&&0!==CN("SVC").length?CN("SVC"):void 0};try{return(await this.signal.request(RM.SUBSCRIBE,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===TM.ERR_SUBSCRIBE_REQUEST_INVALID)return rA.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),r.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw r}}async subscribeDataChannel(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new hA(CO.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(RM.SUBSCRIBE_DATASTREAM,r,!0)}catch(r){if(n&&r.data&&r.data.code===TM.ERR_SUBSCRIBE_REQUEST_INVALID)return rA.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),r.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw r}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new hA(CO.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!CN("USE_SUB_RTX"),twcc:!!CN("SUBSCRIBE_TWCC"),svc:Array.isArray(CN("SVC"))&&0!==CN("SVC").length?CN("SVC"):void 0};try{return await this.signal.request(RM.SUBSCRIBE_STREAMS,n,!0)}catch(n){if(t&&n.data&&n.data.code===TM.ERR_SUBSCRIBE_REQUEST_INVALID)return rA.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw n}}async setVideoProfile(e){const t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,n=e.width,r=e.height,i=!0;return"number"!=typeof t&&(t=t.exact||t.ideal||t.max||t.min||0,t||(i=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,n||(i=!1)),"number"!=typeof r&&(r=r.exact||r.ideal||r.max||r.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:r,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(RM.SET_VIDEO_PROFILE,t);rA.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(RM.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(e){rA.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e)}}async unsubscribeDataChannel(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new hA(CO.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await np.all(e.map((e=>this.signal.request(RM.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:t},!0))))}catch(e){rA.warning("unsubscribeDataChannel warning: ",e)}}async massUnsubscribe(e){try{await this.signal.request(RM.UNSUBSCRIBE_STREAMS,e,!0)}catch(e){rA.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(e){const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(RM.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(RM.GATEWAY_INFO)}async renewToken(e){await this.signal.request(RM.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,t){t&&(this._clientRoleOptions=Object.assign({},t)),CN("CLIENT_ROLE_OPTIONS")&&(rA.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(CN("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},CN("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),CN("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},CN("CLIENT_ROLE_OPTIONS")),rA.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(CN("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),"CONNECTED"!==this.state)return void(this.role=e);let n,r=0;"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(RM.SET_CLIENT_ROLE,{role:e,level:r,delay:n,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(RM.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(RM.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(RM.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(RM.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(RM.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,n){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,t,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),BU({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(RM.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=WU.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(e){let t;return t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),t?{username:vN.username,password:vN.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(BU(BU({},vN),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;const e=await this.signal.request(RM.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),null!=e.ntp_offset&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach((e=>{const t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((t=>t.peer_uid===e.peer_uid));t&&t.B_st!==e.B_st&&lI((()=>{this.emit(qM.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)}))})),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){var t;if(!this.joinInfo||!this.key)throw new hA(CO.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let r=CN("REPORT_APP_SCENARIO");if("string"!=typeof r)try{r=JSON.stringify(r)}catch(e){r=void 0}var i;r&&r.length>128&&(r=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(qM.UPDATE_GATEWAY_CONFIG),i=this.store.clientId,Dr(PL).call(PL,i)||PL.push(i);const o=!(tO()||iO(87)||_A())&&"boolean"==typeof CN("ENABLE_PRE_SUB")&&CN("ENABLE_PRE_SUB"),a=!_A()&&PU("ENABLE_PREALLOC_PC","boolean"),s=DU(),c=rO(87)||function(){const e=qk();if(e.name!==Gk.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||15===Number(t[0])&&Number(t[1])>=4}(),l=BU({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:mN,browser:navigator.userAgent,process_id:CN("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:CN("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:BU(BU({enableEncodedTransform:!!CN("ENABLE_AUDIO_METADATA")&&c||!!CN("ENABLE_AUDIO_TOPN")&&oO(Gk.CHROME,87,116)||void 0,enableAudioMetadata:!!CN("ENABLE_AUDIO_METADATA")&&c,enableAudioPts:!!CN("ENABLE_AUDIO_PTS_METADATA")&&c,topnSmoothLevel:CN("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:CN("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:CN("TOPN_SWITCH_HOLD_MS"),topnAudioGain:CN("TOPN_AUDIO_GAIN"),enablePublishedUserList:CN("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:CN("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:PU("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:PU("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:PU("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:!0===CN("USE_PUB_RTX")||!0===CN("USE_SUB_RTX")||void 0,disableFEC:CN("DISABLE_FEC"),enableNTPReport:!!CN("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!CN("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!CN("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:PU("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!CN("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!CN("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:PU("USE_XR","boolean"),enableLossbasedBwe:PU("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!CN("ENABLE_AUT_CC")||void 0,enableCCFallback:PU("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:a,preSubNum:o?PU("PRE_SUB_NUM","number"):void 0,enablePubTWCC:PU("PUBLISH_TWCC","boolean"),enableSubTWCC:PU("SUBSCRIBE_TWCC","boolean"),enablePubRTX:PU("USE_PUB_RTX","boolean"),enableSubRTX:PU("USE_SUB_RTX","boolean"),enableSubSVC:CN("ENABLE_SVC")?CN("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(CN("SVC"))&&0!==CN("SVC").length?CN("SVC"):void 0,enableSvcExtended:CN("ENABLE_SVC")&&Array.isArray(CN("SVC_EXTENDED"))&&0!==CN("SVC_EXTENDED").length?CN("SVC_EXTENDED"):void 0},s),{},{audioDuplicate:PU("ENABLE_AUDIO_RED","boolean")?null!==(t=PU("AUDIO_DUPLICATE_NUM","number"))&&void 0!==t?t:2:void 0})},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(l.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(l.aes_mode=this.joinInfo.aesmode,CN("ENCRYPT_AES")?(l.aes_secret=this.joinInfo.aespassword,l.aes_encrypt=!0):l.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(l.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(l.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),void 0!==this.joinInfo.defaultVideoStream&&(l.default_video_stream=this.joinInfo.defaultVideoStream),l}getRejoinMessage(){if(!this.joinInfo)throw new hA(CO.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(CM.WS_RECONNECT_CREATE_CONNECTION,(e=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(CM.WS_RECONNECTING,(e=>{this.joinInfo&&uA.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||$O.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",uA.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(CM.WS_CLOSED,(e=>{let t;switch(e){case YO.LEAVE:t=$O.LEAVE;break;case YO.UID_BANNED:case YO.IP_BANNED:case YO.CHANNEL_BANNED:case YO.SERVER_ERROR:t=$O.SERVER_ERROR;break;case YO.FALLBACK:t=$O.FALLBACK;break;case YO.LICENSE_MISSING:case YO.LICENSE_EXPIRED:case YO.LICENSE_MINUTES_EXCEEDED:case YO.LICENSE_PERIOD_INVALID:case YO.LICENSE_MULTIPLE_SDK_SERVICE:case YO.LICENSE_ILLEGAL:case YO.TOKEN_EXPIRE:t=e;break;default:t=$O.NETWORK_ERROR}rA.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+$O.NETWORK_ERROR)),this.joinInfo&&uA.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===YO.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==YO.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(CM.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if("audience"===this.role){const e=CN("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(rA.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(uA.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void rA.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));wN("EVENT_REPORT_DOMAIN",e[1]),wN("EVENT_REPORT_BACKUP_DOMAIN",e[1]),wN("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}})),this.signal.on(OM.ON_UPLINK_STATS,(e=>{this._statsCollector.updateUplinkStats(e)})),this.signal.on(CM.REQUEST_RECOVER,((e,t,n)=>{if(!this.joinInfo)return n(new hA(CO.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,nI(this,qM.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)})),this.signal.on(CM.REQUEST_JOIN_INFO,(async(e,t,n)=>{var r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const i=dI(null===(r=this.joinInfo)||void 0===r?void 0:r.turnServer);if(CN("NEW_TURN_MODE")&&i){let e=i.servers,t=i.serversFromGateway;const n=this.signal.currentURLIndex;e.length>0&&(e=[e[n%e.length]],i.servers=e),Array.isArray(t)&&t.length>0&&(t=[t[0]],i.serversFromGateway=t),rA.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(n))}const{iceParameters:o,dtlsParameters:a,rtpCapabilities:s}=await nI(this,qM.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:i});try{e(this.getJoinMessage({ortc:{iceParameters:o,dtlsParameters:a,rtpCapabilities:s,version:"2"}}))}catch(e){t(e)}})),this.signal.on(CM.REQUEST_REJOIN_INFO,(e=>{e(this.getRejoinMessage())})),this.signal.on(CM.REPORT_JOIN_GATEWAY,((e,t)=>{if(!this.joinInfo)return;let n,r="";var i;e instanceof hA?(n=(null===(i=e.data)||void 0===i?void 0:i.desc)||e.code,r=e.message):n=e,uA.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,errorMsg:r,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})})),this.signal.on(CM.IS_P2P_DISCONNECTED,(e=>{e(oI(this,qM.IS_P2P_DISCONNECTED))})),this.signal.on(CM.DISCONNECT_P2P,(()=>{this.emit(qM.DISCONNECT_P2P)})),this.signal.on(CM.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(CM.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(CM.JOIN_RESPONSE,(e=>{const t=this.getCurrentGatewayAddress();this.emit(qM.JOIN_RESPONSE,e,t)})),this.signal.on(CM.PRE_CONNECT_PC,(async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),t=CN("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&t){const n=hU(e);this.emit(qM.PRE_CONNECT_PC,{candidates:n,fingerprint:t})}}})),this.signal.on(CM.RECOVER_NOTIFICATION,(e=>{this.joinInfo&&"string"==typeof CN("AP_REQUEST_DETAIL")&&(this.joinInfo.apRequestDetail="".concat(CN("AP_REQUEST_DETAIL"),";").concat(e))}))}async tryUnsubBeforeResub(e,t){try{await this.signal.request(RM.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(e){throw rA.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e),e}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(RM.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(e){throw rA.warning("unsubscribe datachannel warning",e),e}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(RM.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(e){throw rA.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e),e}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(RM.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(e){throw rA.warning("unpublish datastream warning: ",e),e}}async tryMassUnsubBeforeResub(e){const t={users:e.map((e=>({stream_id:e.stream_id,stream_type:e.stream_type})))};try{await this.signal.request(RM.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){throw rA.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e),e}}async muteLocal(e,t){const n={action:e.find((e=>e.stream_type===KM.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(RM.CONTROL,n,!0,!0)}catch(e){throw rA.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e),e}}async unmuteLocal(e,t){const n={action:e.find((e=>e.stream_type===KM.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(RM.CONTROL,n,!0,!0)}catch(e){throw rA.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e),e}}async muteRemote(e,t){const n={action:e===ij.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(RM.CONTROL,n,!0,!0)}catch(e){throw rA.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),e),e}}async unmuteRemote(e,t){const n={action:e===ij.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(RM.CONTROL,n,!0,!0)}catch(e){throw rA.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),e),e}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(RM.RESTART_ICE,t,!0)}catch(e){throw rA.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e),e}}reconnect(e,t){"CONNECTED"===this.state&&this.signal.reconnect(e||void 0,t||$O.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!CN("GATEWAY_WSS_ADDRESS"))return CN("USE_CANDIDATE_FROM_AP_DETAIL")&&null!==(e=this.joinInfo)&&void 0!==e&&e.apGatewayAddress?(rA.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(t=this.joinInfo)&&void 0!==t&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(RM.SET_PARAMETER,{enablePublishAudioFilter:e})}}let HU=0,zU=0;function KU(e,t,n,r){return new np(((i,o)=>{t.timeout=t.timeout||CN("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),HU+=vI(t.data)):n&&(t.data.size?HU+=t.data.size:t.data instanceof FormData?HU+=yI(t.data):HU+=vI(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Mk.request(t).then((e=>{"string"==typeof e.data?zU+=vI(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?zU+=e.data.byteLength:zU+=vI(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((e=>{Mk.isCancel(e)?o(new hA(CO.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new hA(CO.NETWORK_TIMEOUT,e.message)):e.response?o(new hA(CO.NETWORK_RESPONSE_ERROR,e.response.status)):o(new hA(CO.NETWORK_ERROR,e.message))}))}))}!function(){var e;function n(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var r,i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},o=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof t&&t];for(var n=0;n<e.length;++n){var r=e[n];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function a(e,t){if(t)e:{var n=o;e=e.split(".");for(var r=0;r<e.length-1;r++){var a=e[r];if(!(a in n))break e;n=n[a]}(t=t(r=n[e=e[e.length-1]]))!=r&&null!=t&&i(n,e,{configurable:!0,writable:!0,value:t})}}function s(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function c(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:n(e)}}if(a("Symbol",(function(e){function t(e,t){this.A=e,i(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return function e(i){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(i||"")+"_"+r++,i)}})),a("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<t.length;r++){var a=o[t[r]];"function"==typeof a&&"function"!=typeof a.prototype[e]&&i(a.prototype,e,{configurable:!0,writable:!0,value:function(){return s(n(this))}})}return e})),"function"==typeof Object.setPrototypeOf)r=Object.setPrototypeOf;else{var l;e:{var d={};try{d.__proto__={a:!0},l=d.a;break e}catch(e){}l=!1}r=l?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var u=r;function h(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function p(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function f(e,t){return e.h=3,{value:t}}function m(e){this.g=new h,this.G=e}function _(e,t,n,r){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var o=i.value}catch(t){return e.g.j=null,e.g.s(t),g(e)}return e.g.j=null,r.call(e.g,o),g(e)}function g(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function v(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){p(e.g);var n=e.g.j;return n?_(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),g(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function y(e,t){return t=new v(new m(t)),u&&e.prototype&&u(t,e.prototype),t}if(h.prototype.o=function(e){this.v=e},h.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},h.prototype.return=function(e){this.l={return:e},this.h=this.u},m.prototype.o=function(e){return p(this.g),this.g.j?_(this,this.g.j.next,e,this.g.o):(this.g.o(e),g(this))},m.prototype.s=function(e){return p(this.g),this.g.j?_(this,this.g.j.throw,e,this.g.o):(this.g.s(e),g(this))},a("Array.prototype.entries",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return[e,t]}))}})),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var b=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},E=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},S=function(e,t,n){return t instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},T=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},w="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,C=w.FormData,R=w.XMLHttpRequest&&w.XMLHttpRequest.prototype.send,k=w.Request&&w.fetch,O=w.navigator&&w.navigator.sendBeacon,I=w.Element&&w.Element.prototype,N=w.Symbol&&Symbol.toStringTag;N&&(Blob.prototype[N]||(Blob.prototype[N]="Blob"),"File"in w&&!File.prototype[N]&&(File.prototype[N]="File"));try{new File([],"")}catch(e){w.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),N&&Object.defineProperty(e,N,{value:"File"}),e}}var A=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},x=function(e){this.i=[];var t=this;e&&b(e.elements,(function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];b(n,(function(n){t.append(e.name,n)}))}else"select-multiple"===e.type||"select-one"===e.type?b(e.options,(function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)})):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?E(e.value):e.value,t.append(e.name,n))}))};if((e=x.prototype).append=function(e,t,n){T(arguments,2),this.i.push(S(e,t,n))},e.delete=function(e){T(arguments,1);var t=[];e=String(e),b(this.i,(function(n){n[0]!==e&&t.push(n)})),this.i=t},e.entries=function e(){var t,n=this;return y(e,(function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=f(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2}))},e.forEach=function(e,t){T(arguments,1);for(var n=c(this),r=n.next();!r.done;r=n.next()){var i=c(r.value);r=i.next().value,i=i.next().value,e.call(t,i,r,this)}},e.get=function(e){T(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){T(arguments,1);var t=[];return e=String(e),b(this.i,(function(n){n[0]===e&&t.push(n[1])})),t},e.has=function(e){T(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,r,i=this;return y(e,(function(e){if(1==e.h&&(t=c(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,f(e,c(r).next().value));n=t.next(),e.h=2}))},e.set=function(e,t,n){T(arguments,2),e=String(e);var r=[],i=S(e,t,n),o=!0;b(this.i,(function(t){t[0]===e?o&&(o=!r.push(i)):r.push(t)})),o&&r.push(i),this.i=r},e.values=function e(){var t,n,r,i,o=this;return y(e,(function(e){if(1==e.h&&(t=c(o),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,(i=c(r)).next(),f(e,i.next().value));n=t.next(),e.h=2}))},x.prototype._asNative=function(){for(var e=new C,t=c(this),n=t.next();!n.done;n=t.next()){var r=c(n.value);n=r.next().value,r=r.next().value,e.append(n,r)}return e},x.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach((function(e,r){return"string"==typeof e?t.push(n+A(E(r))+'"\r\n\r\n'+E(e)+"\r\n"):t.push(n+A(E(r))+'"; filename="'+A(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")})),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},x.prototype[Symbol.iterator]=function(){return this.entries()},x.prototype.toString=function(){return"[object FormData]"},I&&!I.matches&&(I.matches=I.matchesSelector||I.mozMatchesSelector||I.msMatchesSelector||I.oMatchesSelector||I.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),N&&(x.prototype[N]="FormData"),R){var P=w.XMLHttpRequest.prototype.setRequestHeader;w.XMLHttpRequest.prototype.setRequestHeader=function(e,t){P.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},w.XMLHttpRequest.prototype.send=function(e){e instanceof x?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),R.call(this,e)):R.call(this,e)}}k&&(w.fetch=function(e,t){return t&&t.body&&t.body instanceof x&&(t.body=t.body._blob()),k.call(this,e,t)}),O&&(w.navigator.sendBeacon=function(e,t){return t instanceof x&&(t=t._asNative()),O.call(this,e,t)}),w.FormData=x}}();const qU=()=>{const e=CN("AREAS");return 0===e.length&&e.push(XM.GLOBAL),ii(e).call(e,((e,t,n)=>{const r=YU(t);return r?0===n?r:"".concat(e,",").concat(r):e}),"")},YU=e=>e===XM.OVERSEA?"".concat(ZM.ASIA,",").concat(ZM.EUROPE,",").concat(ZM.AFRICA,",").concat(ZM.NORTH_AMERICA,",").concat(ZM.SOUTH_AMERICA,",").concat(ZM.OCEANIA):ZM[e],JU=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((e=>{const n=$M[e],r=Object.keys(n);r&&r.map((e=>{"CODE"!==e&&(t[e]=t[e].concat(n[e]))}))})),t},XU={GLOBAL:{ASIA:[XM.CHINA,XM.JAPAN,XM.INDIA,XM.KOREA,XM.HKMC],EUROPE:[],NORTH_AMERICA:[XM.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},QU=Object.keys(XU[XM.GLOBAL]),ZU=[XM.CHINA,XM.NORTH_AMERICA,XM.EUROPE,XM.ASIA,XM.JAPAN,XM.INDIA,XM.OCEANIA,XM.SOUTH_AMERICA,XM.AFRICA,XM.KOREA,XM.HKMC,XM.US],$U=function(e,t){let n=[];if(Dr(e).call(e,XM.GLOBAL)){const o=[XM.GLOBAL,XM.OVERSEA],a=Object.keys($M);if(t===XM.GLOBAL)throw new hA(CO.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===XM.CHINA)n=[XM.OVERSEA];else if(i=t,Dr(QU).call(QU,i)){const e=(r=t,XU[XM.GLOBAL][r]||[]),i=[...o,t,...e];n=a.filter((e=>!Dr(i).call(i,e)))}else if(function(e){let t=!1;return QU.forEach((n=>{var r;Dr(r=XU[XM.GLOBAL][n]).call(r,e)&&(t=!0)})),t}(t)){const e=function(e){let t;return QU.forEach((n=>{var r;Dr(r=XU[XM.GLOBAL][n]).call(r,e)&&(t=n)})),t}(t),r=[...o,e,t];n=a.filter((e=>!Dr(r).call(r,e)))}else n=e;n=function(e){const t=[];return ZU.forEach((n=>{Dr(e).call(e,n)&&t.push(n)})),t.concat(e.filter((e=>!Dr(ZU).call(ZU,e))))}(n)}else n=e;var r,i;return n};function eV(e){var t,n;if(!e&&Dr(t=CN("AREAS")).call(t,XM.EXTENSIONS))return rA.debug("update area from ap : reset"),void tV(NL,!0);if(!Dr(n=CN("AREAS")).call(n,XM.GLOBAL)||!e)return;let r=$M.EXTENSIONS;r&&(r={CODE:YU(XM.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},rA.debug("update area from ap success: ".concat(e,",config is "),r),wN("AREAS",[XM.EXTENSIONS],!0),Object.keys(r).map((e=>{wN(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?r[e][0]:r[e])})))}function tV(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=uA.reportApiInvoke(null,{name:HO.SET_AREA,options:e,tag:zO.TRACER});try{let r=[];if("string"==typeof e&&(r=[e]),Array.isArray(e)&&(e.forEach((e=>{if(!Dr(QM).call(QM,e))throw new hA(CO.INVALID_PARAMS,"invalid area code")})),r=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:t,excludedArea:n}=e;if(!t)throw new hA(CO.INVALID_PARAMS,"area code is needed");let i=t;"string"==typeof t&&(i=[t]),r=n?$U(i,n):i}if(!t){if(kN.AREAS){const e=new hA(CO.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(e),void rA.warning("setArea is prohibited because of config-distribute")}if(Dr(r).call(r,XM.GLOBAL)&&CN("AREAS")===XM.EXTENSIONS){const e=new hA(CO.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(e),void rA.warning("setArea is prohibited because of ap extensions")}}wN("AREAS",r,t);const i=JU(r);Object.keys(i).map((e=>{wN(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?i[e][0]:i[e])})),rA.debug("set area success:",r.join(","))}catch(e){throw n.onError(e),e}n.onSuccess()}function nV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nV(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let iV=1;function oV(e,t,n,r,i){iV+=1;const o={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:iV,requestId:iV,version:mN,cname:n.cname},a={service_name:t,json_body:JSON.stringify(o)};let s,c,l=e[0];return VI((async()=>{s=Date.now();const e=await KU(l,{data:a,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-s,0!==e.code){const t=new hA(CO.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:c});throw rA.error(t.toString()),t}const n=JSON.parse(e.json_body);if(200!==n.code){const e=new hA(CO.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(n.code,", reason: ").concat(n.reason),{code:n.code,responseTime:c});throw rA.error(e.toString()),e}if(!n.servers||0===n.servers.length){const e=new hA(CO.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:n.code,responseTime:c});throw rA.error(e.toString()),e}const i=function(e,t){return{addressList:e.servers.map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(CN("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t)))),workerToken:e.workerToken,vid:e.vid}}(n,t);return CN("LIVE_STREAMING_ADDRESS")&&(i.addressList=CN("LIVE_STREAMING_ADDRESS")instanceof Array?CN("LIVE_STREAMING_ADDRESS"):[CN("LIVE_STREAMING_ADDRESS")]),rV(rV({},i),{},{responseTime:c})}),((r,i)=>(uA.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(r.addressList),firstSuccess:0===i,responseTime:c,serverIp:e[i%e.length]}),!1)),((r,i)=>(uA.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:c,serverIp:e[i%e.length]}),!!(r.code!==CO.OPERATION_ABORTED&&r.code!==CO.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(l=e[(i+1)%e.length],!0))),i)}let aV=1;function sV(e,t,n,r){let{url:i,areaCode:o}=e;const{clientId:a,sid:s}=t,c=Date.now();let l;const d=t.role,[u,h]=hV(t,o,[Wj.CHOOSE_SERVER]);let p=aI.networkState;return VI((async()=>{p&&aI.networkState===eI.OFFLINE&&aI.onlineWaiter&&await np.race([aI.onlineWaiter,EI(r&&r.maxRetryTimeout||jI.maxRetryTimeout)]),p=aI.networkState;const{data:e,headers:o}=await KU(i,{data:u,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l="1"===o.http3?1:-1,uA.reportResourceTiming(i,s),lV(e,i,t,c,[Wj.CHOOSE_SERVER],l);const a=Xj(e,Wj.CHOOSE_SERVER);return dV(a),Kj(a,i)}),(e=>(e&&uA.joinChooseServer(s,{role:d,lts:c,succ:!0,csAddr:i,opid:h,serverList:e.gatewayAddrs.map((e=>e.address)),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[Wj.CHOOSE_SERVER].toString(),isHttp3:l,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.res.detail&&e.res.detail[38]}),!1)),(e=>e.code!==CO.OPERATION_ABORTED&&(e.code===CO.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(uA.joinChooseServer(s,{role:d,lts:c,succ:!1,csAddr:i,serverList:null,opid:h,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[Wj.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:p}),isHttp3:l,corssRegionTagReq:t.apRequestDetail}),rA.warning("[".concat(a||"sid-".concat(s.slice(0,6)),"] Choose server network error, retry"),e),!0))),r)}function cV(e,t,n,r){let i,{url:o,areaCode:a,serviceIds:s}=e;const c=Date.now(),l=t.role,[d,u]=hV(t,a,s);let h;return VI((async()=>{h&&aI.networkState===eI.OFFLINE&&aI.onlineWaiter&&await np.race([aI.onlineWaiter,EI(r&&r.maxRetryTimeout||jI.maxRetryTimeout)]),h=aI.networkState;const{data:e,headers:a}=await KU(o,{data:d,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===a.http3?1:-1,uA.reportResourceTiming(o,t.sid),lV(e,o,t,c,s,i);const l=Xj(e,Wj.CHOOSE_SERVER),u=Xj(e,"proxy5"===t.cloudProxyServer?Wj.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?Wj.CLOUD_PROXY:Wj.CLOUD_PROXY_FALLBACK);return dV(l),{gatewayInfo:Kj(l,o),proxyInfo:u,url:o}}),(e=>(e.gatewayInfo&&uA.joinChooseServer(t.sid,{role:l,lts:c,succ:!0,csAddr:o,serverList:e.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,opid:u,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:s.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.gatewayInfo.res.detail&&e.gatewayInfo.res.detail[38]}),e.proxyInfo&&uA.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:o,turnServerAddrList:e.proxyInfo.addresses.map((e=>e.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:s.toString()}),!1)),(e=>e.code!==CO.OPERATION_ABORTED&&(e.code===CO.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(uA.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:s.toString(),extend:JSON.stringify({networkState:h})}),rA.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0))),r)}const lV=(e,t,n,r,i,o)=>{const{sid:a,clientId:s,cloudProxyServer:c}=n,l=[],d=s=>{4096===s.flag?uA.joinChooseServer(a,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:s.error.message,csIp:s.error.data&&s.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:o,corssRegionTagReq:n.apRequestDetail}):1048576!==s.flag&&4194304!==s.flag&&4194310!==s.flag||uA.joinWebProxyAP(a,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:s.error.code,eventType:c,unilbsServerIds:i.toString()})};if(e.response_body.forEach((t=>{const n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)rA.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{const n={error:new hA(CO.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};l.push(n),d(n)}if(0!==n){const r=wj(n),i={error:new hA(CO.CAN_NOT_GET_GATEWAY_SERVER,r.desc,{desc:r.desc,retry:r.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?rA.warning(i.error.toString()):l.push(i),d(i)}})),l.length)throw rA.warning("[".concat(s||"sid-".concat(a.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(l.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry))).join(" | "))),new hA(CO.CAN_NOT_GET_GATEWAY_SERVER,l.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!l.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(l.map((e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((e=>!!e)))]})},dV=e=>{var t,n,r,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new hA(CO.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(CN("AP_AREA")&&(null!==(r=e.detail)&&void 0!==r&&r[23]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[23])?eV(e.detail[23].toLowerCase()):eV()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19])){const t=e.detail[19],n=null==t?void 0:t.split(";");for(let r=0;r<n.length;r++){var o;const t=xy(o=n[r]).call(o);e.addresses[r]&&n&&(e.addresses[r].fingerprint=t)}}if(CN("GATEWAY_ADDRESS")&&CN("GATEWAY_ADDRESS").length>0){rA.debug("assign gateway address to",CN("GATEWAY_ADDRESS"));const t=CN("GATEWAY_ADDRESS").map((t=>{var n,r;const i=null!==(n=null===(r=e.addresses.find((e=>e.ip===t.ip&&e.port===t.port)))||void 0===r?void 0:r.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}}));e.addresses=t}},uV=(e,t)=>{if(e.response_body&&e.response_body.length){const t=e.response_body[0];if(0!==t.buffer.code){const e=wj(t.buffer.code);throw new hA(CO.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw rA.debug("update ticket request received ap response without response body:",t),new hA(CO.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},hV=(e,t,n)=>{const r=Math.floor(Math.random()*10**12),i="host"===e.role?"1":"audience"===e.role?"2":void 0,o={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:rV(rV(rV({6:e.stringUid,11:t,12:CN("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};o.request_bodies.forEach((t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));const a=new FormData;return a.append("request",JSON.stringify(o)),[a,r]},pV=(e,t)=>{const n=Math.floor(Math.random()*10**12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((e=>({ip:e.ip,port:e.port})))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let fV=0;function mV(e){return np.all(e.map((e=>e.then((e=>{throw e}),(e=>e))))).then((e=>{throw e}),(e=>e))}const _V=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:o}=e,a=0;const s=t;let c,l=0;const d=async()=>{const e=(()=>{const e=a*s,t=e+s;return n.slice(e,t).map(r)})();o&&o.push(...e);try{c=await mV(e)}catch(e){if(l+=s,a++,!(l>=n.length))return void await d();i(e)}e.forEach((e=>e.cancel()))};return await d(),c},gV=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let o=0;const a=async()=>{const e=n(t.shift());try{return await e}catch(e){if(o++,o>=i||null!=r&&r(e))throw e;return a()}};return a()};async function vV(e,t,n,r){const i=async function(e,t,n,r){let i=null;const o=[],a=async()=>{const i=CN("WEBCS_DOMAIN").slice(0,CN("AJAX_REQUEST_CONCURRENT")).map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:qU()}))),a=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),s=await _V({fragementLength:CN("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(rA.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),sV(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),s},s=async()=>{if(await EI(1e3),null!==i)return i;const a=CN("WEBCS_DOMAIN_BACKUP_LIST").map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:qU()}))),s=r.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map((e=>e.url))}),c=await _V({fragementLength:CN("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:r=>(rA.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),sV(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},s),c};try{return i=await mV([a(),s()]),o.length&&o.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),i}catch(e){throw e[0]}}(e,t,n,r);return{gatewayInfo:await i}}async function yV(e,t,n,r,i){const o=e.cloudProxyServer;if("disabled"===o){if(!r)return;if(e.useLocalAccessPoint)return await vV(e,t,n,i);if(CN("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:r,proxyInfo:o}=await wV(e,t,n,i);if(e.turnServer&&"auto"!==e.turnServer.mode)return{gatewayInfo:r};const s=o.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||vN.tcpport,udpport:e.udpport||vN.udpport,username:e.username||vN.username,password:e.password||vN.password,forceturn:!1,security:!0})));if(i.useP2P){var a;const t=null!==(a=e.uid)&&void 0!==a?a:r.uid,n="glb:".concat(t.toString()),i=await FO(n),c=o.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||vN.tcpport,udpport:e.udpport||vN.udpport,username:n,password:i,forceturn:!1,security:!0})));s.push(...c)}return e.turnServer={mode:"manual",servers:s},{gatewayInfo:r}}return await vV(e,t,n,i)}const{proxyInfo:s,gatewayInfo:c}=await wV(e,t,n,i),l={gatewayInfo:c},d=s.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport?e.tcpport:vN.tcpport,udpport:"proxy4"===o?void 0:e.udpport?e.udpport:vN.udpport,username:e.username||vN.username,password:e.password||vN.password,forceturn:"proxy4"!==o,security:"proxy5"===o})));if(i.useP2P){var u;const t=null!==(u=e.uid)&&void 0!==u?u:c.uid,n="glb:".concat(t.toString()),r=await FO(n),i=s.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport||vN.tcpport,udpport:"proxy4"===o?void 0:e.udpport||vN.udpport,username:n,password:r,forceturn:"proxy4"!==o,security:"proxy5"===o})));d.push(...i)}return e.turnServer={mode:"manual",servers:d},rA.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),l}async function bV(e,t,n,r,i){const o=CN("ACCOUNT_REGISTER").slice(0,CN("AJAX_REQUEST_CONCURRENT"));let a=[];a=t.proxyServer?o.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):o.map((e=>"https://".concat(e,"/api/v1")));const s=null==i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{const o=await async function(e,t,n,r,i){const o=Date.now(),a={sid:n.sid,opid:10,appid:n.appId,string_uid:t};let s=e[0];const c=await VI((()=>KU(s+"".concat(-1===s.indexOf("?")?"?":"&","action=stringuid"),{data:a,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((n,r)=>{if(0===n.code){if(n.uid<=0||n.uid>=Math.pow(2,32))throw rA.error("Invalid Uint Uid ".concat(t," => ").concat(n.uid),n),uA.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:n.uid,errorCode:CO.INVALID_UINT_UID_FROM_STRING_UID,extend:a}),new hA(CO.INVALID_UINT_UID_FROM_STRING_UID);return uA.reqUserAccount(a.sid,{lts:o,success:!0,serverAddr:s,stringUid:a.string_uid,uid:n.uid,errorCode:null,extend:a}),!1}const i=wj(n.code);return i.retry&&(s=e[(r+1)%e.length]),uA.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:n.uid,errorCode:i.desc,extend:a}),i.retry}),((t,n)=>t.code!==CO.OPERATION_ABORTED&&(uA.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:null,errorCode:t.code,extend:a}),s=e[(n+1)%e.length],!0)),i);if(0!==c.code){const e=wj(c.code);throw new hA(CO.UNEXPECTED_RESPONSE,e.desc)}return c}(a,e,t,n,r);return null==i||i.recordJoinChannelService({status:"success",endTs:Date.now()},s),o.uid}catch(e){throw null==i||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e]},s),e}}async function EV(e,t,n){const r=CN("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):r.map((e=>"https://".concat(e,"/api/v1")));try{const r=await gV({referenceList:i,asyncMapHandler:r=>async function(e,t,n,r){const i=Date.now(),o={sid:n.sid,opid:10,appid:n.appId,string_uid:t};try{const t=await KU(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==t.code){const e=wj(t.code);throw new hA(CO.UNEXPECTED_RESPONSE,"preload sua error:".concat(e.desc),e)}if(t.uid<=0||t.uid>=Math.pow(2,32))throw new hA(CO.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:i,url:e,req:o,uid:t.uid,elapse:Date.now()-i}}catch(e){throw e}}(r,e,t,n),closeFn:e=>e.code===CO.OPERATION_ABORTED||e.code===CO.UNEXPECTED_RESPONSE&&!e.data.retry});return r}catch(e){throw e}}async function SV(e,t,n){const r=CN("CDS_AP").slice(0,CN("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config"))),i=r.map((r=>function(e,t,n,r){const i=qk(),o={flag:64,cipher_method:0,features:rV(rV(rV(rV(rV({install_id:fN(),device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:mN,cname:t.cname,session_id:t.sid,proxyServer:t.proxyServer,sdk_type:Bj.WEB_RTC,browser_name:i.name,browser_version:i.version,user_agent:navigator.userAgent,channel_name:t.cname},t.stringUid&&{string_uid:t.stringUid}),t.uid&&{uid:t.uid+""}),i.os&&{os_name:i.os}),i.osVersion&&{os_version:i.osVersion}),{},{detail:""})};return VI((()=>KU(e,{data:o,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(e=>e.code!==CO.OPERATION_ABORTED),r)}(r,e,t,n)));let o=null,a=null,s={};try{o=await mV(i)}catch(e){if(e.code===CO.OPERATION_ABORTED)throw e;a=e}if(i.forEach((e=>e.cancel())),uA.reportApiInvoke(e.sid,{name:HO.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:o}}).onSuccess(),o&&o.test_tags)try{s=function(e){if(!e.test_tags)return{};const t=e.test_tags,n=Object.keys(t),r={};return n.forEach((e=>{var n;const i=xy(n=e.slice(4)).call(n),o=JSON.parse(t[e]),a=o[1];r[i]={tag:o[0]||"",value:a}})),r}(o)}catch(e){}return s}async function TV(e,t){const n=CN("WEBCS_DOMAIN").concat(CN("WEBCS_DOMAIN_BACKUP_LIST")).map((e=>({url:"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:qU(),serviceIds:[Wj.CHOOSE_SERVER,Wj.CLOUD_PROXY_FALLBACK]})));try{const r=await gV({referenceList:n,asyncMapHandler:n=>async function(e,t,n){let r,{url:i,areaCode:o,serviceIds:a}=e;const s=Date.now(),[c,l]=hV(t,o,a);let d=aI.networkState;try{d&&aI.networkState===eI.OFFLINE&&aI.onlineWaiter&&await np.race([aI.onlineWaiter,EI(jI.maxRetryTimeout)]),d=aI.networkState;const{data:e,headers:t}=await KU(i,{data:c,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r="1"===t.http3?1:-1;const o=e=>{const t=[];if(e.response_body.forEach((n=>{const r=n.buffer.code;if(23===n.uri&&0===r&&!n.buffer.edges_services)if(4194310===n.buffer.flag)n.buffer.edges_services=[];else{const r={error:new hA(CO.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:n.buffer.flag};t.push(r)}if(0!==r){const i=wj(r),o={error:new hA(CO.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:n.buffer.flag};4194310===n.buffer.flag?rA.warning(o.error.toString()):t.push(o)}})),t.length)throw new hA(CO.CAN_NOT_GET_GATEWAY_SERVER,t.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!t.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(t.map((e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((e=>!!e)))]})};o(e);const a=Xj(e,Wj.CHOOSE_SERVER),u=Xj(e,Wj.CLOUD_PROXY_FALLBACK);return dV(a),{gatewayInfo:Kj(a,i),proxyInfo:u,opid:l,requestTime:s,url:i,isHttp3:r,elapse:Date.now()-s}}catch(e){throw e}}(n,e,t),closeFn:e=>e.code===CO.OPERATION_ABORTED||e.code===CO.CAN_NOT_GET_GATEWAY_SERVER&&!e.data.retry});return r}catch(e){throw e}}async function wV(e,t,n,r){const i=CN("PROXY_SERVER_TYPE3"),o=(e,t,n)=>{let r=n||i;return Array.isArray(r)&&(r=t%2==0?i[1]:i[0]),"https://".concat(r,"/ap/?url=").concat(e)};let a=null;const s=[],c=async()=>{const i=CN("WEBCS_DOMAIN").slice(0,CN("AJAX_REQUEST_CONCURRENT")).map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:qU(),serviceIds:[Wj.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?Wj.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?Wj.CLOUD_PROXY:Wj.CLOUD_PROXY_FALLBACK]}})),a=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),c=await _V({fragementLength:CN("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(rA.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),cV(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:s});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),c},l=async()=>{if(await EI(1e3),null!==a)return a;const i=CN("WEBCS_DOMAIN_BACKUP_LIST").map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:qU(),serviceIds:[Wj.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?Wj.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?Wj.CLOUD_PROXY:Wj.CLOUD_PROXY_FALLBACK]}})),c=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),l=await _V({fragementLength:CN("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(rA.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),cV(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:s});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},c),l};let d,u,h;try{({gatewayInfo:d,proxyInfo:u,url:h}=await mV([c(),l()]))}catch(e){throw e[0]}if(s.length&&s.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),!d||!u)throw new hA(CO.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=h,"disabled"!==e.cloudProxyServer&&Array.isArray(i)&&h){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];Dr(i).call(i,t)&&(e.proxyServer=t,rA.setProxyServer(t),uA.setProxyServer(t))}return a={gatewayInfo:d,proxyInfo:await Qj(u,d.uid)},a}async function CV(e,t,n){const r=CN("UAP_AP").slice(0,CN("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap"))),i=r.map((r=>function(e,t,n,r){const i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:mN,cname:t.cname,uid:t.uid.toString(),requestId:aV,seq:aV};aV+=1;const o={service_name:"tele_channel",json_body:JSON.stringify(i)};return VI((async()=>{const t=await KU(e,{data:o,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){const e=new hA(CO.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw rA.error(e.toString()),e}const r=JSON.parse(t.json_body);if(200!==r.code){const e=new hA(CO.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(r.code,", reason: ").concat(r.reason));throw rA.error(e.toString()),e}if(!r.servers||0===r.servers.length){const e=new hA(CO.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw rA.error(e.toString()),e}return{vid:r.vid,workerToken:r.workerToken,addressList:(CN("CHANNEL_MEDIA_RELAY_SERVERS")||r.servers).map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(CN("WORKER_DOMAIN"),":").concat(e.wss)))}}),void 0,(e=>!!(e.code!==CO.OPERATION_ABORTED&&e.code!==CO.UNEXPECTED_RESPONSE||e.data&&e.data.retry)),r)}(r,e,t,n)));try{const e=await mV(i);return i.forEach((e=>e.cancel())),e}catch(e){throw e[0]}}async function RV(e,t,n){let r=null;const i=[],o=async o=>{const a=CN(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2")));return o&&(await EI(1e3),null!==r)?r:await _V({fragementLength:CN("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:r=>(rA.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),r),function(e,t,n,r){const[i]=pV(t,[Wj.CHOOSE_SERVER]);let o=aI.networkState;return VI((async()=>{o&&aI.networkState===eI.OFFLINE&&aI.onlineWaiter&&await np.race([aI.onlineWaiter,EI(r&&r.maxRetryTimeout||jI.maxRetryTimeout)]),o=aI.networkState;const t=await KU(e,{data:i,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0);return uV(t,e)}),(()=>!1),(e=>e.code!==CO.OPERATION_ABORTED&&(e.code===CO.UPDATE_TICKET_FAILED?e.data.retry:(rA.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0))),r)}(r,e,t,n)),allFailedhandler:e=>{throw e[0]},promisesCollector:i})};try{return r=await mV([o(!1),o(!0)]),i.length&&i.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),r}catch(e){throw e[0]}}function kV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function OV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kV(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class IV extends BO{get isSuccess(){return!!this.configs}constructor(e,t){super(),uC(this,"configs",void 0),uC(this,"store",void 0),uC(this,"joinInfo",void 0),uC(this,"cancelToken",void 0),uC(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),uC(this,"interval",void 0),uC(this,"mutex",void 0),uC(this,"mutableParamsRead",!1),uC(this,"configCache",{}),uC(this,"limit_bitrate",void 0),this.mutex=new LI("config-distribute",e),this.store=t}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),CN("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),CN("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,uA.reportApiInvoke(null,{options:void 0,name:HO.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:zO.TRACER}).onSuccess(JSON.stringify(kN))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void rA.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await SV(this.joinInfo,this.cancelToken,this.retryConfig),rA.debug("[config-distribute] get config distribute",JSON.stringify(e));const t=function(e){var t;const n=Jp(t=Object.keys(e).filter((e=>/^webrtc_ng_global_parameter/.test(e)))).call(t);for(let o=0;o<n.length;o++)for(let t=n.length-1;t>o;t--){const r=n[t],i=e[r].value;if("number"==typeof i.__priority){const o=i.__priority,a=n[t-1],s=e[a].value;if("number"==typeof s.__priority){if(!(o>s.__priority))continue;{const e=r;n[t]=n[t-1],n[t-1]=e}}else{const e=r;n[t]=n[t-1],n[t-1]=e}}}const r=Date.now();let i={};return n.forEach((t=>{const n=e[t].value.__expires;n&&n<=r||(i[t]=e[t])})),i}(e);this.cacheGlobalParameterConfig(t),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=t}catch(e){const t=new hA(CO.NETWORK_RESPONSE_ERROR,e);rA.warning("[config-distribute] ".concat(t.toString()))}finally{t()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){tj(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(ej.UPDATE_BITRATE_LIMIT,e):this.emit(ej.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&OV({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const t={},n=Object.keys(e),r=[];n.forEach((n=>{const i=e[n].value;t[n]=i;const o=i.__id;if(o&&this.configCache[n]&&this.configCache[n].__id===o)return;const a=i.__type,s=e[n].value,c=e[n].tag;let l=0;a?a===RN.REALTIME&&(l=1):Object.keys(s).some((e=>Object.prototype.hasOwnProperty.call(SN,e)||!LL()&&Object.prototype.hasOwnProperty.call(yN,e)?(l=1,!0):void 0)),r.push({tag:c,isApplied:l,feature:n,params:JSON.stringify(i)})})),r.forEach((e=>{let{tag:t,feature:n,params:r,isApplied:i}=e;this.store.sessionId&&uA.abTest(this.store.sessionId,{intSucc:1,isApplied:i,tag:t,feature:n,params:r,cid:this.store.cid,uid:this.store.intUid})})),this.configCache=t}catch(e){rA.debug("handleABTestConfigDistribute error",e)}}cacheGlobalParameterConfig(e){const t=function(e){const t={};return Object.keys(e).forEach((n=>{const r=e[n].value,i=r.__expires,o=r.__type;Object.keys(r).forEach((e=>{"__id"===e||"__type"===e||"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(t,e)||(t[e]=OV(OV({value:r[e]},i&&{expires:i}),o&&{type:o}))}))})),t}(e);try{var n;const r=null===(n=t.LIMIT_BITRATE)||void 0===n?void 0:n.value;delete t.LIMIT_BITRATE,r&&tj(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(t),this.handleABTestConfigDistribute(e),function(e){try{const t=Date.now();Object.keys(e).forEach((n=>{const{value:r,type:i,expires:o}=e[n];o&&o<=t||((i===RN.REALTIME||Object.prototype.hasOwnProperty.call(SN,n))&&(kN[n]=r,TN[n]=r,rA.debug("Update realtime parameters from config distribute",n,r)),i||LL()||!Object.prototype.hasOwnProperty.call(yN,n)||(kN[n]=r,TN[n]=r,rA.debug("Update gateway parameters from config distribute",n,r)))}))}catch(t){rA.error("Error update config immediately: ".concat(e),t.message)}}(t);const i=JSON.stringify(t),o=window.btoa(i);window.localStorage.setItem("websdk_ng_global_parameter",o),rA.debug("Caching global parameters ".concat(i))}catch(e){rA.error("Error caching global parameters:",e.message)}}handleGlobalParameterConfig(e){try{const t=Date.now();Object.keys(e).forEach((n=>{if("CLIENT_ROLE_OPTIONS"===n&&Object.prototype.hasOwnProperty.call(TN,n)){const{value:r,expires:i}=e[n];if(i&&i<=t)return;(function(e,t){try{return"object"==typeof e&&"object"==typeof t&&JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}})(TN[n],r)||(kN[n]=r,TN[n]=r,this.emit(ej.UPDATE_CLIENT_ROLE_OPTIONS,r),rA.debug("Updating client role options: ".concat(JSON.stringify(r))))}}))}catch(e){rA.error("Error handling global parameter config:",e.message)}}}class NV extends BO{constructor(){super(...arguments),uC(this,"resultStorage",new Map)}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))}setRemoteAudioStats(e,t){const n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){const n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}record(e,t,n){if(CN("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(n),r.result.length>=5)){var i;const n=Dr(i=r.result).call(i,!0);r.isPrevNormal&&!n&&this.emit("exception",AV[e],e,t),!r.isPrevNormal&&n&&this.emit("exception",AV[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=n,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof UP&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=qj(t._encoderConfig.frameRate));const r=e.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof UP&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}const AV={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},xV=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}};function PV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function DV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?PV(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class LV{constructor(e){uC(this,"store",void 0),uC(this,"onStatsException",void 0),uC(this,"onUploadPublishDuration",void 0),uC(this,"onStatsChanged",void 0),uC(this,"onVideoCodecChanged",void 0),uC(this,"localStats",new Map),uC(this,"remoteStats",new Map),uC(this,"updateStatsInterval",void 0),uC(this,"trafficStats",void 0),uC(this,"trafficStatsPeerList",[]),uC(this,"uplinkStats",void 0),uC(this,"exceptionMonitor",void 0),uC(this,"p2pChannel",void 0),uC(this,"scalabilityMode",oN.L1T1),uC(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=e,this.exceptionMonitor=new NV,this.exceptionMonitor.on("exception",((e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)}))}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(cj.LocalAudioTrack)||DV({},WA)}getLocalVideoTrackStats(){return this.localStats.get(cj.LocalVideoTrack)||DV({},GA)}getRemoteAudioTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.audioStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{audioStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRemoteNetworkQualityStats(e){const t={};if(e){var n;const r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach((e=>{let[n,{networkStats:r}]=e;r&&(t[n]=r)}));return t}getRemoteVideoTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.videoStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{videoStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRTCStats(){let e=0,t=0,n=0,r=0;const i=this.localStats.get(cj.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);const o=this.localStats.get(cj.LocalVideoTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate);const a=this.localStats.get(cj.LocalVideoLowTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate),this.remoteStats.forEach((e=>{let{audioStats:t,videoStats:i}=e;t&&(n+=t.receiveBytes,r+=t.receiveBitrate),i&&(n+=i.receiveBytes,r+=i.receiveBitrate)}));let s=1;return this.trafficStats&&(s+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:s,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter((e=>void 0!==e.B_ppad||void 0!==e.B_ppvd)),e.peer_delay.filter((e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid))).forEach((e=>{var t;const n=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),r=null!=n&&n.videoSSRC?xV.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,i=null!=n&&n.audioSSRC?xV.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r>i?r:i),this.trafficStatsPeerList.push(e.peer_uid))})),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&rA.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){if(!e)return!1;const r=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,i=!n||t.framesDecodeCount>n.framesDecodeCount;return r||!i}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach((t=>{let[n,r]=t;switch(n){case cj.LocalVideoTrack:case cj.LocalVideoLowTrack:{const t=r,a=DV({},GA),s=e.getStats(),c=e.getLocalMedia(n);if(s){const n=s.videoSend.find((e=>e.ssrc===(null==c?void 0:c.ssrcs[0].ssrcId)));if(n){const r=e.getLocalVideoSize(),o=e.getEncoderConfig(cj.LocalVideoTrack);var i;"H264"!==n.codec&&"H265"!==n.codec&&"VP8"!==n.codec&&"VP9"!==n.codec&&"AV1X"!==n.codec&&"AV1"!==n.codec||(a.codecType=n.codec,(null==t?void 0:t.codecType)!==n.codec&&(null===(i=this.onVideoCodecChanged)||void 0===i||i.call(this,n.codec.toLocaleLowerCase()))),a.sendBytes=n.bytes,a.sendBitrate=t?8*Math.max(0,a.sendBytes-t.sendBytes):0,n.inputFrame?(a.captureFrameRate=n.inputFrame.frameRate,a.captureResolutionHeight=n.inputFrame.height,a.captureResolutionWidth=n.inputFrame.width):r&&(a.captureResolutionWidth=r.width,a.captureResolutionHeight=r.height),n.sentFrame?(a.sendFrameRate=n.sentFrame.frameRate,a.sendResolutionHeight=n.sentFrame.height,a.sendResolutionWidth=n.sentFrame.width):r&&(a.sendResolutionWidth=r.width,a.sendResolutionHeight=r.height),n.avgEncodeMs&&(a.encodeDelay=n.avgEncodeMs),o&&o.bitrateMax?a.targetSendBitrate=1e3*o.bitrateMax:n.targetBitrate&&(a.targetSendBitrate=n.targetBitrate),a.sendPackets=n.packets,a.sendPacketsLost=n.packetsLost,a.sendJitterMs=n.jitterMs,a.sendRttMs=n.rttMs,a.totalDuration=t?t.totalDuration+1:1,a.totalFreezeTime=t?t.totalFreezeTime:0,this.isLocalVideoFreeze(n)&&(a.totalFreezeTime+=1),n.scalabilityMode&&this.scalabilityMode!==n.scalabilityMode&&(rA.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(n.scalabilityMode)),this.scalabilityMode=n.scalabilityMode)}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(n,a),((null==t?void 0:t.sendResolutionWidth)!==a.sendResolutionWidth||(null==t?void 0:t.sendResolutionHeight)!==a.sendResolutionHeight)&&(null===(o=this.onStatsChanged)||void 0===o||o.call(this,"resolution",{width:a.sendResolutionWidth,height:a.sendResolutionHeight})),a&&c&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,c.track,a);break}case cj.LocalAudioTrack:{const t=r,i=DV({},WA),o=e.getStats(),a=e.getLocalMedia(n);if(o){const n=o.audioSend.find((e=>e.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId)));if(n){if("opus"!==n.codec&&"aac"!==n.codec&&"PCMU"!==n.codec&&"PCMA"!==n.codec&&"G722"!==n.codec||(i.codecType=n.codec),n.inputLevel)i.sendVolumeLevel=Math.round(32767*n.inputLevel);else{const t=e.getLocalAudioVolume();t&&(i.sendVolumeLevel=Math.round(32767*t))}i.sendBytes=n.bytes,i.sendPackets=n.packets,i.sendPacketsLost=n.packetsLost,i.sendJitterMs=n.jitterMs,i.sendRttMs=n.rttMs,i.sendBitrate=t?8*Math.max(0,i.sendBytes-t.sendBytes):0}}this.trafficStats&&(i.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(cj.LocalAudioTrack,i),i&&a&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,a.track,i);break}}}))}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach((t=>{var n,r;let[i,{videoStats:o,audioStats:a,videoPcStats:s}]=t;const c=a,l=o,d=s,u=DV({},HA),h=DV({},KA),p=DV({},zA),{audioTrack:f,videoTrack:m,audioSSRC:_,videoSSRC:g}=e.getRemoteMedia(i);let v;v=this.store.useP2P?e.getStats(!0):e.getStats();const y=null===(n=v)||void 0===n?void 0:n.audioRecv.find((e=>e.ssrc===_)),b=null===(r=v)||void 0===r?void 0:r.videoRecv.find((e=>e.ssrc===g)),E=this.trafficStats&&this.trafficStats.peer_delay.find((e=>e.peer_uid===i));if(y&&("opus"!==y.codec&&"aac"!==y.codec&&"PCMU"!==y.codec&&"PCMA"!==y.codec&&"G722"!==y.codec||(u.codecType=y.codec),y.outputLevel?u.receiveLevel=Math.round(32767*y.outputLevel):f&&(u.receiveLevel=Math.round(32767*f.getVolumeLevel())),u.receiveBytes=y.bytes,u.receivePackets=y.packets,u.receivePacketsLost=y.packetsLost,u.receivePacketsDiscarded=y.packetsDiscarded,u.packetLossRate=u.receivePacketsLost/(u.receivePackets+u.receivePacketsLost),u.receiveBitrate=c?8*Math.max(0,u.receiveBytes-c.receiveBytes):0,u.totalDuration=c?c.totalDuration+1:1,u.totalFreezeTime=c?c.totalFreezeTime:0,u.freezeRate=u.totalFreezeTime/u.totalDuration,u.receiveDelay=y.jitterBufferMs,u.totalDuration>10&&LV.isRemoteAudioFreeze(f)&&(u.totalFreezeTime+=1)),b){var S;"H264"!==b.codec&&"H265"!==b.codec&&"VP8"!==b.codec&&"VP9"!==b.codec&&"AV1X"!==b.codec&&"AV1"!==b.codec||(h.codecType=b.codec),h.receiveBytes=b.bytes,h.receiveBitrate=l?8*Math.max(0,h.receiveBytes-l.receiveBytes):0,h.decodeFrameRate=b.decodeFrameRate<0?0:b.decodeFrameRate,h.renderFrameRate=b.decodeFrameRate<0?0:b.decodeFrameRate,b.outputFrame&&(h.renderFrameRate=b.outputFrame.frameRate),b.receivedFrame?(h.receiveFrameRate=b.receivedFrame.frameRate,h.receiveResolutionHeight=b.receivedFrame.height,h.receiveResolutionWidth=b.receivedFrame.width):m&&(h.receiveResolutionHeight=m._videoHeight||0,h.receiveResolutionWidth=m._videoWidth||0),void 0!==b.framesRateFirefox&&(h.receiveFrameRate=Math.round(b.framesRateFirefox)),h.receivePackets=b.packets,h.receivePacketsLost=b.packetsLost,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost);const t=l?l.totalFreezeTime:0,n=l?l.totalDuration:0;h.totalDuration=l?l.totalDuration+1:1,h.totalFreezeTime=null!==(S=b.totalFreezesDuration)&&void 0!==S?S:t||0,h.receiveDelay=b.jitterBufferMs||0;const r=!!g&&e.getRemoteVideoIsReady(g);void 0===b.totalFreezesDuration&&m&&r&&LV.isRemoteVideoFreeze(m,b,d)&&(h.totalFreezeTime+=1),h.freezeRate=Math.max(0,Math.min((h.totalFreezeTime-t)/(h.totalDuration-n),1))}E&&(u.end2EndDelay=E.B_ad,h.end2EndDelay=E.B_vd,u.transportDelay=E.B_ed,h.transportDelay=E.B_ed,u.currentPacketLossRate=E.B_ealr4/100,h.currentPacketLossRate=E.B_evlr4/100,p.uplinkNetworkQuality=E.B_punq?E.B_punq:0,p.downlinkNetworkQuality=E.B_pdnq?E.B_pdnq:0),this.remoteStats.set(i,{audioStats:u,videoStats:h,videoPcStats:b,networkStats:p}),f&&this.exceptionMonitor.setRemoteAudioStats(f,u),m&&this.exceptionMonitor.setRemoteVideoStats(m,h)}))}}class MV{constructor(){uC(this,"destChannelMediaInfos",new Map),uC(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){BM(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){BM(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){AM(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function jV(e){if(!(e instanceof MV))return new hA(CO.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new hA(CO.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new hA(CO.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class UV{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){uC(this,"uid",void 0),uC(this,"_uintid",void 0),uC(this,"_trust_in_room_",!0),uC(this,"_trust_audio_enabled_state_",!0),uC(this,"_trust_video_enabled_state_",!0),uC(this,"_trust_audio_mute_state_",!0),uC(this,"_trust_video_mute_state_",!0),uC(this,"_audio_muted_",!1),uC(this,"_video_muted_",!1),uC(this,"_audio_enabled_",!0),uC(this,"_video_enabled_",!0),uC(this,"_audio_added_",!1),uC(this,"_video_added_",!1),uC(this,"_is_pre_created",!1),uC(this,"_video_pre_subscribed",!1),uC(this,"_audio_pre_subscribed",!1),uC(this,"_trust_video_stream_added_state_",!0),uC(this,"_trust_audio_stream_added_state_",!0),uC(this,"_audioTrack",void 0),uC(this,"_videoTrack",void 0),uC(this,"_dataChannels",[]),uC(this,"_audioSSRC",void 0),uC(this,"_videoSSRC",void 0),uC(this,"_audioOrtc",void 0),uC(this,"_videoOrtc",void 0),uC(this,"_cname",void 0),uC(this,"_rtxSsrcId",void 0),uC(this,"_videoMid",void 0),uC(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}function VV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function FV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VV(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const BV="9",WV=4e4;function GV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function HV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?GV(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var zV=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(zV||{});const KV=new Map;function qV(e,t,n,r){let{scale:i}=e;if(0===i&&r===zV.UP||i>=t.length-1&&r===zV.DOWN)return e;let o=HV(HV({},e),{},{scale:r===zV.DOWN?++i:--i});switch(n){case"maintain-framerate":o=HV(HV({},o),t[i].motion);break;case"maintain-resolution":o=HV(HV({},o),t[i].detail);break;case"balanced":o=HV(HV({},o),t[i].balanced)}return o}function YV(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:JV(t)};KV.set(e,n)}else KV.delete(e)}function JV(e){const t=HV({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:o}=t,{MIN_FRAME_RATE:a,MAX_THRESHOLD_FRAMERATE:s,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:l,BITRATE_MAX_THRESHOLD:d,BWE_SCALE_UP_THRESHOLD:u,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:f,BALANCE_BITRATE_FACTOR:m,BALANCE_FRAMERATE_FACTOR:_,BALANCE_RESOLUTION_FACTOR:g,MOTION_RESOLUTION_FACTOR:v,MOTION_BITRATE_FACTOR:y,DETAIL_FRAMERATE_FACTOR:b,DETAIL_BITRATE_FACTOR:E}=bN,S=Math.min(t.frameRate,s),T=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(p,1)*S),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o}}];for(let w=1;w<=c;w++){const e={bwe_up:Math.round(Math.pow(u,w)*n),bwe_down:Math.round(Math.pow(h,w+1)*n),fps_up:Math.round(Math.pow(f,w)*S),fps_down:Math.round(Math.pow(p,w+1)*S)},t={scaleResolutionDownBy:i/Math.pow(g,w),frameRate:Math.max(Math.round(Math.pow(_,w)*r),a),bitrateMax:Math.max(Math.round(Math.pow(m,w)*n),d),bitrateMin:Math.max(Math.round(Math.pow(m,w)*o),l)},s={scaleResolutionDownBy:i/Math.pow(v,w),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(y,w)*n),d),bitrateMin:Math.max(Math.round(Math.pow(y,w)*o),l)},c={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(b,w)*r),a),bitrateMax:Math.max(Math.round(Math.pow(E,w)*n),d),bitrateMin:Math.max(Math.round(Math.pow(E,w)*o),l)};T.push({scale:w,threshold:e,balanced:t,motion:s,detail:c})}return T}function XV(e,t,n,r,i,o){const a=KV.get(e)||{overUse:0,underUse:0,adaptationList:JV(i)},{adaptationList:s}=a;KV.set(e,a);const{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:l}=bN,{scale:d}=r;let u,h;return"number"==typeof t&&t>0&&function(e,t,n,r){if(t>=n.length)return!1;let{threshold:{fps_down:i}}=n[t];return CN("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[0].threshold.fps_down),e<i}(t,d,s,o)&&(a.overUse++,h=iN.CPU,a.overUse>c)||"number"==typeof n&&n>0&&function(e,t,n){if(t>=n.length)return!1;const{threshold:{bwe_down:r}}=n[t];return e<r}(n,d,s)&&(a.overUse++,h=iN.BANDWIDTH,a.overUse>c)?(a.overUse=0,a.underUse=0,u=qV(r,s,o,zV.DOWN),[u,h]):("number"==typeof t&&t>0&&"number"==typeof n&&n>0&&function(e,t,n,r){if(0===t)return;let{threshold:{fps_up:i}}=n[t];return CN("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[1].threshold.fps_up),e>i}(t,d,s,o)&&function(e,t,n){if(0===t)return;const{threshold:{bwe_up:r}}=n[t];return e>r}(n,d,s)&&(a.underUse++,a.underUse>l&&(a.overUse=0,a.underUse=0,u=qV(r,s,o,zV.UP),0===u.scale&&(h=iN.NONE))),[u,h])}function QV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ZV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QV(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $V(e){var t;return!!CN("ENABLE_AG_ADAPTATION")&&!!(e instanceof OD||Dr(t=e._hints).call(t,PA.CUSTOM_TRACK))&&(!!CN("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(e){const t=qk();if(t.os!==Wk.IOS||!t.osVersion)return!1;const n=t.osVersion.split(".");return Number(n[0])>=e}(14)&&cO(17,4,!0)||sO(14)&&lO(17,4,!0)))}const eF=new Map;function tF(e,t){const n=eF.get(e);if(n){const{timer:t}=n;window.clearTimeout(t),eF.delete(e)}t.qualityLimitationReason=iN.NONE,YV(e)}function nF(e,t){var n;let r;switch(t){case cj.LocalAudioTrack:r=KM.Audio;break;case cj.LocalVideoTrack:r=Dr(n=e._hints).call(n,PA.SCREEN_TRACK)?KM.Screen:KM.High;break;case cj.LocalVideoLowTrack:r=KM.Low}return r}function rF(e){const t=fA();if(e.some((e=>e._bypassWebAudio)))throw new RO(CO.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new RO(CO.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function iF(e,t){rF(e);const n=t||new UP;return e.forEach((e=>n.addAudioTrack(e))),n}const oF=!fA().supportUnifiedPlan||CN("CHROME_FORCE_PLAN_B")&&yO();function aF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;return oF?(n={spec:t,store:e},jU("PlanBConnection").create(n)):new hF(t,e)}function sF(e){return e&&("disconnected"===e.iceConnectionState||"checking"===e.iceConnectionState||"failed"===e.iceConnectionState)}function cF(e){try{if(e.iceServers)return!1;if(e.turnServer&&"off"!==e.turnServer.mode){if(JO(e.turnServer.servers))return!1;if(CN("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some((e=>e.forceturn)))return!0}return!1}catch(e){return!1}}var lF;function dF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function uF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dF(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let hF=(lF=class e extends rj{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Dr(t=Object.keys(IN)).call(t,e)})))]}constructor(t,n){super(t,n),uC(this,"id",SI(5,"connection-")),uC(this,"store",void 0),uC(this,"peerConnection",void 0),uC(this,"forceTurn",!1),uC(this,"remoteSDP",void 0),uC(this,"initialOffer",void 0),uC(this,"transportEventReceiver",void 0),uC(this,"statsFilter",void 0),uC(this,"extension",{useXR:CN("USE_XR")}),uC(this,"localCapabilities",void 0),uC(this,"remoteCodecs",void 0),uC(this,"localCandidateCount",0),uC(this,"allCandidatesReceived",!1),uC(this,"isPreallocation",!1),uC(this,"preSSRCMap",new Map),uC(this,"dataStreamChannelMap",new Map),uC(this,"establishPromise",void 0),uC(this,"recoveredDataChannelIds",[]),uC(this,"currentDataChannelId",1),uC(this,"supportAV1RtpSpec",!1),uC(this,"mutex",void 0),uC(this,"qualityLimitationReason",iN.NONE),uC(this,"isFirstConnected",!1),this.store=n,this.forceTurn=cF(t),this.mutex=new LI("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=hN(this.peerConnection,CN("STATS_UPDATE_INTERVAL"),void 0,tO()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const t=this.preSSRCMap.get(e);if(void 0!==t){const e=this.peerConnection.getTransceivers().find((e=>e.mid===t));if(e)return{transceiver:e,track:e.receiver.track,id:t}}}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);const n=this.remoteSDP.toString();null==t||t(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else rA.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else rA.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t))}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=lU(n.sdp),i=await bU({filterRTX:!CN("USE_PUB_RTX")&&!CN("USE_SUB_RTX"),filterVideoFec:CN("FILTER_VIDEO_FEC"),filterAudioFec:CN("FILTER_AUDIO_FEC"),filterVideoCodec:CN("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=TU(i),this.initialOffer=n,CN("ENABLE_SVC")&&"av1"==this.store.codec){const t=await async function(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:oN.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const n=MN(t.sdp).mediaDescriptions[0];if(!n)return;const r=n.attributes.extmaps.find((e=>"https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"===e.extensionName));return e.close(),r}catch(e){return}}();var e;t&&(this.supportAV1RtpSpec=!0,null===(e=i.send)||void 0===e||e.videoExtensions.push(t))}let o;return n.sdp&&NU(n.sdp)&&(o=dI(i),(t=o).send&&(rU(ij.VIDEO,t.send.videoExtensions),rU(ij.AUDIO,t.send.audioExtensions)),t.recv&&(rU(ij.VIDEO,t.recv.videoExtensions),rU(ij.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(rU(ij.VIDEO,t.sendrecv.videoExtensions),rU(ij.AUDIO,t.sendrecv.audioExtensions))),uF(uF({},r),{},{rtpCapabilities:o||i,offerSDP:n.sdp})}catch(e){throw new RO(CO.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}var t}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&NU(this.initialOffer.sdp)&&(t=e.rtpCapabilities,n=this.localCapabilities,t.send&&(nU(ij.VIDEO,t.send.videoExtensions,n.send.videoExtensions),nU(ij.AUDIO,t.send.audioExtensions,n.send.audioExtensions)),t.recv&&(nU(ij.VIDEO,t.recv.videoExtensions,n.recv.videoExtensions),nU(ij.AUDIO,t.recv.audioExtensions,n.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return dI(this._localCapabilities)}get rtpCapabilities(){return dI(this._rtpCapabilities)}get candidates(){return dI(this._candidates)}get iceParameters(){return dI(this._iceParameters)}get dtlsParameters(){return dI(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];uC(this,"sessionDesc",void 0),uC(this,"_localCapabilities",void 0),uC(this,"_rtpCapabilities",void 0),uC(this,"_candidates",void 0),uC(this,"_originCandidates",void 0),uC(this,"_iceParameters",void 0),uC(this,"_isUseExtmapAllowMixed",void 0),uC(this,"_dtlsParameters",void 0),uC(this,"setup",void 0),uC(this,"currentMidIndex",void 0),uC(this,"cname",void 0),uC(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,e=dI(e);const{iceParameters:n,dtlsParameters:r,candidates:i,rtpCapabilities:o,setup:a,localCapabilities:s,cname:c}=e;this._rtpCapabilities=o,this._candidates=i,this._originCandidates=dI(i),this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=s,this.setup=a,this.cname=c,this.sessionDesc=this.updateRemoteRTPCapabilities(o),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){const t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send;let o=this.sessionDesc.mediaDescriptions.length-1;for(let a=1;a<e;a++){const e=2*a+2e4,s=2*a+WV,{ssrcs:c,ssrcGroups:l}=pU([{ssrcId:e}],this.cname),{ssrcs:d,ssrcGroups:u}=pU([{ssrcId:s,rtx:CN("USE_SUB_RTX")?s+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:BV,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:BV,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:c,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return jN(this.sessionDesc)}send(e,t,n,r){const{ssrcs:i,ssrcGroups:o}=pU(t,this.cname,CN("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(i);if(a){if(tO()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,a.attributes.mid),r&&(r.twcc||r.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(a,r),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i);let n;return-1===t||1===t&&($k()||function(){const e=qk();return!(e.name!==Gk.CHROME||!e.osVersion)&&Number(e.version)<=90}()||CN("ENABLE_ENCODED_TRANSFORM")&&Zk())||0===t&&CN("USE_SUB_RTX")||uO()?(n=this.createOrRecycleSendMedia(e,i,o,"sendonly",r),this.updateBundleMids()):(n=dI(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=i,n.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,r)),tO()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map((e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)})),n=[];let r=!1;return t.forEach((e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)})),{mids:n,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{"0"===e.attributes.mid||tO()||uO()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Dr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Dr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}receive(e,t,n,r){e.forEach(((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])})),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||MN((n=this._isUseExtmapAllowMixed,"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite".concat(n?"\na=extmap-allow-mixed":"","\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n")));var n;this._rtpCapabilities=e;const r=this.rtpCapabilities.send,i=this.localCapabilities.send;for(const o of t.mediaDescriptions){if(o.attributes.iceUfrag=this._iceParameters.iceUfrag,o.attributes.icePwd=this._iceParameters.icePwd,o.attributes.fingerprints=this._dtlsParameters.fingerprints,o.attributes.candidates=this._candidates,o.attributes.setup=this.setup,"application"===o.media.mediaType&&(o.attributes.sctpPort="5000"),"video"===o.media.mediaType)if(0===r.videoCodecs.length){const e=i.videoCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Dr(n=t.encodingName.toLowerCase()).call(n,"vp8")}))||[i.videoCodecs[0]];o.media.fmts=e.map((e=>e.payloadType.toString(10))),o.attributes.payloads=e,o.attributes.extmaps=[]}else if(o.media.fmts=r.videoCodecs.map((e=>e.payloadType.toString(10))),o.attributes.payloads=r.videoCodecs,o.attributes.extmaps=r.videoExtensions,CN("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:e,ssrcGroups:t}=pU([{ssrcId:WV,rtx:CN("USE_SUB_RTX")?40001:void 0}],this.cname);o.attributes.ssrcs=e,o.attributes.ssrcGroups=t}if("audio"===o.media.mediaType)if(0===r.audioCodecs.length){const e=i.audioCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Dr(n=t.encodingName.toLowerCase()).call(n,"opus")}))||[i.audioCodecs[0]];o.media.fmts=e.map((e=>e.payloadType.toString(10))),o.attributes.payloads=e,o.attributes.extmaps=[]}else if(o.media.fmts=r.audioCodecs.map((e=>e.payloadType.toString(10))),o.attributes.payloads=r.audioCodecs,o.attributes.extmaps=r.audioExtensions,wU(o),CN("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:e,ssrcGroups:t}=pU([{ssrcId:2e4}],this.cname);o.attributes.ssrcs=e,o.attributes.ssrcGroups=t}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){const t=this._originCandidates.filter((e=>"udp"===e.transport)),n=[];if(t.forEach((e=>{n.push(FV(FV({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})),0!==t.length){switch(e){case oj.TCP_RELAY:this._candidates=n;break;case oj.UDP_TCP_RELAY:case oj.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=dI(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex((n=>{const r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(tO()){if(r){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r}))}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if("application"===n.media.mediaType)return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:BV,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,r,i,o){const a=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=CU(a,s,this.localCapabilities.send,a===ij.VIDEO?r:i),l=a===ij.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;const d="".concat(this.currentMidIndex);let u={media:{mediaType:a,port:BV,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};u=this.mungRecvMediaDsec(u,e,o);const h=this.findFirstClosedMedia(a);if(h){const e=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}updateRemoteCodec(e,t,n){const r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Dr(t=Object.keys(IN)).call(t,e)})))],i=new Set(t);if(r.every((e=>i.has(e))))return rA.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const o=this._rtpCapabilities.recv.videoCodecs.filter((e=>t.some((t=>{var n;return Dr(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}))));if(0===o.length)return rA.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;const a=[...new Set(o.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")))];let s;if(rA.debug("updateRemoteCodec, from ".concat(r," to ").concat(a)),0===e.length)s=this.sessionDesc.mediaDescriptions.filter((e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction));else if(s=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&"video"===t.media.mediaType&&Dr(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction)),s.length!==e.length)return rA.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(CN("USE_PUB_RTX")||CN("USE_SUB_RTX")){const e=RU(o,this.rtpCapabilities.recv.videoCodecs);o.push(...e)}this._rtpCapabilities.recv.videoCodecs=o;const c=this.localCapabilities.send,l=this.rtpCapabilities.recv,d=CU(ij.VIDEO,l,c,n);return s.forEach((e=>{const t=d.map((e=>e.payloadType.toString(10)));rA.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from"),e.attributes.payloads,"to",d),e.attributes.payloads=d,e.media.fmts=t})),!0}createOrRecycleSendMedia(e,t,n,r,i){const o=this.rtpCapabilities.send,a=e===ij.VIDEO?o.videoCodecs:o.audioCodecs,s=e===ij.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let l={media:{mediaType:e,port:BV,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};l=this.mungSendMediaDesc(l,i);const d=this.findFirstClosedMedia(e);if(d){const e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}mungRecvMediaDsec(e,t,n){const r=dI(e);return mU(r),fU(r,t),_U(r,t),gU(r),vU(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=dI(e);return vU(n,t,this.localCapabilities.recv),wU(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>tO()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===t?void 0:t.attributes.ssrcs}}(uF(uF({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),i=OU(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(i||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),null==o||o(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const a=this.peerConnection.getTransceivers()[0];if(null!=a&&a.receiver&&this.tryBindTransportEvents(a.receiver),CN("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(CN("PRELOAD_MEDIA_COUNT"));const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t)}const{preSSRCs:s}=e;if(Array.isArray(s)&&s.length>0){const{mids:e}=this.remoteSDP.batchSend(s.map((e=>({kind:e.kind,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtx}],mslabel:e.mslabel}))));e.forEach(((e,t)=>{this.preSSRCMap.set(s[t].ssrcId,e)})),await kU(this.peerConnection,this.remoteSDP,this.extension),rA.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}var t,n}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:t}=e;this.remoteSDP.updateRemoteRTPCapabilities(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:n}=e;if(Array.isArray(n)&&n.length>0){const{mids:e}=this.remoteSDP.batchSend(n.map((e=>Object.assign({},{kind:e.kind,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtx}],mslabel:e.mslabel}))));e.forEach(((e,t)=>{this.preSSRCMap.set(n[t].ssrcId,e)}))}await kU(this.peerConnection,this.remoteSDP,this.extension),rA.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return YR((function*(){const i=yield XR(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],a=eU();e.forEach((e=>{const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,uF({direction:"sendonly"},"video"===e.trackMediaType&&r.supportAV1RtpSpec&&a?{sendEncodings:[{scalabilityMode:a}]}:{}));o.push(t),e._updateRtpTransceiver(t)})),tO()&&!0===CN("SIMULCAST")&&(yield XR(r.applySimulcastForFirefox(o,e)));const s=yield XR(r.peerConnection.createOffer()),c=r.remoteSDP.predictReceivingMids(e.length),l=r.mungSendOfferSDP(s.sdp,e,c),d=MN(l),u=c.map((e=>{const t=d.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return dU(t,CN("USE_PUB_RTX"))}));let h;try{h=yield u}catch(i){h=[],r.remoteSDP.receive(e,t,n,h);const o=r.remoteSDP.toString();throw yield XR(r.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield XR(r.peerConnection.setRemoteDescription({type:"answer",sdp:o})),yield XR(r.stopSending(c,!0)),i}r.remoteSDP.receive(e,t,n,h);const p=r.remoteSDP.toString(),f=r.logSDPExchange(l,"offer","local","send");return yield XR(r.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield XR(r.applySimulcastEncodings(o,e)),yield XR(r.applySendEncodings(o,e)),null==f||f(p),yield XR(r.peerConnection.setRemoteDescription({type:"answer",sdp:p})),o.map(((e,t)=>{const n=c[t];return{localSSRC:u[t],id:n,transceiver:e}}))}catch(e){throw e instanceof RO?e:new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);if(n&&"open"===n.readyState)rA.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const t=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if("number"!=typeof t)throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:t,negotiated:!0,ordered:!1,maxRetransmits:CN("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)}t.forEach((e=>{e._updateOriginDataChannel(n)}));const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),rA.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else rA.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(e){throw e instanceof RO?e:new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(e.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(e){throw e instanceof RO?e:new RO(CO.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{var t;tF(this.id+e.mid,this),e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);o&&(await kU(this.peerConnection,this.remoteSDP,this.extension),rA.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const a=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:i,transceiver:a}}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);return n&&(await kU(this.peerConnection,this.remoteSDP,this.extension),rA.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),t.map((e=>{const t=this.peerConnection.getTransceivers().find((t=>t.mid===e));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}}))}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach((e=>{Array.from(this.preSSRCMap.entries()).some((t=>{let[n,r]=t;if(r===e)return this.preSSRCMap.delete(n),!0}))})),this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async(e,t)=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return YR((function*(){const n=yield XR(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const n=fA().supportPCSetConfiguration,r=CN("FORCE_TURN_TCP")||t.forceTurn;if(e===oj.RELAY&&!n)return;if(n&&!r){const n=e===oj.RELAY?"relay":"all",r=t.peerConnection.getConfiguration();r.iceTransportPolicy!==n&&(rA.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(r.iceTransportPolicy,"] to [").concat(n,"]")),r.iceTransportPolicy=n,t.peerConnection.setConfiguration(r))}t.remoteSDP.updateCandidates(e);const i=yield XR(t.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=lU(i.sdp),{remoteIceParameters:a}=yield o.iceParameters;t.remoteSDP.restartICE(a);const s=t.remoteSDP.toString(),c=t.logSDPExchange(i.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield XR(t.peerConnection.setLocalDescription(i)),null==c||c(s),yield XR(t.peerConnection.setRemoteDescription({type:"answer",sdp:s}))}catch(e){rA.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}}))()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(oj.TCP_RELAY),await kU(this.peerConnection,this.remoteSDP,this.extension)}catch(e){rA.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),e)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach((e=>{tF(this.id+e.mid,this)})),this.preSSRCMap.clear(),this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return uF(uF({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?tO()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:uF(uF({},XI),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:uF(uF({},XI),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.isFirstConnected=!0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var t;const n="code: ".concat(e.errorCode,", message: ").concat(e.errorText),r=e.port?"local: ".concat(e.port):"";rA.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(n,"), url: ").concat(e.url||"",", host_candidate:").concat(r)),null===(t=this.onICECandidateError)||void 0===t||t.call(this,n)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&rA.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,rA.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,rA.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),CN("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(JO(t.turnServer.servers)?n.iceServers=t.turnServer.servers:CN("NEW_TURN_MODE")&&n.iceServers?(CN("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.servers)),CN("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):"off"!==t.turnServer.mode&&(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),CN("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),CN("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),CN("ENABLE_ENCODED_TRANSFORM")&&fA().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(zj(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!CN("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}static newTurnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{const n=CN("NEW_TURN_MODE");1===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}):2===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}):3===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(zj(e.turnServerURL),":443?transport=tcp")}):4===n&&(t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(zj(e.turnServerURL),":443?transport=tcp")}))})),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const e=null==t?void 0:t.iceTransport.state;var n;e&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,e))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:e,remote:t}=n.getSelectedCandidatePair();rA.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n,r;if(!t){const n=this.peerConnection.getSenders();t=n.find((t=>t.track===e._mediaStreamTrack))}if(!t)return rA.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return rA.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!fA().supportSetRtpSenderParameters)return rA.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},o={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;case"balanced":i.degradationPreference="balanced"}const a=function(e,t){return e.getTransceivers().find((e=>e.sender.track===t||e.receiver.track===t))}(this.peerConnection,e._mediaStreamTrack),s=zx(e);if($V(e)&&a&&t&&s&&this.getLocalVideoStats&&Dr(n=["vp8","vp9"]).call(n,this.store.codec)){var c;const n=i.degradationPreference||(Dr(c=e._hints).call(c,PA.CUSTOM_TRACK)?CN("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(e,t,n,r,i,o){if(tF(e,n),i(t),"balanced"!==r&&"maintain-framerate"!==r&&"maintain-resolution"!==r)return;let a=-1;YV(e,t);const s=window.setInterval((()=>{const s=eF.get(e);if(!CN("ENABLE_AG_ADAPTATION")||!s)return tF(e,n),void i(t);const c=o();if(c.sendPackets>0&&c.OutgoingAvailableBandwidth>0){if(-1===a)return void(a=Date.now());if(Date.now()-a<1e3)return;const o=c.sendFrameRate,l=c.OutgoingAvailableBandwidth,[d,u]=XV(e,o,l,s.adaptationConfig,t,r);u&&(n.qualityLimitationReason=u),d&&s.adaptationConfig.scale!==d.scale&&(rA.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,"\n           sendFps ").concat(o,", bwe ").concat(l,", switch from ").concat(s.adaptationConfig.scale," to ").concat(d.scale," ")),s.adaptationConfig=ZV(ZV({},s.adaptationConfig),d),i(d))}}),CN("CHECK_LOCAL_STATS_INTERVAL")),c=ZV({},t);eF.set(e,{timer:s,adaptationConfig:c,originConfig:t,adaptationFunc:i}),rA.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(r))}(this.id+a.mid,s,this,n,(e=>{t&&this.updateAdaptation(t,e)}),this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var l;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(o.maxBitrate=1e3*t),(Dr(l=e._hints).call(l,PA.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(n&&(o.maxFramerate=qj(n)),r&&r>=1&&(o.scaleResolutionDownBy=r))}const{maxFramerate:d}=CN("ENCODER_CONFIG_LIMIT");if(d&&"number"==typeof d&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,d):d),CN("DSCP_TYPE")&&yO()){var u;const e=CN("DSCP_TYPE");Dr(u=["very-low","low","medium","high"]).call(u,e)&&(o.networkPriority=e)}const h=t.getParameters(),p=null===(r=h.encodings)||void 0===r?void 0:r[0];tO()&&!p&&(i.encodings=[o]),p&&Object.assign(p,o),Object.assign(h,i),rA.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await t.setParameters(h),await async function(e,t,n){try{var r;if(!fA().supportSetRtpSenderParameters)return;if(!function(e){return"vp9"===e||"av1"===e}(e)||!CN("ENABLE_SVC"))return;const i={},o={},a=t.getParameters(),s=null===(r=a.encodings)||void 0===r?void 0:r[0];o.scalabilityMode=eU(n),s&&Object.assign(s,o),Object.assign(a,i),await t.setParameters(a),rA.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(a.encodings)))}catch(e){rA.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",e)}}(this.store.codec,t,CN("SVC_MODE"))}async updateAdaptation(e,t){var n,r;if(!e)return rA.debug("[updateAdaptation] no rtpSender found");if(!fA().supportSetRtpSenderParameters)return rA.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const i={},{bitrateMax:o,frameRate:a,scaleResolutionDownBy:s}=t;o&&(i.maxBitrate=1e3*o),a&&(i.maxFramerate=qj(a)),s&&s>=1&&Dr(n=["vp8","vp9"]).call(n,this.store.codec)&&(i.scaleResolutionDownBy=s);const c=e.getParameters(),l=null===(r=c.encodings)||void 0===r?void 0:r[0];l&&Object.assign(l,i),Object.assign(c,{});try{await e.setParameters(c),rA.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(c.encodings)))}catch(t){!("transport"in e)||e.transport&&"connected"===e.transport.state?"connected"!==this.peerConnectionState?rA.debug("[updateAdaptation] peerConnection not connected}"):rA.debug("[updateAdaptation] updateRtpSenderEncodings failed",t):rA.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,t){try{if(!fA().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];i instanceof kD&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(e){rA.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=MN(e);return t.forEach(((e,t)=>{const i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&(fU(o,e),yU(o,e,this.store.codec))})),jN(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var n,r,i,o,a;const c=e[s],l=t[s];if(l instanceof kD&&!Dr(n=l._hints).call(n,PA.LOW_STREAM)&&null!==(r=l._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=l._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(a=l._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!tO()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof kD&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof kD&&CN("SIMULCAST")&&"vp8"===this.store.codec&&!Dr(t=e._hints).call(t,PA.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(CN("SDP_LOGGING"))return rA.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return t&&0!==t.length?t[0].ssrcId:void 0}setConfiguration(t){if(fA().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},vM(lF.prototype,"updateRemoteRTPCapabilities",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"updateRemoteRTPCapabilities"),lF.prototype),vM(lF.prototype,"connect",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"connect"),lF.prototype),vM(lF.prototype,"updateRemoteConnect",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"updateRemoteConnect"),lF.prototype),vM(lF.prototype,"createDataChannels",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"createDataChannels"),lF.prototype),vM(lF.prototype,"receive",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"receive"),lF.prototype),vM(lF.prototype,"batchReceive",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"batchReceive"),lF.prototype),vM(lF.prototype,"stopReceiving",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"stopReceiving"),lF.prototype),vM(lF.prototype,"muteRemote",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"muteRemote"),lF.prototype),vM(lF.prototype,"unmuteRemote",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"unmuteRemote"),lF.prototype),vM(lF.prototype,"muteLocal",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"muteLocal"),lF.prototype),vM(lF.prototype,"unmuteLocal",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"unmuteLocal"),lF.prototype),vM(lF.prototype,"close",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"close"),lF.prototype),vM(lF.prototype,"updateEncoderConfig",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"updateEncoderConfig"),lF.prototype),vM(lF.prototype,"updateSendParameters",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"updateSendParameters"),lF.prototype),vM(lF.prototype,"replaceTrack",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"replaceTrack"),lF.prototype),vM(lF.prototype,"updateAdaptation",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"updateAdaptation"),lF.prototype),vM(lF.prototype,"getRemoteSSRC",[pF],Object.getOwnPropertyDescriptor(lF.prototype,"getRemoteSSRC"),lF.prototype),lF);function pF(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}function fF(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=qj(t.width),r.height=qj(t.height);const i=qj(t.framerate||15);document.body.append(n),document.body.append(r);let o=e._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();const a=r.getContext("2d");if(!a)throw new hA(CO.UNEXPECTED_ERROR,"can not get canvas context");const s=fA(),c=r.captureStream(s.supportRequestFrame?0:i).getVideoTracks()[0];c.canvas||(c.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const e=n.videoWidth,t=n.videoHeight/e,i=r.width*t;Math.abs(i-r.height)>=2&&(rA.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(i)),r.height=i)}a.drawImage(n,0,0,r.width,r.height),c.requestFrame&&c.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,n.srcObject=new MediaStream([o]))},r.stopCapture=px((()=>r.startCapture&&r.startCapture()),i);const l=c.stop;return c.stop=()=>{l.call(c),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),rA.debug("clean low stream renderer")},c}var mF=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e[e.Video_Send_Type=2225]="Video_Send_Type",e}(mF||{}),_F=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(_F||{}),gF=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(gF||{}),vF=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(vF||{}),yF=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(yF||{});const bF=1e3,EF=6,SF=3,TF=Math.max(EF,SF);function wF(e,t,n){null!=n&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function CF(e){const t={[vF.CONN_TYPE]:0,[vF.RTT]:e.rtt,[vF.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t[vF.CONN_TYPE]=1),"tcp"===n&&(t[vF.CONN_TYPE]=3),"tls"===n&&(t[vF.CONN_TYPE]=4);break}case"srflx":t[vF.CONN_TYPE]=2;break;case"unknown":t[vF.CONN_TYPE]=5;break;default:t[vF.CONN_TYPE]=0}return t}function RF(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class kF extends BO{constructor(e){super(),uC(this,"store",void 0),uC(this,"uploadWRTCStatsTimer",void 0),uC(this,"uploadOutboundDenoiserStatsTimer",void 0),uC(this,"uploadExtStatsTimer",void 0),uC(this,"uploadExtUsageStatsTimer",void 0),uC(this,"uploadInboundExtStatsTimer",void 0),uC(this,"requestStats",void 0),uC(this,"requestTransportStats",void 0),uC(this,"requestLocalMedia",void 0),uC(this,"requestRemoteMedia",void 0),uC(this,"requestAllTracks",void 0),uC(this,"requestVideoIsReady",void 0),uC(this,"requestUploadStats",void 0),uC(this,"requestUpload",void 0),uC(this,"uploadOutboundStarted",!1),uC(this,"uploadInboundStarted",!1),uC(this,"uploadTransportStarted",!1),uC(this,"uploadBaseStatsStarted",!1),uC(this,"uploadExtensionUsageStarted",!1),uC(this,"lastRecvStats",void 0),uC(this,"lastSendStats",void 0),uC(this,"lastRefRecvStats",void 0),uC(this,"lastRefSendStats",void 0),uC(this,"lastNormalRecvStats",void 0),uC(this,"lastNormalSendStats",void 0),uC(this,"needUploadRenderFreezeTime",!0),uC(this,"lastUploadCompensateTime",-1),uC(this,"uploadCompensateDeltaTime",0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const t=e%SF==0,n=e%EF==0;let r,i;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(i=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!i&&this.uploadInboundStarted&&(i=this.requestStats(!0)),r||i){var o;const a={};if(this.uploadTransportStarted&&r){const e=this.getTransportStats(r,i,t);e&&(a.misc=[e])}if(this.uploadOutboundStarted&&r){const e=this.getOutboundStats(r,n?this.lastNormalSendStats:void 0,t?this.lastRefSendStats:void 0,this.lastSendStats);e&&(a.outbound=[e])}if(this.uploadInboundStarted&&i){this.uploadCompensateStats(e);const r=this.getInboundStats(i,n?this.lastNormalRecvStats:void 0,t?this.lastRefRecvStats:void 0,this.lastRecvStats);r&&(a.inbound=r)}const s=null===(o=this.requestTransportStats)||void 0===o?void 0:o.call(this).connectState;s&&(Array.isArray(a.misc)?a.misc[0]&&a.misc[0].addition&&(a.misc[0].addition[yF.RTC_PEER_CONNECTION_STATE]=aN[s]):a.misc=[{addition:{[yF.RTC_PEER_CONNECTION_STATE]:aN[s]}}]),this.requestUploadStats(a)}this.lastRecvStats=i,this.lastSendStats=r,n&&(this.lastNormalRecvStats=i,this.lastNormalSendStats=r),t&&(this.lastRefRecvStats=i,this.lastRefSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval((()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var t,n;const e=null===(t=this.requestTransportStats)||void 0===t?void 0:t.call(this);return void(e&&(null===(n=this.requestUploadStats)||void 0===n||n.call(this,{misc:[{addition:{[yF.RTC_PEER_CONNECTION_STATE]:aN[e.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===TF+1&&(e=1)}),bF)}uploadCompensateStats(e){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const t=e%SF==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!t)return;if(-1===this.lastUploadCompensateTime)return void(this.lastUploadCompensateTime=Date.now());const n=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=n,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const r=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*r;const i=this.requestStats(!0);new Array(r).fill(0).forEach((()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const e={};if(this.uploadInboundStarted&&i){const t=this.requestRemoteMedia()||[],n=[];t.forEach((e=>{let[t,r]=e;const o={peer:t.uid};if(t._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(t._videoSSRC)&&r.has(ij.VIDEO)&&t.videoTrack){const e=function(e,t,n){if(!t.videoRecv.find((t=>t.ssrc===e)))return;const r={};if(n&&n._player){const e=n._player,{renderFreezeAccTime2:t,videoElementStatus:i}=e;if("visible"===zD.visibility&&i===QA.PLAYING&&fA().supportRequestVideoFrameCallback){const n=Math.min(6e3,t);e.renderFreezeAccTime2=Math.max(0,t-n),wF(r,mF.Video_Render_Freeze_Time_Render2,n),CN("USE_NEW_RENDER_FREEZE_TIME")&&wF(r,mF.Video_Render_Freeze_Time_Render,n)}}return r}(t._videoSSRC,i,t.videoTrack);e&&(o.video=e)}o.video&&n.push(o)})),n.length>0&&(e.inbound=n,this.requestUploadStats(e))}}))}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(e,t,n){if(!this.requestStats)return;if(!n)return null==e.rtt?void 0:{addition:{[vF.RTT]:e.rtt,[vF.CONN_TYPE]:void 0,[vF.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const r=CF(e);if(this.store.useP2P){if(t){const e=CF(t);r[vF.CONN_TYPE]+=e[vF.CONN_TYPE]<<3}r[vF.CONN_TYPE]+=110}else r[vF.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,t,n,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const i=this.requestLocalMedia();if(!i||0===i.length)return;let o,a,s;return i.forEach((r=>{let[i,{track:c,ssrcs:l}]=r;switch(i){case cj.LocalVideoLowTrack:case cj.LocalVideoTrack:if(i===cj.LocalVideoTrack){const r=function(e,t,n,r,i){const o=t.videoSend.find((t=>t.ssrc===e));if(!o)return;const a={},{sentFrame:s,inputFrame:c}=o;if(r&&(wF(a,mF.Video_Send_Qp_Sum,o.qpSumPerFrame),c&&s)){var l;const e=c.frameRate,t=s.frameRate;a[mF.Video_Send_Freeze]=function(e,t){let n=!0;return n=!(e<=5)&&(e<=10?t<3:e<=20?t<4:t<5),n}(e,t)?1:0,a[mF.Video_Send_Type]="CameraVideoTrack"===n.__className__?0:Dr(l=n._hints).call(l,PA.SCREEN_TRACK)?1:2}if(i){switch(s&&(wF(a,_F.Video_Send_Height,s.height),wF(a,_F.Video_Send_Width,s.width),wF(a,_F.Video_Send_Frame_Rate,s.frameRate)),a[_F.Video_Send_Disabled]=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?1:0,o.adaptionChangeReason){case"none":a[_F.Video_Send_Adaptation]=0;break;case"cpu":a[_F.Video_Send_Adaptation]=1;break;case"bandwidth":a[_F.Video_Send_Adaptation]=2;break;case"other":a[_F.Video_Send_Adaptation]=3}let r=0;o.adaptionChangeReason&&(r+=RF(o.adaptionChangeReason)),t.qualityLimitationReason&&(r+=RF(t.qualityLimitationReason)<<3),a[_F.Video_Send_Adaptation]=r,a[_F.Video_Send_Player_Status]=$A[n._player?n._player.videoElementStatus:"uninit"],wF(a,_F.Video_Send_Nacks,o.nacksCount),wF(a,_F.Video_Send_Plis,o.plisCount),wF(a,_F.Video_Send_Firs,o.firsCount),wF(a,_F.Video_Send_Avg_Encode,o.avgEncodeMs),wF(a,_F.Video_Send_Huge_Frame_Sent,o.hugeFramesSent),wF(a,_F.Video_Send_Bytes_Retransmit,o.retransmittedBytesSent),wF(a,_F.Video_Send_Packages_Retransmit,o.retransmittedPacketsSent),wF(a,_F.Video_Send_Key_Frames_Encoded,o.keyFramesEncoded);const c=i.videoSend.find((t=>t.ssrc===e));if(c){let e=bF*SF;c.timestamp&&o.timestamp&&(e=o.timestamp-c.timestamp),null!=c.packets&&null!=o.packets&&wF(a,_F.Video_Send_Package_Rate,1e3*(o.packets-c.packets)/e),null!=o.packetsLost&&null!=c.packetsLost&&wF(a,_F.Video_Send_Package_Lost,o.packetsLost-c.packetsLost),null!=c.bytes&&null!=o.bytes&&wF(a,_F.Video_Send_Bitrate,8*(o.bytes-c.bytes)/e)}}return a}(l[0].ssrcId,e,c,t,n),i=c&&function(e,t,n,r){const i=t.videoSend.find((t=>t.ssrc===e));if(!i)return null;const o={};if(r){const e=i.inputFrame,t=e&&e.height||n.videoHeight||0,r=e&&e.width||n.videoWidth||0,a=e&&e.frameRate||0;wF(o,_F.Video_Capture_Height,t),wF(o,_F.Video_Capture_Width,r),wF(o,_F.Video_Capture_Frame_Rate,a)}return o}(l[0].ssrcId,e,c,!!n),o=function(e,t){const n={};return t&&(wF(n,_F.Video_Send_Retransmit,e.bitrate.retransmit),wF(n,_F.Video_Send_Target_Encoded,e.bitrate.targetEncoded),wF(n,_F.Video_Send_Actual_Encoded,e.bitrate.actualEncoded),wF(n,_F.Video_Send_Transmit,e.bitrate.transmit),wF(n,_F.Video_Send_Bandwidth,e.sendBandwidth)),n}(e,!!n);a=Object.assign({},r,i,o)}else s=function(e,t,n,r){const i=t.videoSend.find((t=>t.ssrc===e));if(!i)return;const o={};if(r){const t=i.sentFrame;t&&(wF(o,_F.Video_Send_Low_Height,t.height),wF(o,_F.Video_Send_Low_Width,t.width),wF(o,_F.Video_Send_Low_Frame_Rate,t.frameRate));const n=r.videoSend.find((t=>t.ssrc===e));if(n){let e=bF*EF;n.timestamp&&i.timestamp&&(e=i.timestamp-n.timestamp),null!=n.packets&&null!=i.packets&&wF(o,_F.Video_Send_Low_Package_Rate,1e3*(i.packets-n.packets)/e),null!=i.packetsLost&&null!=n.packetsLost&&wF(o,_F.Video_Send_Low_Package_Lost,i.packetsLost-n.packetsLost),null!=n.bytes&&null!=i.bytes&&wF(o,_F.Video_Send_Low_Bitrate,8*(i.bytes-n.bytes)/e)}}return o}(l[0].ssrcId,e,0,n);break;case cj.LocalAudioTrack:o=c&&function(e,t,n,r,i){const o=t.audioSend.find((t=>t.ssrc===e));if(!o)return;const a={};if(i){a[_F.Audio_Send_Disabled]=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?1:0;const t=100*n._source.getAccurateVolumeLevel(),r=o.inputLevel;if(null!=r){const e=Math.ceil(50*Math.log10(100*r+1));wF(a,_F.Audio_Send_Level,e)}wF(a,_F.Audio_Capture_PCM_Level,t),wF(a,_F.Audio_Send_AEC_Return_Loss,o.aecReturnLoss),wF(a,_F.Audio_Send_AEC_Return_Loss_Enhancement,o.aecReturnLossEnhancement),wF(a,_F.Audio_Send_Bytes_Retransmit,o.retransmittedBytesSent),wF(a,_F.Audio_Send_Packages_Retransmit,o.retransmittedPacketsSent),a[_F.Audio_Send_Freeze]=0;const s=i.audioSend.find((t=>t.ssrc===e));if(s){let e=bF*EF;s.timestamp&&o.timestamp&&(e=o.timestamp-s.timestamp),null!=s.bytes&&null!=o.bytes&&wF(a,_F.Audio_Send_Bitrate,8*(o.bytes-s.bytes)/e),null!=s.packets&&null!=o.packets&&wF(a,_F.Audio_Send_Package_Rate,1e3*(o.packets-s.packets)/e)}}return a}(l[0].ssrcId,e,c,0,n)}})),{high:a,low:s,audio:o}}getInboundStats(e,t,n,r){if(!this.requestRemoteMedia)return;const i=this.requestRemoteMedia()||[],o=[];return i.forEach((i=>{let[a,s]=i;const c={peer:a.uid};if(s.has(ij.VIDEO)&&a.videoTrack){const i=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,o=a.videoTrack?function(e,t,n,r,i,o,a,s){const c=t.videoRecv.find((t=>t.ssrc===e));if(!c)return;const l={},{receivedFrame:d,outputFrame:u,decodeFrameRate:h}=c;wF(l,gF.Video_Render_Frame_Rate_Decode,h),c.framesRateFirefox&&wF(l,gF.Video_Recv_Frame_Rate,c.framesRateFirefox),d&&wF(l,gF.Video_Recv_Frame_Rate,d.frameRate),wF(l,gF.Video_Recv_Frame_Dropped,c.framesDroppedCount),wF(l,gF.Video_Recv_Bytes_Retransmit,c.retransmittedBytesReceived),wF(l,gF.Video_Recv_Packages_Retransmit,c.retransmittedPacketsReceived),wF(l,gF.Video_Recv_Packages_Discarded,c.packetsDiscarded),wF(l,gF.Video_Recv_Avg_Decode,c.avgDecodeMs),wF(l,gF.Video_Recv_Avg_Processing_Delay,c.avgProcessingDelayMs),wF(l,gF.Video_Recv_Avg_Assembly_Time,c.avgFramesAssembledFromMultiplePacketsMs),wF(l,gF.Video_Recv_Avg_Inter_Frame_Delay,c.avgInterFrameDelayMs),wF(l,gF.Video_Recv_Key_Frames_Decoded,c.keyFramesDecoded);const p=s&&s.videoRecv.find((t=>t.ssrc===e));if(p){const e=t.timestamp-s.timestamp||bF;null!=c.packetsLost&&null!=p.packetsLost&&wF(l,gF.Video_Recv_Package_Lost,c.packetsLost-p.packetsLost),null!=p.bytes&&null!=c.bytes&&wF(l,gF.Video_Recv_Bitrate,8*(c.bytes-p.bytes)/e),null!=p.packets&&null!=c.packets&&wF(l,gF.Video_Recv_Package_Rate,1e3*(c.packets-p.packets)/e)}const f=o&&o.videoRecv.find((t=>t.ssrc===e));if(f&&(wF(l,mF.Video_Recv_Qp_Sum,c.qpSumPerFrame),l[mF.Video_Recv_Freeze]=r&&LV.isRemoteVideoFreeze(n,c,f)?1:0),a){var m;const t=a.videoRecv.find((t=>t.ssrc===e));d?(wF(l,_F.Video_Recv_Height,d.height),wF(l,_F.Video_Recv_Width,d.width)):n&&(wF(l,_F.Video_Recv_Height,n._videoHeight||0),wF(l,_F.Video_Recv_Width,n._videoWidth||0)),u&&wF(l,_F.Video_Recv_Frame_Rate_Output,u.frameRate);const r=null===(m=n._player)||void 0===m?void 0:m.rendFrameRate.toFixed(0);if(r&&wF(l,_F.Video_Render_Frame_Rate_Render,+r),wF(l,_F.Video_Recv_Jitter_Buffer,c.jitterBufferMs),wF(l,_F.Video_Recv_Current_Delay,c.currentDelayMs),wF(l,_F.Video_Recv_Firs,c.firsCount),wF(l,_F.Video_Recv_Nacks,c.nacksCount),wF(l,_F.Video_Recv_Plis,c.plisCount),n){l[_F.Video_Recv_Disabled]=n._originMediaStreamTrack.enabled&&n._mediaStreamTrack.enabled?0:1;const e=n._player;if(e){const{freezeTimeCounterList:n,renderFreezeAccTime:r,renderFreezeAccTime2:o,videoElementStatus:a}=e;if(n&&n.length>0&&wF(l,mF.Video_Render_Freeze_Time,n.splice(0,1)[0]),i&&"visible"===zD.visibility&&a===QA.PLAYING&&fA().supportRequestVideoFrameCallback){const t=Math.min(6e3,o);e.renderFreezeAccTime2=Math.max(0,o-t),wF(l,mF.Video_Render_Freeze_Time_Render2,t);const n=Math.min(6e3,r);e.renderFreezeAccTime=Math.max(0,r-n),wF(l,mF.Video_Render_Freeze_Time_Render,CN("USE_NEW_RENDER_FREEZE_TIME")?t:n)}if("number"==typeof c.totalFreezesDuration){const e=t&&t.totalFreezesDuration?c.totalFreezesDuration-t.totalFreezesDuration:c.totalFreezesDuration;wF(l,_F.Video_Render_Freeze_Duration,1e3*e)}}}if(l[_F.Video_Recv_Player_Status]=$A[n._player?n._player.videoElementStatus:"uninit"],t&&void 0!==c.totalInterFrameDelay&&void 0!==c.totalSquaredInterFrameDelay&&void 0!==t.totalInterFrameDelay&&void 0!==t.totalSquaredInterFrameDelay){const e=c.totalInterFrameDelay-t.totalInterFrameDelay,n=c.totalSquaredInterFrameDelay-t.totalSquaredInterFrameDelay,r=c.framesDecodeCount-t.framesDecodeCount,i=e/r*1e3,o=Math.round(1e3*Math.sqrt((n-Math.pow(e,2)/r)/r));!isNaN(o)&&i+o>Math.max(3*i,i+150)&&(l[_F.Video_Recv_I_Frame_Delay]=o)}}return l}(a._videoSSRC,e,a.videoTrack,!0===i,this.needUploadRenderFreezeTime,t,n,r):void 0;o&&(c.video=o)}if(s.has(ij.AUDIO)&&a.audioTrack){const i=a.audioTrack?function(e,t,n,r,i,o){const a=t.audioRecv.find((t=>t.ssrc===e));if(!a)return;const s={};wF(s,gF.Audio_Recv_Jitter,a.jitterMs),wF(s,gF.Audio_Recv_Bytes_Retransmit,a.retransmittedBytesReceived),wF(s,gF.Audio_Recv_Packages_Retransmit,a.retransmittedPacketsReceived),wF(s,gF.Audio_Recv_Packages_Discarded,a.packetsDiscarded),wF(s,gF.Audio_Recv_Avg_Processing_Delay,a.avgProcessingDelayMs);const c=o&&o.audioRecv.find((t=>t.ssrc===e));if(c){const e=bF;null!=a.packets&&null!=c.packets&&wF(s,gF.Audio_Recv_Package_Rate,1e3*(a.packets-c.packets)/e),null!=a.packetsLost&&null!=c.packetsLost&&wF(s,gF.Audio_Recv_Package_Lost,a.packetsLost-c.packetsLost)}if(r){const{receivedFrames:e,droppedFrames:t}=a;null!=e&&null!=t&&(s[mF.Audio_Recv_Freeze]=0===(l=e)||100*t/l>20?1:0)}var l;if(i){const t=100*n._source.getAccurateVolumeLevel(),r=a.outputLevel;if(null!=r){const e=Math.ceil(50*Math.log10(100*r+1));wF(s,_F.Audio_Render_Level,e)}wF(s,_F.Audio_Recv_PCM_Level,t),n&&(s[_F.Audio_Recv_Disabled]=n._originMediaStreamTrack.enabled&&n._mediaStreamTrack.enabled?0:1),wF(s,_F.Audio_Recv_Jitter_Buffer,a.jitterBufferMs),wF(s,_F.Audio_Recv_Current_Delay,a.jitterBufferMs),s[_F.Audio_Recv_Player_Status]=$A[Px.getPlayerState(n.getTrackId())];const o=i.audioRecv.find((t=>t.ssrc===e));if(o){null!=o.bytes&&null!=a.bytes&&wF(s,_F.Audio_Recv_Bitrate,8*(a.bytes-o.bytes)/(bF*SF));const e=a.concealedSamples-o.concealedSamples;e>0&&wF(s,_F.Audio_Recv_Concealed_Samples,e);const t=a.totalSamplesReceived-o.totalSamplesReceived;t>0&&wF(s,_F.Audio_Recv_Total_Samples_Received,t);const n=a.freezeSamples80-o.freezeSamples80;n>0&&wF(s,_F.Audio_Render_Freeze_Samples_80ms,n);const r=a.freezeSamples200-o.freezeSamples200;r>0&&wF(s,_F.Audio_Render_Freeze_Samples_200ms,r);const i=a.freezeMs80-o.freezeMs80;wF(s,_F.Audio_Render_Freeze_Time_80ms,i<0?0:i);const c=a.freezeMs200-o.freezeMs200;wF(s,_F.Audio_Render_Freeze_Time_200ms,c<0?0:c)}}return s}(a._audioSSRC,e,a.audioTrack,t,n,r):void 0;i&&(c.audio=i)}(c.video||c.audio)&&o.push(c)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find((e=>e instanceof MP));if(e&&e._external.getDenoiserStats){const t=e._external.getDenoiserStats();t&&this.requestUpload(kM.DENOISER_STATS,t)}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((()=>{this.requestAllTracks&&this.requestUpload&&this.requestAllTracks().forEach((e=>{e.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}))}))}),2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((()=>{this.requestUpload&&this.requestRemoteMedia&&(this.requestRemoteMedia()||[]).forEach((e=>{let[t,n]=e;n.has(ij.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})),n.has(ij.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}))}))}),2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval((async()=>{const t=Date.now(),n={connectionInterval:CN("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t};let r=[];const i=this.requestAllTracks&&this.requestAllTracks()||[];for(const e of i)!e.muted&&e.enabled&&(r=r.concat(await e.getProcessorUsage()));const o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[e,c]of o)c.has(ij.VIDEO)&&e.videoTrack&&(r=r.concat(await e.videoTrack.getProcessorUsage())),c.has(ij.AUDIO)&&e.audioTrack&&(r=r.concat(await e.audioTrack.getProcessorUsage()));if(0===r.length)return;n.details=function(e,t){const n={};for(const{id:a,value:s,level:c,direction:l}of e){var r;const e=null!==(r=t.get(a))&&void 0!==r?r:0,d=2===s?e+CN("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;var i,o;t.set(a,d),n[a]?(2===s&&(n[a].value=s),c>n[a].level&&(n[a].level=c),"remote"===l&&(n[a].remoteUidCount+=1),n[a].totalTs=null!==(i=t.get(a))&&void 0!==i?i:0):n[a]={value:s,level:c,remoteUidCount:"local"===l?0:1,totalTs:null!==(o=t.get(a))&&void 0!==o?o:0}}return Object.keys(n).map((e=>{const{level:t,value:r,totalTs:i}=n[e];return{id:e,level:t,value:r,totalTs:i}}))}(r,e);const a=Date.now(),s=a>t?a:t+1;this.requestUpload&&this.requestUpload(kM.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:s})}),CN("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const OF=CN("ICE_RESTART_INTERVAL");let IF=new Map,NF=new Map,AF=[oj.UDP_TCP_RELAY,oj.TCP_RELAY,oj.RELAY],xF=CN("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&fA().supportPCSetConfiguration;function PF(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=IF.get(e.id);n&&(window.clearTimeout(n),IF.delete(e.id));const r=NF.get(e.id);t&&r&&r.index===AF.length-1&&(rA.debug("[".concat(e.id,"] reset ICE restart policy")),NF.delete(e.id))}function DF(e,t,n){if(0===IF.size&&0===NF.size&&(Array.isArray(CN("RESTART_SEQUENCE"))&&CN("RESTART_SEQUENCE").length>0&&!function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1){const r=e[n];if(e.filter((e=>e===r)).length!==t.filter((e=>e===r)).length)return!1}return!0}(AF,CN("RESTART_SEQUENCE"))&&(AF=CN("RESTART_SEQUENCE").filter((e=>{var t;if(Dr(t=Object.values(oj)).call(t,e))return!0})),rA.debug("use reconnection policy from config distribution, queues: ".concat(AF.join(" => ")))),xF=CN("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&fA().supportPCSetConfiguration),0===AF.length)return void n();let r,{index:i=0,type:o}=NF.get(e.id)||{};if(xF&&o===oj.RELAY)return void n();let a=o&&i>=AF.length-1;if(xF)o=oj.RELAY;else{if(a)return void n();o?(i++,o=AF[i]):(o=AF[0],i=0)}rA.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(o,", index: ").concat(i)),t(o),NF.set(e.id,{index:i,type:o}),r=window.setTimeout((()=>DF(e,t,n)),OF),IF.set(e.id,r)}var LF;function MF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?MF(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function UF(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=ZR,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new VF(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function VF(e){function t(e){if(Object(e)!==e)return np.reject(new TypeError(e+" is not an object."));var t=e.done;return np.resolve(e.value).then((function(e){return{value:e,done:t}}))}return VF=function(e){this.s=e,this.n=e.next},VF.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?np.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?np.reject(e):t(n.apply(this.s,arguments))}},new VF(e)}let FF=(LF=class extends BO{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(dj.StateChange,t,this._state)}constructor(e,t){super(),uC(this,"isPlanB",void 0),uC(this,"store",void 0),uC(this,"statsUploader",void 0),uC(this,"connection",void 0),uC(this,"localTrackMap",new Map),uC(this,"remoteUserMap",new Map),uC(this,"localDataChannels",[]),uC(this,"remoteDataChannelMap",new Map),uC(this,"pendingLocalTracks",[]),uC(this,"pendingRemoteTracks",[]),uC(this,"pendingLocalDataChannels",[]),uC(this,"pendingRemoteDataChannels",[]),uC(this,"statsCollector",void 0),uC(this,"shouldForwardP2PCreation",void 0),uC(this,"iceFailedCount",0),uC(this,"dtlsFailedCount",0),uC(this,"mutex",void 0),uC(this,"_state",lj.Disconnected),uC(this,"_pcStatsUploadType",CN("NEW_ICE_RESTART")?aj.FIRST_CONNECTION:aj.OLD_FIRST_CONNECTION),uC(this,"_isStartRestartIce",!1),uC(this,"_restartTimer",void 0),uC(this,"_isTryConnecting",!1),uC(this,"_iceError",null),uC(this,"_forceTurn",!1),uC(this,"_isWaitPcToRePub",!1),uC(this,"handleMuteLocalTrack",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==lj.Connected)return void n(new RO(CO.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const i=r.find((e=>"videoLowTrack"===e[0]));i&&i[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const o=this.createMuteMessage(r);await rI(this,dj.RequestMuteLocal,o),t()}catch(e){n(e)}finally{r()}})),uC(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==lj.Connected)return void n(new RO(CO.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();const i=r.find((e=>"videoLowTrack"===e[0]));if(i){const t=i[1];if(t.track._originMediaStreamTrack.stop(),!CN("DISABLE_DUAL_STREAM_USE_ENCODING")&&fA().supportDualStreamEncoding){const n=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}else{const n=fF(e,oI(this,dj.RequestLowStreamParameter));t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}await new np(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}await this.connection.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const o=this.createUnmuteMessage(r);await rI(this,dj.RequestUnmuteLocal,o),t()}catch(e){n(e)}finally{r()}})),uC(this,"handleUpdateVideoEncoder",(async(e,t,n,r)=>{let i;r||(i=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const n=this.localTrackMap.get(cj.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==lj.Connected)return void t();const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),await this.connection.updateEncoderConfig(r,i),this.emit(dj.UpdateVideoEncoder,i),t()}catch(e){n(e)}finally{var o;null===(o=i)||void 0===o||o()}})),uC(this,"handleUpdateVideoSendParameters",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get(cj.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==lj.Connected)return void t();const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}})),uC(this,"handleReplaceMixingTrack",(async(e,t,n,r)=>{if(!this.connection||this.state!==lj.Connected)return void t();const i=iF([e]);let o;rA.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(i.getTrackId(),"]")),"boolean"==typeof r&&r||(o=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(e,i),t()}catch(e){n(e)}finally{var a;null===(a=o)||void 0===a||a()}})),uC(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;rA.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var o;const n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.connection||!n||this.state!==lj.Connected)return void t();if(await(null===(o=this.connection)||void 0===o?void 0:o.replaceTrack(e,n[1].id)),this.isPlanB){const t=n[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(n[0],t)}if(n[0]===cj.LocalVideoTrack&&!CN("DISABLE_DUAL_STREAM_USE_ENCODING")&&fA().supportDualStreamEncoding){const t=this.localTrackMap.get(cj.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new np(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(e){n(e)}finally{var a;null===(a=i)||void 0===a||a()}})),uC(this,"handleGetRTCStats",(e=>{e(this.statsCollector.getRTCStats())})),uC(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),uC(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),uC(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),uC(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new kF(this.store),this.bindStatsUploaderEvents(),this.mutex=new LI("P2PChannel-mutex",this.store.clientId),this.isPlanB=!fA().supportUnifiedPlan||CN("CHROME_FORCE_PLAN_B")&&yO(),this.shouldForwardP2PCreation=CN("FORWARD_P2P_CREATION")&&fA().supportPCSetConfiguration&&vO(),this.shouldForwardP2PCreation&&(this.connection=aF(this.store),this.emit(dj.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=lj.New,this._forceTurn=cF(e),rA.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&"closed"===(null===(t=this.connection)||void 0===t?void 0:t.peerConnectionState);if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(rA.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=aF(this.store,e),this.emit(dj.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new RO(CO.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=CN("NEW_ICE_RESTART")?aj.FIRST_CONNECTION:aj.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new RO(CO.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");CN("ENABLE_PREALLOC_PC")&&this.state===lj.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=lj.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter((e=>{var t;let[n]=e;return Dr(t=[cj.LocalVideoLowTrack,cj.LocalVideoTrack]).call(t,n)})),n=t.map((e=>{let[,{id:t}]=e;return t})),r=t.map((e=>{let[t]=e;return t}));if(this.connection instanceof hF){if(uA.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Dr(e).call(e,this.store.codec)){const t=["vp9","vp8","h264"].find((t=>Dr(e).call(e,t)));t&&(this.store.codec=t,rA.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(t,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof hF&&"closed"!==this.connection.peerConnectionState&&Dr(e=[lj.New,lj.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==lj.Connected){if(this.state===lj.Disconnected)throw new RO(CO.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach((e=>{var t;Dr(t=this.pendingLocalDataChannels).call(t,e)||this.pendingLocalDataChannels.push(e)})),[]}const t=this.filterTobePublishedDataChannels(e);return 0===t.length?[]:(t.forEach((e=>{const t=Date.now();this.store.publish(e.id.toString(),"datachannel",t)})),await this.connection.createDataChannels(this.store.uid,t),t.forEach((e=>{this.localDataChannels.push(e);const t=Date.now();this.store.publish(e.id+"","datachannel",void 0,t)})),e.map((e=>({streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId}))))}publish(e,t,n){var r=this;return YR((function*(){const i=yield XR(r.mutex.lock("From P2PChannel.publish"));try{var o;const i=r.connection&&Dr(o=["disconnected","failed"]).call(o,r.connection.peerConnectionState);if(!r.connection||r.state!==lj.Connected||i){if(r.state===lj.Disconnected)throw new RO(CO.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return r.pendingLocalTracks=r.pendingLocalTracks.concat(t),void(i&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,xV.markPublishStart(r.store.clientId,r.store.pubId);const a=r.filterTobePublishedTracks(e,t,n);if(0===a.length)return void(yield XR(r.tryToUnmuteAudio(e)));yield*QR(UF(r.doPublish(r.connection,a)))}finally{i()}}))()}doPublish(e,t){var n=this;return YR((function*(){t.forEach((e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===cj.LocalAudioTrack?"audio":"video",i)})),n.bindLocalTrackEvents(t);const r=t.map((e=>{let{track:t}=e;return t})),i=yield XR(e.send(r,n.store.codec,n.store.audioCodec)),o=(yield XR(i.next())).value,a=n.createGatewayPublishMessage(t,o);let s;try{s=yield a}catch(e){throw i.throw(e),(null==e?void 0:e.code)===CO.WS_ABORT&&t.forEach((e=>{let{track:t}=e;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)})),n.unbindLocalTrackEvents(t),e}const c=n.mapPubResToRemoteConfig(a,s,r),l=(yield XR(i.next(c))).value;if(n.state===lj.Disconnected)throw new RO(CO.UNEXPECTED_ERROR,"PeerConnection already disconnected.");CN("ENABLE_VIDEO_SEI");const d=CN("ENABLE_ENCODED_TRANSFORM"),u=CN("ENABLE_AUDIO_METADATA");r.forEach((async e=>{const t=e.getRTCRtpTransceiver();if(!t||!d)return;const{interceptLocalVideoFrame:n,interceptLocalAudioFrame:r}=VU();e.trackMediaType===ij.VIDEO?await n(t.sender,e):e.trackMediaType===ij.AUDIO&&await r(t.sender,{metadata:u?()=>{const t=e.metadata.shift();return t&&t.value}:void 0})})),t.forEach((e=>{let{type:t}=e;n.statsCollector.addLocalStats(t)})),n.assignLocalTracks(t,l),n.statsUploader.startUploadOutboundStats(),t.forEach((e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===cj.LocalAudioTrack?"audio":"video",void 0,i)}))}))()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof kD))return rA.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=n,i=function(e,t){const n={};return e.height&&e.width&&(n.scaleResolutionDownBy=Zj(e,t)),n.maxFramerate=e.framerate?qj(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==cj.LocalVideoLowTrack||!CN("DISABLE_DUAL_STREAM_USE_ENCODING")&&fA().supportDualStreamEncoding)null!=i.scaleResolutionDownBy&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const t=r._originMediaStreamTrack;if(!t.canvas)return rA.warn("[".concat(r.getTrackId(),"] no canvas on track"));!function(e,t){const n=e.canvas;t.width&&(n.width=qj(t.width)),t.height&&(n.height=qj(t.height)),t.framerate&&(n.stopCapture&&n.stopCapture(),n.stopCapture=px((()=>{!n.startCapture&&n.stopCapture&&n.stopCapture(),n.startCapture&&n.startCapture()}),qj(t.framerate)))}(t,e)}null!=i.maxBitrate&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),null!=i.maxFramerate&&(r._encoderConfig.frameRate&&"object"==typeof r._encoderConfig.frameRate?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),rA.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return YR((function*(){if(!t.connection||t.state!==lj.Connected)return;const n=yield XR(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const n=t.localTrackMap.get(cj.LocalVideoTrack);if(!n)throw new RO(CO.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(cj.LocalVideoLowTrack))throw new RO(CO.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const i=[{track:t.getLowVideoTrack(n.track,e),type:cj.LocalVideoLowTrack}];if(yield*QR(UF(t.doPublish(t.connection,i))),n.track.muted||!n.track.enabled){var r;const e=null===(r=t.localTrackMap.get(cj.LocalVideoLowTrack))||void 0===r?void 0:r.id;void 0!==e&&(yield XR(t.connection.muteLocal([e])))}}finally{n()}}))()}async republish(){this.pendingLocalTracks.length>0&&(rA.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await nI(this,dj.RequestRePublish,this.pendingLocalTracks),this.emit(dj.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(rA.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await nI(this,dj.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:e,kind:n}=this.pendingRemoteTracks[t];(n!==ij.AUDIO||e._audio_added_&&e._audioSSRC)&&(n!==ij.VIDEO||e._video_added_&&e._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await nI(this,dj.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===ij.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach((e=>{let{user:t}=e;this.emit(dj.MediaReconnectEnd,t.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==lj.Connected)return void e.forEach((e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find((e=>"videoLowTrack"===e[0]));return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==lj.Connected)return void e.forEach((e=>{const t=this.pendingLocalDataChannels.indexOf(e);-1!==t&&this.pendingLocalDataChannels.splice(t,1)}));const t=this.filterTobeUnpublishedDataChannels(e);return 0!==t.length?(t.forEach((e=>{const t=this.localDataChannels.indexOf(e);-1!==t&&this.localDataChannels.splice(t,1)})),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),t.map((e=>e.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==lj.Connected)return;const e=this.localTrackMap.get(cj.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[cj.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==lj.Connected)throw new RO(CO.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter((t=>{var n;return!(null!==(n=this.remoteDataChannelMap.get(e))&&void 0!==n&&n.get(t.id))}));if(0!==n.length)return await this.connection.createDataChannels(e.uid,n),n.forEach((t=>{var n;this.remoteDataChannelMap.has(e)?null===(n=this.remoteDataChannelMap.get(e))||void 0===n||n.set(t.id,t):this.remoteDataChannelMap.set(e,new Map([[t.id,t]]));const r=this.pendingRemoteDataChannels.findIndex((n=>{let{user:r,id:i}=n;return r.uid===e.uid&&i===t.id}));-1!==r&&this.pendingRemoteDataChannels.splice(r,1)})),n.map((e=>e.id))}async subscribe(e,t,n,r,i){var o;if(!this.connection||this.state!==lj.Connected)throw new RO(CO.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(o=this.remoteUserMap.get(e))&&void 0!==o&&o.has(t))return;let a,s,c;const l=this.connection.getPreMedia(n);if(l)rA.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),c=l.transceiver,a=l.track,s=l.id;else if(i){const n=i.find((e=>{let{stream_type:n}=e;return n===t}));if(!n)throw new RO(CO.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const r=await this.connection.receive(t,n.ssrcs,String(e._uintid),n.attributes);this.connection instanceof hF&&(c=r.transceiver),a=r.track,s=r.id}else{const i=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof hF&&(c=i.transceiver),a=i.track,s=i.id}if(t===ij.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new HD(a,e.uid,e._uintid,this.store),rA.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new GD(a,e.uid,e._uintid,this.store),rA.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),c&&CN("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:n,interceptRemoteAudioFrame:r}=VU();t==ij.VIDEO?await n(c.receiver,{onSei:CN("ENABLE_VIDEO_SEI")&&(t=>{var n;return null===(n=e._videoTrack)||void 0===n?void 0:n._onSei(t)})}):t==ij.AUDIO&&await r(c.receiver,{enableTopn:!!CN("ENABLE_AUDIO_TOPN"),enableMetadata:!!CN("ENABLE_AUDIO_METADATA"),onMetadata:e=>{this.safeEmit(dj.AudioMetadata,e)}})}const d=this.remoteUserMap.get(e);d?d.set(t,s):this.remoteUserMap.set(e,new Map([[t,s]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const u=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==u&&(this.pendingRemoteTracks.splice(u,1),this.emit(dj.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==lj.Connected)throw new RO(CO.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((e=>{var t;let{user:n,mediaType:r}=e;return!(null!==(t=this.remoteUserMap.get(n))&&void 0!==t&&t.has(r))}));const t=[],n=new Map;e.forEach((e=>{if(!this.connection)return;const r=this.connection.getPreMedia(e.ssrcId);r?n.set(e.ssrcId,r):t.push(e)}));const r=await this.connection.batchReceive(t.map((e=>{let{user:t,mediaType:n,ssrcId:r,rtxSsrcId:i}=e;return{kind:n,ssrcMsg:[{ssrcId:r,rtx:i}],mslabel:String(t._uintid)}})));t.forEach(((e,t)=>{n.set(e.ssrcId,r[t])}));for(const{user:i,mediaType:o,ssrcId:a}of e){const e=n.get(a);if(!e)return void rA.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(o,", ").concat(a));const{track:t,id:r,transceiver:s}=e;if(s&&CN("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=VU();o==ij.VIDEO?await e(s.receiver,{onSei:CN("ENABLE_VIDEO_SEI")&&(e=>{var t;return null===(t=i._videoTrack)||void 0===t?void 0:t._onSei(e)})}):o==ij.AUDIO&&await t(s.receiver,{enableTopn:!!CN("ENABLE_AUDIO_TOPN"),enableMetadata:!!CN("ENABLE_AUDIO_METADATA"),onMetadata:e=>{this.safeEmit(dj.AudioMetadata,e)}})}if(o===ij.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(t):(i._audioTrack=new HD(t,i.uid,i._uintid,this.store),rA.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),s&&i._audioTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(t):(i._videoTrack=new GD(t,i.uid,i._uintid,this.store),rA.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),s&&i._videoTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(i,i._videoTrack)),CN("ENABLE_VIDEO_SEI")&&s){const{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=VU();o==ij.VIDEO?await e(s.receiver,{onSei:e=>{var t;null===(t=i._videoTrack)||void 0===t||t._onSei(e)}}):o==ij.AUDIO&&await t(s.receiver)}const c=this.remoteUserMap.get(i);c?c.set(o,r):this.remoteUserMap.set(i,new Map([[o,r]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const l=this.pendingRemoteTracks.findIndex((e=>{let{user:t,kind:n}=e;return t.uid===i.uid&&o===n}));-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(dj.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.connection&&this.state===lj.Connected||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===ij.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===ij.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==lj.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(0===i.length)return;await this.connection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t})));const o=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),i.forEach((e=>{let[t,{kind:r}]=e;var i,o;if(r===ij.VIDEO&&t._videoSSRC&&(null===(i=this.connection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===ij.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(o=t._videoTrack)||void 0===o||o._destroy(),t._videoTrack=void 0);else if(r===ij.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}})),o}async unsubscribeDataChannel(e,t){if(t.forEach((e=>{const t=this.pendingRemoteDataChannels.findIndex((t=>t.id===e.id));-1!==t&&this.pendingRemoteDataChannels.splice(t,1)})),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(0===n.length)return;t.forEach((e=>{e._close()}));const r=this.remoteDataChannelMap.get(e);return n.forEach((e=>{r&&r.delete(e.id)})),r&&0===r.size&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map((e=>e.id))}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:o}of e){const e=this.pendingRemoteTracks.filter((e=>{let{user:t,kind:n}=e;return void 0!==o?t.uid===i.uid&&o===n:t.uid===i.uid}));e.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),t=t.concat(e)}if(!this.connection||this.state!==lj.Connected)return void t.forEach((e=>{let{user:t,kind:n}=e;var r;if(n===ij.AUDIO)null===(r=t._audioTrack)||void 0===r||r._destroy(),t._audioTrack=void 0;else if(n===ij.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}}));const n=ii(e).call(e,((e,t)=>{let{user:n,mediaType:r}=t;const i=this.filterTobeUnSubscribedTracks(n,r);return e.concat(i)}),[]);if(0===n.length)return;await this.connection.stopReceiving(n.map((e=>{let[,{id:t}]=e;return t})));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),n.forEach((e=>{let[t,{kind:n}]=e;var r,i;if(n===ij.VIDEO&&t._videoSSRC&&(null===(r=this.connection)||void 0===r||r.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===ij.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0;else if(n===ij.AUDIO){var o;this.unbindRemoteTrackEvents(t._audioTrack),null===(o=t._audioTrack)||void 0===o||o._destroy(),t._audioTrack=void 0}})),r}isPreSubScribe(e){return!(!this.connection||this.state!==lj.Connected)&&!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void rA.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void rA.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===ij.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||rA.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):rA.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(cj.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(cj.LocalAudioTrack);if((null==t?void 0:t.track)instanceof UP){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==cj.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===cj.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===cj.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get(cj.LocalAudioTrack),o=r?this.localTrackMap.get(cj.LocalVideoLowTrack):this.localTrackMap.get(cj.LocalVideoTrack);uA.publish(this.store.sessionId,{eventElapse:xV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(PA.SCREEN_TRACK)),audio:!!n,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);const a=n.find((e=>e instanceof LP)),s=r?null===(o=this.localTrackMap.get(cj.LocalVideoTrack))||void 0===o?void 0:o.track:n.find((e=>e instanceof kD));uA.publish(this.store.sessionId,{eventElapse:xV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==s?void 0:s.getTrackLabel(),screenshare:-1!==(null==s?void 0:s._hints.indexOf(PA.SCREEN_TRACK)),audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===ij.VIDEO?n._videoSSRC:n._audioSSRC;i&&uA.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===ij.VIDEO,audio:r===ij.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:xV.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){rA.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new LI("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=aF(this.store),this.emit(dj.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(cj.LocalAudioTrack);if((null==e?void 0:e.track)instanceof UP){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=lj.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(cj.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(cj.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof kD||t&&t.track instanceof LP?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(KN(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(cj.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Jp(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.connection&&(rA.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=lj.Reconnecting,CN("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=aF(this.store),this.emit(dj.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case cj.LocalVideoTrack:Dr(t=r._hints).call(t,PA.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case cj.LocalAudioTrack:r instanceof UP?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case cj.LocalVideoLowTrack:}})),this.emit(dj.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(KN(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(dj.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach((e=>{this.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach((e=>{let[t,n]=e;Array.from(KN(n).call(n)).forEach((e=>{this.setPendingRemoteDataChannel(t,e)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),rA.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof UV?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof UV?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return YR((function*(){if(!t.connection||t.state!==lj.Connected)return;const n=yield XR(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield XR(t.connection.restartICE(e));const n=yield XR(r.next());if(n.done)return;const i=n.value,o=yield i;switch(sF(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case oj.UDP_TCP_RELAY:t._pcStatsUploadType=aj.UDP_TCP_RESTART;break;case oj.TCP_RELAY:t._pcStatsUploadType=aj.TCP_RESTART;break;case oj.RELAY:t._pcStatsUploadType=aj.RELAY_RESTART;break;default:t._pcStatsUploadType=aj.OLD_RESTART}t._isTryConnecting=!0,r.next(o)}catch(e){var i;null===(i=r)||void 0===i||i.throw(e)}finally{n()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(cj.LocalVideoTrack),n=this.localTrackMap.get(cj.LocalAudioTrack),r=e.videoSend.find((e=>e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId))),i=e.audioSend.find((e=>e.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId)));if(!r||!i)return 1;const o=iI(this,dj.NeedSignalRTT),a=r?r.rttMs:void 0,s=i?i.rttMs:void 0,c=a&&s?(a+s)/2:a||s,l=(c&&o?(c+o)/2:c||o)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(PA.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return AL[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,o=r._videoSSRC,a=e.audioRecv.find((e=>e.ssrc===i)),s=e.videoRecv.find((e=>e.ssrc===o));if(!a&&!s)return void(t+=1);const c=iI(this,dj.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=a?a.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new np(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}async replaceTrack(e,t){var n;if(rA.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==lj.Connected)return;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await(null===(n=this.connection)||void 0===n?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const e=r[1];e.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,e)}if(i===cj.LocalVideoTrack&&!CN("DISABLE_DUAL_STREAM_USE_ENCODING")&&fA().supportDualStreamEncoding){const t=this.localTrackMap.get(cj.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new np(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=cI(e=e.filter((e=>-1===i.indexOf(e))));let o,a=!1;const s=this.localTrackMap.get(cj.LocalAudioTrack);for(const c of e){if(c instanceof kD&&(this.localTrackMap.has(cj.LocalVideoTrack)||a?new RO(CO.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:cj.LocalVideoTrack}),a=!0),t)){const e=this.getLowVideoTrack(c,n);r.push({track:e,type:cj.LocalVideoLowTrack})}if(c instanceof LP)if(s){const e=s.track;if(e instanceof UP)rF([c]),e.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{const t=iF([e,c]);rA.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(t.getTrackId(),"]")),this.replaceTrack(e,t)}}else o instanceof UP?(rF([c]),o.addAudioTrack(c)):o=o||!c._useAudioElement&&fA().webAudioMediaStreamDest&&!c._bypassWebAudio?iF(o?[c,o]:[c]):c}return o&&(rA.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),r.push({track:o,type:cj.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=cI(e=e.filter((e=>-1!==n.indexOf(e))));for(const r of e){if(r instanceof LP){const e=this.localTrackMap.get(cj.LocalAudioTrack);if(!e)continue;e.track instanceof UP?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([cj.LocalAudioTrack,e]),e.track.close())):t.push([cj.LocalAudioTrack,e])}if(r instanceof kD){const e=this.localTrackMap.get(cj.LocalVideoTrack);if(!e)continue;t.push([cj.LocalVideoTrack,e]);const n=this.localTrackMap.get(cj.LocalVideoLowTrack);n&&t.push([cj.LocalVideoLowTrack,n])}}return t}filterTobePublishedDataChannels(e){return(e=cI(e)).filter((e=>-1===this.localDataChannels.findIndex((t=>t.id===e.id))))}filterTobeUnpublishedDataChannels(e){return(e=(e=cI(e)).filter((e=>-1!==this.localDataChannels.indexOf(e)))).filter((e=>e._originDataChannel))}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case cj.LocalVideoTrack:t.addListener(xA.GET_STATS,this.handleGetLocalVideoStats),t.addListener(xA.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(xA.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(xA.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(xA.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(xA.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(xA.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(xA.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(xA.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case cj.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case cj.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof UP?e.trackList.forEach((e=>{e.addListener(xA.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(xA.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(xA.GET_STATS,this.handleGetLocalAudioStats),e.addListener(xA.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(xA.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(xA.GET_STATS,this.handleGetLocalAudioStats),e.addListener(xA.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(xA.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(xA.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(xA.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(xA.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(xA.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case cj.LocalVideoTrack:t.off(xA.GET_STATS,this.handleGetLocalVideoStats),t.off(xA.GET_RTC_STATS,this.handleGetRTCStats),t.off(xA.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(xA.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(xA.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(xA.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(xA.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(xA.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(xA.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case cj.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case cj.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof UP?e.trackList.forEach((e=>{e.off(xA.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(xA.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(xA.GET_STATS,this.handleGetLocalAudioStats),e.off(xA.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(xA.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(xA.GET_STATS,this.handleGetLocalAudioStats),e.off(xA.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(xA.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(xA.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(xA.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(xA.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(xA.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof GD&&t.addListener(xA.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof HD&&t.addListener(xA.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(xA.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(ij.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(ij.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{var r;let i,o,{track:a,type:s}=e;switch(s){case cj.LocalAudioTrack:i=KM.Audio,o={dtx:a instanceof MP&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case cj.LocalVideoTrack:i=Dr(r=a._hints).call(r,PA.SCREEN_TRACK)?KM.Screen:KM.High,o=jF(jF({},Yj(a)),{},{codec:this.store.codec,svc_mode:eU()});break;case cj.LocalVideoLowTrack:i=KM.Low,o=jF(jF({},Yj(a)),{},{codec:this.store.codec,svc_mode:eU()})}return{stream_type:i,attributes:o,ssrcs:t[n]}}))}createGatewayUnpublishMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case cj.LocalVideoTrack:n=Dr(t=i._hints).call(t,PA.SCREEN_TRACK)?KM.Screen:KM.High;break;case cj.LocalAudioTrack:n=KM.Audio;break;case cj.LocalVideoLowTrack:n=KM.Low}return{stream_type:n,ssrcs:o,mid:a}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(rA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(dj.PeerConnectionStateChange,t),"connecting"===t&&e instanceof hF&&!tO()&&CN("FIRST_TCP_CANDIDATE")&&window.setTimeout((()=>{"connecting"===t&&e.extendCandidate()}),CN("FIRST_TCP_CANDIDATE_INTERVAL")),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof hF&&PF(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=aj.DISCONNECTED_OR_FAILED,"CONNECTED"===iI(this,dj.QueryClientConnectionState)&&this._isWaitPcToRePub)){const e=this.pendingLocalTracks.map((e=>e.getTrackId())),t=this.pendingLocalDataChannels.map((e=>"dc_".concat(e.id)));uA.reportApiInvoke(this.store.sessionId,{name:HO.REPUB_AFTER_PC_CONNECTED,options:e.concat(t),tag:zO.TRACER}).onSuccess(),this.republish()}if(CN("NEW_ICE_RESTART")&&e instanceof hF&&!tO()&&!this._forceTurn){if(Dr(sj).call(sj,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const t=t=>{sF(e)&&(rA.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(t)),"CONNECTED"===iI(this,dj.QueryClientConnectionState)&&this.emit(dj.RequestRestartICE,t))},n=()=>{sF(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),rA.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(dj.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout((()=>{DF(e,t,n)}),800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout((()=>{"disconnected"===e.iceConnectionState&&CN("ICE_RESTART")&&"CONNECTED"===iI(this,dj.QueryClientConnectionState)&&this.emit(dj.RequestRestartICE)}),800),void setTimeout((()=>{"disconnected"===e.peerConnectionState&&(rA.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout((()=>this.emit(dj.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);"failed"===t&&(rA.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout((()=>this.emit(dj.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),rA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),uA.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:zO.TRACER}).onSuccess(),this.emit(dj.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{rA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{rA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{rA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(KN(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(VA.FIRST_FRAME_DECODED),uA.firstRemoteFrame(this.store.sessionId,sA.FIRST_AUDIO_DECODE,cA.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:xV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(KN(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&uA.firstRemoteFrame(this.store.sessionId,sA.FIRST_AUDIO_RECEIVED,cA.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:xV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(KN(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&uA.firstRemoteFrame(this.store.sessionId,sA.FIRST_VIDEO_RECEIVED,cA.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:xV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(dj.ConnectionTypeChange,n),rA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify($j(t))," -> ").concat(JSON.stringify($j(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{rA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify($j(t))," -> ").concat(JSON.stringify($j(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return jF(jF({},e),t)},e.onICECandidateError=e=>{this._iceError=e}}resetConnection(e){e instanceof hF&&function(e){NF.delete(e.id),PF(e)}(e),e.close(),this.emit(dj.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(cj.LocalAudioTrack);if(e instanceof LP&&(null==n?void 0:n.track)instanceof UP)return n.track.isActive||t.push([cj.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===cj.LocalVideoTrack)){const e=this.localTrackMap.get(cj.LocalVideoLowTrack);e&&t.push([cj.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(cj.LocalAudioTrack);if(e instanceof LP&&(null==n?void 0:n.track)instanceof UP)return n.track.isActive&&t.push([cj.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===cj.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get(cj.LocalVideoLowTrack);e&&t.push([cj.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case cj.LocalAudioTrack:n=KM.Audio;break;case cj.LocalVideoTrack:n=Dr(t=i._hints).call(t,PA.SCREEN_TRACK)?KM.Screen:KM.High;break;case cj.LocalVideoLowTrack:n=KM.Low}return{stream_type:n,ssrcs:o,mid:a}}))}createUnmuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case cj.LocalAudioTrack:n=KM.Audio;break;case cj.LocalVideoTrack:n=Dr(t=i._hints).call(t,PA.SCREEN_TRACK)?KM.Screen:KM.High;break;case cj.LocalVideoLowTrack:n=KM.Low}return{stream_type:n,ssrcs:o,mid:a}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach((t=>{var r;null!==(r=this.remoteDataChannelMap.get(e))&&void 0!==r&&r.has(t.id)&&n.push(t)})),n}createUnsubscribeMessage(e){const t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case ij.VIDEO:return void(n._videoSSRC&&t.push({stream_type:ij.VIDEO,ssrcId:n._videoSSRC}));case ij.AUDIO:return void(n._audioSSRC&&t.push({stream_type:ij.AUDIO,ssrcId:n._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach((e=>{let[n,{kind:r}]=e;if(t.has(n)){let e=t.get(n);r===ij.VIDEO?e|=JM.Video:e|=JM.Audio,t.set(n,e)}else r===ij.VIDEO?t.set(n,JM.Video):t.set(n,JM.Audio)})),{users:Array.from(t.entries()).map((e=>{let[t,n]=e;return{stream_id:t.uid,stream_type:n}}))}}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(cj.LocalVideoTrack),n=this.localTrackMap.get(cj.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new np(((e,n)=>{this.handleUpdateVideoEncoder(t.track,e,n,!0)}))),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new np(((e,t)=>{this.handleUpdateVideoEncoder(n.track,e,t,!0)})))}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(e,t,n){return e.map(((e,r)=>{var i;let{stream_type:o}=e;const a=null===(i=t.find((e=>{let{stream_type:t}=e;return o===t})))||void 0===i?void 0:i.attributes;if(a&&CN("DISABLE_SCREEN_SHARE_REMB")){const e=n[r]._hints;(Dr(e).call(e,PA.SCREEN_TRACK)||Dr(e).call(e,PA.SCREEN_LOW_TRACK))&&(a.remb=!1,rA.debug("disable remb for screen share, hints:",e))}return a}))}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof LP){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(0===r.length)continue;await(null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t}))));const i=this.createUnmuteMessage(r);return void await rI(this,dj.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(dj.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(dj.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:(null===(e=this.connection)||void 0===e?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await EI(UI(this.dtlsFailedCount,jI)),this.emit(dj.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await nI(this,dj.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(dj.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(cj.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof kD))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof kD)).length>1)throw new RO(CO.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof LP)).length>1&&(e.some((e=>e instanceof LP&&e._bypassWebAudio))||!fA().webAudioMediaStreamDest))throw new RO(CO.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof kD&&this.pendingLocalTracks.some((e=>e instanceof kD)))throw new RO(CO.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof LP&&this.pendingLocalTracks.some((e=>e instanceof LP))&&(!fA().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof LP&&e._bypassWebAudio))))throw new RO(CO.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const r=!CN("DISABLE_DUAL_STREAM_USE_ENCODING")&&fA().supportDualStreamEncoding,i=jF(jF({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=r?e._mediaStreamTrack.clone():fF(e,i);const a=SI(8,"track-low-"),s=new kD(o,jF(jF({},r&&{scaleResolutionDownBy:Zj(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return s.on(jA.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,DA.LOW_STREAM)})),s._hints.push(PA.LOW_STREAM),Dr(n=e._hints).call(n,PA.SCREEN_TRACK)&&s._hints.push(PA.SCREEN_LOW_TRACK),e.on("sei-to-send",(e=>{s.emit("sei-to-send",e)})),e.addListener(xA.NEED_CLOSE,(()=>{s.close()})),s}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof hF){var i,o,a,s;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:l,dtlsTransportState:d,peerConnectionState:u}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();uA.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:l,dtlsstate:d,connectionstate:u,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:null!==(i=null==h?void 0:h.protocol)&&void 0!==i?i:"",selectedLocalCandidateType:null!==(o=h.candidateType)&&void 0!==o?o:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:null!==(a=p.protocol)&&void 0!==a?a:"",selectedRemoteCandidateType:null!==(s=p.candidateType)&&void 0!==s?s:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const o=Array.from(KN(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,a=i.subscribe.find((e=>e.userId===o.uid&&"video"===e.type));uA.firstRemoteVideoDecode(this.store.sessionId,sA.FIRST_VIDEO_DECODE,cA.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:xV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:r?1:0,firstFrame:(null==a?void 0:a.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const o=await this.connection.getRemoteSSRC(i);return void 0!==o&&o!==n}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===cj.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,DA.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},vM(LF.prototype,"startP2PConnection",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"startP2PConnection"),LF.prototype),vM(LF.prototype,"connect",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"connect"),LF.prototype),vM(LF.prototype,"updateRemoteRTPCapabilities",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"updateRemoteRTPCapabilities"),LF.prototype),vM(LF.prototype,"publishDataChannel",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"publishDataChannel"),LF.prototype),vM(LF.prototype,"unpublish",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"unpublish"),LF.prototype),vM(LF.prototype,"unpublishDataChannel",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"unpublishDataChannel"),LF.prototype),vM(LF.prototype,"unpublishLowStream",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"unpublishLowStream"),LF.prototype),vM(LF.prototype,"subscribeDataChannel",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"subscribeDataChannel"),LF.prototype),vM(LF.prototype,"subscribe",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"subscribe"),LF.prototype),vM(LF.prototype,"massSubscribe",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"massSubscribe"),LF.prototype),vM(LF.prototype,"unsubscribe",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"unsubscribe"),LF.prototype),vM(LF.prototype,"unsubscribeDataChannel",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"unsubscribeDataChannel"),LF.prototype),vM(LF.prototype,"massUnsubscribe",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"massUnsubscribe"),LF.prototype),vM(LF.prototype,"muteRemote",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"muteRemote"),LF.prototype),vM(LF.prototype,"unmuteRemote",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"unmuteRemote"),LF.prototype),vM(LF.prototype,"hasRemoteMediaWithLock",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"hasRemoteMediaWithLock"),LF.prototype),vM(LF.prototype,"disconnectForReconnect",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"disconnectForReconnect"),LF.prototype),vM(LF.prototype,"updateBitrateLimit",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"updateBitrateLimit"),LF.prototype),vM(LF.prototype,"remoteMediaSsrcChanged",[BF],Object.getOwnPropertyDescriptor(LF.prototype,"remoteMediaSsrcChanged"),LF.prototype),LF);function BF(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PChannel.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}function WF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function GF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?WF(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const HF=Date.now(),zF=20,KF=new Map,qF=new Map;async function YF(e){const t=KF.get(e),n=Array.isArray(t)&&t[t.length-1],r=qF.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};0===r.firstRecvTs&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const o=n.sendTs-r.firstSendTs,a=o-(Date.now()-r.firstRecvTs);a>0&&(r.firstRecvTs=Date.now()-o);let s=n.mediaDelay+a;s<=0?(t.pop(),JF(n.context,i),s=0):s=Math.min(s,zF),setTimeout((()=>t.length&&YF(e)),s)}function JF(e,t){e.safeEmit(ZO.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function XF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return JF(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=KF.get(r)||[],o=i.findIndex((t=>e.sendTs>=t.sendTs)),a=GF(GF({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});-1===o?i.push(a):i.splice(o,0,a),KF.set(r,i);let s=!1;var c;qF.has(r)?s=!(null===(c=qF.get(r))||void 0===c||!c.isSyncing):qF.set(r,{isSyncing:s,firstRecvTs:0,firstSendTs:0}),s||YF(r)}const QF=qk().name;function ZF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ZF(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const eB="websdk_ng_cache_parameter",tB=CN("MAX_PRELOAD_ASYNC_LENGTH"),nB=1e4,rB=new Map,iB=[];let oB=null,aB=0,sB=0;const cB=new Map,lB=function(e,t){const n=[];let r=0;const i=async()=>{const e=n.shift();e&&await e(),n.length>0&&r<t?i():r--};return async function(){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return new np((async(o,s)=>{n.push((async()=>{try{const t=await e(...a);o(t)}catch(e){s(e)}})),r<t&&(r++,i())}))}}(uB,tB),dB=Mk.CancelToken.source();async function uB(e,t,n,r,i,o){try{if(!CN("ENABLE_PRELOAD"))return;if(!fA().supportWebCrypto)return void pI((()=>{rA.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported");if(!n&&null!==n)throw new RO(CO.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&AO(n,"token",1,2047),AO(e,"appid",1,2047),AM(t),r&&xM(r);const a=TI();rA.debug("preload channel ".concat(t,", uid is ").concat(r));const s={appId:e,cname:t,token:n||e,uid:"string"!=typeof r?r:null,sid:a,proxyServer:i};let c,l;"string"==typeof r?(s.stringUid=r,[l,c]=await np.all([EV(r,{sid:a,appId:e},dB.token),TV($F($F({},s),{},{token:n||e,uid:0}),dB.token)]),s.uid=l.uid,c.gatewayInfo.uid=s.uid,c.gatewayInfo.res.uid=s.uid):(o&&(s.stringUid=o),c=await TV(s,dB.token));const d={sid:a,appId:e,cname:t,token:n||e,uid:s.stringUid||r,intUid:s.uid||c.gatewayInfo.uid,stringUid:s.stringUid,ts:Date.now(),sua:l,ap:c};await async function(e){let t;try{e.uid&&pB({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const n=yB(e),r=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",_I(t),"AES-GCM",!1,["encrypt"]),r=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,fI(window.btoa(JSON.stringify(e))));return mI(new Uint8Array(r))}catch(e){return}}(e,e.token||e.appId);if(!r)return;t=gB(eB);const i=t?JSON.parse(t):[];i.push({[n]:r}),i.length>CN("AP_CACHE_NUM")&&i.shift(),vB(eB,JSON.stringify(i))}catch(e){rA.warn("Error caching server parameters:",e.message),vB(eB,"")}}(d),aB++}catch(e){throw sB++,function(e){oB||(oB=window.setTimeout((()=>{let t="";cB.forEach(((e,n)=>{t+="".concat(n,": ").concat(e," ;")})),uA.reportApiInvoke(null,{name:HO.PRELOAD,options:{success:aB,failed:sB,err:t}}).onError(e),aB=0,sB=0,cB.clear(),oB=null}),nB));const t=cB.get(e.code)||0;cB.set(e.code,t+1)}(e),e}}async function hB(e){try{if(CN("AP_REQUEST_DETAIL")||CN("ENABLE_ROLE_SELECT_EDGE"))return;const t=pB(e);if(!t||"disabled"!==e.cloudProxyServer)return;const n=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",_I(t),"AES-GCM",!1,["decrypt"]),r=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,fI(e));return JSON.parse(window.atob(mI(new Uint8Array(r))))}catch(e){return}}(t,e.token||e.appId);if(!n)return;if(!function(e,t){return!(e.cname!==t.cname||e.appId!==t.appId||e.token!==t.token)&&(t.stringUid?e.stringUid===t.stringUid:"number"==typeof t.uid?e.uid===t.uid:e.uid==t.uid)}(n,e))return;if(n&&Date.now()-n.ts<CN("AP_CACHE_LIFETIME"))return n}catch(e){rA.warn("Error get preloadInfo",e.message)}}function pB(e){let t;try{if(t=gB(eB),!t)return;const n=JSON.parse(t),r=yB(e),i=function(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}(n,(e=>r in e));if(-1===i)return;const o=n.splice(i,1)[0];return vB(eB,JSON.stringify(n)),o[r]}catch(e){rA.warn("Error delete preload info: ".concat(t),e.message),vB(eB,"")}}function fB(e){if(e){let t=rB.get(e);t&&(window.clearTimeout(t),t=null,rB.delete(e)),Dr(iB).call(iB,e)||"disabled"!==e.cloudProxyServer||iB.push(e)}if(rB.size<CN("AP_CACHE_NUM")&&iB.length>0){const e=iB.shift();rB.set(e,window.setTimeout((async()=>{const{appId:t,cname:n,token:r,stringUid:i,uid:o,proxyServer:a}=e;try{await lB(t,n,r,o,a,i),rB.has(e)&&fB(e)}catch(t){rA.warn("update preload failed",t.message),mB(e)}}),CN("AP_UPDATE_INTERVAL")))}}function mB(e){const t=iB.indexOf(e);-1!==t&&iB.splice(t,1);let n=rB.get(e);n&&(window.clearTimeout(n),n=null,rB.delete(e),fB())}function _B(e,t){const n=e.sua,r=e.ap;t&&n&&uA.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),uA.reportResourceTiming(e.ap.url,e.sid),uA.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map((e=>e.ip)).join(","),eventType:"disabled",unilbsServerIds:[Wj.CHOOSE_SERVER,Wj.CLOUD_PROXY_FALLBACK].toString()}),uA.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[Wj.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function gB(e){return window.atob(window.localStorage.getItem(e)||"")}function vB(e,t){window.localStorage.setItem(e,window.btoa(t))}function yB(e){let t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),xI(t)}function bB(e){let t=function(){const e=wB.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){let n=e.appId;void 0!==n&&(LB(t,10),AB(t,n));let r=e.cid;void 0!==r&&(LB(t,16),LB(t,r));let i=e.cname;void 0!==i&&(LB(t,26),AB(t,i));let o=e.deviceId;void 0!==o&&(LB(t,34),AB(t,o));let a=e.elapse;void 0!==a&&(LB(t,40),jB(t,a));let s=e.fileSize;void 0!==s&&(LB(t,48),jB(t,TB(s)));let c=e.height;void 0!==c&&(LB(t,56),jB(t,TB(c)));let l=e.jpg;void 0!==l&&(LB(t,66),LB(t,l.length),IB(t,l));let d=e.networkType;void 0!==d&&(LB(t,72),jB(t,TB(d)));let u=e.osType;void 0!==u&&(LB(t,80),jB(t,TB(u)));let h=e.requestId;void 0!==h&&(LB(t,90),AB(t,h));let p=e.sdkVersion;void 0!==p&&(LB(t,98),AB(t,p));let f=e.sequence;void 0!==f&&(LB(t,104),jB(t,TB(f)));let m=e.sid;void 0!==m&&(LB(t,114),AB(t,m));let _=e.timestamp;void 0!==_&&(LB(t,120),jB(t,_));let g=e.uid;void 0!==g&&(LB(t,128),LB(t,g));let v=e.vid;void 0!==v&&(LB(t,136),LB(t,v));let y=e.width;void 0!==y&&(LB(t,144),jB(t,TB(y)));let b=e.service;void 0!==b&&(LB(t,152),LB(t,b));let E=e.callbackData;void 0!==E&&(LB(t,162),LB(t,E.length),IB(t,E));let S=e.ticket;void 0!==S&&(LB(t,170),AB(t,S));let T=e.vendorConfigs;void 0!==T&&(LB(t,178),AB(t,T))}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function EB(e){return function(e){let t={};e:for(;!RB(e);){let n=DB(e);switch(n>>>3){case 0:break e;case 1:t.code=DB(e);break;case 2:t.msg=NB(e,DB(e));break;case 3:t.requestId=NB(e,DB(e));break;case 4:t.timestamp=MB(e,!1);break;default:SB(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function SB(e,t){switch(t){case 0:for(;128&xB(e););break;case 2:CB(e,DB(e));break;case 5:CB(e,4);break;case 1:CB(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function TB(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let wB=[];function CB(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function RB(e){return e.offset>=e.limit}function kB(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function OB(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function IB(e,t){let n=kB(e,t.length);e.bytes.set(t,n)}function NB(e,t){let n=OB(e,t),r=String.fromCharCode,i=e.bytes,o="\ufffd",a="";for(let s=0;s<t;s++){let e,c,l,d,u=i[s+n];0==(128&u)?a+=r(u):192==(224&u)?s+1>=t?a+=o:(e=i[s+n+1],128!=(192&e)?a+=o:(d=(31&u)<<6|63&e,d<128?a+=o:(a+=r(d),s++))):224==(240&u)?s+2>=t?a+=o:(e=i[s+n+1],c=i[s+n+2],32896!=(49344&(e|c<<8))?a+=o:(d=(15&u)<<12|(63&e)<<6|63&c,d<2048||d>=55296&&d<=57343?a+=o:(a+=r(d),s+=2))):240==(248&u)?s+3>=t?a+=o:(e=i[s+n+1],c=i[s+n+2],l=i[s+n+3],8421504!=(12632256&(e|c<<8|l<<16))?a+=o:(d=(7&u)<<18|(63&e)<<12|(63&c)<<6|63&l,d<65536||d>1114111?a+=o:(d-=65536,a+=r(55296+(d>>10),56320+(1023&d)),s+=3))):a+=o}return a}function AB(e,t){let n=t.length,r=0;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}LB(e,r);let i=kB(e,r),o=e.bytes;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),e<128?o[i++]=e:(e<2048?o[i++]=e>>6&31|192:(e<65536?o[i++]=e>>12&15|224:(o[i++]=e>>18&7|240,o[i++]=e>>12&63|128),o[i++]=e>>6&63|128),o[i++]=63&e|128)}}function xB(e){return e.bytes[OB(e,1)]}function PB(e,t){let n=kB(e,1);e.bytes[n]=t}function DB(e){let t,n=0,r=0;do{t=xB(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function LB(e,t){for(t>>>=0;t>=128;)PB(e,127&t|128),t>>>=7;PB(e,t)}function MB(e,t){let n,r=0,i=0,o=0;return n=xB(e),r=127&n,128&n&&(n=xB(e),r|=(127&n)<<7,128&n&&(n=xB(e),r|=(127&n)<<14,128&n&&(n=xB(e),r|=(127&n)<<21,128&n&&(n=xB(e),i=127&n,128&n&&(n=xB(e),i|=(127&n)<<7,128&n&&(n=xB(e),i|=(127&n)<<14,128&n&&(n=xB(e),i|=(127&n)<<21,128&n&&(n=xB(e),o=127&n,128&n&&(n=xB(e),o|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|o<<24,unsigned:t}}function jB(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=kB(e,o),s=e.bytes;switch(o){case 10:s[a+9]=i>>>7&1;case 9:s[a+8]=9!==o?128|i:127&i;case 8:s[a+7]=8!==o?r>>>21|128:r>>>21&127;case 7:s[a+6]=7!==o?r>>>14|128:r>>>14&127;case 6:s[a+5]=6!==o?r>>>7|128:r>>>7&127;case 5:s[a+4]=5!==o?128|r:127&r;case 4:s[a+3]=4!==o?n>>>21|128:n>>>21&127;case 3:s[a+2]=3!==o?n>>>14|128:n>>>14&127;case 2:s[a+1]=2!==o?n>>>7|128:n>>>7&127;case 1:s[a]=1!==o?128|n:127&n}}const UB={},VB={},FB=4294967296,BB=FB*FB,WB=BB/2,GB=YB(0,!0),HB=YB(0),zB=JB(0,-2147483648,!1),KB=JB(-1,2147483647,!1),qB=JB(-1,-1,!0);function YB(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=VB[e],r)?r:(n=JB(e,0,!0),i&&(VB[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=UB[e],r)?r:(n=JB(e,e<0?-1:0,!1),i&&(UB[e]=n),n)}function JB(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function XB(e,t){if(isNaN(e))return t?GB:HB;if(t){if(e<0)return GB;if(e>=BB)return qB}else{if(e<=-WB)return zB;if(e+1>=WB)return KB}return e<0?t?GB:HB:JB(e%FB|0,e/FB|0,t)}function QB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class ZB extends BO{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(gj.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(e){var t;super(),uC(this,"name","AgoraRTCImageModeration"),uC(this,"_connectionState",_j.CONNECTING),uC(this,"_sequence",0),uC(this,"_moderationStartTime",void 0),uC(this,"_workerConnection",void 0),uC(this,"_workerMessageLengthLimit",void 0),uC(this,"_qualityRatio",void 0),uC(this,"_connectInfo",void 0),uC(this,"_cancelTokenSource",Mk.CancelToken.source()),uC(this,"_retryConfig",void 0),uC(this,"_moderationInterval",void 0),uC(this,"_moderationTimer",null),uC(this,"_moderationMode",1),uC(this,"_quality",1),uC(this,"_qualityTimer",null),uC(this,"_ticket",void 0),uC(this,"_moderationIntervalMinimum",void 0),uC(this,"_uploadFailedNum",0),uC(this,"_uploadNum",0),uC(this,"_uploadTimer",null),uC(this,"_extraInfo",void 0),uC(this,"_vendor",""),uC(this,"_encoder",new TextEncoder),uC(this,"_moderationId",void 0),uC(this,"inspectImage",(()=>{if(this.connectionState!==_j.CONNECTED)throw new hA(CO.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===_j.CONNECTED?this.requestToInspectImage():rA.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=SI(5,"image-moderation-"),this._workerMessageLengthLimit=CN("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=CN("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=CN("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Vj("worker-"+this._moderationId,jI),this.on(gj.STATE_CHANGE,((e,t)=>{rA.debug("[".concat(this._moderationId,"] Moderation operation :").concat(vj[e]," ").concat(t||""))})),this.handleWorkerEvents()}async init(e,t){this.emit(gj.STATE_CHANGE,vj.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new np(((r,i)=>{this.on(gj.CONNECTION_STATE_CHANGE,((e,t)=>{e===_j.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorker(e)})).catch((e=>{i(e)}))}))}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),rA.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===_j.CONNECTED&&this.inspectImage()}async requestAP(e,t,n){const r=CN("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:a,sid:s,token:c,uid:l}=t;fV++;const d="moderation_plugin",u={service_name:d,json_body:JSON.stringify({appId:i,areaCode:o,cname:a,command:"allocateEdge",requestId:fV,seq:fV,sid:s,appToken:c,ts:Date.now(),uid:l+""})};let h,p,f=e[0];return VI((async()=>{h=Date.now();const e=await KU(f,{data:u,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new hA(CO.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:p});throw rA.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new hA(CO.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw rA.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new hA(CO.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:p});throw rA.error(e.toString()),e}if(!t.servers.some((e=>!!e.wss))){const e=new hA(CO.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:p});throw rA.error(e.toString()),e}const r=CN("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(n,"/moderation")})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:p}}),((t,n)=>(uA.apworkerEvent(s,{success:!0,sc:200,serviceName:d,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1)),((t,n)=>(uA.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:d,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==CO.OPERATION_ABORTED&&t.code!==CO.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(gj.STATE_CHANGE,vj.AP_CONNECTED);const{addressList:o,ticket:a}=i;return this._ticket=a,o}async connectWorker(e){this.emit(gj.STATE_CHANGE,vj.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(NM.CONNECTED,(async()=>{this.emit(gj.STATE_CHANGE,vj.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=_j.CONNECTED})),this._workerConnection.on(NM.CLOSED,(()=>{this.connectionState=_j.CLOSED})),this._workerConnection.on(NM.FAILED,(()=>{this.connectionState=_j.CLOSED})),this._workerConnection.on(NM.RECONNECTING,(()=>{this.connectionState=this.connectionState===_j.CONNECTED?_j.RECONNECTING:_j.CONNECTING})),this._workerConnection.on(NM.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){const t=EB(new Uint8Array(e.data));CN("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&rA.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,rA.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{uA.reportApiInvoke(this._connectInfo.sid||null,{name:HO.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:zO.TRACER}).onError(new hA(CO.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null}),CN("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else rA.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(NM.WILL_RECONNECT,((e,t,n)=>{"recover"===e&&n(e),n("tryNext")})),this._workerConnection.on(NM.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=iI(this,gj.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(CN("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&rA.debug("Only the track being played can be inspected"));this._sequence++;const n=await this.generateRequestData(e,t);this._workerConnection.sendMessage(n,!0,!0)}else CN("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&rA.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),d=await Kx(l,n,r),u=this._sequence+"-"+i+"-"+s+"-"+c+"-"+SI(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:ZB.intToLong(Number(c-this._moderationStartTime)),fileSize:l.buffer.byteLength,height:l.height,width:l.width,jpg:d,networkType:6,osType:7,requestId:u,sdkVersion:"4.23.4",sequence:this._sequence,sid:a,timestamp:XB(c),uid:s,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};void 0===this._extraInfo&&delete h.callbackData;const p=bB(h);if(p.byteLength<this._workerMessageLengthLimit){if(CN("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QB(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QB(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},h);delete e.jpg,rA.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return p}{const t=this.quality*this._qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Mk.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=_j.CLOSED,this.emit(gj.STATE_CHANGE,vj.CLOSED)}}function $B(e){if(IO(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new hA(CO.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new hA(CO.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const eW={name:"ImageModeration",create:function(e){let{config:t}=e;return $B(t),new ZB(t)}};var tW,nW,rW,iW,oW,aW,sW,cW,lW,dW,uW,hW,pW,fW,mW,_W,gW,vW,yW,bW,EW,SW,TW,wW,CW,RW,kW,OW,IW,NW,AW,xW,PW,DW,LW,MW,jW,UW,VW,FW,BW,WW;function GW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function HW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?GW(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GW(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}LI.setLogger(rA);let zW=(tW=dA(),nW=dA({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof ax))return[t];t=[t]}return t.map((e=>e?Object(e).toString():"null"))}}),rW=dA({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==FA.DATA?(Array.isArray(t)||(t=[t]),t.map((e=>e.getTrackId()))):[t.getChannelId()])}),iW=dA({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),oW=dA({argsMap:(e,t,n)=>[t,n]}),aW=dA({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return[null==t?void 0:t.uid,n]}))}),sW=dA({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),cW=dA({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return{uid:null==t?void 0:t.uid,mediaType:n}}))}),lW=dA(),dW=dA(),uW=dA(),hW=dA(),pW=dA(),fW=dA(),mW=dA(),_W=dA(),gW=dA(),vW=dA(),yW=dA(),bW=dA(),EW=dA(),SW=dA(),TW=dA(),wW=dA({argsMap:(e,t)=>[t]}),CW=dA(),RW=dA(),kW=dA(),OW=dA(),IW=dA(),NW=dA(),AW=dA(),xW=dA(),PW=dA({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),DW=dA(),LW=dA(),MW=dA(),jW=dA(),UW=dA(),VW=dA(),FW=dA({reportResult:!0}),BW=dA(),WW=class extends BO{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),uC(this,"store",void 0),uC(this,"_uid",void 0),uC(this,"_channelName",void 0),uC(this,"_uintUid",void 0),uC(this,"_users",[]),uC(this,"_config",void 0),uC(this,"_clientId",void 0),uC(this,"_appId",void 0),uC(this,"_sessionId",null),uC(this,"_key",void 0),uC(this,"_rtmConfig",{}),uC(this,"_joinInfo",void 0),uC(this,"_gateway",void 0),uC(this,"_statsCollector",void 0),uC(this,"_configDistribute",void 0),uC(this,"_leaveMutex",void 0),uC(this,"_publishMutex",void 0),uC(this,"_renewTokenMutex",void 0),uC(this,"_subscribeMutex",void 0),uC(this,"_encryptionMode","none"),uC(this,"_encryptionSecret",null),uC(this,"_encryptionSalt",null),uC(this,"_encryptDataStream",!1),uC(this,"_encryptDataStreamKey",null),uC(this,"_encryptDataStreamIv",null),uC(this,"_proxyServer",void 0),uC(this,"_turnServer",{servers:[],mode:"auto"}),uC(this,"_cloudProxyServerMode","disabled"),uC(this,"_isDualStreamEnabled",!1),uC(this,"_defaultStreamFallbackType",void 0),uC(this,"_lowStreamParameter",void 0),uC(this,"_streamFallbackTypeCacheMap",new Map),uC(this,"_remoteStreamTypeCacheMap",new Map),uC(this,"_axiosCancelSource",Mk.CancelToken.source()),uC(this,"_audioVolumeIndicationInterval",void 0),uC(this,"_networkQualityInterval",void 0),uC(this,"_userOfflineTimeout",void 0),uC(this,"_streamRemovedTimeout",void 0),uC(this,"_liveTranscodeStreamingClient",void 0),uC(this,"_liveRawStreamingClient",void 0),uC(this,"_channelMediaRelayClient",void 0),uC(this,"_networkQualitySensitivity","normal"),uC(this,"_p2pChannel",void 0),uC(this,"_useLocalAccessPoint",!1),uC(this,"_setLocalAPVersion",void 0),uC(this,"_joinAndNotLeaveYet",!1),uC(this,"_numberOfJoinCount",0),uC(this,"_remoteDefaultVideoStreamType",void 0),uC(this,"_inspect",void 0),uC(this,"_moderation",void 0),uC(this,"_license",void 0),uC(this,"_pendingPublishedUsers",[]),uC(this,"ntpAlignErrorCount",0),uC(this,"remoteInboundOffset",0),uC(this,"_peerConnectionState",void 0),uC(this,"_handleLocalTrackEnable",((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),uC(this,"_handleLocalTrackDisable",((e,t,n)=>{this.unpublish(e).then(t).catch(n)})),uC(this,"_handleUserOnline",(e=>{if(CN("BLOCK_LOCAL_CLIENT")&&DL(e.uid,this.channelName))return void rA.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&rA.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const t=this._users.find((t=>t.uid===e.uid));if(t)t._trust_in_room_=!0,t._is_pre_created&&(t._is_pre_created=!1,this.safeEmit(ZO.USER_JOINED,t));else{const t=new UV(e.uid,e.uint_id||e.uid);this._users.push(t),rA.debug("[".concat(this._clientId,"] user online"),e.uid),this.safeEmit(ZO.USER_JOINED,t)}})),uC(this,"_handleUserOffline",(e=>{if(CN("BLOCK_LOCAL_CLIENT")&&DL(e.uid,this.channelName))return;const t=this._users.find((t=>t.uid===e.uid));t&&(this._handleRemoveStream(e),this._handleRemoveDataChannels(e),t._audio_pre_subscribed||t._video_pre_subscribed?t._is_pre_created=!0:sI(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),rA.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(ZO.USER_LEAVED,t,e.reason))})),uC(this,"_handleAddAudioOrVideoStream",((e,t,n,r,i,o,a)=>{if(CN("BLOCK_LOCAL_CLIENT")&&DL(t,this.channelName))return;const s=this._users.find((e=>e.uid===t));if(!s)return void rA.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));rA.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(s.uid,e,void 0,void 0,void 0,Date.now());const c="audio"===e?s.hasAudio:s.hasVideo;s._uintid||(s._uintid=i||t),"audio"===e?s._trust_audio_stream_added_state_=!0:s._trust_video_stream_added_state_=!0,"audio"===e?(s._audio_added_=!0,void 0!==n&&(s._audioSSRC=n),void 0!==r&&(s._cname=r),o&&(s._audioOrtc=o)):(s._video_added_=!0,void 0!==n&&(s._videoSSRC=n),void 0!==r&&(s._cname=r),void 0!==a&&(s._rtxSsrcId=a),o&&(s._videoOrtc=o)),("audio"===e?s.hasAudio:s.hasVideo)&&!c&&(rA.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published ").concat(e)),this.safeEmit(ZO.USER_PUBLISHED,s,e)),"video"===e?uA.onGatewayStream(this._sessionId,sA.ON_ADD_VIDEO_STREAM,cA.ON_ADD_VIDEO_STREAM,{peer:i||t,ssrc:s._videoSSRC}):uA.onGatewayStream(this._sessionId,sA.ON_ADD_AUDIO_STREAM,cA.ON_ADD_AUDIO_STREAM,{peer:i||t,ssrc:s._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(s,e,n).then((t=>{if(t&&(rA.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof FF))return this._p2pChannel.unsubscribe(s,e,!0).then((()=>this._subscribe(s,e,!0).catch((e=>{rA.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(s,e)&&(rA.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after reconnect.")),this._subscribe(s,e,!0).catch((e=>{rA.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),uC(this,"_handleRemoveStream",(e=>{if(CN("BLOCK_LOCAL_CLIENT")&&DL(e.uid,this.channelName))return;const t=this._users.find((t=>t.uid===e.uid));if(!t)return void rA.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));rA.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let n=()=>{};t.hasAudio&&t.hasVideo?n=()=>{rA.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(ZO.USER_UNPUBLISHED,t,"audio"),rA.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(ZO.USER_UNPUBLISHED,t,"video")}:t.hasVideo?n=()=>{rA.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(ZO.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(n=()=>{rA.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(ZO.USER_UNPUBLISHED,t,"audio")}),t._video_pre_subscribed||t._audio_pre_subscribed||(t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel instanceof FF&&this._p2pChannel.unsubscribe(t).then((e=>{if(e)return this._gateway.unsubscribe(e,t.uid)})),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0),uA.onGatewayStream(this._sessionId,sA.ON_REMOVE_STREAM,cA.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),n()})),uC(this,"_handleSetStreamLocalEnable",((e,t,n)=>{if(CN("BLOCK_LOCAL_CLIENT")&&DL(t,this.channelName))return;const r=this._users.find((e=>e.uid===t));if(!r)return void rA.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));rA.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));const i="audio"===e?r.hasAudio:r.hasVideo;if("audio"===e){r._trust_audio_enabled_state_=!0;const e=r._audio_enabled_;if(r._audio_enabled_=n,r._audio_enabled_===e)return;{const e=r._audio_enabled_?"enable-local-audio":"disable-local-audio";rA.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(ZO.USER_INFO_UPDATED,t,e)}}else{r._trust_video_enabled_state_=!0;const e=r._video_enabled_;if(r._video_enabled_=n,r._video_enabled_===e)return;{const e=r._video_enabled_?"enable-local-video":"disable-local-video";rA.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(ZO.USER_INFO_UPDATED,t,e)}}const o="audio"===e?r.hasAudio:r.hasVideo;return i!==o?!i&&o?(rA.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(ZO.USER_PUBLISHED,r,e)):("video"===e&&r._videoTrack&&r._videoTrack._destroy(),"audio"===e&&r._audioTrack,this._p2pChannel.muteRemote(r,e),rA.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(ZO.USER_UNPUBLISHED,r,e)):void 0})),uC(this,"_handleMuteStream",((e,t,n)=>{if(CN("BLOCK_LOCAL_CLIENT")&&DL(e,this.channelName))return;rA.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);const r=this._users.find((t=>t.uid===e));if(!r)return void rA.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));const i="audio"===t?r.hasAudio:r.hasVideo;if("audio"===t){r._trust_audio_mute_state_=!0;const t=r._audio_muted_;if(r._audio_muted_=n,r._audio_muted_===t)return;{const t=r._audio_muted_?"mute-audio":"unmute-audio";rA.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(ZO.USER_INFO_UPDATED,e,t)}}else{r._trust_video_mute_state_=!0;const t=r._video_muted_;if(r._video_muted_=n,r._video_muted_===t)return;{const t=r._video_muted_?"mute-video":"unmute-video";rA.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(ZO.USER_INFO_UPDATED,e,t)}}const o="audio"===t?r.hasAudio:r.hasVideo;if(i!==o){if(!i&&o)return("audio"===t?r._audioSSRC:r._videoSSRC)?(rA.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(ZO.USER_PUBLISHED,r,t)):void rA.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&r._videoTrack&&!r._video_pre_subscribed&&r._videoTrack._destroy(),"audio"===t&&r._audioTrack,this._p2pChannel.muteRemote(r,t),rA.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(ZO.USER_UNPUBLISHED,r,t)}})),uC(this,"_handleP2PLost",(async e=>{rA.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():rA.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)})),uC(this,"_handleTokenWillExpire",(()=>{rA.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(ZO.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),uC(this,"_handleBeforeUnload",(e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),rA.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),uC(this,"_handleUpdateNetworkQuality",(()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(ZO.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(ZO.NETWORK_QUALITY,e)})),uC(this,"_handleP2PAddAudioOrVideoStream",((e,t,n,r)=>{const i=this._users.find((e=>e.uid===t));if(!i)return void rA.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));rA.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(i.uid,e,void 0,void 0,void 0,Date.now());const o="audio"===e?i.hasAudio:i.hasVideo;"audio"===e?i._trust_audio_stream_added_state_=!0:i._trust_video_stream_added_state_=!0,"audio"===e?(i._audio_added_=!0,void 0!==n&&(i._audioSSRC=n),void 0!==r&&(i._audioMid=r)):(i._video_added_=!0,void 0!==n&&(i._videoSSRC=n),void 0!==r&&(i._videoMid=r)),("audio"===e?i.hasAudio:i.hasVideo)&&!o&&(rA.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published ").concat(e)),this.safeEmit(ZO.USER_PUBLISHED,i,e)),this._p2pChannel.hasPendingRemoteMedia(i,e)&&(rA.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(i.uid," after reconnect.")),this._subscribe(i,e,!0).catch((e=>{rA.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),this._config=e,this._clientId=t||SI(5,"client-"),this.store=new class{constructor(e,t,n,r){SO(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:gN.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(e){this.state=function(e,t){switch(t.type){case ON.SET_SESSION_ID:return wO(wO({},e),{},{sessionId:t.sessionId});case ON.SET_P2P_ID:return wO(wO({},e),{},{p2pId:t.p2pId});case ON.SET_UID:return wO(wO({},e),{},{uid:t.uid});case ON.SET_INT_UID:return wO(wO({},e),{},{intUid:t.intUid});case ON.SET_PUB_ID:return wO(wO({},e),{},{pubId:t.pubId});case ON.KEY_METRIC_CLIENT_CREATED:return wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{clientCreated:t.metric})});case ON.KEY_METRIC_JOIN_START:return wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{joinStart:t.metric})});case ON.KEY_METRIC_JOIN_END:return wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{joinEnd:t.metric})});case ON.KEY_METRIC_REQUEST_AP_START:return wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{requestAPStart:t.metric})});case ON.KEY_METRIC_REQUEST_AP_END:return wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{requestAPEnd:t.metric})});case ON.KEY_METRIC_JOIN_GATEWAY_START:return wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case ON.KEY_METRIC_JOIN_GATEWAY_END:return wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case ON.KEY_METRIC_PEER_CONNECTION_START:return wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case ON.KEY_METRIC_PEER_CONNECTION_END:return wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case ON.KEY_METRIC_DESCRIPTION_START:return wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{descriptionStart:t.metric})});case ON.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case ON.KEY_METRIC_ICE_CONNECTION_END:return wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case ON.KEY_METRIC_PUBLISH:{const n=e.keyMetrics.publish,r=n.findIndex((e=>e.trackId===t.metric.trackId));return-1!==r?(n[r]=wO(wO({},n[r]),t.metric),wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{publish:[...n]})})):wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case ON.KEY_METRIC_SUBSCRIBE:{const n=e.keyMetrics.subscribe,r=n.findIndex((e=>e.userId===t.metric.userId&&e.type===t.metric.type));return-1!==r?(n[r]=wO(wO({},n[r]),t.metric),wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{subscribe:[...n]})})):wO(wO({},e),{},{keyMetrics:wO(wO({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case ON.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case ON.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=wO(wO({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case ON.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case ON.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case ON.SET_USE_P2P:return wO(wO({},e),{},{useP2P:t.val});case ON.SET_TRANSPORT_TYPE:return wO(wO({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)}set sessionId(e){this.dispatch({type:ON.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set cid(e){this.state.cid=e}get cid(){return this.state.cid}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:ON.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:ON.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:ON.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:ON.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:ON.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:ON.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:ON.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:ON.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(e){this.state.hasStartJoinChannel=e}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(e){this.state.isABTestSuccess=e}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ON.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ON.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ON.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ON.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ON.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ON.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ON.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ON.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ON.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ON.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ON.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ON.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,r){this.dispatch({type:ON.KEY_METRIC_PUBLISH,metric:wO(wO({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})}subscribe(e,t,n,r,i,o,a){this.dispatch({type:ON.KEY_METRIC_SUBSCRIBE,metric:wO(wO(wO(wO(wO({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i}),o&&{streamAdded:o}),a&&{firstDecoded:a})})}massSubscribe(e,t,n,r){e.forEach((e=>{this.dispatch({type:ON.KEY_METRIC_SUBSCRIBE,metric:wO(wO(wO({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map((e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return"number"!=typeof t?(this.dispatch({type:ON.RECORD_JOIN_CHANNEL_SERVICE,record:wO(wO({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ON.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ON.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ON.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new LI("client-leave",this._clientId),this._publishMutex=new LI("client-publish",this._clientId),this._renewTokenMutex=new LI("client-renewtoken",this._clientId),this._subscribeMutex=new LI("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),rA.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(mN," build: ").concat(EN,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{QO(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(e){rA.warning("[".concat(this._clientId,"] ").concat(e.toString()))}var r;this._statsCollector=new LV(this.store),this._statsCollector.onStatsException=(e,t,n)=>{rA.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),this.safeEmit(ZO.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,r)=>{const i=this._users.find((t=>t.uid===e));i&&uA.peerPublishStatus(this._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:i._uintid})},this._statsCollector.onVideoCodecChanged=e=>{if(CN("VIDEO_STANDARD_BITRATE_VERSION")&&("av1"===e||"h265"===e||"h264"===e)){const t=this.localTracks.find((e=>e instanceof kD));t&&1!==t._saveEncodeBitrateRatio&&t.setSaveEncodeBitrateRatio("h264"===e?CN("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P="p2p"===e.mode,this._gateway=new GU(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||jI,httpRetryConfig:e.httpRetryConfig||jI,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new IV(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},jU("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new FF(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];wN("JOIN_GATEWAY_USE_443PORT_ONLY",o),wN("JOIN_GATEWAY_USE_DUAL_DOMAIN",a);const s=this._gateway.signal.websocket;return s instanceof Uj&&(s.use443PortOnly=o,s.tryDoubleDomain=a),async function(e,t,n){Vk.get(e)||Vk.set(e,[]),Fk.get(e)||Fk.set(e,t),Bk.get(e)||Bk.set(e,0);const r=Vk.get(e),i=Fk.get(e);if(!r||!i)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Bk.get(e)===i){const e=Uk();r.push(e),await e.promise}Bk.set(e,Bk.get(e)+1);for(var o=arguments.length,a=new Array(o>3?o-3:0),s=3;s<o;s++)a[s-3]=arguments[s];const c=await n(...a);return Bk.set(e,Bk.get(e)-1),Bk.get(e)===i-1&&r.length>0&&(r[0].resolve(),r.shift()),0===Bk.get(e)&&(Vk.set(e,[]),Fk.set(e,0),Bk.set(e,0)),c}("client.join",CN("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const o=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const a="HTTPS"===(FI||FI||(FI=(window.location.protocol.split(":")[0]||"").toUpperCase(),FI)),s=KI()?window.isSecureContext:"Browser Not Support";if(!KI()&&!a||!window.isSecureContext){const e="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";rA.warning(e)}uA.setAppId(e);try{if(!n&&null!==n)throw new hA(CO.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&AO(n,"token",1,2047),AO(e,"appid",1,2047),AM(t),r&&xM(r),i&&AO(i,"optionalInfo",1,2047)}catch(i){throw uA.reportApiInvoke(TI(),{name:HO.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:s},tag:zO.TRACER}).onError(i),i}if(this._leaveMutex.isLocked&&(rA.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),rA.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){const i=new hA(CO.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw uA.reportApiInvoke(TI(),{name:HO.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:s},tag:zO.TRACER}).onError(i),i}this._gateway.state="CONNECTING";const c=await hB({appId:e,cname:t,uid:r,stringUid:"string"==typeof r?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new hA(CO.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const l=(null==c?void 0:c.sid)||TI();rA.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._sessionId||(this._sessionId=l,this.store.sessionId=this._sessionId);const d=uA.reportApiInvoke(l,{id:this._clientId,name:HO.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:s},tag:zO.TRACER}),u=HW(HW(HW({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof r?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!c},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:CN("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(u.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof r&&(u.stringUid=r,this._uintUid?(u.uid=this._uintUid,this._uintUid=void 0):u.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(u.aesmode=this._encryptionMode,u.aespassword=await(async e=>{const t=function(){const e=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n+=1)t[n]=e.charCodeAt(n);return t}(),n=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),r=UO(e),i=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,r);return function(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}(new Uint8Array(i))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new hA(CO.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(u.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&("aes-128-gcm2"===this._encryptionMode||"aes-256-gcm2"===this._encryptionMode))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const e=new TextEncoder,t=CN("USE_PURE_ENCRYPTION_MASTER_KEY")?e.encode(u.appId+this._encryptionSecret+this._encryptionSecret):e.encode(u.appId+u.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(e,t,n){const r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256,o=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:xN,hash:"SHA-256",salt:n},r,i+AN);return new Uint8Array(o).subarray(i/8)}(this._encryptionMode,t,fI(this._encryptionSalt)),this._encryptDataStreamKey=await async function(e,t,n){const r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:xN,hash:"SHA-256",salt:n},r,{name:"AES-GCM",length:i},!0,["encrypt","decrypt"])}(this._encryptionMode,t,fI(this._encryptionSalt))}else s?rA.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):rA.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,rA.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:u.stringUid});const h=this._sessionId;setTimeout((()=>{"CONNECTING"===this.connectionState&&h===this._sessionId&&uA.joinChannelTimeout(this._sessionId,5)}),5e3);try{var p;let r;const i=u.cloudProxyServer;if(Dr(p=["proxy3","proxy4","proxy5"]).call(p,i)){const e=CN("PROXY_SERVER_TYPE3");Array.isArray(e)?u.proxyServer=e[0]:u.proxyServer=e}if(uA.setProxyServer(u.proxyServer),rA.setProxyServer(u.proxyServer),this.store.requestAPStart(),c){if(rA.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(u.stringUid?", ".concat(u.stringUid," => ").concat(c.intUid):""," ")),u.stringUid&&!u.uid&&(u.uid=c.intUid),r={gatewayInfo:c.ap.gatewayInfo},CN("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===u.turnServer.mode)if(0===c.ap.proxyInfo.addresses.length)rA.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const e=(await Qj(c.ap.proxyInfo,c.ap.gatewayInfo.uid)).map((e=>({turnServerURL:e.address,tcpport:e.tcpport||vN.tcpport,udpport:e.udpport||vN.udpport,username:e.username||vN.username,password:e.password||vN.password,forceturn:!1,security:!0})));u.turnServer={mode:"manual",servers:e}}_B(c,u.stringUid)}else{if(u.stringUid&&!u.uid){let e;[e,r]=await np.all([bV(u.stringUid,u,this._axiosCancelSource.token,this._config.httpRetryConfig||jI,this.store),yV(u,this._axiosCancelSource.token,this._config.httpRetryConfig||jI,!0,this.store)]),rA.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(u.stringUid," => ").concat(e)),u.uid=e,r.gatewayInfo.uid=e,r.gatewayInfo.res.uid=e}else r=await yV(u,this._axiosCancelSource.token,this._config.httpRetryConfig||jI,!0,this.store);if(!this._joinAndNotLeaveYet)throw new hA(CO.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(u,this._axiosCancelSource.token),this._configDistribute.on(ej.UPDATE_BITRATE_LIMIT,(e=>{this._p2pChannel.updateBitrateLimit(e)})),this._configDistribute.on(ej.UPDATE_CLIENT_ROLE_OPTIONS,(e=>{this._setClientRoleOptions(e)}))}),0),this._key=n||e;const o=r.gatewayInfo,a=u.uid?u.uid:o.uid;this._joinInfo=HW(HW({},u),{},{cid:o.cid,uid:a,vid:o.vid,apResponse:o.res,apGatewayAddress:o.apGatewayAddress,uni_lbs_ip:o.uni_lbs_ip,gatewayAddrs:o.gatewayAddrs}),this.store.intUid=a,this.store.cid=o.cid;const s=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new hA(CO.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));d.onSuccess(s),this._appId=e,this._channelName=u.cname,this._uid=s,this.store.uid=s,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener($k()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()}),0);const l=u.stringUid?"string uid: ".concat(u.stringUid,",uid: ").concat(u.uid):"uid: ".concat(this._uid);return rA.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(l)),setTimeout((()=>{rA.startUpload()}),5e3),this.store.joinEnd(),f=this,Dr(xL).call(xL,f)||xL.push(f),"disabled"===this._cloudProxyServerMode&&fA().supportWebCrypto&&CN("ENABLE_PRELOAD")&&fB(this._joinInfo),s}catch(e){const t=Array.isArray(e)?e[0]:e;throw t&&t.code===CO.OPERATION_ABORTED?rA.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),t):rA.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),t),t.code!==CO.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),d.onError(t),t}var f}_joinGateway(){if(!this._joinInfo||!this._key)throw new hA(CO.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!CN("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){rA.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener($k()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const t=xL.indexOf(e);-1!==t&&xL.splice(t,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return rA.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState,YO.LEAVE),rA.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e)){if(!(e instanceof ax))return this._publishDataChannel(e);e=[e]}if(0===e.length)throw new hA(CO.INVALID_PARAMS,"param list is empty");const n=e;if("audience"===this._gateway.role)throw new hA(CO.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof ax))throw new hA(CO.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new hA(CO.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}rA.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map((e=>"".concat(e.getTrackId()," ")))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach((e=>{const t=this._configDistribute.getBitrateLimit();e instanceof kD&&t&&e.setBitrateLimit(t.uplink)}));try{await this._publishHighStream(n),rA.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map((e=>"".concat(e.getTrackId()," ")))))}catch(e){throw rA.error("[".concat(this._clientId,"] publish error"),e.toString()),e}finally{r()}}async _publishDataChannel(e){IO(e.id,"id",0,65535,!0),kO(e.ordered,"ordered"),AO(e.metadata,"metadata",0,512),rA.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(-1!==this._p2pChannel.getAllDataChannels().findIndex((t=>t.id===e.id)))throw new hA(CO.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new hA(CO.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new hA(CO.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&CN("FORCE_TURN")&&!CN("TURN_ENABLE_TCP")&&!CN("TURN_ENABLE_UDP"))throw new hA(CO.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const t=function(e){return UU(e,!1)}(e),n=await this._p2pChannel.publishDataChannel([t]);if(n.length>0){if("number"!=typeof t._originDataChannelId)throw rA.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new hA(CO.CREATE_DATACHANNEL_ERROR);try{await np.all(n.map((e=>this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)))),await t._waitTillOpen()}catch(e){if(e.code!==CO.DISCONNECT_P2P)throw e}}return rA.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(e){throw rA.error("[".concat(this._clientId,"] publish datachannels error"),e.toString()),e}finally{t()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new hA(CO.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof ax))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);rA.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map((e=>"".concat(e.getTrackId()," ")))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.sendExtensionMessage(yj.UNPUBLISH,{unpubMsg:e},!0)}else{const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.unpublish(e,this._uid),rA.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map((e=>"".concat(e.getTrackId())))))}}catch(e){throw rA.error("[".concat(this._clientId,"] unpublish error"),e.toString()),e}finally{n&&n()}}async _unpublishDataChannel(e){void 0!==e&&0!==e.length||(e=this._p2pChannel.getAllDataChannels()),rA.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map((e=>"".concat(e.id," ")))," "));const t=await this._publishMutex.lock();try{const t=await this._p2pChannel.unpublishDataChannel(e);t&&await this._gateway.unpublishDataChannel(t),rA.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map((e=>"".concat(e.id)))))}catch(e){throw rA.error("[".concat(this._clientId,"] unpublish dataChannel error"),e.toString()),e}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof UV)){const t=this.remoteUsers.find((t=>t.uid===e));if(!t)throw new hA(CO.INVALID_REMOTE_USER,"user is not in the channel");e=t}return"datachannel"===t?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(OO(t,"mediaType",["audio","video"]),this.store.useP2P)throw new hA(CO.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new hA(CO.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new hA(CO.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===ij.AUDIO,r=t===ij.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:i,ortc:o,rtxSsrcId:a,cname:s,uint_id:c}=await this._gateway.presubscribe(e,t,!0);if(null==i)throw new hA(CO.UNEXPECTED_RESPONSE,"no ssrc id");let l=this._users.find((t=>t.uid===e));l||(l=new UV(e,c||e),l._is_pre_created=!0,this._users.push(l)),s&&(l._cname=s),l._uintid||(l._uintid=c||e),n&&(l._audioSSRC=i,l._audio_pre_subscribed=!0,o&&(l._audioOrtc=o)),r&&(l._videoSSRC=i,l._video_pre_subscribed=!0,o&&(l._videoOrtc=o),null!=a&&(l._rtxSsrcId=a)),rA.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(i)),await this._p2pChannel.subscribe(l,t,i,a,o);const d=n?l._audioTrack:l._videoTrack;if(!d)throw new hA(CO.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(l._trust_audio_stream_added_state_=!0,l._audio_added_=!0),r&&(l._trust_video_stream_added_state_=!0,l._video_added_=!0),d}catch(t){throw rA.error("[".concat(this._clientId,"] presub user ").concat(e," error"),t),t}finally{i()}}async _subscribeDataChannel(e,t){var n;if(IO(t,"channelId",0,65535,!0),!this._joinInfo)throw new hA(CO.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new hA(CO.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));const r=this._users.find((t=>t===e));if(!r)throw rA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new hA(CO.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw rA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new hA(CO.INVALID_REMOTE_USER,"user is not published");const i=null===(n=e._dataChannels)||void 0===n?void 0:n.find((e=>e.id===t));if(!i)throw rA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new hA(CO.REMOTE_USER_IS_NOT_PUBLISHED);const o=await this._subscribeMutex.lock();rA.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const n=await this._p2pChannel.subscribeDataChannel(e,[i]);if(n&&Dr(n).call(n,i.id))try{var a;if("number"!=typeof i._originDataChannelId)throw rA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new hA(CO.CREATE_DATACHANNEL_ERROR);const t={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:null!==(a=i.metadata)&&void 0!==a?a:""};await this._gateway.subscribeDataChannel(e.uid,t,!0),await i._waitTillOpen()}catch(t){if((null==t?void 0:t.code)!==CO.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),t;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return rA.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{o()}}async _p2pSubscribe(e,t,n){if(OO(t,"mediaType",["audio","video"]),!this._joinInfo)throw new hA(CO.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new hA(CO.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=this._users.find((t=>t===e));if(!r){const t=new hA(CO.INVALID_REMOTE_USER,"user is not in the channel");throw rA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new hA(CO.INVALID_REMOTE_USER,"user is not published");throw rA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!n&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){const n=new hA(CO.REMOTE_USER_IS_NOT_PUBLISHED);throw rA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}const i=await this._subscribeMutex.lock();rA.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const n="audio"===t?e._audioSSRC:e._videoSSRC,r="audio"===t?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,n,r)}catch(e){throw e}rA.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{rA.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));const n="audio"===t?e._audioTrack:e._videoTrack;if(!n)throw new hA(CO.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(t){throw rA.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{i()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(OO(t,"mediaType",["audio","video"]),!this._joinInfo)throw new hA(CO.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new hA(CO.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=this._users.find((t=>t===e));if(!r){const t=new hA(CO.INVALID_REMOTE_USER,"user is not in the channel");throw rA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new hA(CO.INVALID_REMOTE_USER,"user is not published");throw rA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(n||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){const n=new hA(CO.REMOTE_USER_IS_NOT_PUBLISHED);throw rA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let i="audio"===t?e._audioSSRC:e._videoSSRC,o="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,s={stream_type:"audio"===t?ij.AUDIO:ij.VIDEO,ssrcId:i};const c=await this._subscribeMutex.lock();rA.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const r="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==r&&r!==i&&(i=r,o="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,s={stream_type:"audio"===t?ij.AUDIO:ij.VIDEO,ssrcId:i}),xV.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,a,o);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,s,!0)}catch(n){if((null==n?void 0:n.code)!==CO.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),n;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(n){throw this._p2pChannel.reportSubscribeEvent(!1,null==n?void 0:n.code,e,t),n}rA.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{rA.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));const r="audio"===t?e._audioTrack:e._videoTrack;if(!r)throw new hA(CO.UNEXPECTED_ERROR,"can not find remote track in user object");return r}catch(t){throw rA.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{c()}}async massSubscribe(e){if(xO(e,"subscribeList"),!this._joinInfo)throw new hA(CO.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new hA(CO.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();rA.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; ")));const i=(e=[...e]).map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n}})),o=await this._p2pChannel.globalLock();try{var a;for(let t=e.length-1;t>=0;t--){const r=e[t],{user:o,mediaType:a}=r;if(OO(a,"mediaType",["audio","video"]),!o){const e=new hA(CO.INVALID_PARAMS,"user property does not exist in subscribeList item");throw rA.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}const s=this._users.find((e=>e===o));if(!s){const n=new hA(CO.INVALID_REMOTE_USER,"user is not in the channel");rA.error("[".concat(this._clientId,"] can not massSubscribe ").concat(o.uid,", this user is not in the channel")),i[t].error=n,e.splice(t,1);continue}if("audio"===a&&(!o.hasAudio||void 0===o._audioSSRC)||"video"===a&&(!o.hasVideo||void 0===o._videoSSRC)){const n=new hA(CO.REMOTE_USER_IS_NOT_PUBLISHED);rA.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid," with mediaType ").concat(a,", remote user is not published")),i[t].error=n,e.splice(t,1);continue}const c=JM.Video|JM.LwoVideo,l=n.get(o);if(l){if("video"===a?l&c:l&JM.Audio){e.splice(t,1),rA.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(o.uid,", mediaType:").concat(a," twice"));continue}n.set(o,l|("video"===a?c:JM.Audio))}else n.set(o,"video"===a?c:JM.Audio)}for(let t=e.length-1;t>=0;t--){const r=e[t],{user:i,mediaType:o}=r,a=JM.Video|JM.LwoVideo;if(this._p2pChannel.hasRemoteMedia(i,o)){await this._p2pChannel.unmuteRemoteNoLock(i,o);const r=n.get(i);n.set(i,"video"===o?r^a:r^JM.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map((e=>({userId:e.user.uid,type:e.mediaType}))),t);let r=ii(a=Array.from(n.entries())).call(a,((e,t)=>{let[n,r]=t;if(0===r)return e;const i={stream_id:n.uid,stream_type:r};return r&JM.Audio&&(i.audio_ssrc=n._audioSSRC),r&JM.Video&&(i.video_ssrc=n._videoSSRC),e.push(i),e}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n,ssrcId:n===ij.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===ij.VIDEO?t._rtxSsrcId:void 0}})));const n=new Map;if(r=r.filter((e=>e.video_ssrc&&!this._p2pChannel.isPreSubScribe(e.video_ssrc)||e.audio_ssrc&&!this._p2pChannel.isPreSubScribe(e.audio_ssrc)||!e.video_ssrc&&!e.audio_ssrc)),r.length>0){const e=await this._gateway.subscribeAll(r,!0);((null==e?void 0:e.users)||[]).forEach((e=>{let{stream_id:t,video_error_code:r,audio_error_code:i,error_code:o}=e;(r||i||o)&&n.set(t,{video_error_code:r,audio_error_code:i,error_code:o})}))}if(Array.from(n.entries()).length>0){const e=[];Array.from(n.entries()).forEach((t=>{let[n,r]=t;const i=this.remoteUsers.find((e=>e.uid===n));if(i){let t;r.error_code||r.video_error_code&&r.audio_error_code?t=void 0:r.video_error_code?t=ij.VIDEO:r.audio_error_code&&(t=ij.AUDIO),e.push({user:i,mediaType:t})}})),e.length>0&&await this._p2pChannel.massUnsubscribeNoLock(e)}for(const e of i){const t=n.get(e.user.uid);if(t){const n=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(n){const t=Rj(n);rA.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new hA(CO.SUBSCRIBE_FAILED,"code ".concat(n,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(i.filter((e=>!e.error)).map((e=>({userId:e.user.uid,type:e.mediaType}))),void 0,Date.now()),i.forEach((e=>{var n;uA.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(n=e.error)||void 0===n?void 0:n.code)||null,video:e.mediaType===ij.VIDEO,audio:e.mediaType===ij.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===ij.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(e.user._videoSSRC)},!0)})),rA.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),i}catch(t){throw await this._p2pChannel.massUnsubscribeNoLock(e),t}}finally{o(),r()}}async unsubscribe(e,t,n){if(!(e instanceof UV)){const t=this.remoteUsers.find((t=>t.uid===e));if(!t)throw new hA(CO.INVALID_REMOTE_USER,"user is not in the channel");e=t}if(t||this.store.useP2P){if("datachannel"===t)return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&OO(t,"mediaType",["audio","video"]),!this._joinInfo)throw new hA(CO.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");const r=this._users.find((t=>t===e));if(!r){const t=new hA(CO.INVALID_REMOTE_USER,"user is not in the channel");throw rA.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}rA.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),t&&"audio"!==t||(e._audio_pre_subscribed=!1),t&&"video"!==t||(e._video_pre_subscribed=!1),e._is_pre_created&&sI(this._users,e),rA.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(t){if(t.code===CO.DISCONNECT_P2P)return void rA.warning("disconnecting p2p, abort unsubscribe request.");throw rA.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&IO(t,"id",0,65535,!0),!this._joinInfo)throw new hA(CO.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");const n=this._users.find((t=>t===e));if(!n){const t=new hA(CO.INVALID_REMOTE_USER,"user is not in the channel");throw rA.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}let r;if("number"==typeof t){const n=e._dataChannels.find((e=>e.id===t));n&&(r=[n])}else r=e._dataChannels;if(void 0===r){const n=new hA(CO.REMOTE_USER_IS_NOT_PUBLISHED);throw rA.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),n}rA.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map((e=>e.id))));try{const t=await this._p2pChannel.unsubscribeDataChannel(e,r);t&&await this._gateway.unsubscribeDataChannel(t,e.uid),rA.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(t))}catch(t){if(t.code===CO.DISCONNECT_P2P)return void rA.warning("disconnecting p2p, abort unsubscribe request.");throw rA.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}}async massUnsubscribe(e){if(xO(e,"unsubscribeList"),!this._joinInfo)throw new hA(CO.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");rA.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const e=new hA(CO.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw rA.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}OO(i,"mediaType",["video","audio",void 0]);const o=this._users.find((e=>e===r));if(!o){rA.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const a=JM.Video|JM.LwoVideo;if(t.has(r)){const o=t.get(r);let s;switch(i){case"video":s=o&a;break;case"audio":s=o&JM.Audio;break;default:s=o&(JM.Audio|a)}if(s){rA.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?"audio"===i?t.set(r,o|JM.Audio):"video"===i&&t.set(r,o|a):t.set(r,o|JM.Audio|a)}else i?"audio"===i?t.set(r,JM.Audio):"video"===i&&t.set(r,a):t.set(r,JM.Audio|a)}try{const t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),rA.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join()))}catch(e){if(e.code===CO.DISCONNECT_P2P)return void rA.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw rA.error("[".concat(this._clientId,"] massUnsubscribe error"),e.toString()),e}}async setLowStreamParameter(e){!function(e){if(!e)throw new RO(CO.INVALID_PARAMS);PO(e.width)||NO(e.width,"streamParameter.width"),PO(e.height)||NO(e.height,"streamParameter.height"),PO(e.framerate)||NO(e.framerate,"streamParameter.framerate"),PO(e.bitrate)||IO(e.bitrate,"streamParameter.bitrate")}(e),(!e.width&&e.height||e.width&&!e.height)&&rA.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),rA.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,cj.LocalVideoLowTrack)}async enableDualStream(){if(!fA().supportDualStream)throw uA.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new hA(CO.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new hA(CO.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw uA.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,uA.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),rA.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new hA(CO.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(cj.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw uA.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,uA.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),rA.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(e){OO(e,"role",["audience","host"])}(e),t&&QO(t),"rtc"===this.mode||"p2p"===this.mode)throw rA.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new hA(CO.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&"host"===e)throw new hA(CO.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new hA(CO.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&CN("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",$O.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),rA.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if("rtc"===this.mode||"p2p"===this.mode)return;if("audience"!==this._config.role||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&QO(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch(e){}finally{rA.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(AO(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new hA(CO.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new hA(CO.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,uA.setProxyServer(this._proxyServer),rA.setProxyServer(this._proxyServer),rA.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new hA(CO.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new hA(CO.INVALID_OPERATION,"You have already set the proxy")}if(JO(e))return this._turnServer={servers:e,mode:"original-manual"},void rA.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((e=>e.urls)).join(","),"."));e.forEach((e=>XO(e))),this._turnServer={servers:e,mode:"manual"},rA.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new hA(CO.INVALID_OPERATION,"you should set license before join channel");if(AO(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new hA(CO.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,rA.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new hA(CO.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new hA(CO.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(void 0===e&&(e=3),e){case 1:case 2:throw new hA(CO.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new hA(CO.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,rA.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new hA(CO.INVALID_OPERATION,"Stop proxy server after leave channel");uA.setProxyServer(),rA.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",rA.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new hA(CO.INVALID_PARAMS,"accessPoints is required.");xO(e.accessPoints.serverList,"accessPoints.serverList"),AO(e.accessPoints.domain,"accessPoints.domain");const t=(e,t)=>{IO(e,t,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new hA(CO.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");CN("CLOSE_AFB_FOR_LOCAL_AP")&&(wN("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),wN("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,o=e.accessPoints.serverList.map((e=>r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e)),a=o.map((e=>"".concat(e,":").concat(n)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,wN("WEBCS_DOMAIN",a),wN("WEBCS_DOMAIN_BACKUP_LIST",a),wN("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(xO(e.report.hostname,"report.hostname"),wN("EVENT_REPORT_DOMAIN",e.report.hostname[0]),wN("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(wN("EVENT_REPORT_DOMAIN",o[0]),wN("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let s=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),s=e.report.port),wN("STATS_COLLECTOR_PORT",s),e.report?wN("ENABLE_EVENT_REPORT",!0):wN("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(xO(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=o[0];let l=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),l=e.log.port),wN("LOG_UPLOAD_SERVER","".concat(c,":").concat(l));let d=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(xO(e.cds.hostname,"cds.hostname"),d=e.cds.hostname):d=o;let u=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),u=e.cds.port),wN("CDS_AP",d.map((e=>"".concat(e,":").concat(u)))),e.cds?wN("ENABLE_CONFIG_DISTRIBUTE",!0):wN("ENABLE_CONFIG_DISTRIBUTE",!1),rA.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(xO(e,"serverList"),AO(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new hA(CO.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((e=>n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,wN("WEBCS_DOMAIN",e),wN("WEBCS_DOMAIN_BACKUP_LIST",e),wN("GATEWAY_DOMAINS",[t]),wN("EVENT_REPORT_DOMAIN",e[0]),wN("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),wN("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),rA.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(OO(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw rA.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else rA.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){OO(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{const t=this._users.find((t=>t.uid===e));t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(e){throw rA.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}rA.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){OO(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(e){throw rA.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}rA.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){!function(e){OO(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),AO(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Dr(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new hA(CO.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new hA(CO.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(kO(r,"encryptDataStream"),!Dr(i).call(i,e))throw new hA(CO.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||rA.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=mI(n))}async renewToken(e){if(AO(e,"token",1,2047),!this._key||!this._joinInfo)throw new hA(CO.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(CN("USE_NEW_TOKEN")){rA.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const t=await RV(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||jI);rA.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else rA.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});rA.debug("[".concat(this._clientId,"] renewToken success"))}catch(e){throw this._key=t,this._joinInfo.token=t,rA.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?rA.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(ZO.VOLUME_INDICATOR,e)}),CN("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new hA(CO.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new hA(CO.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new hA(CO.LIVE_STREAMING_TASK_CONFLICT);const n=t?PM.TRANSCODE:PM.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(PM.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((t=>t&&t.hasUrl(e)));if(!t.length)throw new hA(CO.INVALID_PARAMS,"can not find live streaming url to stop");await np.all(t.map((t=>t&&t.stopLiveStreamingTask(e))))}async startChannelMediaRelay(e){jV(e);const t=this._createChannelMediaRelayClient();await t.startChannelMediaRelay(e)}async updateChannelMediaRelay(e){jV(e);const t=this._createChannelMediaRelayClient();await t.updateChannelMediaRelay(e)}async stopChannelMediaRelay(){const e=this._createChannelMediaRelayClient();await e.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof FF&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new hA(CO.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){const t=new TextEncoder;e.payload=t.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Dr(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(e,t,n){var r;const i=ii(r=Array.from(n)).call(r,((e,t)=>e+t),0),o={serverTs:0,seq:DN++,length:n.length,checkSum:i},a=new Uint8Array(II(i,2)),s=new ArrayBuffer(PN),c=new DataView(s);c.setUint32(0,o.serverTs),c.setUint16(4,o.seq),c.setUint16(6,o.length),c.setUint16(8,o.checkSum);const l=16-n.length%16;n=gI(n,new Uint8Array(l));const d=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e,tagLength:NN,additionalData:a},t,n);return gI(new Uint8Array(s),new Uint8Array(d))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new hA(CO.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(RM.DATA_STREAM,{payload:mI(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-HF},!n)}sendMetadata(e){if(!this._joinInfo)throw new hA(CO.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new hA(CO.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(RM.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:mI(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(oA),!this._joinInfo)throw new hA(CO.INVALID_OPERATION,"can not send custom report, not joined");await uA.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){OO(t.spatialLayer,"spatialLayer",[0,1,2,3]),OO(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(e){throw rA.error("[".concat(this._clientId,"] pick SVC layer failed"),e.toString()),e}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(kO(t,"apRTM"),IO(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,rA.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState)&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(rA.debug("[".concat(this._clientId,"] reset client")),function(e){const t=PL.indexOf(e);-1!==t&&PL.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Mk.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&mB(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&uA.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((e=>e._close())),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new LI("client-publish",this._clientId),this._subscribeMutex=new LI("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}}_startSession(e,t){var n;const r=e||TI();e?rA.debug("[".concat(this._clientId,"] new Session ").concat(r)):rA.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,uA.addSid(r);const o={lts:(new Date).getTime(),mode:this.mode,buildFormat:1,stringUid:(null==t?void 0:t.stringUid)||(null===(n=this._joinInfo)||void 0===n?void 0:n.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:"audience"===this.role?2:1};uA.sessionInit(this._sessionId,HW({cname:t.channel,appid:t.appId},o)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new hA(CO.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new hA(CO.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&CN("FORCE_TURN")&&!CN("TURN_ENABLE_TCP")&&!CN("TURN_ENABLE_UDP"))throw new hA(CO.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");rA.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const t=(await n.next()).value;if(t){try{await this._gateway.sendExtensionMessage(yj.PUBLISH,t,!0)}catch(e){throw n.throw(e),e}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(e){if(e.code!==CO.DISCONNECT_P2P)throw n.throw(e),e}await n.next((null===(t=i)||void 0===t?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const t of e)t instanceof kD&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig).catch((e=>{rA.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))})),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,e),(null==t?void 0:t.code)===CO.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new hA(CO.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new hA(CO.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));rA.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await e.next()).value;if(n){var t;let r;try{r=await this._gateway.publish(this._uid,n,!0)}catch(t){if(t.code!==CO.DISCONNECT_P2P)throw e.throw(t),t}e.next((null===(t=r)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,void 0,!0),(null==e?void 0:e.code)===CO.WS_ABORT)return;throw e}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new hA(CO.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const e=(t={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},jU("LiveStreaming").create(t));var t;return e.onLiveStreamError=(e,t)=>{uA.reportApiInvoke(this._sessionId,{name:HO.ON_LIVE_STREAM_ERROR,options:[e,t],tag:zO.TRACER}).onSuccess(),this.safeEmit(ZO.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{uA.reportApiInvoke(this._sessionId,{name:HO.ON_LIVE_STREAM_WARNING,options:[e,t],tag:zO.TRACER}).onSuccess(),this.safeEmit(ZO.LIVE_STREAMING_WARNING,e,t)},e.on(VM.REQUEST_WORKER_MANAGER_LIST,((e,t,n)=>{if(!this._joinInfo)return n(new hA(CO.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(e,t,n,r){const i=CN("UAP_AP").slice(0,CN("AJAX_REQUEST_CONCURRENT")).map((e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")));return await oV(i,e,t,n,r)})(e,this._joinInfo,this._axiosCancelSource.token,jI).then(t).catch(n)})),e};return e===PM.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new hA(CO.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},jU("ChannelMediaRelay").create(e));r.on("state",(e=>{e===HM.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(ZO.CHANNEL_MEDIA_RELAY_STATE,e)})),r.on("event",(e=>{this.safeEmit(ZO.CHANNEL_MEDIA_RELAY_EVENT,e)})),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(e,t)=>{var n;"resolution"===e&&(null===(n=this._channelMediaRelayClient)||void 0===n||n.setVideoProfile(t))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];if(t){const e=[];this._users.forEach((t=>{t._dataChannels.forEach((r=>{n.every((e=>e.uid!==t._uintid||e.stream_id!==r.id))&&e.push({uid:t._uintid,stream_id:r.id,ordered:r.ordered,max_retrans_times:r.maxRetransmits,metadata:r.metadata})}))})),e.length>0&&this._handleUpdateDataChannel({added:[],deleted:e})}Array.isArray(n)&&n.length>0&&n.forEach((e=>{const{uid:n,stream_id:r,ordered:o,max_retrans_times:a,metadata:s}=e,c=this._users.find((e=>e._uintid===n));if(c){if(rA.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(n)),Dr(i).call(i,c)||i.push(c),c._uintid||(c._uintid=n),-1===c._dataChannels.findIndex((t=>t.id===e.stream_id))){const e={id:r,ordered:!!o,maxRetransmits:a,metadata:s},n=function(e){return UU(e,!0)}(e);c._dataChannels.push(n),rA.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published datachannel")),t||this.safeEmit(ZO.USER_PUBLISHED,c,"datachannel",e)}this._p2pChannel.hasPendingRemoteDataChannel(c,e.stream_id)&&(rA.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(c.uid," after reconnect.")),this._subscribeDataChannel(c,e.stream_id).catch((e=>{rA.error("[".concat(this._clientId,"] resubscribe datachannel error"),e.toString())})))}else rA.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))})),t&&(this.safeEmit(ZO.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach((e=>{const{uid:t,stream_id:n}=e,r=this._users.find((e=>e._uintid===t));if(!r)return void rA.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const i=r._dataChannels.find((t=>t.id===e.stream_id));i&&(rA.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(t)),this._p2pChannel.unsubscribeDataChannel(r,[i]).then((e=>{if(r._dataChannels=r._dataChannels.filter((e=>e!==i)),e)return this._gateway.unsubscribeDataChannel(e,r.uid)})),rA.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(i.id)),this.safeEmit(ZO.USER_UNPUBLISHED,r,"datachannel",i._config))}))}_handleRemoveDataChannels(e){const t=this._users.find((t=>t.uid===e.uid));if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){rA.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{rA.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach((e=>{this.safeEmit(ZO.USER_UNPUBLISHED,t,"datachannel",e._config)}))};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then((e=>{if(e)return this._gateway.unsubscribeDataChannel(e,t.uid)})),n()}}else rA.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(qM.UPDATE_GATEWAY_CONFIG,(()=>{!function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void rA.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach((e=>{const{value:r,type:i,expires:o}=t[e];o&&o<=n||i||LL()||!Object.prototype.hasOwnProperty.call(yN,e)||(kN[e]=r,TN[e]=r,rA.debug("Update gateway parameters from config distribute",e,r))}))}catch(e){rA.error("Error update config from local cache",e.message)}}()})),this._gateway.on(qM.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(qM.CONNECTION_STATE_CHANGE,((e,t,n)=>{var r;if(n===YO.FALLBACK)return;const i=()=>{this.safeEmit(ZO.CONNECTION_STATE_CHANGE,e,t,n)};if(uA.reportApiInvoke(this._sessionId||(null===(r=this._gateway.joinInfo)||void 0===r?void 0:r.sid)||null,{name:HO.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:zO.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),rA.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void i();if("RECONNECTING"===e)this._users.forEach((e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._is_pre_created||(e._audio_pre_subscribed||(e._audioSSRC=void 0,e._audioOrtc=void 0),e._video_pre_subscribed||(e._videoSSRC=void 0,e._videoOrtc=void 0,e._rtxSsrcId=void 0),e._cname=void 0)})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===e){var o;this._streamFallbackTypeCacheMap.forEach(((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch((e=>{rA.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)}))})),this._remoteStreamTypeCacheMap.forEach(((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch((e=>{rA.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)}))})),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(o=this._joinInfo)||void 0===o?void 0:o.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{rA.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((e=>{rA.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter((e=>!e._trust_in_room_)).forEach((e=>{rA.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach((e=>{e._trust_audio_mute_state_||(rA.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,ij.AUDIO,!1)),e._trust_video_mute_state_||(rA.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,ij.VIDEO,!1)),e._trust_audio_enabled_state_||(rA.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(rA.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(rA.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(rA.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(rA.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))})))}),1e3))}i()})),this._gateway.on(qM.REQUEST_NEW_GATEWAY_LIST,(async(e,t)=>{if(!this._joinInfo)return t(new hA(CO.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t;const n=await hB(HW(HW({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n?(t=n.ap,_B(n),this._joinInfo.preload=!0):(t=await vV(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||jI,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);const r=[];t.gatewayInfo.gatewayAddrs.forEach((e=>{let{address:t}=e;const[n,i]=t.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:n,port:i}):r.push({host:n,port:i})})),e(r)}catch(e){t(e)}})),this._gateway.on(qM.NETWORK_QUALITY,(e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(ZO.NETWORK_QUALITY,e)})),this._gateway.on(qM.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit(ZO.STREAM_TYPE_CHANGED,e,t),uA.reportApiInvoke(this._sessionId,{name:HO.STREAM_TYPE_CHANGE,options:[e,t],tag:zO.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.on(qM.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(qM.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,n)=>{try{let n=await this._p2pChannel.getEstablishParams();CN("ENABLE_PREALLOC_PC")&&n||(n=await this._p2pChannel.startP2PConnection(e)),t(n)}catch(e){n(e)}})),this._gateway.on(qM.JOIN_RESPONSE,((e,t)=>{if(this.store.useP2P)return;let n;e.attributes?n=e.attributes.userAttributes.preSubSsrcs:rA.debug("no attributes in joinResponse");const r=uU(e.ortc,t,n);this._p2pChannel.connect(r)})),this._gateway.on(qM.PRE_CONNECT_PC,(async e=>{const{candidates:t,fingerprint:n}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var r;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:e,cid:i}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(i,"_").concat(e),icePwd:"".concat(i,"_").concat(e)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(r=CN("FINGERPRINT"))&&void 0!==r?r:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}}))}_handleGatewaySignalEvents(){this._gateway.signal.on(OM.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(OM.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(OM.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc))),this._gateway.signal.on(OM.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(OM.ON_REMOTE_DATASTREAM_UPDATE,(e=>{this._handleUpdateDataChannel(e)})),this._gateway.signal.on(OM.ON_REMOTE_FULL_DATASTREAM_INFO,(e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)})),this._gateway.signal.on(OM.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(OM.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(OM.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,ij.AUDIO,!0))),this._gateway.signal.on(OM.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,ij.AUDIO,!1))),this._gateway.signal.on(OM.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,ij.VIDEO,!0))),this._gateway.signal.on(OM.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,ij.VIDEO,!1))),this._gateway.signal.on(OM.RECEIVE_METADATA,(e=>{const t=fI(e.metadata);this.safeEmit(ZO.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(OM.ON_DATA_STREAM,(async e=>{var t;if(!e)return;let n=fI(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Dr(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<PN)throw new hA(CO.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(PN));const t=await async function(e,t,n){const r=n.subarray(0,PN),i=r.slice(8,PN),o=(i[0]<<8)+i[1],a=(r[6]<<8)+r[7],s=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:e,tagLength:NN,additionalData:new Uint8Array(II(o,2))},t,n.subarray(PN));return new Uint8Array(s).subarray(0,a)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n);n=t}let r=0;if(e.ordered||e.syncWithAudio){const t=this._p2pChannel.getStats(),n=this.remoteUsers.find((t=>t.uid===e.uid)),i=null==t?void 0:t.audioRecv.find((e=>e.ssrc===(null==n?void 0:n._audioSSRC)));r=null==i?void 0:i.jitterBufferMs}(null==r||Number.isNaN(r))&&(r=0),XF(HW(HW({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(OM.ON_CRYPT_ERROR,(()=>{pI((()=>{rA.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(ZO.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(OM.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(OM.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{rA.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,YO.TOKEN_EXPIRE),this.safeEmit(ZO.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(OM.ON_STREAM_FALLBACK_UPDATE,(e=>{rA.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(ZO.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")})),this._gateway.signal.on(OM.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),rA.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(OM.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(OM.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(CM.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case RM.PUBLISH:{if(!t)return;const e=t.ortc;if(e){var n,r;const i=e.some((e=>{let{stream_type:t}=e;return t===KM.Audio})),o=e.some((e=>{let{stream_type:t}=e;return t!==KM.Audio})),a=e.some((e=>{let{stream_type:t}=e;return t===KM.Screen||t===KM.ScreenLow}));"offer"===t.state&&uA.publish(this._joinInfo.sid,{eventElapse:xV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:CO.TIMEOUT,audio:i,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:a,audioName:i?null===(n=e.find((e=>{let{stream_type:t}=e;return t===KM.Audio})))||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId.toString():void 0,videoName:o?null===(r=e.find((e=>{let{stream_type:t}=e;return t!==KM.Audio})))||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId.toString():void 0})}break}case RM.SUBSCRIBE:t&&uA.subscribe(this._joinInfo.sid,{succ:!1,ec:CO.TIMEOUT,audio:t.stream_type===ij.AUDIO,video:t.stream_type===ij.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:xV.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}})),this._gateway.signal.on(OM.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(OM.ON_PUBLISHED_USER_LIST,(e=>{if(null==e||!e.users)return;CN("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((e=>!DL(e.string_id||e.stream_id,this.channelName))));const t=[],n=[];for(const r of e.users){let e=this._users.find((e=>e._uintid===r.stream_id));e?e._trust_in_room_=!0:(e=new UV(r.string_id||r.stream_id,r.stream_id),this._users.push(e),0===this.getListeners(ZO.PUBLISHED_USER_LIST).length&&(rA.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(ZO.USER_JOINED,e)));const i=JM.Audio&r.stream_type,o=(JM.Video|JM.LwoVideo)&r.stream_type,a=0!=(65280&r.stream_type),s=i&&e.hasAudio,c=o&&e.hasVideo;o&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=r.video_ssrc,e._rtxSsrcId=r.video_rtx),i&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=r.audio_ssrc),i&&!s&&0===this.getListeners(ZO.PUBLISHED_USER_LIST).length&&(rA.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(ZO.USER_PUBLISHED,e,"audio")),o&&!c&&0===this.getListeners(ZO.PUBLISHED_USER_LIST).length&&(rA.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(ZO.USER_PUBLISHED,e,"video")),(i&&!s||o&&!c||a)&&t.push(e),o&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&n.push({user:e,mediaType:"video"}),i&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&n.push({user:e,mediaType:"audio"})}n.length>0&&(rA.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map((e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType))).join("; ")," ")),this.massSubscribe(n).catch((e=>{rA.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())}))),this.getListeners(ZO.PUBLISHED_USER_LIST).length>0?CN("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(rA.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((e=>e.uid)).join(", "))),this.safeEmit(ZO.PUBLISHED_USER_LIST,t)):rA.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((e=>e.uid)).join(", ")))})),this._gateway.signal.on(OM.ON_RTP_CAPABILITY_CHANGE,(e=>{const{video_codec:t}=e;this._p2pChannel instanceof FF&&this._p2pChannel.updateRemoteRTPCapabilities(t.map((e=>e.toLowerCase())).filter((e=>{var t;return Dr(t=Object.keys(IN)).call(t,e)})))}))}_handleP2PEvents(){this._gateway.signal.on(OM.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(yj.PUBLISH,((e,t,n)=>{const{uid:r}=e;e.forEach((e=>{const{kind:i,ssrcs:o,mid:a,isMuted:s}=e;this._handleP2PAddAudioOrVideoStream(i,r,o[0].ssrcId,a);const c=this._users.find((e=>e.uid===r));return c&&this.store.useP2P?this._p2pChannel.mockSubscribe(c,i,o[0].ssrcId,a).then((()=>{t()})).catch(n):t(),this._handleMuteStream(r,i,!!s)}))})),this._gateway.signal.on(yj.CALL,(async(e,t,n)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:null===(r=this._joinInfo)||void 0===r?void 0:r.turnServer},e))}catch(e){n(e)}})),this._gateway.signal.on(CM.P2P_CONNECTION,(async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)})),this._gateway.signal.on(yj.UNPUBLISH,(async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:r,uid:i}=e,o=this._users.find((e=>e.uid===i));if(!o)return rA.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach((async e=>{let{stream_type:t}=e;const n=t===KM.Audio?ij.AUDIO:ij.VIDEO;await this._p2pChannel.unsubscribe(o,n),this._handleMuteStream(i,n,!0)})),t()}catch(e){n(e)}}})),this._gateway.signal.on(yj.CONTROL,(async(e,t)=>{const{action:n}=e;switch(n){case Ej.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,ij.VIDEO,!0);break;case Ej.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,ij.AUDIO,!0);break;case Ej.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,ij.VIDEO,!1);break;case Ej.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,ij.AUDIO,!1)}})),this._gateway.signal.on(yj.RESTART_ICE,(async(e,t,n)=>{if(this.store.useP2P)try{const{direction:n,iceParameter:r}=e;n!==IM.SEND_ONLY||r?t(await this._p2pChannel.restartICE(n,r)):(this._p2pChannel.handleDisconnect(n),t())}catch(e){n(e)}})),this._gateway.signal.on(yj.CANDIDATE,(e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}})),this._p2pChannel.on(dj.RequestP2PRestartICE,(async(e,t,n)=>{try{const{direction:n}=e;t(await this._gateway.sendExtensionMessage(yj.RESTART_ICE,e,n===IM.SEND_ONLY))}catch(e){n(e)}})),this._p2pChannel.on(dj.LocalCandidate,(e=>{this._gateway.sendExtensionMessage(yj.CANDIDATE,JSON.stringify(e),!0)})),this._p2pChannel.on(dj.RequestP2PMuteLocal,(async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(yj.CONTROL,e,!0),t()}catch(e){n(e)}})),this._p2pChannel.on(dj.RequestP2PUnmuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===CO.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(dj.RequestP2PMuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===CO.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(dj.StateChange,((e,t)=>{t===lj.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(dj.PeerConnectionStateChange,(e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(ZO.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)})),this._p2pChannel.on(dj.RequestMuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===CO.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(dj.RequestUnmuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===CO.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(dj.RequestRePublish,((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),this._p2pChannel.on(dj.RequestRePublishDataChannel,((e,t,n)=>{np.all(e.map((async e=>{const t=await this._p2pChannel.publishDataChannel([e]);try{t.forEach((e=>{this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)}))}catch(e){if(e.code!==CO.DISCONNECT_P2P)throw e}}))).then(t).catch(n)})),this._p2pChannel.on(dj.RequestReSubscribe,(async(e,t,n)=>{try{for(const{user:t,kind:n}of e)n===ij.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(e){n(e)}})),this._p2pChannel.on(dj.RequestUpload,((e,t)=>{this._gateway.upload(e,t)})),this._p2pChannel.on(dj.RequestUploadStats,(e=>{this._gateway.uploadWRTCStats(e)})),this._p2pChannel.on(dj.MediaReconnectStart,(e=>{this.safeEmit(ZO.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(dj.MediaReconnectEnd,(e=>{this.safeEmit(ZO.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(dj.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(dj.RequestRestartICE,(async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(e){return void t.throw(e)}const{iceParameters:o}=function(e){const t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(i);await t.next({remoteIceParameters:o})})),this._p2pChannel.on(dj.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(dj.RequestReconnectPC,(async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),a=uU(i,o);await this._p2pChannel.connect(a),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(dj.RequestUnpublishForReconnectPC,(async(e,t,n)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):n()})),this._p2pChannel.on(dj.P2PLost,(()=>{this.safeEmit(ZO.P2P_LOST,this.store.uid)})),this._p2pChannel.on(dj.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(dj.ConnectionTypeChange,(e=>{this.safeEmit(ZO.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(dj.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(dj.QueryClientConnectionState,(e=>{e(this.connectionState)})),this._p2pChannel.on(dj.AudioMetadata,(e=>{this.safeEmit(ZO.AUDIO_METADATA,e)}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||"CONNECTED"!==this.connectionState)throw new hA(CO.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new hA(CO.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},jU("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:o,token:a,uid:s,cid:c,vid:l}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:o,token:a,uid:s,cid:c,vid:l?Number(l):0},jI)}catch(e){throw Array.isArray(e)?e[0]:e}var t}handleVideoInspectEvents(e){e.on(pj.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(ZO.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===uj.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(ZO.CONTENT_INSPECT_ERROR,new hA(CO.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(pj.INSPECT_RESULT,((e,t)=>{var n;if((null==t?void 0:t.code)===CO.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return rA.debug("Stop inspect content because that has left channel"),null==this||null===(n=this._inspect)||void 0===n||n.close(),void(this._inspect=void 0);this.safeEmit(ZO.CONTENT_INSPECT_RESULT,e,t)})),e.on(pj.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}async disableContentInspect(){if(!this._inspect)throw new hA(CO.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(kO(e,"enabled"),e){if(!t)throw new hA(CO.INVALID_PARAMS,"config is required");if($B(t),!this._joinInfo)throw new hA(CO.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const e=(n={config:t},jU("ImageModeration").create(n));this._moderation=e,this.handleImageModerationEvents(e);const{appId:r,cname:i,sid:o,token:a,uid:s,cid:c,vid:l}=this._joinInfo;await e.init({appId:r,areaCode:"",cname:i,sid:o,token:a,uid:s,cid:c,vid:l?Number(l):0},jI)}}catch(e){throw Array.isArray(e)?e[0]:e}}else{var n;if(!this._moderation)throw new hA(CO.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}}handleImageModerationEvents(e){e.on(gj.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(ZO.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===_j.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new hA(CO.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(gj.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}setP2PTransport(e){if(function(e){OO(e,"transport",["default","auto","relay","sd-rtn"])}(e),"p2p"!==this.mode)throw new hA(CO.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,rA.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return rA.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){kO(e,"enabled"),wN("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},vM(WW.prototype,"leave",[tW],Object.getOwnPropertyDescriptor(WW.prototype,"leave"),WW.prototype),vM(WW.prototype,"publish",[nW],Object.getOwnPropertyDescriptor(WW.prototype,"publish"),WW.prototype),vM(WW.prototype,"unpublish",[rW],Object.getOwnPropertyDescriptor(WW.prototype,"unpublish"),WW.prototype),vM(WW.prototype,"subscribe",[iW],Object.getOwnPropertyDescriptor(WW.prototype,"subscribe"),WW.prototype),vM(WW.prototype,"presubscribe",[oW],Object.getOwnPropertyDescriptor(WW.prototype,"presubscribe"),WW.prototype),vM(WW.prototype,"massSubscribe",[aW],Object.getOwnPropertyDescriptor(WW.prototype,"massSubscribe"),WW.prototype),vM(WW.prototype,"unsubscribe",[sW],Object.getOwnPropertyDescriptor(WW.prototype,"unsubscribe"),WW.prototype),vM(WW.prototype,"massUnsubscribe",[cW],Object.getOwnPropertyDescriptor(WW.prototype,"massUnsubscribe"),WW.prototype),vM(WW.prototype,"setLowStreamParameter",[lW],Object.getOwnPropertyDescriptor(WW.prototype,"setLowStreamParameter"),WW.prototype),vM(WW.prototype,"enableDualStream",[dW],Object.getOwnPropertyDescriptor(WW.prototype,"enableDualStream"),WW.prototype),vM(WW.prototype,"disableDualStream",[uW],Object.getOwnPropertyDescriptor(WW.prototype,"disableDualStream"),WW.prototype),vM(WW.prototype,"setClientRole",[hW],Object.getOwnPropertyDescriptor(WW.prototype,"setClientRole"),WW.prototype),vM(WW.prototype,"_setClientRoleOptions",[pW],Object.getOwnPropertyDescriptor(WW.prototype,"_setClientRoleOptions"),WW.prototype),vM(WW.prototype,"setProxyServer",[fW],Object.getOwnPropertyDescriptor(WW.prototype,"setProxyServer"),WW.prototype),vM(WW.prototype,"setTurnServer",[mW],Object.getOwnPropertyDescriptor(WW.prototype,"setTurnServer"),WW.prototype),vM(WW.prototype,"setLicense",[_W],Object.getOwnPropertyDescriptor(WW.prototype,"setLicense"),WW.prototype),vM(WW.prototype,"startProxyServer",[gW],Object.getOwnPropertyDescriptor(WW.prototype,"startProxyServer"),WW.prototype),vM(WW.prototype,"stopProxyServer",[vW],Object.getOwnPropertyDescriptor(WW.prototype,"stopProxyServer"),WW.prototype),vM(WW.prototype,"setLocalAccessPointsV2",[yW],Object.getOwnPropertyDescriptor(WW.prototype,"setLocalAccessPointsV2"),WW.prototype),vM(WW.prototype,"setLocalAccessPoints",[bW],Object.getOwnPropertyDescriptor(WW.prototype,"setLocalAccessPoints"),WW.prototype),vM(WW.prototype,"setRemoteDefaultVideoStreamType",[EW],Object.getOwnPropertyDescriptor(WW.prototype,"setRemoteDefaultVideoStreamType"),WW.prototype),vM(WW.prototype,"setRemoteVideoStreamType",[SW],Object.getOwnPropertyDescriptor(WW.prototype,"setRemoteVideoStreamType"),WW.prototype),vM(WW.prototype,"setStreamFallbackOption",[TW],Object.getOwnPropertyDescriptor(WW.prototype,"setStreamFallbackOption"),WW.prototype),vM(WW.prototype,"setEncryptionConfig",[wW],Object.getOwnPropertyDescriptor(WW.prototype,"setEncryptionConfig"),WW.prototype),vM(WW.prototype,"renewToken",[CW],Object.getOwnPropertyDescriptor(WW.prototype,"renewToken"),WW.prototype),vM(WW.prototype,"enableAudioVolumeIndicator",[RW],Object.getOwnPropertyDescriptor(WW.prototype,"enableAudioVolumeIndicator"),WW.prototype),vM(WW.prototype,"startLiveStreaming",[kW],Object.getOwnPropertyDescriptor(WW.prototype,"startLiveStreaming"),WW.prototype),vM(WW.prototype,"setLiveTranscoding",[OW],Object.getOwnPropertyDescriptor(WW.prototype,"setLiveTranscoding"),WW.prototype),vM(WW.prototype,"stopLiveStreaming",[IW],Object.getOwnPropertyDescriptor(WW.prototype,"stopLiveStreaming"),WW.prototype),vM(WW.prototype,"startChannelMediaRelay",[NW],Object.getOwnPropertyDescriptor(WW.prototype,"startChannelMediaRelay"),WW.prototype),vM(WW.prototype,"updateChannelMediaRelay",[AW],Object.getOwnPropertyDescriptor(WW.prototype,"updateChannelMediaRelay"),WW.prototype),vM(WW.prototype,"stopChannelMediaRelay",[xW],Object.getOwnPropertyDescriptor(WW.prototype,"stopChannelMediaRelay"),WW.prototype),vM(WW.prototype,"sendCustomReportMessage",[PW],Object.getOwnPropertyDescriptor(WW.prototype,"sendCustomReportMessage"),WW.prototype),vM(WW.prototype,"pickSVCLayer",[DW],Object.getOwnPropertyDescriptor(WW.prototype,"pickSVCLayer"),WW.prototype),vM(WW.prototype,"setRTMConfig",[LW],Object.getOwnPropertyDescriptor(WW.prototype,"setRTMConfig"),WW.prototype),vM(WW.prototype,"enableContentInspect",[MW],Object.getOwnPropertyDescriptor(WW.prototype,"enableContentInspect"),WW.prototype),vM(WW.prototype,"disableContentInspect",[jW],Object.getOwnPropertyDescriptor(WW.prototype,"disableContentInspect"),WW.prototype),vM(WW.prototype,"setImageModeration",[UW],Object.getOwnPropertyDescriptor(WW.prototype,"setImageModeration"),WW.prototype),vM(WW.prototype,"setP2PTransport",[VW],Object.getOwnPropertyDescriptor(WW.prototype,"setP2PTransport"),WW.prototype),vM(WW.prototype,"getJoinChannelServiceRecords",[FW],Object.getOwnPropertyDescriptor(WW.prototype,"getJoinChannelServiceRecords"),WW.prototype),vM(WW.prototype,"setPublishAudioFilterEnabled",[BW],Object.getOwnPropertyDescriptor(WW.prototype,"setPublishAudioFilterEnabled"),WW.prototype),WW);class KW{constructor(e,t){uC(this,"id",0),uC(this,"element",void 0),uC(this,"peerPair",void 0),uC(this,"context",void 0),uC(this,"audioPlayerElement",void 0),uC(this,"audioTrack",void 0),KW.count+=1,this.id=KW.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;const e=async(e,t)=>{const n="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(n),"complete"===e.iceGatheringState?e.localDescription:new np((t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}}))},t=async(e,t)=>await e.setRemoteDescription(t);try{const n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);const r=await e(this.peerPair[1],"answer");await t(this.peerPair[0],r)}catch(e){throw new hA(CO.LOCAL_AEC_ERROR,e.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(e){throw new hA(CO.LOCAL_AEC_ERROR,e.toString()).print()}if(!t)throw new hA(CO.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n=t.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){rA.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((e=>{e.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var qW,YW;uC(KW,"count",0);const JW=window.AudioContext||window.webkitAudioContext,XW=new(qW=dA({report:uA}),vM((YW=class{constructor(){uC(this,"units",[]),uC(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return rA.debug("the system does not need to process local aec"),-1;this.context||(this.context=new JW);let t=this.units.find((t=>t&&t.getElement()===e));return t||(t=new KW(e,this.context),this.units.push(t)),t.startEchoCancellation(),rA.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return qk().name!==Gk.SAFARI}}).prototype,"processExternalMediaAEC",[qW],Object.getOwnPropertyDescriptor(YW.prototype,"processExternalMediaAEC"),YW.prototype),YW);function QW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ZW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QW(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QW(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const $W=window||document;function eG(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!$W)return;const n=bY._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=e=>{if(!(e&&e.blockedURI&&(bY.onSecurityPolicyViolation||bY.getListeners(mj.SECURITY_POLICY_VIOLATION).length>0)))return;const t=e.blockedURI;CN("CSP_DETECTED_HOSTNAME_LIST").some((e=>Dr(t).call(t,e)))&&(bY.onSecurityPolicyViolation&&"function"==typeof bY.onSecurityPolicyViolation&&bY.onSecurityPolicyViolation(e),bY.getListeners(mj.SECURITY_POLICY_VIOLATION).length>0&&bY.safeEmit(mj.SECURITY_POLICY_VIOLATION,e))};n&&$W.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||bY.getListeners(mj.SECURITY_POLICY_VIOLATION).length>0)&&$W.addEventListener("securitypolicyviolation",r),bY._cspEventHandlerPointer=r}var tG=u,nG=OC,rG=RegExp.prototype,iG=function(e){return e===rG||tG(rG,e)?nG(e):e.flags},oG=r(iG);function aG(e){let t=e.length;for(;--t>=0;)e[t]=0}const sG=256,cG=286,lG=30,dG=15,uG=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),hG=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),pG=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),fG=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mG=new Array(576);aG(mG);const _G=new Array(60);aG(_G);const gG=new Array(512);aG(gG);const vG=new Array(256);aG(vG);const yG=new Array(29);aG(yG);const bG=new Array(lG);function EG(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let SG,TG,wG;function CG(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}aG(bG);const RG=e=>e<256?gG[e]:gG[256+(e>>>7)],kG=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},OG=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,kG(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},IG=(e,t,n)=>{OG(e,n[2*t],n[2*t+1])},NG=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},AG=(e,t,n)=>{const r=new Array(16);let i,o,a=0;for(i=1;i<=dG;i++)a=a+n[i-1]<<1,r[i]=a;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=NG(r[t]++,t))}},xG=e=>{let t;for(t=0;t<cG;t++)e.dyn_ltree[2*t]=0;for(t=0;t<lG;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},PG=e=>{e.bi_valid>8?kG(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},DG=(e,t,n,r)=>{const i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]},LG=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&DG(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!DG(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},MG=(e,t,n)=>{let r,i,o,a,s=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+s++],r+=(255&e.pending_buf[e.sym_buf+s++])<<8,i=e.pending_buf[e.sym_buf+s++],0===r?IG(e,i,t):(o=vG[i],IG(e,o+sG+1,t),a=uG[o],0!==a&&(i-=yG[o],OG(e,i,a)),r--,o=RG(r),IG(e,o,n),a=hG[o],0!==a&&(r-=bG[o],OG(e,r,a)))}while(s<e.sym_next);IG(e,256,t)},jG=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems;let a,s,c,l=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<o;a++)0!==n[2*a]?(e.heap[++e.heap_len]=l=a,e.depth[a]=0):n[2*a+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=r[2*c+1]);for(t.max_code=l,a=e.heap_len>>1;a>=1;a--)LG(e,n,a);c=o;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],LG(e,n,1),s=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=s,n[2*c]=n[2*a]+n[2*s],e.depth[c]=(e.depth[a]>=e.depth[s]?e.depth[a]:e.depth[s])+1,n[2*a+1]=n[2*s+1]=c,e.heap[1]=c++,LG(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,d,u,h,p,f,m=0;for(h=0;h<=dG;h++)e.bl_count[h]=0;for(n[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)d=e.heap[l],h=n[2*n[2*d+1]+1]+1,h>c&&(h=c,m++),n[2*d+1]=h,d>r||(e.bl_count[h]++,p=0,d>=s&&(p=a[d-s]),f=n[2*d],e.opt_len+=f*(h+p),o&&(e.static_len+=f*(i[2*d+1]+p)));if(0!==m){do{for(h=c-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[c]--,m-=2}while(m>0);for(h=c;0!==h;h--)for(d=e.bl_count[h];0!==d;)u=e.heap[--l],u>r||(n[2*u+1]!==h&&(e.opt_len+=(h-n[2*u+1])*n[2*u],n[2*u+1]=h),d--)}})(e,t),AG(n,l,e.bl_count)},UG=(e,t,n)=>{let r,i,o=-1,a=t[1],s=0,c=7,l=4;for(0===a&&(c=138,l=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++s<c&&i===a||(s<l?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=i,0===a?(c=138,l=3):i===a?(c=6,l=3):(c=7,l=4))},VG=(e,t,n)=>{let r,i,o=-1,a=t[1],s=0,c=7,l=4;for(0===a&&(c=138,l=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++s<c&&i===a)){if(s<l)do{IG(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(IG(e,i,e.bl_tree),s--),IG(e,16,e.bl_tree),OG(e,s-3,2)):s<=10?(IG(e,17,e.bl_tree),OG(e,s-3,3)):(IG(e,18,e.bl_tree),OG(e,s-11,7));s=0,o=i,0===a?(c=138,l=3):i===a?(c=6,l=3):(c=7,l=4)}};let FG=!1;const BG=(e,t,n,r)=>{OG(e,0+(r?1:0),3),PG(e),kG(e,n),kG(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var WG=e=>{FG||((()=>{let e,t,n,r,i;const o=new Array(16);for(n=0,r=0;r<28;r++)for(yG[r]=n,e=0;e<1<<uG[r];e++)vG[n++]=r;for(vG[n-1]=r,i=0,r=0;r<16;r++)for(bG[r]=i,e=0;e<1<<hG[r];e++)gG[i++]=r;for(i>>=7;r<lG;r++)for(bG[r]=i<<7,e=0;e<1<<hG[r]-7;e++)gG[256+i++]=r;for(t=0;t<=dG;t++)o[t]=0;for(e=0;e<=143;)mG[2*e+1]=8,e++,o[8]++;for(;e<=255;)mG[2*e+1]=9,e++,o[9]++;for(;e<=279;)mG[2*e+1]=7,e++,o[7]++;for(;e<=287;)mG[2*e+1]=8,e++,o[8]++;for(AG(mG,287,o),e=0;e<lG;e++)_G[2*e+1]=5,_G[2*e]=NG(e,5);SG=new EG(mG,uG,257,cG,dG),TG=new EG(_G,hG,0,lG,dG),wG=new EG(new Array(0),pG,0,19,7)})(),FG=!0),e.l_desc=new CG(e.dyn_ltree,SG),e.d_desc=new CG(e.dyn_dtree,TG),e.bl_desc=new CG(e.bl_tree,wG),e.bi_buf=0,e.bi_valid=0,xG(e)},GG=(e,t,n,r)=>{let i,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<sG;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),jG(e,e.l_desc),jG(e,e.d_desc),a=(e=>{let t;for(UG(e,e.dyn_ltree,e.l_desc.max_code),UG(e,e.dyn_dtree,e.d_desc.max_code),jG(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*fG[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t?BG(e,t,n,r):4===e.strategy||o===i?(OG(e,2+(r?1:0),3),MG(e,mG,_G)):(OG(e,4+(r?1:0),3),((e,t,n,r)=>{let i;for(OG(e,t-257,5),OG(e,n-1,5),OG(e,r-4,4),i=0;i<r;i++)OG(e,e.bl_tree[2*fG[i]+1],3);VG(e,e.dyn_ltree,t-1),VG(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),MG(e,e.dyn_ltree,e.dyn_dtree)),xG(e),r&&PG(e)},HG=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(vG[n]+sG+1)]++,e.dyn_dtree[2*RG(t)]++),e.sym_next===e.sym_end),zG=e=>{OG(e,2,3),IG(e,256,mG),(e=>{16===e.bi_valid?(kG(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},KG={_tr_init:WG,_tr_stored_block:BG,_tr_flush_block:GG,_tr_tally:HG,_tr_align:zG},qG=(e,t,n,r)=>{let i=65535&e,o=e>>>16&65535,a=0;for(;0!==n;){a=n>2e3?2e3:n,n-=a;do{i=i+t[r++]|0,o=o+i|0}while(--a);i%=65521,o%=65521}return i|o<<16};const YG=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var JG=(e,t,n,r)=>{const i=YG,o=r+n;e^=-1;for(let a=r;a<o;a++)e=e>>>8^i[255&(e^t[a])];return~e},XG={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},QG={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ZG,_tr_stored_block:$G,_tr_flush_block:eH,_tr_tally:tH,_tr_align:nH}=KG,{Z_NO_FLUSH:rH,Z_PARTIAL_FLUSH:iH,Z_FULL_FLUSH:oH,Z_FINISH:aH,Z_BLOCK:sH,Z_OK:cH,Z_STREAM_END:lH,Z_STREAM_ERROR:dH,Z_DATA_ERROR:uH,Z_BUF_ERROR:hH,Z_DEFAULT_COMPRESSION:pH,Z_FILTERED:fH,Z_HUFFMAN_ONLY:mH,Z_RLE:_H,Z_FIXED:gH,Z_DEFAULT_STRATEGY:vH,Z_UNKNOWN:yH,Z_DEFLATED:bH}=QG,EH=286,SH=30,TH=19,wH=2*EH+1,CH=15,RH=258,kH=262,OH=42,IH=113,NH=666,AH=(e,t)=>(e.msg=XG[t],t),xH=e=>2*e-(e>4?9:0),PH=e=>{let t=e.length;for(;--t>=0;)e[t]=0},DH=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)};let LH=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const MH=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},jH=(e,t)=>{eH(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,MH(e.strm)},UH=(e,t)=>{e.pending_buf[e.pending++]=t},VH=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},FH=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=qG(e.adler,t,i,n):2===e.state.wrap&&(e.adler=JG(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},BH=(e,t)=>{let n,r,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match;const c=e.strstart>e.w_size-kH?e.strstart-(e.w_size-kH):0,l=e.window,d=e.w_mask,u=e.prev,h=e.strstart+RH;let p=l[o+a-1],f=l[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(n=t,l[n+a]===f&&l[n+a-1]===p&&l[n]===l[o]&&l[++n]===l[o+1]){o+=2,n++;do{}while(l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&o<h);if(r=RH-(h-o),o=h-RH,r>a){if(e.match_start=t,a=r,r>=s)break;p=l[o+a-1],f=l[o+a]}}}while((t=u[t&d])>c&&0!=--i);return a<=e.lookahead?a:e.lookahead},WH=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-kH)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),DH(e),r+=t),0===e.strm.avail_in)break;if(n=FH(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=LH(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=LH(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<kH&&0!==e.strm.avail_in)},GH=(e,t)=>{let n,r,i,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,s=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<o&&(0===n&&t!==aH||t===rH||n!==r+e.strm.avail_in))break;a=t===aH&&n===r+e.strm.avail_in?1:0,$G(e,0,0,a),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,MH(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(FH(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===a);return s-=e.strm.avail_in,s&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==rH&&t!==aH&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(FH(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,o=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=o||(r||t===aH)&&t!==rH&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,a=t===aH&&0===e.strm.avail_in&&n===r?1:0,$G(e,e.block_start,n,a),e.block_start+=n,MH(e.strm)),a?3:1)},HH=(e,t)=>{let n,r;for(;;){if(e.lookahead<kH){if(WH(e),e.lookahead<kH&&t===rH)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=LH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-kH&&(e.match_length=BH(e,n)),e.match_length>=3)if(r=tH(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=LH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=LH(e,e.ins_h,e.window[e.strstart+1]);else r=tH(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(jH(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===aH?(jH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(jH(e,!1),0===e.strm.avail_out)?1:2},zH=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<kH){if(WH(e),e.lookahead<kH&&t===rH)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=LH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-kH&&(e.match_length=BH(e,n),e.match_length<=5&&(e.strategy===fH||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=tH(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=LH(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(jH(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=tH(e,0,e.window[e.strstart-1]),r&&jH(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=tH(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===aH?(jH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(jH(e,!1),0===e.strm.avail_out)?1:2};function KH(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const qH=[new KH(0,0,0,0,GH),new KH(4,4,8,4,HH),new KH(4,5,16,8,HH),new KH(4,6,32,32,HH),new KH(4,4,16,16,zH),new KH(8,16,32,32,zH),new KH(8,16,128,128,zH),new KH(8,32,128,256,zH),new KH(32,128,258,1024,zH),new KH(32,258,258,4096,zH)];function YH(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=bH,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*wH),this.dyn_dtree=new Uint16Array(2*(2*SH+1)),this.bl_tree=new Uint16Array(2*(2*TH+1)),PH(this.dyn_ltree),PH(this.dyn_dtree),PH(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(CH+1),this.heap=new Uint16Array(2*EH+1),PH(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*EH+1),PH(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const JH=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==OH&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==IH&&t.status!==NH?1:0},XH=e=>{if(JH(e))return AH(e,dH);e.total_in=e.total_out=0,e.data_type=yH;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?OH:IH,e.adler=2===t.wrap?0:1,t.last_flush=-2,ZG(t),cH},QH=e=>{const t=XH(e);return t===cH&&(e=>{e.window_size=2*e.w_size,PH(e.head),e.max_lazy_match=qH[e.level].max_lazy,e.good_match=qH[e.level].good_length,e.nice_match=qH[e.level].nice_length,e.max_chain_length=qH[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},ZH=(e,t,n,r,i,o)=>{if(!e)return dH;let a=1;if(t===pH&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>9||n!==bH||r<8||r>15||t<0||t>9||o<0||o>gH||8===r&&1!==a)return AH(e,dH);8===r&&(r=9);const s=new YH;return e.state=s,s.strm=e,s.status=OH,s.wrap=a,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=o,s.method=n,QH(e)};var $H=(e,t)=>{if(JH(e)||t>sH||t<0)return e?AH(e,dH):dH;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===NH&&t!==aH)return AH(e,0===e.avail_out?hH:dH);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(MH(e),0===e.avail_out)return n.last_flush=-1,cH}else if(0===e.avail_in&&xH(t)<=xH(r)&&t!==aH)return AH(e,hH);if(n.status===NH&&0!==e.avail_in)return AH(e,hH);if(n.status===OH&&0===n.wrap&&(n.status=IH),n.status===OH){let t=bH+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=mH||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,VH(n,t),0!==n.strstart&&(VH(n,e.adler>>>16),VH(n,65535&e.adler)),e.adler=1,n.status=IH,MH(e),0!==n.pending)return n.last_flush=-1,cH}if(57===n.status)if(e.adler=0,UH(n,31),UH(n,139),UH(n,8),n.gzhead)UH(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),UH(n,255&n.gzhead.time),UH(n,n.gzhead.time>>8&255),UH(n,n.gzhead.time>>16&255),UH(n,n.gzhead.time>>24&255),UH(n,9===n.level?2:n.strategy>=mH||n.level<2?4:0),UH(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(UH(n,255&n.gzhead.extra.length),UH(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=JG(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(UH(n,0),UH(n,0),UH(n,0),UH(n,0),UH(n,0),UH(n,9===n.level?2:n.strategy>=mH||n.level<2?4:0),UH(n,3),n.status=IH,MH(e),0!==n.pending)return n.last_flush=-1,cH;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=JG(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,MH(e),0!==n.pending)return n.last_flush=-1,cH;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=JG(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=JG(e.adler,n.pending_buf,n.pending-r,r)),MH(e),0!==n.pending)return n.last_flush=-1,cH;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,UH(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=JG(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=JG(e.adler,n.pending_buf,n.pending-r,r)),MH(e),0!==n.pending)return n.last_flush=-1,cH;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,UH(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=JG(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(MH(e),0!==n.pending))return n.last_flush=-1,cH;UH(n,255&e.adler),UH(n,e.adler>>8&255),e.adler=0}if(n.status=IH,MH(e),0!==n.pending)return n.last_flush=-1,cH}if(0!==e.avail_in||0!==n.lookahead||t!==rH&&n.status!==NH){let r=0===n.level?GH(n,t):n.strategy===mH?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(WH(e),0===e.lookahead)){if(t===rH)return 1;break}if(e.match_length=0,n=tH(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(jH(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===aH?(jH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(jH(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===_H?((e,t)=>{let n,r,i,o;const a=e.window;for(;;){if(e.lookahead<=RH){if(WH(e),e.lookahead<=RH&&t===rH)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=a[i],r===a[++i]&&r===a[++i]&&r===a[++i])){o=e.strstart+RH;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<o);e.match_length=RH-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=tH(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=tH(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(jH(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===aH?(jH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(jH(e,!1),0===e.strm.avail_out)?1:2})(n,t):qH[n.level].func(n,t);if(3!==r&&4!==r||(n.status=NH),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),cH;if(2===r&&(t===iH?nH(n):t!==sH&&($G(n,0,0,!1),t===oH&&(PH(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),MH(e),0===e.avail_out))return n.last_flush=-1,cH}return t!==aH?cH:n.wrap<=0?lH:(2===n.wrap?(UH(n,255&e.adler),UH(n,e.adler>>8&255),UH(n,e.adler>>16&255),UH(n,e.adler>>24&255),UH(n,255&e.total_in),UH(n,e.total_in>>8&255),UH(n,e.total_in>>16&255),UH(n,e.total_in>>24&255)):(VH(n,e.adler>>>16),VH(n,65535&e.adler)),MH(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?cH:lH)},ez=(e,t)=>{let n=t.length;if(JH(e))return dH;const r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==OH||r.lookahead)return dH;if(1===i&&(e.adler=qG(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(PH(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const o=e.avail_in,a=e.next_in,s=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,WH(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=LH(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,WH(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=a,e.input=s,e.avail_in=o,r.wrap=i,cH},tz={deflateInit:(e,t)=>ZH(e,t,bH,15,8,vH),deflateInit2:ZH,deflateReset:QH,deflateResetKeep:XH,deflateSetHeader:(e,t)=>JH(e)||2!==e.state.wrap?dH:(e.state.gzhead=t,cH),deflate:$H,deflateEnd:e=>{if(JH(e))return dH;const t=e.state.status;return e.state=null,t===IH?AH(e,uH):cH},deflateSetDictionary:ez,deflateInfo:"pako deflate (from Nodeca project)"};const nz=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var rz={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)nz(n,t)&&(e[t]=n[t])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,o=e.length;r<o;r++){let t=e[r];n.set(t,i),i+=t.length}return n}};let iz=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){iz=!1}const oz=new Uint8Array(256);for(let n=0;n<256;n++)oz[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;oz[254]=oz[254]=1;var az={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,i,o,a=e.length,s=0;for(i=0;i<a;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<a&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),o=0,i=0;o<s;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<a&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,i;const o=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){o[i++]=t;continue}let a=oz[t];if(a>4)o[i++]=65533,r+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&r<n;)t=t<<6|63&e[r++],a--;a>1?o[i++]=65533:t<65536?o[i++]=t:(t-=65536,o[i++]=55296|t>>10&1023,o[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&iz)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(o,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+oz[e[n]]>t?n:t}},sz=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const cz=Object.prototype.toString,{Z_NO_FLUSH:lz,Z_SYNC_FLUSH:dz,Z_FULL_FLUSH:uz,Z_FINISH:hz,Z_OK:pz,Z_STREAM_END:fz,Z_DEFAULT_COMPRESSION:mz,Z_DEFAULT_STRATEGY:_z,Z_DEFLATED:gz}=QG;function vz(e){this.options=rz.assign({level:mz,method:gz,chunkSize:16384,windowBits:15,memLevel:8,strategy:_z},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new sz,this.strm.avail_out=0;let n=tz.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==pz)throw new Error(XG[n]);if(t.header&&tz.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?az.string2buf(t.dictionary):"[object ArrayBuffer]"===cz.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=tz.deflateSetDictionary(this.strm,e),n!==pz)throw new Error(XG[n]);this._dict_set=!0}}function yz(e,t){const n=new vz(t);if(n.push(e,!0),n.err)throw n.msg||XG[n.err];return n.result}vz.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?hz:lz,"string"==typeof e?n.input=az.string2buf(e):"[object ArrayBuffer]"===cz.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(o===dz||o===uz)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=tz.deflate(n,o),i===fz)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=tz.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===pz;if(0!==n.avail_out){if(o>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},vz.prototype.onData=function(e){this.chunks.push(e)},vz.prototype.onEnd=function(e){e===pz&&(this.result=rz.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var bz={Deflate:vz,deflate:yz,deflateRaw:function(e,t){return(t=t||{}).raw=!0,yz(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,yz(e,t)},constants:QG};const Ez=16209;var Sz=function(e,t){let n,r,i,o,a,s,c,l,d,u,h,p,f,m,_,g,v,y,b,E,S,T,w,C;const R=e.state;n=e.next_in,w=e.input,r=n+(e.avail_in-5),i=e.next_out,C=e.output,o=i-(t-e.avail_out),a=i+(e.avail_out-257),s=R.dmax,c=R.wsize,l=R.whave,d=R.wnext,u=R.window,h=R.hold,p=R.bits,f=R.lencode,m=R.distcode,_=(1<<R.lenbits)-1,g=(1<<R.distbits)-1;e:do{p<15&&(h+=w[n++]<<p,p+=8,h+=w[n++]<<p,p+=8),v=f[h&_];t:for(;;){if(y=v>>>24,h>>>=y,p-=y,y=v>>>16&255,0===y)C[i++]=65535&v;else{if(!(16&y)){if(0==(64&y)){v=f[(65535&v)+(h&(1<<y)-1)];continue t}if(32&y){R.mode=16191;break e}e.msg="invalid literal/length code",R.mode=Ez;break e}b=65535&v,y&=15,y&&(p<y&&(h+=w[n++]<<p,p+=8),b+=h&(1<<y)-1,h>>>=y,p-=y),p<15&&(h+=w[n++]<<p,p+=8,h+=w[n++]<<p,p+=8),v=m[h&g];n:for(;;){if(y=v>>>24,h>>>=y,p-=y,y=v>>>16&255,!(16&y)){if(0==(64&y)){v=m[(65535&v)+(h&(1<<y)-1)];continue n}e.msg="invalid distance code",R.mode=Ez;break e}if(E=65535&v,y&=15,p<y&&(h+=w[n++]<<p,p+=8,p<y&&(h+=w[n++]<<p,p+=8)),E+=h&(1<<y)-1,E>s){e.msg="invalid distance too far back",R.mode=Ez;break e}if(h>>>=y,p-=y,y=i-o,E>y){if(y=E-y,y>l&&R.sane){e.msg="invalid distance too far back",R.mode=Ez;break e}if(S=0,T=u,0===d){if(S+=c-y,y<b){b-=y;do{C[i++]=u[S++]}while(--y);S=i-E,T=C}}else if(d<y){if(S+=c+d-y,y-=d,y<b){b-=y;do{C[i++]=u[S++]}while(--y);if(S=0,d<b){y=d,b-=y;do{C[i++]=u[S++]}while(--y);S=i-E,T=C}}}else if(S+=d-y,y<b){b-=y;do{C[i++]=u[S++]}while(--y);S=i-E,T=C}for(;b>2;)C[i++]=T[S++],C[i++]=T[S++],C[i++]=T[S++],b-=3;b&&(C[i++]=T[S++],b>1&&(C[i++]=T[S++]))}else{S=i-E;do{C[i++]=C[S++],C[i++]=C[S++],C[i++]=C[S++],b-=3}while(b>2);b&&(C[i++]=C[S++],b>1&&(C[i++]=C[S++]))}break}}break}}while(n<r&&i<a);b=p>>3,n-=b,p-=b<<3,h&=(1<<p)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<a?a-i+257:257-(i-a),R.hold=h,R.bits=p};const Tz=15,wz=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Cz=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Rz=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),kz=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Oz=(e,t,n,r,i,o,a,s)=>{const c=s.bits;let l,d,u,h,p,f,m=0,_=0,g=0,v=0,y=0,b=0,E=0,S=0,T=0,w=0,C=null;const R=new Uint16Array(16),k=new Uint16Array(16);let O,I,N,A=null;for(m=0;m<=Tz;m++)R[m]=0;for(_=0;_<r;_++)R[t[n+_]]++;for(y=c,v=Tz;v>=1&&0===R[v];v--);if(y>v&&(y=v),0===v)return i[o++]=20971520,i[o++]=20971520,s.bits=1,0;for(g=1;g<v&&0===R[g];g++);for(y<g&&(y=g),S=1,m=1;m<=Tz;m++)if(S<<=1,S-=R[m],S<0)return-1;if(S>0&&(0===e||1!==v))return-1;for(k[1]=0,m=1;m<Tz;m++)k[m+1]=k[m]+R[m];for(_=0;_<r;_++)0!==t[n+_]&&(a[k[t[n+_]]++]=_);if(0===e?(C=A=a,f=20):1===e?(C=wz,A=Cz,f=257):(C=Rz,A=kz,f=0),w=0,_=0,m=g,p=o,b=y,E=0,u=-1,T=1<<y,h=T-1,1===e&&T>852||2===e&&T>592)return 1;for(;;){O=m-E,a[_]+1<f?(I=0,N=a[_]):a[_]>=f?(I=A[a[_]-f],N=C[a[_]-f]):(I=96,N=0),l=1<<m-E,d=1<<b,g=d;do{d-=l,i[p+(w>>E)+d]=O<<24|I<<16|N}while(0!==d);for(l=1<<m-1;w&l;)l>>=1;if(0!==l?(w&=l-1,w+=l):w=0,_++,0==--R[m]){if(m===v)break;m=t[n+a[_]]}if(m>y&&(w&h)!==u){for(0===E&&(E=y),p+=g,b=m-E,S=1<<b;b+E<v&&(S-=R[b+E],!(S<=0));)b++,S<<=1;if(T+=1<<b,1===e&&T>852||2===e&&T>592)return 1;u=w&h,i[u]=y<<24|b<<16|p-o}}return 0!==w&&(i[p+w]=m-E<<24|64<<16),s.bits=y,0};const{Z_FINISH:Iz,Z_BLOCK:Nz,Z_TREES:Az,Z_OK:xz,Z_STREAM_END:Pz,Z_NEED_DICT:Dz,Z_STREAM_ERROR:Lz,Z_DATA_ERROR:Mz,Z_MEM_ERROR:jz,Z_BUF_ERROR:Uz,Z_DEFLATED:Vz}=QG,Fz=16180,Bz=16190,Wz=16191,Gz=16192,Hz=16194,zz=16199,Kz=16200,qz=16206,Yz=16209,Jz=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Xz(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Qz=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Fz||t.mode>16211?1:0},Zz=e=>{if(Qz(e))return Lz;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Fz,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,xz},$z=e=>{if(Qz(e))return Lz;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Zz(e)},eK=(e,t)=>{let n;if(Qz(e))return Lz;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Lz:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,$z(e))},tK=(e,t)=>{if(!e)return Lz;const n=new Xz;e.state=n,n.strm=e,n.window=null,n.mode=Fz;const r=eK(e,t);return r!==xz&&(e.state=null),r};let nK,rK,iK=!0;const oK=e=>{if(iK){nK=new Int32Array(512),rK=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Oz(1,e.lens,0,288,nK,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Oz(2,e.lens,0,32,rK,0,e.work,{bits:5}),iK=!1}e.lencode=nK,e.lenbits=9,e.distcode=rK,e.distbits=5},aK=(e,t,n,r)=>{let i;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(t.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>r&&(i=r),o.window.set(t.subarray(n-r,n-r+i),o.wnext),(r-=i)?(o.window.set(t.subarray(n-r,n),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var sK=(e,t)=>{let n,r,i,o,a,s,c,l,d,u,h,p,f,m,_,g,v,y,b,E,S,T,w=0;const C=new Uint8Array(4);let R,k;const O=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Qz(e)||!e.output||!e.input&&0!==e.avail_in)return Lz;n=e.state,n.mode===Wz&&(n.mode=Gz),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,r=e.input,s=e.avail_in,l=n.hold,d=n.bits,u=s,h=c,T=xz;e:for(;;)switch(n.mode){case Fz:if(0===n.wrap){n.mode=Gz;break}for(;d<16;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,C[0]=255&l,C[1]=l>>>8&255,n.check=JG(n.check,C,2,0),l=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=Yz;break}if((15&l)!==Vz){e.msg="unknown compression method",n.mode=Yz;break}if(l>>>=4,d-=4,S=8+(15&l),0===n.wbits&&(n.wbits=S),S>15||S>n.wbits){e.msg="invalid window size",n.mode=Yz;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&l?16189:Wz,l=0,d=0;break;case 16181:for(;d<16;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}if(n.flags=l,(255&oG(n))!==Vz){e.msg="unknown compression method",n.mode=Yz;break}if(57344&oG(n)){e.msg="unknown header flags set",n.mode=Yz;break}n.head&&(n.head.text=l>>8&1),512&oG(n)&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=JG(n.check,C,2,0)),l=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}n.head&&(n.head.time=l),512&oG(n)&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,C[2]=l>>>16&255,C[3]=l>>>24&255,n.check=JG(n.check,C,4,0)),l=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&oG(n)&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=JG(n.check,C,2,0)),l=0,d=0,n.mode=16184;case 16184:if(1024&oG(n)){for(;d<16;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}n.length=l,n.head&&(n.head.extra_len=l),512&oG(n)&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=JG(n.check,C,2,0)),l=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&oG(n)&&(p=n.length,p>s&&(p=s),p&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(o,o+p),S)),512&oG(n)&&4&n.wrap&&(n.check=JG(n.check,r,p,o)),s-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&oG(n)){if(0===s)break e;p=0;do{S=r[o+p++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S))}while(S&&p<s);if(512&oG(n)&&4&n.wrap&&(n.check=JG(n.check,r,p,o)),s-=p,o+=p,S)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&oG(n)){if(0===s)break e;p=0;do{S=r[o+p++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S))}while(S&&p<s);if(512&oG(n)&&4&n.wrap&&(n.check=JG(n.check,r,p,o)),s-=p,o+=p,S)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&oG(n)){for(;d<16;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}if(4&n.wrap&&l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Yz;break}l=0,d=0}n.head&&(n.head.hcrc=oG(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Wz;break;case 16189:for(;d<32;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}e.adler=n.check=Jz(l),l=0,d=0,n.mode=Bz;case Bz:if(0===n.havedict)return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=l,n.bits=d,Dz;e.adler=n.check=1,n.mode=Wz;case Wz:if(t===Nz||t===Az)break e;case Gz:if(n.last){l>>>=7&d,d-=7&d,n.mode=qz;break}for(;d<3;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}switch(n.last=1&l,l>>>=1,d-=1,3&l){case 0:n.mode=16193;break;case 1:if(oK(n),n.mode=zz,t===Az){l>>>=2,d-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Yz}l>>>=2,d-=2;break;case 16193:for(l>>>=7&d,d-=7&d;d<32;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Yz;break}if(n.length=65535&l,l=0,d=0,n.mode=Hz,t===Az)break e;case Hz:n.mode=16195;case 16195:if(p=n.length,p){if(p>s&&(p=s),p>c&&(p=c),0===p)break e;i.set(r.subarray(o,o+p),a),s-=p,o+=p,c-=p,a+=p,n.length-=p;break}n.mode=Wz;break;case 16196:for(;d<14;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}if(n.nlen=257+(31&l),l>>>=5,d-=5,n.ndist=1+(31&l),l>>>=5,d-=5,n.ncode=4+(15&l),l>>>=4,d-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Yz;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}n.lens[O[n.have++]]=7&l,l>>>=3,d-=3}for(;n.have<19;)n.lens[O[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,R={bits:n.lenbits},T=Oz(0,n.lens,0,19,n.lencode,0,n.work,R),n.lenbits=R.bits,T){e.msg="invalid code lengths set",n.mode=Yz;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;w=n.lencode[l&(1<<n.lenbits)-1],_=w>>>24,g=w>>>16&255,v=65535&w,!(_<=d);){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}if(v<16)l>>>=_,d-=_,n.lens[n.have++]=v;else{if(16===v){for(k=_+2;d<k;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}if(l>>>=_,d-=_,0===n.have){e.msg="invalid bit length repeat",n.mode=Yz;break}S=n.lens[n.have-1],p=3+(3&l),l>>>=2,d-=2}else if(17===v){for(k=_+3;d<k;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}l>>>=_,d-=_,S=0,p=3+(7&l),l>>>=3,d-=3}else{for(k=_+7;d<k;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}l>>>=_,d-=_,S=0,p=11+(127&l),l>>>=7,d-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Yz;break}for(;p--;)n.lens[n.have++]=S}}if(n.mode===Yz)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Yz;break}if(n.lenbits=9,R={bits:n.lenbits},T=Oz(1,n.lens,0,n.nlen,n.lencode,0,n.work,R),n.lenbits=R.bits,T){e.msg="invalid literal/lengths set",n.mode=Yz;break}if(n.distbits=6,n.distcode=n.distdyn,R={bits:n.distbits},T=Oz(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,R),n.distbits=R.bits,T){e.msg="invalid distances set",n.mode=Yz;break}if(n.mode=zz,t===Az)break e;case zz:n.mode=Kz;case Kz:if(s>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=l,n.bits=d,Sz(e,h),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,r=e.input,s=e.avail_in,l=n.hold,d=n.bits,n.mode===Wz&&(n.back=-1);break}for(n.back=0;w=n.lencode[l&(1<<n.lenbits)-1],_=w>>>24,g=w>>>16&255,v=65535&w,!(_<=d);){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}if(g&&0==(240&g)){for(y=_,b=g,E=v;w=n.lencode[E+((l&(1<<y+b)-1)>>y)],_=w>>>24,g=w>>>16&255,v=65535&w,!(y+_<=d);){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}l>>>=y,d-=y,n.back+=y}if(l>>>=_,d-=_,n.back+=_,n.length=v,0===g){n.mode=16205;break}if(32&g){n.back=-1,n.mode=Wz;break}if(64&g){e.msg="invalid literal/length code",n.mode=Yz;break}n.extra=15&g,n.mode=16201;case 16201:if(n.extra){for(k=n.extra;d<k;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;w=n.distcode[l&(1<<n.distbits)-1],_=w>>>24,g=w>>>16&255,v=65535&w,!(_<=d);){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}if(0==(240&g)){for(y=_,b=g,E=v;w=n.distcode[E+((l&(1<<y+b)-1)>>y)],_=w>>>24,g=w>>>16&255,v=65535&w,!(y+_<=d);){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}l>>>=y,d-=y,n.back+=y}if(l>>>=_,d-=_,n.back+=_,64&g){e.msg="invalid distance code",n.mode=Yz;break}n.offset=v,n.extra=15&g,n.mode=16203;case 16203:if(n.extra){for(k=n.extra;d<k;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Yz;break}n.mode=16204;case 16204:if(0===c)break e;if(p=h-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Yz;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=i,f=a-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do{i[a++]=m[f++]}while(--p);0===n.length&&(n.mode=Kz);break;case 16205:if(0===c)break e;i[a++]=n.length,c--,n.mode=Kz;break;case qz:if(n.wrap){for(;d<32;){if(0===s)break e;s--,l|=r[o++]<<d,d+=8}if(h-=c,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=oG(n)?JG(n.check,i,h,a-h):qG(n.check,i,h,a-h)),h=c,4&n.wrap&&(oG(n)?l:Jz(l))!==n.check){e.msg="incorrect data check",n.mode=Yz;break}l=0,d=0}n.mode=16207;case 16207:if(n.wrap&&oG(n)){for(;d<32;){if(0===s)break e;s--,l+=r[o++]<<d,d+=8}if(4&n.wrap&&l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Yz;break}l=0,d=0}n.mode=16208;case 16208:T=Pz;break e;case Yz:T=Mz;break e;case 16210:return jz;default:return Lz}return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=l,n.bits=d,(n.wsize||h!==e.avail_out&&n.mode<Yz&&(n.mode<qz||t!==Iz))&&aK(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=oG(n)?JG(n.check,i,h,e.next_out-h):qG(n.check,i,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Wz?128:0)+(n.mode===zz||n.mode===Hz?256:0),(0===u&&0===h||t===Iz)&&T===xz&&(T=Uz),T},cK={inflateReset:$z,inflateReset2:eK,inflateResetKeep:Zz,inflateInit:e=>tK(e,15),inflateInit2:tK,inflate:sK,inflateEnd:e=>{if(Qz(e))return Lz;let t=e.state;return t.window&&(t.window=null),e.state=null,xz},inflateGetHeader:(e,t)=>{if(Qz(e))return Lz;const n=e.state;return 0==(2&n.wrap)?Lz:(n.head=t,t.done=!1,xz)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,o;return Qz(e)?Lz:(r=e.state,0!==r.wrap&&r.mode!==Bz?Lz:r.mode===Bz&&(i=1,i=qG(i,t,n,0),i!==r.check)?Mz:(o=aK(e,t,n,n),o?(r.mode=16210,jz):(r.havedict=1,xz)))},inflateInfo:"pako inflate (from Nodeca project)"},lK=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const dK=Object.prototype.toString,{Z_NO_FLUSH:uK,Z_FINISH:hK,Z_OK:pK,Z_STREAM_END:fK,Z_NEED_DICT:mK,Z_STREAM_ERROR:_K,Z_DATA_ERROR:gK,Z_MEM_ERROR:vK}=QG;function yK(e){this.options=rz.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new sz,this.strm.avail_out=0;let n=cK.inflateInit2(this.strm,t.windowBits);if(n!==pK)throw new Error(XG[n]);if(this.header=new lK,cK.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=az.string2buf(t.dictionary):"[object ArrayBuffer]"===dK.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=cK.inflateSetDictionary(this.strm,t.dictionary),n!==pK)))throw new Error(XG[n])}function bK(e,t){const n=new yK(t);if(n.push(e),n.err)throw n.msg||XG[n.err];return n.result}yK.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let o,a,s;if(this.ended)return!1;for(a=t===~~t?t:!0===t?hK:uK,"[object ArrayBuffer]"===dK.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),o=cK.inflate(n,a),o===mK&&i&&(o=cK.inflateSetDictionary(n,i),o===pK?o=cK.inflate(n,a):o===gK&&(o=mK));n.avail_in>0&&o===fK&&n.state.wrap>0&&0!==e[n.next_in];)cK.inflateReset(n),o=cK.inflate(n,a);switch(o){case _K:case gK:case mK:case vK:return this.onEnd(o),this.ended=!0,!1}if(s=n.avail_out,n.next_out&&(0===n.avail_out||o===fK))if("string"===this.options.to){let e=az.utf8border(n.output,n.next_out),t=n.next_out-e,i=az.buf2string(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(o!==pK||0!==s){if(o===fK)return o=cK.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},yK.prototype.onData=function(e){this.chunks.push(e)},yK.prototype.onEnd=function(e){e===pK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=rz.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var EK={Inflate:yK,inflate:bK,inflateRaw:function(e,t){return(t=t||{}).raw=!0,bK(e,t)},ungzip:bK,constants:QG};const{Deflate:SK,deflate:TK,deflateRaw:wK,gzip:CK}=bz,{Inflate:RK,inflate:kK,inflateRaw:OK,ungzip:IK}=EK;var NK=TK,AK=kK,xK=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(xK||{});class PK{constructor(){uC(this,"_sequence",0),uC(this,"_startTime",Date.now()),uC(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const n=new Uint8Array(4);n.set([1,0,0,0]);const r={id:0,length:4,data:n.buffer},i={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[r]};t.commonPacketHeader.extension=1,t.extension=i,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;CN("SHOW_DATASTREAM2_LOG")&&rA.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));const n=new ArrayBuffer(t.commonPacketHeader.length),r=new Uint8Array(n),i=new DataView(n);let o=0;if(i.setUint16(o,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),o+=2,i.setUint32(o,t.commonPacketHeader.sequence,!0),o+=4,i.setUint16(o,t.commonStreamHeader,!0),o+=2,t.extension){const e=this.serializeExtension(t.extension);r.set(new Uint8Array(e),o),o+=e.byteLength}if(r.set(new Uint8Array(t.payload),o),o+=t.payload.byteLength,o!==t.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const t=new DataView(e);let n=0;const r=t.getUint16(n,!0);n+=2;const i={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:t.getUint16(n+2,!0)<<16|t.getUint16(n,!0)};let o,a;if(n+=4,CN("SHOW_DATASTREAM2_LOG")&&rA.debug("receive data header: ".concat(JSON.stringify(i))),t.getUint16(n,!0),n+=2,i.extension){a=this.deserializeExtension(e.slice(n)),n+=2+a.length,o=e.slice(n);let t=!1;if(a.datas.length>0){const e=a.datas.find((e=>0===e.id));e&&(t=1==(1&new DataView(e.data).getUint32(0,!0)))}o=t?this.decompress(o):o}else o=e.slice(8);return o}serializeExtension(e){const{profile:t,length:n,datas:r}=e,i=new ArrayBuffer(n+2),o=new Uint8Array(i),a=new DataView(i);let s=0;if(a.setUint8(s++,t),a.setUint8(s++,n),r.forEach((e=>{t?(a.setUint8(s++,e.id),a.setUint8(s++,e.length),o.set(new Uint8Array(e.data),s),s+=e.data.byteLength):(a.setUint8(s++,e.id|e.length<<4),o.set(new Uint8Array(e.data),s),s+=e.data.byteLength)})),s!==n+2)throw Error("serialize extension error, is ".concat(s,"!==").concat(n+2));return i}deserializeExtension(e){const t=new DataView(e);let n=0;const r=t.getUint8(n);n++;const i=t.getUint8(n);n++;const o=r===xK.TWO_BYTE,a=[],s=new DataView(e,2);let c=0;for(;c<i;){let e=0,t=0,n=new ArrayBuffer(0);o?(e=s.getUint8(c),c++,t=s.getUint8(c),c++):(e=15&s.getUint8(c),t=s.getUint8(c)>>4,c++),t>0&&(n=s.buffer.slice(c+2,c+2+t),c+=n.byteLength),a.push({id:e,length:t,data:n})}if(c!==i)throw Error("parse error");return{profile:r,length:i,datas:a}}decompress(e){return AK(new Uint8Array(e))}compress(e){return NK(new Uint8Array(e))}}const DK={name:"DataStream",create:(e,t)=>{const n=t?new qD(e):new YD(e);return n.useDataStream(new PK),n}};class LK extends BO{constructor(e,t,n){super(),uC(this,"ws",void 0),uC(this,"requestId",1),uC(this,"heartBeatTimer",void 0),uC(this,"joinInfo",void 0),uC(this,"clientId",void 0),uC(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),uC(this,"onClose",(e=>{this.emit("close"),this.dispose()})),uC(this,"onMessage",(e=>{const t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)})),this.joinInfo=e,this.clientId=t,this.ws=new Vj("cross-channel-".concat(this.clientId),n),this.ws.on(NM.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(NM.CONNECTED,this.onOpen),this.ws.on(NM.ON_MESSAGE,this.onMessage),this.ws.on(NM.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){const t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new np(((t,n)=>{const r=window.setTimeout((()=>{n(new hA(CO.TIMEOUT,"wait status timeout, status: ".concat(e)))}),5e3);this.once(e,(i=>{window.clearTimeout(r),i.state&&0!==i.state?n(new hA(CO.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)})),this.once("dispose",(()=>{window.clearTimeout(r),n(new hA(CO.WS_ABORT))}))}))}async request(e){if("closed"===this.ws.state)throw new hA(CO.WS_DISCONNECT);const t=()=>new np(((e,t)=>{this.ws.once(NM.CLOSED,(()=>t(new hA(CO.WS_ABORT)))),this.ws.once(NM.CONNECTED,e)}));"connected"!==this.ws.state&&await t();const n=this.sendMessage(e),r=new np(((e,t)=>{const r=()=>{t(new hA(CO.WS_ABORT))};this.ws.once(NM.RECONNECTING,r),this.ws.once(NM.CLOSED,r),this.once("req_".concat(n),e),EI(3e3).then((()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(NM.RECONNECTING,r),this.ws.off(NM.CLOSED,r),t(new hA(CO.TIMEOUT,"cross channel ws request timeout"))}))})),i=await r;if(!i||200!==i.code)throw new hA(CO.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(i)));return i}async connect(e){this.ws.removeAllListeners(NM.REQUEST_NEW_URLS),this.ws.on(NM.REQUEST_NEW_URLS,(t=>{t(e)})),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class MK extends BO{set state(e){e!==this._state&&(e!==HM.RELAY_STATE_FAILURE&&(this.errorCode=zM.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,n,r,i){super(),uC(this,"joinInfo",void 0),uC(this,"sid",void 0),uC(this,"clientId",void 0),uC(this,"cancelToken",Mk.CancelToken.source()),uC(this,"workerToken",void 0),uC(this,"requestId",0),uC(this,"signal",void 0),uC(this,"prevChannelMediaConfig",void 0),uC(this,"httpRetryConfig",void 0),uC(this,"_resolution",void 0),uC(this,"_state",HM.RELAY_STATE_IDLE),uC(this,"errorCode",zM.RELAY_OK),uC(this,"onStatus",(e=>{rA.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",GM.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",GM.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=zM.SRC_TOKEN_EXPIRED,this.state=HM.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=zM.DEST_TOKEN_EXPIRED,this.state=HM.RELAY_STATE_FAILURE))})),uC(this,"onReconnect",(async()=>{rA.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",GM.NETWORK_DISCONNECTED),this.state=HM.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((e=>{this.state!==HM.RELAY_STATE_IDLE&&(rA.error("auto restart channel media relay failed",e.toString()),this.errorCode=zM.SERVER_CONNECTION_LOST,this.state=HM.RELAY_STATE_FAILURE)}))})),this.joinInfo=e,this.clientId=t,this.sid=TI(),this.signal=new LK(this.joinInfo,this.clientId,n),this.httpRetryConfig=r,this._resolution=i}async startChannelMediaRelay(e){if(this.state!==HM.RELAY_STATE_IDLE)throw new hA(CO.INVALID_OPERATION);this.state=HM.RELAY_STATE_CONNECTING,await this.connect(),rA.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(e){if(e.data&&e.data.serverResponse&&"SetSourceChannel"===e.data.serverResponse.command)throw new hA(CO.CROSS_CHANNEL_FAILED_JOIN_SRC);if(e.data&&e.data.serverResponse&&"SetDestChannelStatus"===e.serverResponse.command)throw new hA(CO.CROSS_CHANNEL_FAILED_JOIN_DEST);if(e.data&&e.data.serverResponse&&"StartPacketTransfer"===e.serverResponse.command)throw new hA(CO.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw e}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==HM.RELAY_STATE_RUNNING)throw new hA(CO.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==HM.RELAY_STATE_RUNNING)throw new hA(CO.INVALID_OPERATION);const t=this.genMessage(WM.SetVideoProfile);await this.signal.request(t),rA.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),rA.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=HM.RELAY_STATE_IDLE,this.dispose()}dispose(){rA.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Mk.CancelToken.source(),this.state=HM.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await CV(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",GM.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const t=this.genMessage(WM.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),rA.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n=this.genMessage(WM.SetSdkProfile,e);await this.signal.request(n),rA.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(WM.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",GM.PACKET_JOINED_SRC_CHANNEL),rA.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const i=this.genMessage(WM.SetSourceUserId,e);await this.signal.request(i),rA.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(WM.SetDestChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",GM.PACKET_JOINED_DEST_CHANNEL),rA.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const a=this.genMessage(WM.StartPacketTransfer,e);await this.signal.request(a),this.emit("event",GM.PACKET_SENT_TO_DEST_CHANNEL),this.state=HM.RELAY_STATE_RUNNING,rA.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const t=this.genMessage(WM.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",GM.PACKET_UPDATE_DEST_CHANNEL),rA.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(WM.StopPacketTransfer);await this.signal.request(e),rA.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){const n=[],r=[],i=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:mN,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.23.4"===o.sdkVersion&&(o.sdkVersion="0.0.1");let a=null,s=null;switch(e){case WM.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case WM.SetSourceChannel:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new hA(CO.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:s.channelName,token:s.token||this.joinInfo.appId},o;case WM.SetSourceUserId:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new hA(CO.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:s.uid+""},o;case WM.SetDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new hA(CO.UNEXPECTED_ERROR,"can not find dest config");return a.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),o.clientRequest={command:"SetDestChannel",channelName:n,uid:r,token:i},o;case WM.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case WM.Reconnect:return o.clientRequest={command:"Reconnect"},o;case WM.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case WM.UpdateDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new hA(CO.UNEXPECTED_ERROR,"can not find dest config");return a.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),o.clientRequest={command:"UpdateDestChannel",channelName:n,uid:r,token:i},o;case WM.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const jK={name:"ChannelMediaRelay",create:function(e){return new MK(e.joinInfo,e.clientId,e.websocketRetryConfig||jI,e.httpRetryConfig||jI,e.resolution)}};function UK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function VK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UK(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UK(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class FK extends BO{constructor(e,t,n,r){super(),uC(this,"spec",void 0),uC(this,"token",void 0),uC(this,"websocket",void 0),uC(this,"pingpongTimer",void 0),uC(this,"reconnectMode","retry"),uC(this,"serviceMode",void 0),uC(this,"reqId",0),uC(this,"commandReqId",0),uC(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),uC(this,"handleWebSocketMessage",(e=>{if(!e.data)return;const t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):(uA.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===PM.TRANSCODE?1:2}),this.emit(UM.PUBLISH_STREAM_STATUS,t))})),this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new Vj("live-streaming",n),this.websocket.on(NM.CONNECTED,this.handleWebSocketOpen),this.websocket.on(NM.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(NM.REQUEST_NEW_URLS,((e,t)=>{nI(this,UM.REQUEST_NEW_ADDRESS).then(e).catch(t)})),this.websocket.on(NM.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(e){return this.websocket.init(e)}async request(e,t,n,r){this.reqId+=1,"request"===e&&(this.commandReqId+=1);const i=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new hA(CO.UNEXPECTED_ERROR);const a=VK({command:e,sdkVersion:"4.23.4"===mN?"0.0.1":mN,seq:o,requestId:o,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new hA(CO.WS_DISCONNECT);const s=()=>new np(((e,t)=>{this.websocket.once(NM.CLOSED,(()=>t(new hA(CO.WS_ABORT)))),this.websocket.once(NM.CONNECTED,e)}));"connected"!==this.websocket.state&&await s(),a.clientRequest&&(a.clientRequest.workerToken=this.token);const c=new np(((e,t)=>{const n=()=>{t(new hA(CO.WS_ABORT))};this.websocket.once(NM.RECONNECTING,n),this.websocket.once(NM.CLOSED,n),this.once("@".concat(o,"-").concat(this.spec.sid),(t=>{e(t)}))}));r&&uA.workerEvent(this.spec.sid,VK(VK({},r),{},{requestId:i,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));const l=Date.now();this.websocket.sendMessage(a);let d=null;try{d=await c}catch(r){if("closed"===this.websocket.state)throw r;return await s(),await this.request(e,t,n)}return r&&uA.workerEvent(this.spec.sid,VK(VK({},r),{},{requestId:i,actionType:"response",payload:JSON.stringify(d.serverResponse),serverCode:d.code,success:200===d.code,responseTime:Date.now()-l})),200!==d.code&&this.handleResponseError(d),d}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e="4.23.4"===mN?"0.0.1":mN;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case FM.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void rA.warning("live stream response already exists stream");case FM.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case FM.LIVE_STREAM_RESPONSE_BAD_STREAM:case FM.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new hA(CO.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case FM.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command)return;throw new hA(CO.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case FM.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new hA(CO.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case FM.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new hA(CO.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(UM.WARNING,t,e.serverResponse.url)}case FM.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const t=new hA(CO.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(UM.WARNING,t,e.serverResponse.url)}case FM.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new hA(CO.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case FM.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new hA(CO.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case FM.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const t=new hA(CO.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(UM.WARNING,t,e.serverResponse.url)}case FM.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new hA(CO.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case FM.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new hA(CO.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case FM.LIVE_STREAM_RESPONSE_WORKER_LOST:case FM.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command)return;throw new hA(CO.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case FM.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new hA(CO.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new hA(CO.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case FM.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case FM.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case FM.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case FM.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new hA(CO.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(wI)}),6e3)}}function BK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function WK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?BK(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BK(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class GK extends BO{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jI,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:jI;super(),uC(this,"onLiveStreamWarning",void 0),uC(this,"onLiveStreamError",void 0),uC(this,"spec",void 0),uC(this,"retryTimeout",1e4),uC(this,"connection",void 0),uC(this,"httpRetryConfig",void 0),uC(this,"wsRetryConfig",void 0),uC(this,"streamingTasks",new Map),uC(this,"isStartingStreamingTask",!1),uC(this,"taskMutex",new LI("live-streaming")),uC(this,"cancelToken",Mk.CancelToken.source()),uC(this,"transcodingConfig",void 0),uC(this,"uapResponse",void 0),uC(this,"lastTaskId",1),uC(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){const t=WK(WK({},jM),e);66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(rA.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map((e=>WK(WK(WK({},DM),e),{},{zOrder:e.zOrder?e.zOrder+1:1})))),function(e){PO(e.width)||IO(e.width,"config.width",0,1e4),PO(e.height)||IO(e.height,"config.height",0,1e4),PO(e.videoBitrate)||IO(e.videoBitrate,"config.videoBitrate",1,1e6),PO(e.videoFrameRate)||IO(e.videoFrameRate,"config.videoFrameRate"),PO(e.lowLatency)||kO(e.lowLatency,"config.lowLatency"),PO(e.audioSampleRate)||OO(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),PO(e.audioBitrate)||IO(e.audioBitrate,"config.audioBitrate",1,128),PO(e.audioChannels)||OO(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),PO(e.videoGop)||IO(e.videoGop,"config.videoGop"),PO(e.videoCodecProfile)||OO(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),PO(e.userCount)||IO(e.userCount,"config.userCount",0,17),PO(e.backgroundColor)||IO(e.backgroundColor,"config.backgroundColor",0,16777215),PO(e.userConfigExtraInfo)||AO(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!PO(e.transcodingUsers)&&(xO(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach(((e,t)=>{xM(e.uid),PO(e.x)||IO(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),PO(e.y)||IO(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),PO(e.width)||IO(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),PO(e.height)||IO(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),PO(e.zOrder)||IO(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),PO(e.alpha)||IO(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)}))),PO(e.watermark)||MM(e.watermark,"watermark"),PO(e.backgroundImage)||MM(e.backgroundImage,"backgroundImage"),e.images&&!PO(e.images)&&(xO(e.images,"config.images"),e.images.forEach(((e,t)=>{MM(e,"images[".concat(t,"]"))})))}(t);const n=[];t.images&&n.push(...t.images.map((e=>WK(WK(WK({},LM),e),{},{zOrder:255})))),t.backgroundImage&&(n.push(WK(WK(WK({},LM),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(n.push(WK(WK(WK({},LM),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=n,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map((e=>WK({},e))),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);const r=(t.userConfigs||[]).map((e=>"number"==typeof e.uid?np.resolve(e.uid):bV(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await np.all(r)).forEach(((e,n)=>{t.userConfigs&&t.userConfigs[n]&&(t.userConfigs[n].uid=e)})),this.transcodingConfig=t,this.connection)try{var i;const e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(up(i=this.streamingTasks).call(i)).map((e=>e.taskId)).join("#")});rA.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(e){if(!e.data||!e.data.retry)throw e;e.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((t=>{rA.warning("[".concat(this.spec.clientId,"] live streaming receive error"),e.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,e).then((()=>{rA.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(t.url," success"))})).catch((e=>{rA.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)}))}))}}async startLiveStreamingTask(e,t,n){if(!this.transcodingConfig&&t===PM.TRANSCODE)throw new hA(CO.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};rA.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));const i=await this.taskMutex.lock();if(!this.connection&&n)return void i();if(this.streamingTasks.get(e)&&!n)return i(),new hA(CO.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(e){throw i(),e}switch(t){case PM.TRANSCODE:r.transcodingConfig=WK({},this.transcodingConfig);case PM.RAW:}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const o=this.lastTaskId++;try{const a=new np(((t,r)=>{EI(this.retryTimeout).then((()=>{if(n)return r(n);const t=this.statusError.get(e);return t?(this.statusError.delete(e),r(t)):void 0}))})),s=await np.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:t===PM.TRANSCODE?1:2,requestByUser:!n,tid:o.toString()}),a]);this.isStartingStreamingTask=!1,rA.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(s.code)),this.streamingTasks.set(e,{clientRequest:r,mode:t,url:e,taskId:o}),i()}catch(r){if(i(),this.isStartingStreamingTask=!1,!r.data||!r.data.retry||n)throw r;return r.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,r)):await this.startLiveStreamingTask(e,t,r)}}stopLiveStreamingTask(e){return new np(((t,n)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new hA(CO.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const i=r.mode;r.abortTask=()=>{rA.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:i===PM.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((n=>{rA.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&(this.connection&&this.connection.close(),this.connection=void 0),t()})).catch(n)}))}resetAllTask(){var e;const t=Array.from(up(e=this.streamingTasks).call(e));this.terminate();for(const n of t)this.startLiveStreamingTask(n.url,n.mode).catch((e=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,e)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Mk.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new hA(CO.UNEXPECTED_ERROR,"live streaming connection has already connected");const t=await nI(this,VM.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new FK(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(UM.WARNING,((e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e))),this.connection.on(UM.PUBLISH_STREAM_STATUS,(e=>this.handlePublishStreamServer(e))),this.connection.on(UM.REQUEST_NEW_ADDRESS,((t,n)=>{if(!this.connection)return n(new hA(CO.UNEXPECTED_ERROR,"can not get new live streaming address list"));nI(this,VM.REQUEST_WORKER_MANAGER_LIST,e).then((e=>{this.uapResponse=e,t(e.addressList)})).catch(n)})),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){const t=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(t),r=e.reason;switch(e.code){case FM.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case FM.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case FM.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case FM.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const r=new hA(CO.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return rA.error(r.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,r);if(!this.isStartingStreamingTask)return;this.statusError.set(t,r)}case FM.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new hA(CO.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case FM.LIVE_STREAM_RESPONSE_WORKER_LOST:case FM.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var i;if(!this.connection)return;this.connection.tryNextAddress();const t=Array.from(up(i=this.streamingTasks).call(i));for(const n of t)n.abortTask?n.abortTask():(rA.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new hA(CO.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then((()=>{rA.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)})).catch((e=>{rA.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)})));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const HK={name:"LiveStreaming",create:function(e){return new GK(e.joinInfo,e.websocketRetryConfig||jI,e.httpRetryConfig||jI)}};function zK(e){let t=nq();return function(e,t){let n=e.appId;void 0!==n&&(_q(t,10),lq(t,n));let r=e.cid;void 0!==r&&(_q(t,16),_q(t,r));let i=e.cname;void 0!==i&&(_q(t,26),lq(t,i));let o=e.deviceId;void 0!==o&&(_q(t,34),lq(t,o));let a=e.elapse;void 0!==a&&(_q(t,40),gq(t,a));let s=e.fileSize;void 0!==s&&(_q(t,48),gq(t,eq(s)));let c=e.height;void 0!==c&&(_q(t,56),gq(t,eq(c)));let l=e.jpg;void 0!==l&&(_q(t,66),_q(t,l.length),function(e,t){let n=aq(e,t.length);e.bytes.set(t,n)}(t,l));let d=e.networkType;void 0!==d&&(_q(t,72),gq(t,eq(d)));let u=e.osType;void 0!==u&&(_q(t,80),gq(t,eq(u)));let h=e.requestId;void 0!==h&&(_q(t,90),lq(t,h));let p=e.sdkVersion;void 0!==p&&(_q(t,98),lq(t,p));let f=e.sequence;void 0!==f&&(_q(t,104),gq(t,eq(f)));let m=e.sid;void 0!==m&&(_q(t,114),lq(t,m));let _=e.timestamp;void 0!==_&&(_q(t,120),gq(t,_));let g=e.uid;void 0!==g&&(_q(t,128),_q(t,g));let v=e.vid;void 0!==v&&(_q(t,136),_q(t,v));let y=e.width;void 0!==y&&(_q(t,144),gq(t,eq(y)));let b=e.service;void 0!==b&&(_q(t,152),_q(t,b));let E=e.callbackData;void 0!==E&&(_q(t,162),lq(t,E));let S=e.jpgEncryption;void 0!==S&&(_q(t,168),_q(t,S));let T=e.requestType;void 0!==T&&(_q(t,176),_q(t,T));let w=e.scorePorn;void 0!==w&&(_q(t,185),fq(t,w));let C=e.scoreSexy;void 0!==C&&(_q(t,193),fq(t,C));let R=e.scoreNeutral;void 0!==R&&(_q(t,201),fq(t,R));let k=e.scene;void 0!==k&&(_q(t,208),_q(t,k));let O=e.ossFilePrefix;void 0!==O&&(_q(t,218),lq(t,O));let I=e.serviceVendor;if(void 0!==I)for(let N of I){_q(t,226);let e=nq();YK(N,e),_q(t,e.limit),dq(t,e),rq(e)}}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function KK(e){return function(e){let t={};e:for(;!oq(e);){let n=mq(e);switch(n>>>3){case 0:break e;case 1:t.code=mq(e);break;case 2:t.msg=cq(e,mq(e));break;case 3:{let n=JK(e);t.data=qK(e),e.limit=n;break}default:XK(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function qK(e){let t={};e:for(;!oq(e);){let n=mq(e);switch(n>>>3){case 0:break e;case 1:t.requestId=cq(e,mq(e));break;case 2:t.requestType=mq(e)>>>0;break;case 3:t.scorePorn=pq(e);break;case 4:t.scoreSexy=pq(e);break;case 5:t.scoreNeutral=pq(e);break;case 6:t.requestScene=mq(e)>>>0;break;case 7:t.scene=mq(e)>>>0;break;default:XK(e,7&n)}}return t}function YK(e,t){let n=e.service;void 0!==n&&(_q(t,8),_q(t,n));let r=e.vendor;void 0!==r&&(_q(t,16),_q(t,r));let i=e.token;void 0!==i&&(_q(t,26),lq(t,i));let o=e.callbackUrl;void 0!==o&&(_q(t,34),lq(t,o))}function JK(e){let t=mq(e),n=e.limit;return e.limit=e.offset+t,n}function XK(e,t){switch(t){case 0:for(;128&uq(e););break;case 2:iq(e,mq(e));break;case 5:iq(e,4);break;case 1:iq(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let QK=new Float32Array(1);new Uint8Array(QK.buffer);let ZK=new Float64Array(1),$K=new Uint8Array(ZK.buffer);function eq(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let tq=[];function nq(){const e=tq.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function rq(e){tq.push(e)}function iq(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function oq(e){return e.offset>=e.limit}function aq(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function sq(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function cq(e,t){let n=sq(e,t),r=String.fromCharCode,i=e.bytes,o="\ufffd",a="";for(let s=0;s<t;s++){let e,c,l,d,u=i[s+n];0==(128&u)?a+=r(u):192==(224&u)?s+1>=t?a+=o:(e=i[s+n+1],128!=(192&e)?a+=o:(d=(31&u)<<6|63&e,d<128?a+=o:(a+=r(d),s++))):224==(240&u)?s+2>=t?a+=o:(e=i[s+n+1],c=i[s+n+2],32896!=(49344&(e|c<<8))?a+=o:(d=(15&u)<<12|(63&e)<<6|63&c,d<2048||d>=55296&&d<=57343?a+=o:(a+=r(d),s+=2))):240==(248&u)?s+3>=t?a+=o:(e=i[s+n+1],c=i[s+n+2],l=i[s+n+3],8421504!=(12632256&(e|c<<8|l<<16))?a+=o:(d=(7&u)<<18|(63&e)<<12|(63&c)<<6|63&l,d<65536||d>1114111?a+=o:(d-=65536,a+=r(55296+(d>>10),56320+(1023&d)),s+=3))):a+=o}return a}function lq(e,t){let n=t.length,r=0;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}_q(e,r);let i=aq(e,r),o=e.bytes;for(let a=0;a<n;a++){let e=t.charCodeAt(a);e>=55296&&e<=56319&&a+1<n&&(e=(e<<10)+t.charCodeAt(++a)-56613888),e<128?o[i++]=e:(e<2048?o[i++]=e>>6&31|192:(e<65536?o[i++]=e>>12&15|224:(o[i++]=e>>18&7|240,o[i++]=e>>12&63|128),o[i++]=e>>6&63|128),o[i++]=63&e|128)}}function dq(e,t){let n=aq(e,t.limit),r=e.bytes,i=t.bytes;for(let o=0,a=t.limit;o<a;o++)r[o+n]=i[o]}function uq(e){return e.bytes[sq(e,1)]}function hq(e,t){let n=aq(e,1);e.bytes[n]=t}function pq(e){let t=sq(e,8),n=e.bytes;return $K[0]=n[t++],$K[1]=n[t++],$K[2]=n[t++],$K[3]=n[t++],$K[4]=n[t++],$K[5]=n[t++],$K[6]=n[t++],$K[7]=n[t++],ZK[0]}function fq(e,t){let n=aq(e,8),r=e.bytes;ZK[0]=t,r[n++]=$K[0],r[n++]=$K[1],r[n++]=$K[2],r[n++]=$K[3],r[n++]=$K[4],r[n++]=$K[5],r[n++]=$K[6],r[n++]=$K[7]}function mq(e){let t,n=0,r=0;do{t=uq(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function _q(e,t){for(t>>>=0;t>=128;)hq(e,127&t|128),t>>>=7;hq(e,t)}function gq(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=aq(e,o),s=e.bytes;switch(o){case 10:s[a+9]=i>>>7&1;case 9:s[a+8]=9!==o?128|i:127&i;case 8:s[a+7]=8!==o?r>>>21|128:r>>>21&127;case 7:s[a+6]=7!==o?r>>>14|128:r>>>14&127;case 6:s[a+5]=6!==o?r>>>7|128:r>>>7&127;case 5:s[a+4]=5!==o?128|r:127&r;case 4:s[a+3]=4!==o?n>>>21|128:n>>>21&127;case 3:s[a+2]=3!==o?n>>>14|128:n>>>14&127;case 2:s[a+1]=2!==o?n>>>7|128:n>>>7&127;case 1:s[a]=1!==o?128|n:127&n}}function vq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const yq=new Map([["moderation",1],["supervise",2]]);class bq extends BO{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(pj.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=ii(t=e.map((e=>yq.get(e)||0))).call(t,((e,t)=>e+t)),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(e){super(),uC(this,"name","AgoraRTCVideoContentInspect"),uC(this,"_connectionState",uj.CONNECTING),uC(this,"_innerConnectionState",void 0),uC(this,"sequence",0),uC(this,"inspectStartTime",void 0),uC(this,"workerManagerConnection",void 0),uC(this,"workerConnection",void 0),uC(this,"workerMessageLengthLimit",void 0),uC(this,"inspectIntervalMinimum",void 0),uC(this,"qualityRatio",void 0),uC(this,"_connectInfo",void 0),uC(this,"_cancelTokenSource",Mk.CancelToken.source()),uC(this,"_retryConfig",void 0),uC(this,"wmSequence",0),uC(this,"inspectInterval",void 0),uC(this,"inspectTimer",null),uC(this,"ossFilePrefix",void 0),uC(this,"extraInfo",void 0),uC(this,"_inspectType",void 0),uC(this,"_inspectMode",void 0),uC(this,"_quality",1),uC(this,"qualityTimer",null),uC(this,"_inspectId",void 0),uC(this,"_needWorkUrlOnly",!1),uC(this,"inspectImage",(()=>{if(this.connectionState!==uj.CONNECTED)throw new hA(CO.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===uj.CONNECTED?this.requestToInspectImage():rA.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=SI(5,"inspect-"),this.workerMessageLengthLimit=CN("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=CN("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=CN("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Vj("worker-manager-"+this._inspectId,jI),this.on(pj.STATE_CHANGE,((e,t)=>{this._innerConnectionState=e,rA.debug("[".concat(this._inspectId,"] Inspect operation :").concat(hj[e]," ").concat(t||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new Vj("worker-"+this._inspectId,jI),this.handleWorkerEvents()}async init(e,t){this.emit(pj.STATE_CHANGE,hj.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new np(((r,i)=>{this.on(pj.CONNECTION_STATE_CHANGE,((e,t)=>{t===uj.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorkerManager(e)})).catch((e=>{i(e)}))}))}async requestAP(e,t,n){const r=CN("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:a,sid:s,token:c,uid:l}=t;fV++;const d="image_moderation_api",u={service_name:d,json_body:JSON.stringify({appId:i,areaCode:o,cname:a,command:"allocateEdge",requestId:fV,seq:fV,sid:s,token:c,ts:Date.now(),uid:l+""})};let h,p,f=e[0];return VI((async()=>{h=Date.now();const e=await KU(f,{data:u,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new hA(CO.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:p});throw rA.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new hA(CO.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw rA.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new hA(CO.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:p});throw rA.error(e.toString()),e}const r=CN("VIDEO_INSPECT_WORKER_MANAGER_HOST"),i=CN("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(i||n)})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,responseTime:p}}),((t,n)=>(uA.apworkerEvent(s,{success:!0,sc:200,serviceName:d,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1)),((t,n)=>(uA.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:d,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==CO.OPERATION_ABORTED&&t.code!==CO.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(pj.STATE_CHANGE,hj.AP_CONNECTED);const{addressList:o}=i;return this.wmSequence++,o}async connectWorkerManager(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=t,this.emit(pj.STATE_CHANGE,hj.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(NM.CONNECTED,(async()=>{this.emit(pj.STATE_CHANGE,hj.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.4",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(NM.CLOSED,(()=>{this._innerConnectionState<hj.GET_WORKER_MANAGER_RESPONSE&&rA.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(NM.FAILED,(()=>{this._innerConnectionState<hj.GET_WORKER_MANAGER_RESPONSE&&rA.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(NM.RECONNECTING,(()=>{this._innerConnectionState<hj.GET_WORKER_MANAGER_RESPONSE&&rA.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(NM.ON_MESSAGE,(async e=>{this.emit(pj.STATE_CHANGE,hj.GET_WORKER_MANAGER_RESPONSE);const t=this.workerManagerConnection.url;this.workerManagerConnection.close();const n=JSON.parse(e.data);if(200!==n.code)throw rA.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new hA(CO.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&t))throw rA.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new hA(CO.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{const e=CN("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,r=t.replace(/:\d+\/?$/,":".concat(e));this.emit(pj.STATE_CHANGE,hj.CONNECT_WORKER,r),this._needWorkUrlOnly?this.emit(pj.REQUEST_NEW_WORKER_URL,r):await this.connectWorker(r)}})),this.workerManagerConnection.on(NM.WILL_RECONNECT,((e,t,n)=>{n(e)})),this.workerManagerConnection.on(NM.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}handleWorkerEvents(){this.workerConnection.on(NM.CONNECTED,(async()=>{this.emit(pj.STATE_CHANGE,hj.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=uj.CONNECTED})),this.workerConnection.on(NM.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){const n=KK(new Uint8Array(e.data));if(CN("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&rA.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),200===n.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(pj.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var t;const e={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},r=ii(t=Object.keys(e)).call(t,((t,n)=>e[t]>e[n]?t:n),"porn"),i=Object.keys(e).find((e=>e===r));this.emit(pj.INSPECT_RESULT,i)}else this.emit(pj.INSPECT_RESULT,void 0,new hA(CO.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(pj.INSPECT_RESULT,void 0,new hA(CO.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else rA.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(pj.INSPECT_RESULT,void 0,new hA(CO.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(NM.CLOSED,(()=>{this.connectionState=uj.CLOSED})),this.workerConnection.on(NM.FAILED,(()=>{this.connectionState=uj.CLOSED})),this.workerConnection.on(NM.RECONNECTING,(()=>{this.connectionState=this.connectionState===uj.CONNECTED?uj.RECONNECTING:uj.CONNECTING})),this.workerConnection.on(NM.WILL_RECONNECT,((e,t,n)=>{"recover"===e&&n(e),n("tryNext")})),this.workerConnection.on(NM.REQUEST_NEW_URLS,((e,t)=>{this.workerManagerConnection.close(),this.once(pj.REQUEST_NEW_WORKER_URL,(t=>{e([t])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((e=>{this.connectWorkerManager(e,!0)})).catch((e=>{t(e)}))}))}async requestToInspectImage(){this.sequence++;const e=iI(this,pj.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(pj.INSPECT_RESULT,void 0,new hA(CO.INVALID_OPERATION,"Only the track being played can be inspected"));const n=await this.generateRequestData(e,t);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(pj.INSPECT_RESULT,void 0,new hA(CO.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s}=t;const c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),d=await Kx(l,n,r),u=this.sequence+"-"+i+"-"+s+"-"+c+"-"+SI(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:(p=Number(c-this.inspectStartTime),{low:p|=0,high:p>>31,unsigned:p>=0}),fileSize:d.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:d,networkType:6,osType:7,requestId:u,sdkVersion:"4.23.4",sequence:this.sequence,sid:a,timestamp:XB(c),uid:s,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var p;void 0===this.extraInfo&&delete h.callbackData,void 0===this.ossFilePrefix&&delete h.ossFilePrefix;const f=zK(h);if(f.byteLength<this.workerMessageLengthLimit){if(CN("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vq(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},h);delete e.jpg,rA.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return f}{const t=this.quality*this.qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Mk.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=uj.CLOSED,this.emit(pj.STATE_CHANGE,hj.CLOSED)}}const Eq={name:"ContentInspect",create:function(e){let{config:t}=e;return function(e){if(!e)throw new hA(CO.INVALID_PARAMS,"inspectConfig is necessary.");if(!e.inspectType||!Array.isArray(e.inspectType))throw new hA(CO.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const t=[...new Set(e.inspectType)];t.forEach((e=>{var t;if(!Dr(t=["supervise","moderation"]).call(t,e))throw new hA(CO.INVALID_PARAMS,"".concat(e," is not a valid inspect type."))})),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new hA(CO.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new bq(t)}};var Sq=r(ee.Object.getOwnPropertySymbols),Tq=An,wq=Xn.indexOf,Cq=Hr,Rq=C([].indexOf),kq=!!Rq&&1/Rq([1],1,-0)<0;Tq({target:"Array",proto:!0,forced:kq||!Cq("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return kq?Rq(this,e,t)||0:wq(this,e,t)}});var Oq=er("Array","indexOf"),Iq=u,Nq=Oq,Aq=Array.prototype,xq=function(e){var t=e.indexOf;return e===Aq||Iq(Aq,e)&&t===Aq.indexOf?Nq:t},Pq=r(xq);function Dq(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==Pq(t).call(t,r))continue;n[r]=e[r]}return n}(e,t);if(Sq){var o=Sq(e);for(r=0;r<o.length;r++)n=o[r],-1===Pq(t).call(t,n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let Lq=class{get localCapabilities(){return dI(this._localCapabilities)}get rtpCapabilities(){return dI(this._rtpCapabilities)}get candidates(){return dI(this._candidates)}get iceParameters(){return dI(this._iceParameters)}get dtlsParameters(){return dI(this._dtlsParameters)}constructor(e){uC(this,"sessionDesc",void 0),uC(this,"_localCapabilities",void 0),uC(this,"_rtpCapabilities",void 0),uC(this,"_candidates",void 0),uC(this,"_iceParameters",void 0),uC(this,"_dtlsParameters",void 0),uC(this,"setup",void 0),uC(this,"currentMidIndex",void 0),uC(this,"cname","o/i14u9pJrxRKAsu"),uC(this,"firefoxSsrcMidMap",new Map),e=dI(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:o,direction:a,setup:s,videoCodec:c,audioCodec:l}=e;let d;this.setup=s,d=a===IM.RECEIVE_ONLY?MN("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"):MN("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=o;const u=a===IM.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=a===IM.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=a===IM.RECEIVE_ONLY?i.send.videoCodecs:CU(ij.VIDEO,u,h,c),f=a===IM.RECEIVE_ONLY?i.send.audioCodecs:CU(ij.AUDIO,u,h,l);for(const m of d.mediaDescriptions)m.attributes.iceUfrag=t.iceUfrag,m.attributes.icePwd=t.icePwd,m.attributes.fingerprints=n.fingerprints,m.attributes.candidates=r,m.attributes.setup=this.setup,"application"===m.media.mediaType&&(m.attributes.sctpPort="5000"),"video"===m.media.mediaType&&(m.media.fmts=p.map((e=>e.payloadType.toString(10))),m.attributes.payloads=p,m.attributes.extmaps=u.videoExtensions),"audio"===m.media.mediaType&&(m.media.fmts=f.map((e=>e.payloadType.toString(10))),m.attributes.payloads=f,m.attributes.extmaps=u.audioExtensions,wU(m));this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1}toString(){return jN(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every((e=>this.hasMid(e))):this.sessionDesc.mediaDescriptions.some((t=>t.attributes.mid===e))}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:o,ssrcGroups:a}=pU(t,this.cname,CN("SYNC_GROUP")?n:void 0),s=this.findPreloadMediaDesc(o);if(s){if(tO()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,s.attributes.mid),i&&(i.twcc||i.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(s,i),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,o,r);let n;return-1===t?(n=this.createOrRecycleSendMedia(e,o,a,"sendonly",r,i),this.updateBundleMids()):(n=dI(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=o,n.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,i)),tO()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,n.attributes.mid),{needExchangeSDP:!0,mid:n.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{e.attributes.ssrcs=[]})),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach((e=>{const i=e._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(i);let a,s=!1;-1===o?(s=!0,a=this.createOrRecycleRecvMedia(e,[],"recvonly",t,n),this.updateBundleMids()):(a=dI(this.sessionDesc.mediaDescriptions[o]),a.attributes.direction="recvonly"),r.push({mid:a.attributes.mid,needCreateTransceiver:s})})),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:o,relatedAddress:a,relatedPort:s,priority:c}=new RTCIceCandidate(e),l={foundation:null!=t?t:"",componentId:"1",transport:null!=n?n:"",priority:c?c+"":"",connectionAddress:null!=r?r:"",port:i?i+"":"",type:o?o+"":"",relAddr:null!=a?a:"",relPort:s?s+"":"",extension:{}};this.candidates.some((e=>e.priority===l.priority&&e.connectionAddress===l.connectionAddress&&e.port===l.port))||(this._candidates.push(l),this.sessionDesc.mediaDescriptions.forEach((e=>{e.attributes.candidates=this.candidates})))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const o=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,s=CU(o,a,this.localCapabilities.send,o===ij.AUDIO?i:r),c=o===ij.VIDEO?a.videoExtensions:a.audioExtensions,l="".concat(++this.currentMidIndex);let d={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,e);const u=this.findFirstClosedMedia(o);if(u){const e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Dr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Dr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex((r=>{const i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(tO()){if(i){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!e||e!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n}))}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex((t=>{const n=t.media.mediaType===e&&"0"!==t.media.port&&("recvonly"===t.attributes.direction||"sendrecv"===t.attributes.direction);return"0"!==t.attributes.mid&&"1"!==t.attributes.mid&&n}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=dI(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}createOrRecycleSendMedia(e,t,n,r,i,o){const a=this.rtpCapabilities.send,s=e===ij.VIDEO?a.videoCodecs:a.audioCodecs,c=e===ij.VIDEO?a.videoExtensions:a.audioExtensions;tO()&&(i="".concat(++this.currentMidIndex));let l={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};l=this.mungSendMediaDesc(l,o);const d=this.findFirstClosedMedia(e);if(d){const e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}mungRecvMediaDsec(e,t,n){const r=dI(e);return mU(r),fU(r,t),_U(r,t),gU(r),vU(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=dI(e);return vU(n,t,this.localCapabilities.recv),wU(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>tO()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}};const Mq=["sdp"];var jq;function Uq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Uq(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Uq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let Fq=(jq=class e extends nj{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),uC(this,"direction",void 0),uC(this,"name",void 0),uC(this,"store",void 0),uC(this,"spec",void 0),uC(this,"peerConnection",void 0),uC(this,"initialOffer",void 0),uC(this,"transport",void 0),uC(this,"statsFilter",void 0),uC(this,"localCandidateCount",0),uC(this,"_isInRestartIce",!1),uC(this,"mutex",void 0),uC(this,"onLocalCandidate",void 0),uC(this,"remoteSDP",void 0),uC(this,"pendingCandidates",[]),uC(this,"localCapabilities",void 0),uC(this,"isReady",!1),uC(this,"restartCnt",0),uC(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new LI("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=null!=r?r:IM.SEND_ONLY,this.name=this.direction===IM.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=hN(this.peerConnection,CN("STATS_UPDATE_INTERVAL"),void 0,tO()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const t=await bU();if(this.localCapabilities=TU(t),e){const{sdp:t}=e,n=Dq(e,Mq),r=function(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=cU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(SU(t,e,"videoExtensions",n,r,i),SU(t,e,"videoCodecs",n,r,i),SU(t,e,"audioExtensions",n,r,i),SU(t,e,"audioCodecs",n,r,i),CN("RAISE_H264_BASELINE_PRIORITY")){const e=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]));if(-1!==e){const t=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()));if(t<e){rA.debug("raising H264 baseline profile priority");const n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&CN("FILTER_SEND_H264_BASELINE")&&(n.videoCodecs=n.videoCodecs.filter((e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"]))))}}return{send:n,recv:r,sendrecv:i}}({},{},t);this.remoteSDP=new Lq({remoteIceParameters:n.iceParameters,remoteDtlsParameters:n.dtlsParameters,candidates:[],remoteRTPCapabilities:r,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const o=lU(i.sdp);await this.peerConnection.setLocalDescription(i);const a=await EU({},{},i.sdp);this.localCapabilities=TU(a);const s=this.peerConnection.getTransceivers()[0];return null!=s&&s.receiver&&s.receiver.transport&&this.tryBindTransportEvents(s.receiver.transport),Vq(Vq({},o),{},{sdp:i.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=lU(e.sdp);return this.initialOffer=e,Vq(Vq({},t),{},{sdp:e.sdp})}}catch(e){throw new RO(CO.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:t,iceParameters:n,dtlsParameters:r}=e,i=await EU({},{},t);this.remoteSDP=new Lq({remoteIceParameters:n,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:i,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const o=this.peerConnection.getTransceivers()[0];null!=o&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((e=>{this.peerConnection.addIceCandidate(e)})),this.pendingCandidates=[])}catch(e){throw new RO(CO.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return YR((function*(){const i=yield XR(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const i=[],o=r.remoteSDP.receive(e,t,n);e.forEach(((e,t)=>{if(o[t].needCreateTransceiver){const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});i.push(t),e._updateRtpTransceiver(t)}else{const n=r.peerConnection.getTransceivers().find((e=>e.mid===o[t].mid));if(!n)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(o[t].mid));i.push(n),e._updateRtpTransceiver(n)}})),tO()&&!0===CN("SIMULCAST")&&(yield XR(r.applySimulcastForFirefox(i,e)));const a=o.map((e=>e.mid)),s=yield XR(r.peerConnection.createOffer()),c=r.mungSendOfferSDP(s.sdp,e,a),l=MN(c),d=a.map((e=>{const t=l.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return dU(t,CN("USE_PUB_RTX"))})),u=i.map(((e,t)=>{const n=a[t];return{localSSRC:d[t],id:n}}));yield XR(r.peerConnection.setLocalDescription({type:"offer",sdp:c}));try{yield u}catch(e){const n=r.remoteSDP.toString();throw yield XR(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield XR(r.peerConnection.setRemoteDescription({type:"answer",sdp:n})),yield XR(r.stopSending(a,!0)),e}yield XR(r.applySimulcastEncodings(i,e)),yield XR(r.applySendEncodings(i,e));const h=r.remoteSDP.toString(),p=r.logSDPExchange(c,"offer","local","send");return null==p||p(h),yield XR(r.setRemoteDescription({type:"answer",sdp:h})),i.map(((e,t)=>{const n=a[t];return{localSSRC:d[t],id:n}}))}catch(e){throw e instanceof RO?e:new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length (".concat(t.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),rA.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else rA.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const a=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!a||null===a.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,mid:a.mid,transceiver:a}}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async mockReceive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),rA.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else rA.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===gN.Auto&&(this.store.p2pTransport=gN.SdRtn,fA().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,fA().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const e=await this.peerConnection.createOffer({iceRestart:!0});if(!e.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:t}=lU(e.sdp);return this.store.descriptionStart(),this.direction===IM.SEND_ONLY&&await this.peerConnection.setLocalDescription(e),t}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===IM.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const e=await this.peerConnection.createAnswer();if(!e.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:t}=lU(e.sdp);return await this.peerConnection.setLocalDescription(e),t}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?tO()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:Vq(Vq({},XI),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:Vq(Vq({},XI),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;Dr(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{var t;e.candidate?(e.candidate.candidate&&(null===(t=this.onLocalCandidate)||void 0===t||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1):rA.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i={iceServers:[]};var o;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(JO(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers,n,r)),CN("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),Dr(o=[gN.Relay,gN.SdRtn]).call(o,n)&&(i.iceTransportPolicy="relay"),CN("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(i.iceTransportPolicy="relay")})))),CN("ENABLE_ENCODED_TRANSFORM")&&fA().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),rA.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=[],i=e.filter((e=>e.tcpport));rA.debug("P2PConnection turnServers is ".concat(i,", current index is ").concat(n));const o=i.length>n?i[n]:i[0];switch(t){case gN.SdRtn:const t=e.filter((e=>{var t;return Dr(t=e.username).call(t,"glb:")&&e.turnServerURL==e.turnServerURL})),i=t.length>n?t[n]:t[0];i&&(r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(zj(i.turnServerURL),":").concat(i.tcpport,"?transport=udp")}),r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(zj(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}));break;case gN.Relay:o&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(zj(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(zj(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var t;null!=e&&e.state&&(null===(t=this.onDTLSTransportStateChange)||void 0===t||t.call(this,e.state))},e.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const t=e.iceTransport;t&&(t.onstatechange=()=>{const t=null==e?void 0:e.iceTransport.state;var n;t&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,t))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){const{local:e,remote:n}=t.getSelectedCandidatePair();rA.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>t.track===e._mediaStreamTrack))),!t)return rA.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return rA.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!fA().supportSetRtpSenderParameters)return rA.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},i={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var o;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(i.maxBitrate=1e3*t),Dr(o=e._hints).call(o,PA.LOW_STREAM)&&(n&&(i.maxFramerate=qj(n)),r&&r>=1&&(i.scaleResolutionDownBy=r))}if(CN("DSCP_TYPE")&&yO()){var a;const e=CN("DSCP_TYPE");Dr(a=["very-low","low","medium","high"]).call(a,e)&&(i.networkPriority=e)}const s=t.getParameters(),c=null===(n=s.encodings)||void 0===n?void 0:n[0];tO()&&!c&&(r.encodings=[i]),c&&Object.assign(c,i),Object.assign(s,r),rA.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(s.encodings))),await t.setParameters(s)}async applySendEncodings(e,t){try{if(!fA().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];i instanceof kD&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(e){rA.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=MN(e);return t.forEach(((e,t)=>{const i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&(fU(o,e),yU(o,e,this.store.codec))})),jN(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var n,r,i,o,a;const c=e[s],l=t[s];if(l instanceof kD&&!Dr(n=l._hints).call(n,PA.LOW_STREAM)&&null!==(r=l._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=l._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(a=l._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!tO()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof kD&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof kD&&CN("SIMULCAST")&&"vp8"===this.store.codec&&!Dr(t=e._hints).call(t,PA.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(CN("SDP_LOGGING"))return rA.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async e=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}async getRemoteSSRC(e,t){var n;if(t=null!=t?t:null===(n=this.currentRemoteDescription)||void 0===n?void 0:n.sdp){var r;const n=null===(r=MN(t).mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===r?void 0:r.attributes.ssrcs;return null==n?void 0:n[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),Dr(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,n){const r=MN(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&n===ij.AUDIO&&"audio"===i.media.mediaType&&wU(i),jN(r)}},vM(jq.prototype,"establish",[Bq],Object.getOwnPropertyDescriptor(jq.prototype,"establish"),jq.prototype),vM(jq.prototype,"connect",[Bq],Object.getOwnPropertyDescriptor(jq.prototype,"connect"),jq.prototype),vM(jq.prototype,"receive",[Bq],Object.getOwnPropertyDescriptor(jq.prototype,"receive"),jq.prototype),vM(jq.prototype,"mockReceive",[Bq],Object.getOwnPropertyDescriptor(jq.prototype,"mockReceive"),jq.prototype),vM(jq.prototype,"stopReceiving",[Bq],Object.getOwnPropertyDescriptor(jq.prototype,"stopReceiving"),jq.prototype),vM(jq.prototype,"restartICE",[Bq],Object.getOwnPropertyDescriptor(jq.prototype,"restartICE"),jq.prototype),vM(jq.prototype,"close",[Bq],Object.getOwnPropertyDescriptor(jq.prototype,"close"),jq.prototype),vM(jq.prototype,"updateEncoderConfig",[Bq],Object.getOwnPropertyDescriptor(jq.prototype,"updateEncoderConfig"),jq.prototype),vM(jq.prototype,"updateSendParameters",[Bq],Object.getOwnPropertyDescriptor(jq.prototype,"updateSendParameters"),jq.prototype),vM(jq.prototype,"replaceTrack",[Bq],Object.getOwnPropertyDescriptor(jq.prototype,"replaceTrack"),jq.prototype),vM(jq.prototype,"muteLocal",[Bq],Object.getOwnPropertyDescriptor(jq.prototype,"muteLocal"),jq.prototype),vM(jq.prototype,"unmuteLocal",[Bq],Object.getOwnPropertyDescriptor(jq.prototype,"unmuteLocal"),jq.prototype),jq);function Bq(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}let Wq=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var Gq,Hq,zq,Kq,qq,Yq,Jq,Xq,Qq,Zq,$q,eY;function tY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function nY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tY(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tY(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let rY=(Gq=iY(Wq.SEND_ONLY),Hq=iY(Wq.SEND_ONLY),zq=iY(),Kq=iY(Wq.RECEIVE_ONLY),qq=iY(Wq.RECEIVE_ONLY),Yq=iY(Wq.RECEIVE_ONLY),Jq=iY(Wq.RECEIVE_ONLY),Xq=iY(Wq.RECEIVE_ONLY),Qq=iY(Wq.RECEIVE_ONLY),Zq=iY(),$q=iY(Wq.RECEIVE_ONLY),eY=class extends BO{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(dj.StateChange,t,this._state)}constructor(e,t){super(),uC(this,"isPlanB",!1),uC(this,"store",void 0),uC(this,"statsUploader",void 0),uC(this,"sendConnection",void 0),uC(this,"recvConnection",void 0),uC(this,"localTrackMap",new Map),uC(this,"remoteUserMap",new Map),uC(this,"localDataChannels",[]),uC(this,"pendingLocalTracks",[]),uC(this,"pendingRemoteTracks",[]),uC(this,"statsCollector",void 0),uC(this,"dtlsFailedCount",0),uC(this,"sendMutex",void 0),uC(this,"recvMutex",void 0),uC(this,"_state",lj.Disconnected),uC(this,"_restartStates",["disconnected","failed"]),uC(this,"reconnectInterval",void 0),uC(this,"uploadUnplinkStarted",!1),uC(this,"uploadDownlinkStarted",!1),uC(this,"uplinkStateUploadInterval",void 0),uC(this,"downlinkStatsUploadInterval",void 0),uC(this,"handleMuteLocalTrack",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==lj.Connected)return void n(new RO(CO.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const a=r.find((e=>"videoLowTrack"===e[0]));a&&a[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(r.map((e=>{let[,{id:t}]=e;return t})));let s=!1;var i,o;s="video"===e.trackMediaType?!(null===(i=this.localTrackMap.get(cj.LocalAudioTrack))||void 0===i||!i.track._muted):void 0===(null===(o=this.localTrackMap.get(cj.LocalVideoTrack))||void 0===o?void 0:o.id);const c=this.createMuteMessage(r);await rI(this,dj.RequestMuteLocal,c);const l="video"===e.trackMediaType?Ej.MUTE_LOCAL_VIDEO:Ej.MUTE_LOCAL_AUDIO;await rI(this,dj.RequestP2PMuteLocal,{action:l,message:c,isMuteAll:s}),t()}catch(e){n(e)}finally{r()}})),uC(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==lj.Connected)return void n(new RO(CO.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();await this.sendConnection.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const i=this.createUnmuteMessage(r),o="video"===e.trackMediaType?Ej.UNMUTE_LOCAL_VIDEO:Ej.UNMUTE_LOCAL_AUDIO;await rI(this,dj.RequestP2PMuteLocal,{action:o,message:i}),t()}catch(e){n(e)}finally{r()}})),uC(this,"handleUpdateVideoEncoder",(async(e,t,n,r)=>{let i;"boolean"==typeof r&&r||(i=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const n=this.localTrackMap.get(cj.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==lj.Connected)return void t();const{id:r,track:i}=n;r&&(await this.sendConnection.updateSendParameters(r,i),await this.sendConnection.updateEncoderConfig(r,i),this.emit(dj.UpdateVideoEncoder,i)),t()}catch(e){n(e)}finally{var o;null===(o=i)||void 0===o||o()}})),uC(this,"handleUpdateVideoSendParameters",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get(cj.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==lj.Connected)return void t();const{id:r,track:i}=n;r&&await this.sendConnection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}})),uC(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;rA.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var o;const n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.sendConnection||!n||void 0===n[1].id||this.state!==lj.Connected)return void t();if(await(null===(o=this.sendConnection)||void 0===o?void 0:o.replaceTrack(e,n[1].id)),n[0]===cj.LocalVideoTrack&&fA().supportDualStreamEncoding){const t=this.localTrackMap.get(cj.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new np(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(e){n(e)}finally{var a;null===(a=i)||void 0===a||a()}})),uC(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),uC(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),uC(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),uC(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new kF(e),this.bindStatsUploaderEvents(),this.sendMutex=new LI("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new LI("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval((()=>{[this.sendConnection,this.recvConnection].forEach((e=>{e&&("disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))}))}),CN("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new RO(CO.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new RO(CO.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(rA.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Fq(e,this.store,IM.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=lj.New,this.sendConnection&&(rA.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Fq(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const t=await this.sendConnection.establish();return{iceParameters:t.iceParameters,dtlsParameters:t.dtlsParameters,sdp:t.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new RO(CO.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=lj.Connected}async addRemoteCandidate(e,t){if(t===IM.RECEIVE_ONLY){if(!this.sendConnection)throw new RO(CO.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new RO(CO.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return YR((function*(){const i=yield XR(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==lj.Connected){r.throwIfTrackTypeNotMatch(e);const t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,xV.markPublishStart(r.store.clientId,r.store.pubId);const i=r.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield XR(r.tryToUnmuteAudio(e)));i.forEach((e=>{let{track:t,type:n}=e;const i=Date.now();r.store.publish(t.getTrackId(),n===cj.LocalAudioTrack?"audio":"video",i)})),r.bindLocalTrackEvents(i);const o=yield XR(r.sendConnection.send(i.map((e=>{let{track:t}=e;return t})),r.store.codec,r.store.audioCodec)),a=(yield XR(o.next())).value,s=r.createGatewayPublishMessage(i,a);try{yield s}catch(e){throw o.throw(e),(null==e?void 0:e.code)===CO.WS_ABORT&&i.forEach((e=>{let{track:t}=e;-1===r.pendingLocalTracks.indexOf(t)&&r.pendingLocalTracks.push(t)})),r.unbindLocalTrackEvents(i),e}yield XR(o.next()),i.forEach((e=>{let{type:t}=e;r.statsCollector.addLocalStats(t)})),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(i,a),i.forEach((e=>{let{track:t,type:n}=e;const i=Date.now();r.store.publish(t.getTrackId(),n===cj.LocalAudioTrack?"audio":"video",void 0,i)})),r.startUploadUplinkState()}finally{i()}}))()}async unpublish(e){if(!this.sendConnection||this.state!==lj.Connected)return void(0===e.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((t=>!Dr(e).call(e,t))));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find((e=>"videoLowTrack"===e[0]));n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===lj.Connected)return n&&n[1].track.close(),r;e.forEach((e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}))}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const e=[],t=[];Array.from(this.localTrackMap.entries()).forEach((n=>{let[r,{track:i,ssrcs:o}]=n;const a={stream_type:nF(i,r),ssrcs:o};i._muted||!i._enabled?e.push(a):t.push(a)})),e.length>0&&e.forEach((e=>{rI(this,dj.RequestMuteLocal,[e])})),t.length>0&&t.forEach((e=>{rI(this,dj.RequestUnmuteLocal,[e])}))};e(),this.uplinkStateUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return YR((function*(){throw new RO(CO.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(rA.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await nI(this,dj.RequestRePublish,this.pendingLocalTracks),this.emit(dj.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new RO(CO.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new RO(CO.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(i=this.remoteUserMap.get(e))&&void 0!==i&&i.has(t))return;const{track:o,mid:a,transceiver:s}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===ij.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new HD(o,e.uid,e._uintid,this.store),rA.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),s&&e._audioTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new GD(o,e.uid,e._uintid,this.store),rA.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),s&&e._videoTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._videoTrack));const c=this.remoteUserMap.get(e);c?c.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const l=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(dj.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new RO(CO.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.recvConnection||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===ij.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===ij.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);0!==i.length&&(await this.recvConnection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach((e=>{let[t,{kind:r}]=e;var i,o;if(r===ij.VIDEO&&t._videoSSRC&&(null===(i=this.recvConnection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===ij.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(o=t._videoTrack)||void 0===o||o._destroy(),t._videoTrack=void 0);else if(r===ij.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}})),i.forEach((e=>{let[,{kind:t}]=e;rI(this,dj.RequestP2PMuteRemote,t)})))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach((e=>{let[,t]=e;[ij.VIDEO,ij.AUDIO].forEach((e=>{t.has(e)?rI(this,dj.RequestP2PUnmuteRemote,e):rI(this,dj.RequestP2PMuteRemote,e)}))}));e(),this.downlinkStatsUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new RO(CO.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new RO(CO.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new RO(CO.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new RO(CO.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void rA.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void rA.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===ij.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||rA.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):rA.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get(cj.LocalAudioTrack);if((null==t?void 0:t.track)instanceof UP){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==cj.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===cj.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===cj.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get(cj.LocalAudioTrack),o=r?this.localTrackMap.get(cj.LocalVideoLowTrack):this.localTrackMap.get(cj.LocalVideoTrack);uA.publish(this.store.sessionId,{eventElapse:xV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(PA.SCREEN_TRACK)),audio:!!n,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);const a=n.find((e=>e instanceof LP)),s=r?null===(o=this.localTrackMap.get(cj.LocalVideoTrack))||void 0===o?void 0:o.track:n.find((e=>e instanceof kD));uA.publish(this.store.sessionId,{eventElapse:xV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==s?void 0:s.getTrackLabel(),screenshare:-1!==(null==s?void 0:s._hints.indexOf(PA.SCREEN_TRACK)),audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===ij.VIDEO?n._videoSSRC:n._audioSSRC;i&&uA.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===ij.VIDEO,audio:r===ij.AUDIO,peerid:n.uid,subscribeRequestid:r===ij.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:xV.measureFromSubscribeStart(this.store.clientId,i)})}reset(){rA.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new LI("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new LI("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(cj.LocalAudioTrack);if((null==e?void 0:e.track)instanceof UP){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=lj.Disconnected}getStats(e){var t,n;return e?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(cj.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(cj.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof kD||t&&t.track instanceof LP?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(KN(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(cj.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Jp(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(rA.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=lj.Reconnecting,CN("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case cj.LocalVideoTrack:Dr(t=r._hints).call(t,PA.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case cj.LocalAudioTrack:r instanceof UP?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case cj.LocalVideoLowTrack:}})),this.emit(dj.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(KN(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(dj.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),rA.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof UV?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===IM.SEND_ONLY){if(!this.sendConnection)throw new RO(CO.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new RO(CO.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const e=await r.restartICE(t);return r.isInRestartIce=!1,e}{const e=await r.restartICE();if(e){const t=await nI(this,dj.RequestP2PRestartICE,{direction:IM.RECEIVE_ONLY,iceParameter:e});await r.restartICE(t),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(cj.LocalVideoTrack),n=this.localTrackMap.get(cj.LocalAudioTrack),r=e.videoSend.find((e=>{var n;return e.ssrc===(null==t||null===(n=t.ssrcs)||void 0===n?void 0:n[0].ssrcId)})),i=e.audioSend.find((e=>{var t;return e.ssrc===(null==n||null===(t=n.ssrcs)||void 0===t?void 0:t[0].ssrcId)}));if(!r||!i)return 1;const o=iI(this,dj.NeedSignalRTT),a=r?r.rttMs:void 0,s=i?i.rttMs:void 0,c=a&&s?(a+s)/2:a||s,l=(c&&o?(c+o)/2:c||o)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(PA.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return AL[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,o=r._videoSSRC,a=e.audioRecv.find((e=>e.ssrc===i)),s=e.videoRecv.find((e=>e.ssrc===o));if(!a&&!s)return void(t+=1);const c=iI(this,dj.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=a?a.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new np(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}filterTobePublishedTracks(e,t,n){const r=[],i=fA(),o=this.getAllTracks();e=cI(e=e.filter((e=>-1===o.indexOf(e))));let a=!1,s=!1;for(const c of e){if(c instanceof kD&&(this.localTrackMap.has(cj.LocalVideoTrack)||a?new RO(CO.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:cj.LocalVideoTrack}),a=!0),t)){const e=this.getLowVideoTrack(c,n);r.push({track:e,type:cj.LocalVideoLowTrack})}if(c instanceof LP){const e=this.localTrackMap.get(cj.LocalAudioTrack);if(e){if(!(e.track instanceof UP))throw new RO(CO.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new RO(CO.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(s){const e=r.find((e=>{let{type:t}=e;return t===cj.LocalAudioTrack}));if(!(e.track instanceof UP))throw new RO(CO.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new RO(CO.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c)}else{if(!i.webAudioMediaStreamDest||c instanceof UP||c._bypassWebAudio)r.push({track:c,type:cj.LocalAudioTrack});else{const e=new UP;e.addAudioTrack(c),r.push({track:e,type:cj.LocalAudioTrack})}s=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=cI(e=e.filter((e=>-1!==n.indexOf(e))));for(const r of e){if(r instanceof LP){const e=this.localTrackMap.get(cj.LocalAudioTrack);if(!e)continue;e.track instanceof UP?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([cj.LocalAudioTrack,e]),e.track.close())):t.push([cj.LocalAudioTrack,e])}if(r instanceof kD){const e=this.localTrackMap.get(cj.LocalVideoTrack);if(!e)continue;t.push([cj.LocalVideoTrack,e]);const n=this.localTrackMap.get(cj.LocalVideoLowTrack);n&&t.push([cj.LocalVideoLowTrack,n])}}return t}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case cj.LocalVideoTrack:t.addListener(xA.GET_STATS,this.handleGetLocalVideoStats),t.addListener(xA.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(xA.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(xA.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(xA.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(xA.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(xA.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(xA.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case cj.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case cj.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof UP?e.trackList.forEach((e=>{e.addListener(xA.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(xA.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(xA.GET_STATS,this.handleGetLocalAudioStats),e.addListener(xA.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(xA.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(xA.GET_STATS,this.handleGetLocalAudioStats),e.addListener(xA.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(xA.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(xA.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(xA.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(xA.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case cj.LocalVideoTrack:t.off(xA.GET_STATS,this.handleGetLocalVideoStats),t.off(xA.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(xA.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(xA.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(xA.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(xA.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(xA.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(xA.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case cj.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case cj.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof UP?e.trackList.forEach((e=>{e.off(xA.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(xA.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(xA.GET_STATS,this.handleGetLocalAudioStats),e.off(xA.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(xA.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(xA.GET_STATS,this.handleGetLocalAudioStats),e.off(xA.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(xA.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(xA.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(xA.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(xA.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof GD&&t.addListener(xA.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof HD&&t.addListener(xA.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(xA.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(ij.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(ij.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{var r;let i,{track:o,type:a}=e;switch(a){case cj.LocalAudioTrack:i=KM.Audio;break;case cj.LocalVideoTrack:i=Dr(r=o._hints).call(r,PA.SCREEN_TRACK)?KM.Screen:KM.High;break;case cj.LocalVideoLowTrack:i=KM.Low}return{kind:a===cj.LocalAudioTrack?ij.AUDIO:ij.VIDEO,stream_type:i,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:o.muted||!o.enabled}}))}createGatewayUnpublishMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case cj.LocalVideoTrack:n=Dr(t=i._hints).call(t,PA.SCREEN_TRACK)?KM.Screen:KM.High;break;case cj.LocalAudioTrack:n=KM.Audio;break;case cj.LocalVideoLowTrack:n=KM.Low}return{stream_type:n,ssrcs:o,mid:a}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;rA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(dj.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(e.isInRestartIce=!1),Dr(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&("disconnected"===t&&await EI(800),"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),rA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),uA.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:zO.TRACER}).onSuccess(),this.emit(dj.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{rA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{rA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{rA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(KN(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(VA.FIRST_FRAME_DECODED),uA.firstRemoteFrame(this.store.sessionId,sA.FIRST_AUDIO_DECODE,cA.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:xV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(KN(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&uA.firstRemoteFrame(this.store.sessionId,sA.FIRST_AUDIO_RECEIVED,cA.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:xV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(KN(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&uA.firstRemoteFrame(this.store.sessionId,sA.FIRST_VIDEO_RECEIVED,cA.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:xV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(dj.ConnectionTypeChange,n),rA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify($j(t))," -> ").concat(JSON.stringify($j(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{rA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify($j(t))," -> ").concat(JSON.stringify($j(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(dj.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===IM.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,rA.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===IM.SEND_ONLY?this.restartICE(e):nI(this,dj.RequestP2PRestartICE,{direction:IM.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(cj.LocalAudioTrack);if(e instanceof LP&&(null==n?void 0:n.track)instanceof UP)return n.track.isActive||t.push([cj.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===cj.LocalVideoTrack)){const e=this.localTrackMap.get(cj.LocalVideoLowTrack);e&&t.push([cj.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(cj.LocalAudioTrack);if(e instanceof LP&&(null==n?void 0:n.track)instanceof UP)return n.track.isActive&&t.push([cj.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===cj.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get(cj.LocalVideoLowTrack);e&&t.push([cj.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case cj.LocalAudioTrack:n=KM.Audio;break;case cj.LocalVideoTrack:n=Dr(t=i._hints).call(t,PA.SCREEN_TRACK)?KM.Screen:KM.High;break;case cj.LocalVideoLowTrack:n=KM.Low}return{stream_type:n,ssrcs:o,mid:a}}))}createUnmuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case cj.LocalAudioTrack:n=KM.Audio;break;case cj.LocalVideoTrack:n=Dr(t=i._hints).call(t,PA.SCREEN_TRACK)?KM.Screen:KM.High;break;case cj.LocalVideoLowTrack:n=KM.Low}return{stream_type:n,ssrcs:o,mid:a}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}createUnsubscribeMessage(e){const t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case ij.VIDEO:return void(n._videoSSRC&&t.push({stream_type:ij.VIDEO,ssrcId:n._videoSSRC}));case ij.AUDIO:return void(n._audioSSRC&&t.push({stream_type:ij.AUDIO,ssrcId:n._audioSSRC}))}})),t}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(cj.LocalVideoTrack),n=this.localTrackMap.get(cj.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new np(((e,n)=>{this.handleUpdateVideoEncoder(t.track,e,n,!0)}))),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new np(((e,t)=>{this.handleUpdateVideoEncoder(n.track,e,t,!0)})))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return"connected"!==e&&"connected"!==t}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof LP){const n=this.filterTobeUnmutedTracks(e[t]);if(0===n.length)continue;const r=this.createUnmuteMessage(n);return void await rI(this,dj.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((e=>{let[,{ssrcs:t}]=e;return!!t})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.recvConnection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(dj.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(dj.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await EI(UI(this.dtlsFailedCount,jI)),this.emit(dj.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(cj.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof kD))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof kD)).length>1)throw new RO(CO.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof LP)).length>1&&(e.some((e=>e instanceof LP&&e._bypassWebAudio))||!fA().webAudioMediaStreamDest))throw new RO(CO.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof kD&&this.pendingLocalTracks.some((e=>e instanceof kD)))throw new RO(CO.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof LP&&this.pendingLocalTracks.some((e=>e instanceof LP))&&(!fA().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof LP&&e._bypassWebAudio))))throw new RO(CO.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!CN("DISABLE_DUAL_STREAM_USE_ENCODING")&&fA().supportDualStreamEncoding,r=nY(nY({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():fF(e,r);const o=SI(8,"track-low-"),a=new kD(i,nY(nY({},n&&{scaleResolutionDownBy:Zj(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,o);return a.on(jA.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,DA.LOW_STREAM)})),a._hints.push(PA.LOW_STREAM),e.addListener(xA.NEED_CLOSE,(()=>{a.close()})),a}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const o=Array.from(KN(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,a=i.subscribe.find((e=>e.userId===o.uid&&"video"===e.type));uA.firstRemoteVideoDecode(this.store.sessionId,sA.FIRST_VIDEO_DECODE,cA.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:xV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const o=await this.recvConnection.getRemoteSSRC(i);return void 0!==o&&o!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new RO(CO.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new RO(CO.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new RO(CO.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new RO(CO.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new RO(CO.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new RO(CO.NOT_SUPPORTED)}async preConnect(e){throw new RO(CO.NOT_SUPPORTED)}getEstablishParams(){throw new RO(CO.NOT_SUPPORTED)}async reSubscribe(e){throw new RO(CO.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new RO(CO.NOT_SUPPORTED)}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===cj.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,DA.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},vM(eY.prototype,"p2pConnect",[Gq],Object.getOwnPropertyDescriptor(eY.prototype,"p2pConnect"),eY.prototype),vM(eY.prototype,"unpublish",[Hq],Object.getOwnPropertyDescriptor(eY.prototype,"unpublish"),eY.prototype),vM(eY.prototype,"unpublishLowStream",[zq],Object.getOwnPropertyDescriptor(eY.prototype,"unpublishLowStream"),eY.prototype),vM(eY.prototype,"subscribe",[Kq],Object.getOwnPropertyDescriptor(eY.prototype,"subscribe"),eY.prototype),vM(eY.prototype,"mockSubscribe",[qq],Object.getOwnPropertyDescriptor(eY.prototype,"mockSubscribe"),eY.prototype),vM(eY.prototype,"unsubscribe",[Yq],Object.getOwnPropertyDescriptor(eY.prototype,"unsubscribe"),eY.prototype),vM(eY.prototype,"muteRemote",[Jq],Object.getOwnPropertyDescriptor(eY.prototype,"muteRemote"),eY.prototype),vM(eY.prototype,"unmuteRemote",[Xq],Object.getOwnPropertyDescriptor(eY.prototype,"unmuteRemote"),eY.prototype),vM(eY.prototype,"hasRemoteMediaWithLock",[Qq],Object.getOwnPropertyDescriptor(eY.prototype,"hasRemoteMediaWithLock"),eY.prototype),vM(eY.prototype,"disconnectForReconnect",[Zq],Object.getOwnPropertyDescriptor(eY.prototype,"disconnectForReconnect"),eY.prototype),vM(eY.prototype,"remoteMediaSsrcChanged",[$q],Object.getOwnPropertyDescriptor(eY.prototype,"remoteMediaSsrcChanged"),eY.prototype),eY);function iY(e){return function(t,n,r){const i=t[n];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];switch(e){case Wq.SEND_ONLY:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}case Wq.RECEIVE_ONLY:{const e=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}default:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n)),t=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e(),t()}}}},r}}class oY extends BO{constructor(e,t){super(),uC(this,"signal",void 0),uC(this,"token",void 0),uC(this,"tokenTimeout",void 0),uC(this,"tokenInterval",void 0),uC(this,"_sequence",0),uC(this,"userMap",new Map),uC(this,"encoder",new TextEncoder),this.signal=e,this.token=t;const n=()=>{this.signal.connectionState===wM.CONNECTED&&this.check(),0===this.userMap.size?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*CN("P2P_TOKEN_INTERVAL"))};n()}async send(e,t,n,r,i){var o;if(0===this.userMap.size)return;const a=Array.from(up(o=this.userMap).call(o))[0].token;"string"!=typeof t&&(t=JSON.stringify(t)),r=null!=r?r:SI(6,""),i=null!=i?i:this._sequence++;const s={_id:r,_type:e,_seq:i,_message:t,token:"".concat(this.token,"_").concat(a)};CN("SHOW_P2P_LOG")&&rA.debug("send message",s,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(s)).forEach((e=>{this.signal.request(RM.DATA_STREAM,{payload:mI(this.encoder.encode(e))})}));const c=new np(((t,i)=>{const o=window.setTimeout((()=>{this.off("res-@".concat(r,"_ack"),a),this.off("res-@".concat(r),l),this.off(bj.ABORT,c),rA.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),0===this.userMap.size?i(new RO(CO.INVALID_REMOTE_USER)):i(new RO(CO.TIMEOUT))}),CN("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),a=()=>{o&&window.clearTimeout(o),this.off(bj.ABORT,c),n&&t()},c=()=>{o&&window.clearTimeout(o),this.off("res-@".concat(r,"_ack"),a),this.off("res-@".concat(r),l),i(new RO(CO.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(bj.ABORT,c),this.once("res-@".concat(r,"_ack"),a);const l=(n,s)=>{d=!0,o&&window.clearTimeout(o),this.off("res-@".concat(r,"_ack"),a),this.off(bj.ABORT,c),"success"===n?t(s):i(new RO(CO.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let d=!1;n||(this.once("res-@".concat(r),l),EI(CN("SIGNAL_REQUEST_TIMEOUT")).then((()=>{d||rA.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(s))})))}));try{return await c}catch(o){if(o.code===CO.TIMEOUT)return await this.send(e,t,n,r,i);throw o}}onMessage(e){var t;const{_uid:n}=e;let r,i=this.userMap.get(n);if(i)r=i.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==yj.CHECK)return;const{token:t}=e;r=new Map,i={uid:n,isStart:!0,token:t,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n,i),this.signal.emit(OM.ON_USER_ONLINE,{uid:n}),this.handleUserOnline()}if("id"in e&&"total"in e){var o;const{id:t,total:i}=e,a=null!==(o=r.get(t))&&void 0!==o?o:[];if(a.push(e),r.has(t)||r.set(t,a),a.length!==i)return;{const i=Jp(a).call(a,((e,t)=>e.index-t.index)).map((e=>e.payload)).join("");r.delete(t),(e=JSON.parse(i))._uid=n}}const{_type:a,token:s}=e;if(Dr(t=[yj.ACK,yj.CHECK]).call(t,a))return a===yj.CHECK&&this.handleCheckToken(i,s),void this.receiveMessage(e);s==="".concat(i.token,"_").concat(this.token)?this.handleReceivedMessage(e):rA.debug('Receive unexpected message", '.concat(s,", cur_token: ").concat(i.token,"_").concat(this.token),e)}check(){const e={_id:SI(6,""),token:this.token,_type:yj.CHECK};CN("SHOW_P2P_LOG")&&rA.debug("send message",e),this.signal.request(RM.DATA_STREAM,{payload:mI(this.encoder.encode(JSON.stringify(e)))})}ack(e){const t={_id:e,_type:yj.ACK,token:this.token};CN("SHOW_P2P_LOG")&&rA.debug("send message",t),this.signal.request(RM.DATA_STREAM,{payload:mI(this.encoder.encode(JSON.stringify(t)))})}response(e,t,n){this.send(yj.RESPONSE,JSON.stringify({success:!n,message:t}),!0,e)}handleReceivedMessage(e){const t=()=>{this.userMap.forEach((e=>{const{receivedMessagesMap:t,nextExpectedSequenceNumber:n}=e;for(;t.has(n);){const r=t.get(n);t.delete(n),this.receiveMessage(r),e.nextExpectedSequenceNumber++}}))};if(!e)return void t();const{_uid:n,_seq:r}=e,i=this.userMap.get(n),{receivedMessagesMap:o,isStart:a,nextExpectedSequenceNumber:s}=i;if(r<s)return this.ack(e._id),void rA.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));o.set(r,e),a&&r===s&&(this.receiveMessage(e),o.delete(s),i.nextExpectedSequenceNumber++,t())}receiveMessage(e){const{_id:t,_type:n,_message:r,_uid:i}=e;if(CN("SHOW_P2P_LOG")&&rA.debug("receive message",e),t){let o;switch(e._type!==yj.ACK&&(r&&(o=JSON.parse(r)),this.ack(e._id)),e._type){case yj.CANDIDATE:case yj.CONTROL:this.signal.emit(n,o,i);break;case yj.PUBLISH:case yj.UNPUBLISH:case yj.RESTART_ICE:case yj.CALL:o.uid=i,nI(this.signal,n,o).then((t=>{this.response(e._id,t)})).catch((()=>{this.response(e._id,void 0,!0)}));break;case yj.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case yj.RESPONSE:{const{success:e,message:n}=o;this.emit("res-@".concat(t),e?"success":"failed",n);break}}}}splitMessage(e){if(e.length<oY.MAX_MESSAGE_SIZE)return[e];const t=[],{remoteToken:n}=JSON.parse(e),r=SI(6,"");let i=0,o=800;const a=Math.ceil(e.length/o);for(;e.length>0;){i++;const s={id:r,index:i,total:a,payload:e.slice(0,o),token:"".concat(this.token,"_").concat(n)};JSON.stringify(s).length>oY.MAX_MESSAGE_SIZE?o-=50:(t.push(s),e=e.slice(o))}return t.map((e=>JSON.stringify(e)))}handleCheckToken(e,t){return e.token!==t?(rA.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((()=>{rA.debug("token timeout, ".concat(t)),this.reset(e.uid)}),CN("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await nI(this.signal,yj.CALL,void 0),t=await this.send(yj.CALL,e);this.signal.emit(CM.P2P_CONNECTION,t,!0)}async reset(e,t){const n=this.userMap.get(e);n&&(this.emit(bj.ABORT),this.signal.emit(OM.ON_USER_OFFLINE,{uid:n.uid,reason:Sj.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(rA.debug("change local token from ".concat(t," to ").concat(t)),this.token=SI(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(bj.ABORT)}}uC(oY,"MAX_SIZE",1),uC(oY,"MAX_MESSAGE_SIZE",1024);class aY extends BO{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===wM.CONNECTED?this.emit(CM.WS_CONNECTED):e===wM.RECONNECTING?this.emit(CM.WS_RECONNECTING,this._websocketReconnectReason):e===wM.CLOSED&&this.emit(CM.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),uC(this,"_disconnectedReason",void 0),uC(this,"_websocketReconnectReason",void 0),uC(this,"_connectionState",wM.CLOSED),uC(this,"reconnectToken",void 0),uC(this,"p2pToken",void 0),uC(this,"websocket",void 0),uC(this,"openConnectionTime",void 0),uC(this,"clientId",void 0),uC(this,"lastMsgTime",Date.now()),uC(this,"uploadCache",[]),uC(this,"uploadCacheInterval",void 0),uC(this,"rttRolling",new BI(5)),uC(this,"pingpongTimer",void 0),uC(this,"pingpongTimeoutCount",0),uC(this,"joinResponse",void 0),uC(this,"multiIpOption",void 0),uC(this,"initError",void 0),uC(this,"spec",void 0),uC(this,"store",void 0),uC(this,"_external_signal",void 0),uC(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(CM.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case OM.ON_DATA_STREAM:return void this.handleDataStream(t._message);case OM.MUTE_AUDIO:case OM.MUTE_VIDEO:case OM.ON_P2P_LOST:case OM.ON_USER_ONLINE:return;case OM.ON_USER_OFFLINE:const{uid:e}=t._message;return rA.debug("[".concat(this.clientId,"] user-offline uid: ").concat(e)),void this._external_signal.reset(e)}if(this.emit(t._type,t._message),t._type===OM.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===OM.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(YO.UID_BANNED);break;case 15:this.close(YO.IP_BANNED);break;case 16:this.close(YO.CHANNEL_BANNED)}if(t._type===OM.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case TM.ERR_LICENSE_MISSING:this.close(YO.LICENSE_MISSING);break;case TM.ERR_LICENSE_EXPIRED:this.close(YO.LICENSE_EXPIRED);break;case TM.ERR_LICENSE_MINUTES_EXCEEDED:this.close(YO.LICENSE_MINUTES_EXCEEDED);break;case TM.ERR_LICENSE_PERIOD_INVALID:this.close(YO.LICENSE_PERIOD_INVALID);break;case TM.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(YO.LICENSE_MULTIPLE_SDK_SERVICE);break;case TM.ERR_LICENSE_ILLEGAL:this.close(YO.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new Uj("gateway-".concat(this.clientId),this.spec.retryConfig,!0,CN("JOIN_GATEWAY_USE_DUAL_DOMAIN"),CN("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===wM.CONNECTED&&this.reconnect("retry",$O.OFFLINE)})),this.p2pToken=SI(6,""),this._external_signal=new oY(this,this.p2pToken)}async request(e,t,n,r){const i=SI(6,""),o={_id:i,_type:e,_message:t},a=this.websocket.connectionID,s=()=>new np(((e,t)=>{if(this.connectionState===wM.CONNECTED)return e();const n=()=>{this.off(CM.WS_CLOSED,r),e()},r=()=>{this.off(CM.WS_CONNECTED,n),t(new RO(CO.WS_ABORT))};this.once(CM.WS_CONNECTED,n),this.once(CM.WS_CLOSED,r)}));if(this.connectionState!==wM.CONNECTING&&this.connectionState!==wM.RECONNECTING||e===RM.JOIN||e===RM.REJOIN||await s(),this.websocket.sendMessage(o,!0),r)return;const c=new np(((n,r)=>{let o=!1;const s=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(CM.WS_CLOSED,c),this.off(CM.WS_RECONNECTING,c),this.emit(CM.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),s);const c=()=>{r(new RO(CO.WS_ABORT,"type: ".concat(e))),this.off(CM.WS_CLOSED,c),this.off(CM.WS_RECONNECTING,c),this.off("res-@".concat(i),s)};this.once(CM.WS_CLOSED,c),this.once(CM.WS_RECONNECTING,c),EI(CN("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==a||o||(rA.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(CM.REQUEST_TIMEOUT,e,t))}))}));let l=null;try{l=await c}catch(r){if(this.connectionState===wM.CLOSED||e===RM.LEAVE)throw new RO(CO.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===RM.JOIN||e===RM.REJOIN?null:(await s(),await this.request(e,t))}if(l.isSuccess)return l.message;const d=Number(l.message.error_code||l.message.code),u=Rj(d),h=new RO(CO.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message,desc:u.desc});return"success"===u.action?l.message:(rA.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===TM.ERR_TOO_MANY_BROADCASTERS?e===RM.JOIN||e===RM.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===u.action?h.throw():"quit"===u.action?(this.initError=h,this.close(),h.throw()):(d===TM.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,rA.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",$O.MULTI_IP)):this.reconnect(u.action,$O.SERVER_ERROR),e===RM.JOIN||e===RM.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new np((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}uploadWRTCStats(e){if(!this.store.sessionId)return void rA.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(kM.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=CN("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==wM.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),CN("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}async sendExtensionMessage(e,t,n){return await this._external_signal.send(e,t,n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new np(((t,n)=>{this.once(CM.WS_CONNECTED,(()=>t(this.joinResponse))),this.once(CM.WS_CLOSED,(()=>n(this.initError||new RO(CO.WS_ABORT)))),this.connectionState=wM.CONNECTING,this.websocket.init(e).catch(n)}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||YO.LEAVE,this.connectionState=wM.CLOSED,rA.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=SI(6,""),this._external_signal.clear(),this._external_signal=new oY(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(CM.ABORT_P2P_EXECUTION);const e=await nI(this,CM.REQUEST_JOIN_INFO),t=await this.request(RM.JOIN,e);if(!t)return this.emit(CM.REPORT_JOIN_GATEWAY,CO.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(CM.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=wM.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleDataStream(e){try{var t;const n=fI(e.payload),r=(new TextDecoder).decode(n),i=JSON.parse(r);"total"in i&&"id"in i||Dr(t=Object.values(yj)).call(t,i._type)?(i._uid=e.uid,this._external_signal.onMessage(i)):this.emit(OM.ON_DATA_STREAM,e)}catch(t){this.emit(OM.ON_DATA_STREAM,e)}}handleNotification(e){rA.debug("[".concat(this.clientId,"] receive notification: "),e);const t=Rj(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(YO.UID_BANNED),void this.close()):void this.reconnect(t.action,$O.SERVER_ERROR);rA.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=CN("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(rA.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>CN("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",$O.TIMEOUT):this.request(RM.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),CN("REPORT_STATS")&&this.send(RM.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWebsocketEvents(){this.websocket.on(NM.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(CM.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(NM.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(NM.CLOSED,(()=>{this.connectionState=wM.CLOSED})),this.websocket.on(NM.FAILED,(()=>{this._disconnectedReason=YO.NETWORK_ERROR,this.connectionState=wM.CLOSED})),this.websocket.on(NM.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===wM.CONNECTED?this.connectionState=wM.RECONNECTING:this.connectionState=wM.CONNECTING})),this.websocket.on(NM.WILL_RECONNECT,((e,t,n)=>{"retry"!==e?(rA.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):rA.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(e)})),this.websocket.on(NM.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.join().catch((e=>{if(this.emit(CM.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof RO&&e.code===CO.UNEXPECTED_RESPONSE&&e.data.code===TM.ERR_NO_AUTHORIZED)return rA.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",$O.SERVER_ERROR);rA.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",$O.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(NM.REQUEST_NEW_URLS,((e,t)=>{nI(this,CM.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(NM.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(OM.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}const sY={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new rY(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new aY(n,t)}};function cY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cY(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cY(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class dY{constructor(e){uC(this,"sessionDesc",void 0),uC(this,"localCapabilities",void 0),uC(this,"rtpCapabilities",void 0),uC(this,"candidates",void 0),uC(this,"_originCandidates",void 0),uC(this,"iceParameters",void 0),uC(this,"dtlsParameters",void 0),uC(this,"setup",void 0),uC(this,"currentMidIndex",void 0),uC(this,"cname",void 0),e=dI(e);const{iceParameters:t,dtlsParameters:n,candidates:r,rtpCapabilities:i,setup:o,localCapabilities:a,sdkCodec:s,cname:c}=e,l=MN("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=i,this.candidates=r,this._originCandidates=dI(r),this.iceParameters=t,this.dtlsParameters=n,this.setup=o,this.localCapabilities=a,this.cname=c;for(let d=0;d<l.mediaDescriptions.length;d++){const e=l.mediaDescriptions[d];if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=r,e.attributes.setup=o,"video"===e.media.mediaType){e.media.fmts=i.videoCodecs.map((e=>e.payloadType.toString(10)));let t=i.videoCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Dr(n=t.encodingName.toLowerCase()).call(n,s)}));0===t.length&&(t=i.videoCodecs),e.attributes.payloads=t,e.attributes.extmaps=i.videoExtensions}"audio"===e.media.mediaType&&(e.media.fmts=i.audioCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=i.audioCodecs,e.attributes.extmaps=i.audioExtensions),l.mediaDescriptions[d]=this.mungMediaDesc(e)}this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return jN(this.sessionDesc)}send(e,t,n){const{ssrcs:r,ssrcGroups:i}=pU(t,this.cname),o=this.sessionDesc.mediaDescriptions.find((t=>e===ij.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType)),a=r[0].attributes.label,s=r[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(r),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(i),{id:a,mslabel:s}}batchSend(e){return e.map((e=>{let{kind:t,ssrcMsg:n}=e;return this.send(t,n,void 0)}))}stopSending(e){this.sessionDesc.mediaDescriptions.forEach((t=>{const n=[],r=[],i=[];t.attributes.ssrcs.forEach((t=>{Dr(e).call(e,t.attributes.label||"")?i.push(t):n.push(t)})),t.attributes.ssrcGroups.forEach((e=>{var t;Dr(t=i.map((e=>e.ssrcId))).call(t,e.ssrcIds[0])||r.push(e)})),t.attributes.ssrcs=n,t.attributes.ssrcGroups=r}))}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,n){e.forEach(((e,t)=>{const n=e._mediaStreamTrack,r=this.sessionDesc.mediaDescriptions.findIndex((e=>e.attributes.mid===n.kind)),i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],e);this.sessionDesc.mediaDescriptions[r]=i}))}stopReceiving(e){}updateCandidates(e){const t=this._originCandidates.filter((e=>"udp"===e.transport)),n=[];if(t.forEach((e=>{n.push(lY(lY({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})),0!==t.length){switch(e){case oj.TCP_RELAY:this.candidates=n;break;case oj.UDP_TCP_RELAY:case oj.RELAY:this.candidates=[...t,...n];break;default:this.candidates=t}for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=dI(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}mungRecvMediaDsec(e,t){const n=dI(e);return fU(n,t),_U(n,t),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,n){const r=this.sessionDesc.mediaDescriptions.find((t=>e===ij.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid));if(r){const e=r.attributes.ssrcs.find((e=>e.attributes.label===t));var i;e&&(e.attributes.label=n,null===(i=e.attributes.msid)||void 0===i||i.replace(t,n))}}mungMediaDesc(e){const t=dI(e);return mU(t),function(e){const t=e.attributes.extmaps.find((e=>oU(e.extensionName)));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}(t),t}getSSRC(e){for(const t of this.sessionDesc.mediaDescriptions)for(const n of t.attributes.ssrcs)if(n.attributes.label===e)return[n]}}var uY;function hY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hY(Object(n),!0).forEach((function(t){uC(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hY(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let fY=(uY=class e extends rj{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Dr(t=Object.keys(IN)).call(t,e)})))]}constructor(t,n){super(t,n),uC(this,"store",void 0),uC(this,"peerConnection",void 0),uC(this,"remoteSDP",void 0),uC(this,"initialOffer",void 0),uC(this,"statsFilter",void 0),uC(this,"useRTX",!1),uC(this,"localCapabilities",void 0),uC(this,"localCandidateCount",0),uC(this,"allCandidatesReceived",!1),uC(this,"establishPromise",void 0),uC(this,"mutex",void 0),this.store=n,this.mutex=new LI("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=hN(this.peerConnection,CN("STATS_UPDATE_INTERVAL"),void 0,tO()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=lU(e.sdp),n=cU(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:CN("FILTER_VIDEO_FEC"),filterAudioFec:CN("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=e,pY(pY({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(e){throw new RO(CO.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new dY(pY(pY({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const t=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new RO(CO.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,t){var n=this;return YR((function*(){const r=yield XR(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const r=e.map((e=>n.peerConnection.addTrack(e._mediaStreamTrack))),i=yield XR(n.peerConnection.createOffer()),o=MN(i.sdp),a=e.map((e=>{const t=e._mediaStreamTrack,r=o.mediaDescriptions.find((e=>e.attributes.mid===t.kind));if(!r)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){const r=e.attributes.ssrcs.filter((e=>e.attributes.label===t)),i=e.attributes.ssrcGroups;if(0===r.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&r.length>1){const e=i.find((e=>-1!==e.ssrcIds.indexOf(r[0].ssrcId)));return e?[{ssrcId:e.ssrcIds[0],rtx:n?e.ssrcIds[1]:void 0}]:[{ssrcId:r[0].ssrcId}]}return[{ssrcId:r[0].ssrcId}]}(r,t.id,n.useRTX)}));let s;try{s=yield a}catch(e){throw r.forEach((e=>{$k()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)})),e}const c=n.mungSendOfferSDP(i.sdp,e);n.remoteSDP.receive(e,t,s);const l=n.remoteSDP.toString();return yield XR(n.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield XR(n.applySendEncodings(r,e)),yield XR(n.peerConnection.setRemoteDescription({type:"answer",sdp:l})),e.map(((e,t)=>{const n=e._mediaStreamTrack.id;return{localSSRC:a[t],id:n}}))}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{r()}}))()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{$k()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:n,mslabel:i}=this.remoteSDP.send(e,t,r),o=new np(((t,r)=>{const o=setTimeout((()=>{r(new Error("Cannot receive track, id: ".concat(n)))}),1e4),a=r=>{const s=qk();if(("Safari"===s.name&&11===Number(s.version)||nO())&&r.track.id!==n&&r.streams[0].id===i){var c;const i=r.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(e,n,r.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(o),void t(i)}if(r.track.id===n)return this.peerConnection.removeEventListener("track",a),clearTimeout(o),void t(r.track)};this.peerConnection.addEventListener("track",a)})),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),{track:await o,id:n}}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map((e=>{if($k()&&e.track)e.track.enabled=!1;else{const t=e.getParameters();t.encodings.forEach((e=>e.active=!1)),e.setParameters(t)}}))}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map((async e=>{if($k()&&e.track)e.track.enabled=!0;else{const t=e.getParameters();t.encodings.forEach((e=>e.active=!0)),await e.setParameters(t)}}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return YR((function*(){const n=yield XR(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const n=fA().supportPCSetConfiguration;if(e===oj.RELAY&&!n)return;if(n){const n=t.peerConnection.getConfiguration(),r=e===oj.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(rA.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}e!==oj.RELAY&&t.remoteSDP.updateCandidates(e);const r=yield XR(t.peerConnection.createOffer({iceRestart:!0}));if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const i=lU(r.sdp),{remoteIceParameters:o}=yield i.iceParameters;t.remoteSDP.restartICE(o);const a=t.remoteSDP.toString();yield XR(t.peerConnection.setLocalDescription(r)),yield XR(t.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(e){rA.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}}))()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const e=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getSenders().filter((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e}));1===n.length&&await this.applySendEncodings(n,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getSenders().find((e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t}));n&&await n.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new RO(CO.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new RO(CO.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,rA.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,rA.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),CN("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(JO(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),CN("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e._mediaStreamTrack.id}))),!t)return rA.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!fA().supportSetRtpSenderParameters)return rA.warn("Browser not support set rtp-sender parameters");const r={},i={};if(e instanceof kD)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(CN("DSCP_TYPE")&&yO()){var o;const e=CN("DSCP_TYPE");Dr(o=["very-low","low","medium","high"]).call(o,e)&&(i.networkPriority=e)}const a=t.getParameters(),s=null===(n=a.encodings)||void 0===n?void 0:n[0];s&&Object.assign(s,i),Object.assign(a,r),rA.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await t.setParameters(a)}async applySendEncodings(e,t){try{if(!fA().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];r&&i&&await this.updateRtpSenderEncodings(i,r)}}catch(e){rA.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){const n=MN(e);return t.forEach(((e,t)=>{const r=e._mediaStreamTrack,i=n.mediaDescriptions.find((e=>e.attributes.mid===r.kind));i&&fU(i,e)})),jN(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const t=this.remoteSDP.batchSend(e).map(((t,n)=>{let{id:r,mslabel:i}=t;const{kind:o}=e[n];return new np(((e,t)=>{const n=setTimeout((()=>{t(new Error("Cannot receive track, id: ".concat(r)))}),1e4),a=t=>{const s=qk();if("Safari"===s.name&&11===Number(s.version)&&t.track.id!==r&&t.streams[0].id===i){var c;const i=t.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(o,r,t.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(n),void e({track:i,id:r})}if(t.track.id===r)return this.peerConnection.removeEventListener("track",a),clearTimeout(n),void e({track:t.track,id:r})};this.peerConnection.addEventListener("track",a)}))})),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await np.all(t)}catch(e){throw new RO(CO.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(fA().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},vM(uY.prototype,"connect",[mY],Object.getOwnPropertyDescriptor(uY.prototype,"connect"),uY.prototype),vM(uY.prototype,"stopSending",[mY],Object.getOwnPropertyDescriptor(uY.prototype,"stopSending"),uY.prototype),vM(uY.prototype,"receive",[mY],Object.getOwnPropertyDescriptor(uY.prototype,"receive"),uY.prototype),vM(uY.prototype,"stopReceiving",[mY],Object.getOwnPropertyDescriptor(uY.prototype,"stopReceiving"),uY.prototype),vM(uY.prototype,"muteRemote",[mY],Object.getOwnPropertyDescriptor(uY.prototype,"muteRemote"),uY.prototype),vM(uY.prototype,"unmuteRemote",[mY],Object.getOwnPropertyDescriptor(uY.prototype,"unmuteRemote"),uY.prototype),vM(uY.prototype,"muteLocal",[mY],Object.getOwnPropertyDescriptor(uY.prototype,"muteLocal"),uY.prototype),vM(uY.prototype,"unmuteLocal",[mY],Object.getOwnPropertyDescriptor(uY.prototype,"unmuteLocal"),uY.prototype),vM(uY.prototype,"close",[mY],Object.getOwnPropertyDescriptor(uY.prototype,"close"),uY.prototype),vM(uY.prototype,"updateEncoderConfig",[mY],Object.getOwnPropertyDescriptor(uY.prototype,"updateEncoderConfig"),uY.prototype),vM(uY.prototype,"updateSendParameters",[mY],Object.getOwnPropertyDescriptor(uY.prototype,"updateSendParameters"),uY.prototype),vM(uY.prototype,"replaceTrack",[mY],Object.getOwnPropertyDescriptor(uY.prototype,"replaceTrack"),uY.prototype),vM(uY.prototype,"getRemoteSSRC",[mY],Object.getOwnPropertyDescriptor(uY.prototype,"getRemoteSSRC"),uY.prototype),uY);function mY(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("Locking from P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}const _Y={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new fY(n,t)}},gY={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!fA().supportWebRTCEncodedTransform)return void rA.warning("browser not support audio encoded transform");if(rL.has(e))return;if(!e.track)return;const n={track:e.track};if(Zk()){if(!e.createEncodedStreams)return void rA.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(e){return void rA.error("create audio-encoded-streams error",e&&e.message)}const o=new TransformStream({transform(i,o){n.controller||(n.controller=o),e.track&&e.track.id!==n.track.id&&(rA.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const a=t.metadata&&t.metadata();a?function(e,t){const{chunk:n,controller:r}=t,i=CN("ENABLE_AUDIO_PTS_METADATA")?tL.AUDIO_64_BIT_PTS:tL.METADATA;n.data=function(e,t,n){const r=n.byteLength,i=r+$D+eL,o=QD+ZD+i,a=new ArrayBuffer(e.byteLength+o),s=new DataView(a);s.setUint8(0,XD),s.setUint16(1,i),s.setUint8(3,t),s.setUint16(4,r);for(let l=0;l<r;l++)s.setUint8(6+l,n[l]);const c=new Uint8Array(s.buffer);return c.set(new Uint8Array(e),o),c.buffer}(n.data,i,e),r.enqueue(n)}(a,{sender:e,chunk:i,controller:o}):o.enqueue(i)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else if($k()){if("undefined"==typeof RTCRtpScriptTransform)return void rA.warning("browser not support RTCRtpScriptTransform");const i=JD(),o=new MessageChannel;await new np((e=>i.onmessage=t=>{"registered"===t.data&&e(void 0)}));const a=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:o.port2},[o.port2]);e.transform=a,await new np((e=>i.onmessage=t=>{"started"===t.data&&e(void 0)})),o.port1.onmessage=i=>{var a;if(i.data.transformed&&e.track&&(null===(a=e.track)||void 0===a?void 0:a.id)!==n.track.id)rA.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r);else if(i.data.getMetadata){const e=t.metadata&&t.metadata();e&&o.port1.postMessage({metadata:e})}},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const t=rL.get(e);if(t){rL.delete(e);try{var n,i;null===(n=t.controller)||void 0===n||n.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){rA.warning(e&&e.message)}}}rL.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!fA().supportWebRTCEncodedTransform)return void rA.warning("browser not support audio encoded transform");if(CL.has(e))return;const n={track:e.track,onMetadata:t.onMetadata};if(Zk()){if(!e.createEncodedStreams)return void rA.warning("browser not support createEncodedStreams() API");oO(Gk.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(e){return void rA.error("create audio-encoded-streams error",e&&e.message)}const o=new TransformStream({transform(i,o){n.controller||(n.controller=o),e.track&&e.track.id!==n.track.id&&(rA.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)),t.enableTopn?function(e,t,n){var r;const i=nL(new DataView(t.data));if(!i)return n.enqueue(t);const o=e.track.id;RL.set(o,e.track);const a=null===(r=i.tlv.find((e=>e.tag===tL.AUDIO_LEVEL)))||void 0===r?void 0:r.value;let s=0;"number"==typeof a&&(s=127-a);const c=Math.round(Math.pow(10,s/60)-1),{selected:l,speaker:d}=function(e,t){let n=mL.get(e);if(n||(n=function(e){const t=new uL;return mL.set(e,t),_L||(_L=new fL(CN("TOPN_SILENCE_THRESHOLD")||500),_L.on("ActiveSpeakerChanged",(e=>{null!=e&&(gL=e)}))),_L.addSpeakers([t]),t}(e)),mL.size<=vL)return{selected:!0,speaker:n};if(!_L)throw new Error("no active speaker detector");return _L.levelChanged(n.id,t),yL=_L.loudest.map((e=>e.id)),gL&&!Dr(yL).call(yL,gL)&&yL.length>=vL&&yL.pop(),{selected:Dr(yL).call(yL,n.id)||n.id===gL,speaker:n}}(e,c),u=function(e,t,n){const r=bL.get(e)||new SL(e,t);return r.score=n,bL.set(e,r),function(e){if(EL.set(e,!0),!TL)return void(TL=Date.now());const t=Date.now();t-TL>1e3&&(EL.get(e)?EL.set(e,!1):(wL(e),EL.delete(e)),TL=t)}(e),r}(o,e.track,d.energyScore);u.addSample(l),u.active&&(t.data=i.frame.buffer,n.enqueue(t))}(e,i,o):t.enableMetadata?function(e,t,n){const r=nL(new DataView(e.data));if(!r)return t.enqueue(e);const i=r.tlv.find((e=>e.tag===tL.METADATA||e.tag===tL.AUDIO_64_BIT_PTS));i&&n&&i.value instanceof Uint8Array&&n(i.value),e.data=r.frame.buffer,t.enqueue(e)}(i,o,t.onMetadata):o.enqueue(i)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else if($k()){if("undefined"==typeof RTCRtpScriptTransform)return void rA.warning("browser not support RTCRtpScriptTransform");const t=JD(),i=new MessageChannel;await new np((e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)}));const o=new RTCRtpScriptTransform(t,{name:"audio-metadata-rx",port:i.port2},[i.port2]);e.transform=o,await new np((e=>t.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id?(rA.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):t.data.metadata&&n.onMetadata&&n.onMetadata(t.data.metadata)},n.worker=t}function r(){e.track.removeEventListener("ended",r),function(e){const t=CL.get(e);if(t){!function(e){const t=mL.get(e);t&&(mL.delete(e),_L&&(_L.removeSpeakers([t]),0===mL.size&&(_L.destroy(),_L=null)))}(e),wL(e.track.id),CL.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){rA.warning(e&&e.message)}}}(e)}CL.set(e,n),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!fA().supportWebRTCEncodedTransform)return void rA.warning("browser not support video encoded transform");if(OL.has(e))return;if(!e.track)return;const n={track:e.track};if(Zk()){if(!e.createEncodedStreams)return void rA.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(e){return void rA.error("create video-encoded-streams error",e&&e.message)}const o=[];t.on("sei-to-send",(e=>{o.push(e)}));const a=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(rA.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const a=o.shift();a&&(t.data=function(e,t){const n=function(e){const t=e.length;let n=[],r=0;for(;r<t;)r+2<t&&0===e[r]&&0===e[r+1]&&(0===e[r+2]||1===e[r+2]||2===e[r+2]||3===e[r+2])?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}(t),r=n.length,i=Math.floor(r/255),o=r%255,a=new Uint8Array(6+i+1+r+e.byteLength);a[0]=0,a[1]=0,a[2]=0,a[3]=1,a[4]=6,a[5]=101;let s=0;for(;s<i;)a[6+s]=255,s++;return a[6+s]=o,s++,a.set(n,6+s),a.set(new Uint8Array(e),6+s+r),a.buffer}(t.data,a)),i.enqueue(t)}});i.readable.pipeThrough(a).pipeTo(i.writable)}else{if(!$k())return;{if("undefined"==typeof RTCRtpScriptTransform)return void rA.warning("browser not support RTCRtpScriptTransform");const i=JD(),o=new MessageChannel;await new np((e=>i.onmessage=t=>{"registered"===t.data&&e(void 0)}));const a=new RTCRtpScriptTransform(i,{name:"sei-tx",port:o.port2},[o.port2]);e.transform=a,await new np((e=>i.onmessage=t=>{"started"===t.data&&e(void 0)})),t.on("sei-to-send",(e=>{o.port1.postMessage({sei:e})})),o.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id&&(rA.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const t=OL.get(e);if(t){OL.delete(e);try{var n,i;null===(n=t.controller)||void 0===n||n.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){rA.warning(e&&e.message)}}}OL.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!fA().supportWebRTCEncodedTransform)return void rA.warning("browser not support video encoded transform");if(!e.track)return;if(IL.has(e)){const n=IL.get(e);return void(n&&(n.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(Zk()){if(!e.createEncodedStreams)return void rA.warning("browser not support createEncodedStreams() API");let t=null;try{t=e.createEncodedStreams()}catch(e){return void rA.error("create video-encoded-streams error",e&&e.message)}const i=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(rA.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const o=function(e){const t=new DataView(e.data);let n=0;for(;n+4<e.data.byteLength;){if(0===t.getUint8(n+0)&&0===t.getUint8(n+1)&&0===t.getUint8(n+2)&&1===t.getUint8(n+3)&&6===t.getUint8(n+4)){let r=n+6,i=0,o=0;for(;255===(o=t.getUint8(r++));)i+=255;i+=o;const a=kL(e.data,r,i);return new Uint8Array(a)}n++}return null}(t);o&&n.onSei&&n.onSei(o),i.enqueue(t)}});t.readable.pipeThrough(i).pipeTo(t.writable)}else if($k()){if("undefined"==typeof RTCRtpScriptTransform)return void rA.warning("browser not support RTCRtpScriptTransform");const t=JD(),i=new MessageChannel;await new np((e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)}));const o=new RTCRtpScriptTransform(t,{name:"sei-rx",port:i.port2},[i.port2]);e.transform=o,await new np((e=>t.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id?(rA.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):t.data.sei&&n.onSei&&n.onSei(t.data.sei)},n.worker=t}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}!function(e){const t=IL.get(e);if(t){IL.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){rA.warning(e&&e.message)}}}(e)}IL.set(e,n),e.track.addEventListener("ended",r)}},vY={name:"InterceptFrame",create:()=>gY};fN(),wN("PROCESS_ID","process-".concat(SI(8,""),"-").concat(SI(4,""),"-").concat(SI(4,""),"-").concat(SI(4,""),"-").concat(SI(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void rA.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();rA.debug("Loading global parameters from cache",t),Object.keys(t).forEach((e=>{if(Object.prototype.hasOwnProperty.call(TN,e)){const{value:r,expires:i}=t[e];if(i&&i<=n)return;kN[e]=r,TN[e]=r}}))}catch(t){rA.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(kN.AREAS)&&kN.AREAS.length>0&&tV(kN.AREAS,!0);const yY=(e,t,n)=>{rA.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),wN(e,t,n)};MU(jK,!1),MU(HK,!1),MU(eW,!1),MU(Eq,!1),MU(DK,!1),MU(sY,!1),MU(_Y,!1),MU(vY,!1);const bY=function(e){const t=new BO,n=e,r={getListeners:t.getListeners.bind(t),on:(e,n)=>(function(e,t){e===mj.SECURITY_POLICY_VIOLATION&&eG(t,!0)}(e,n),t.on.bind(t)(e,n)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return ZW(ZW({},n),r)}({__TRACK_LIST__:NA,VERSION:mN,BUILD:EN,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:yY,getParameter:CN,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(e){let t;return fA().supportUnifiedPlan?(e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"}),t=(await e.createOffer()).sdp):t=(await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,t}(t);if(!n)return e;t.close(),t=null,e=function(e){const t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(n)}catch(e){throw new hA(CO.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return e},checkSystemRequirements:function(){const e=uA.reportApiInvoke(null,{name:HO.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:zO.TRACER});let t=!1;try{const e=window.RTCPeerConnection,n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;t=!!(e&&n&&r),t&&vO()&&iO(75)&&(new e).close()}catch(e){return rA.error("check system requirement failed: ",e),!1}let n=!1;const r=qk();r.name===Gk.CHROME&&Number(r.version)>=58&&("WebKit"!==zk.engine.name||function(){const e=qk();if(Qk()){if(e.os===Wk.MAC_OS)return!0;if(e.os===Wk.IOS){const e=zk.os.version&&zk.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3)return!0;if(e&&Number(e[0])>14)return!0}}return!1}())&&(n=!0),(r.name===Gk.FIREFOX&&Number(r.version)>=56||r.name===Gk.OPERA&&Number(r.version)>=45||r.name===Gk.SAFARI&&Number(r.version)>=11||"WebKit"===r.name&&(nO()||mO())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||_O()||qk().name===Gk.QQ)&&(n=!0),rA.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return kx.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return kx.getRecordingDevices(e)},getCameras:function(e){return kx.getCamerasDevices(e)},getElectronScreenSources:yx,getPlaybackDevices:function(e){return kx.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=SI(5,"client-"),r=uA.reportApiInvoke(null,{id:n,name:HO.CREATE_CLIENT,options:[t],tag:zO.TRACER});try{!function(e){OO(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),OO(e.mode,"config.mode",["rtc","live","p2p"]),void 0!==e.audioCodec&&OO(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&AO(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&XO(e.turnServer),void 0!==e.httpRetryConfig&&KO(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&KO(e.websocketRetryConfig)}(t)}catch(e){throw r.onError(e),e}return(cO(16,0,!0)||lO(16,0,!0))&&("vp9"===t.codec&&(t.codec="vp8",rA.debug("browser not support vp9, force use vp8")),wN("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===t.audioCodec&&(t.audioCodec="opus"),r.onSuccess(),new zW(HW(HW({forceWaitGatewayResponse:!0},t),{},{role:Dr(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=CN("CAMERA_CAPTURE_CONFIG"),n=SI(8,"track-cam-"),r=uA.reportApiInvoke(null,{id:n,tag:zO.TRACER,name:HO.CREATE_CAM_VIDEO_TRACK,options:[ix({},e),t]});t&&(e.encoderConfig=t);const i=Wx(e);let o=null;rA.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{o=(await Tx({video:i},n)).getVideoTracks()[0]||null}catch(e){throw r.onError(e),e}if(!o){const e=new RO(CO.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(e),e.throw(rA)}if(e.optimizationMode&&ID(n,o,e,CA(e.encoderConfig)),CN("USE_STANDARD_BITRATE_DEFAULT")){const t=CA(e.encoderConfig);e.encoderConfig=t,delete t.bitrateMax,delete t.bitrateMin}const a=new OD(o,e,i,e.scalabiltyMode?kA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(a.getTrackId()),rA.info("create camera video success, trackId:",n),a},createCustomVideoTrack:function(e){const t=SI(8,"track-cus-"),n=uA.reportApiInvoke(null,{id:t,tag:zO.TRACER,name:HO.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});CN("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const r=new kD(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?kA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[PA.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),rA.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const n="object"==typeof t?function(e){return Gx(e)}(t):void 0;n&&(t="auto");const r=SI(8,"track-scr-v-"),i=uA.reportApiInvoke(null,{id:r,tag:zO.TRACER,name:HO.CREATE_SCREEN_VIDEO_TRACK,options:[ix({},e),t]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const o=function(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&Zk()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:r,surfaceSwitching:i,systemAudio:o,preferCurrentTab:a}=e;(rO(107)||aO(107)||dO(93))&&(n&&(OO(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(OO(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",i&&(OO(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(rO(105)||aO(105)||dO(91))&&o&&(OO(o,"systemAudio",["exclude","include"]),t.systemAudio=o),(rO(94)||aO(94)||dO(80))&&a&&(t.preferCurrentTab=!0),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const s=e.encoderConfig?RA(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:s?s.width:void 0,maxHeight:s?s.height:void 0},s&&(s.frameRate&&("number"==typeof s.frameRate?(t.mandatory.maxFrameRate=s.frameRate,t.mandatory.minFrameRate=s.frameRate):(t.mandatory.maxFrameRate=s.frameRate.max||s.frameRate.ideal||s.frameRate.exact||void 0,t.mandatory.minFrameRate=s.frameRate.min||s.frameRate.ideal||s.frameRate.exact||void 0),t.frameRate=s.frameRate),s.width&&(t.width=s.width),s.height&&(t.height=s.height)),t}(e);let a=null,s=null;const c=fA();if(!c.supportShareAudio&&"enable"===t){const e=new RO(CO.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(e),e.throw(rA)}rA.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const l=c.supportShareAudio&&"disable"!==t;try{const e=await Tx({screen:o,screenAudio:l?n||!0:void 0},r);a=e.getVideoTracks()[0]||null,s=e.getAudioTracks()[0]||null}catch(e){throw i.onError(e),e}if(!a){const e=new RO(CO.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(e),e.throw(rA)}if(!s&&"enable"===t){a&&a.stop();const e=new RO(CO.SHARE_AUDIO_NOT_ALLOWED);return i.onError(e),e.throw(rA)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(ID(r,a,e,e.encoderConfig&&RA(e.encoderConfig)||void 0),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const d=new kD(a,e.encoderConfig?RA(e.encoderConfig):{},e.scalabiltyMode?kA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[PA.SCREEN_TRACK]);if(!s)return i.onSuccess(d.getTrackId()),rA.info("create screen video track success","video:",d.getTrackId()),d;const u=new LP(s,void 0,SI(8,"track-scr-a-"),!1);return i.onSuccess([d.getTrackId(),u.getTrackId()]),rA.info("create screen video track success","video:",d.getTrackId(),"audio:",u.getTrackId()),[d,u]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=CN("CAMERA_CAPTURE_CONFIG"),r=SI(8,"track-mic-"),i=SI(8,"track-cam-"),o=uA.reportApiInvoke(null,{id:"".concat(r,"-").concat(i),tag:zO.TRACER,name:HO.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const a=Wx(t),s=Hx(e);let c=null,l=null;rA.info("start create camera video track(".concat(i,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const e=await Tx({audio:s,video:a},"".concat(r,"-").concat(i));c=e.getAudioTracks()[0],l=e.getVideoTracks()[0]}catch(e){throw o.onError(e),e}if(!c||!l){const e=new RO(CO.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(e),e.throw(rA)}if(t.optimizationMode&&ID(i,l,t,CA(t.encoderConfig)),CN("USE_STANDARD_BITRATE_DEFAULT")){const e=CA(t.encoderConfig);t.encoderConfig=e,delete e.bitrateMax,delete e.bitrateMin}const d=new MP(c,e,s,r),u=new OD(l,t,a,t.scalabiltyMode?kA(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return o.onSuccess([d.getTrackId(),u.getTrackId()]),rA.info("create camera video track(".concat(i,") and microphone audio track(").concat(r,") success")),[d,u]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=SI(8,"track-mic-"),n=uA.reportApiInvoke(null,{id:t,tag:zO.TRACER,name:HO.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=Hx(e);let i=null;rA.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await Tx({audio:r},t)).getAudioTracks()[0]||null}catch(e){throw n.onError(e),e}if(!i){const e=new RO(CO.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(rA)}const o=new MP(i,e,r,t);return n.onSuccess(o.getTrackId()),rA.info("create microphone audio track success, trackId:",t),o},createCustomAudioTrack:function(e){const t=SI(8,"track-cus-"),n=uA.reportApiInvoke(null,{id:t,tag:zO.TRACER,name:HO.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new LP(e.mediaStreamTrack,e.encoderConfig?IA(e.encoderConfig):{},t,!1);return rA.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const o={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?null!==(t=File.name)&&void 0!==t?t:"File":i,cacheOnlineFile:n,encoderConfig:r},a=SI(8,"track-buf-"),s=uA.reportApiInvoke(null,{id:a,tag:zO.TRACER,name:HO.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(CN("DISABLE_WEBAUDIO"))throw new RO(CO.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");rA.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",a);const c=i;if(!(i instanceof AudioBuffer))try{i=await async function(e,t){let n=null;if("string"==typeof e){const t=FP.get(e);if(t)return rA.debug("use cached audio resource: ",e),t;try{n=(await VI((()=>Mk.get(e,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(e){throw new RO(CO.FETCH_AUDIO_FILE_FAILED,e.toString())}}else{const t=new np(((t,n)=>{const r=new FileReader;r.onload=e=>{e.target?t(e.target.result):n(new RO(CO.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=()=>{n(new RO(CO.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(e)}));n=await t}const r=await function(e){const t=dx();return new np(((n,r)=>{t.decodeAudioData(e,(e=>{n(e)}),(e=>{r(new RO(CO.DECODE_AUDIO_FILE_FAILED,e.toString()))}))}))}(n);return"string"==typeof e&&t&&FP.set(e,r),r}(i,n)}catch(e){return s.onError(e),e.throw(rA)}const l=new VP(i),d=new jP(c,l,r?IA(r):{},a);return rA.info("create buffer source audio track success, trackId:",a),s.onSuccess(d.getTrackId()),d},setAppType:function(e){if(rA.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw rA.debug("Invalid appType"),new hA(CO.INVALID_PARAMS,"invalid app type",e);wN("APP_TYPE",Math.floor(e))},setLogLevel:function(e){rA.setLogLevel(e)},enableLogUpload:function(){CN("USE_NEW_LOG")?wN("UPLOAD_LOG",!0):rA.enableLogUpload()},disableLogUpload:function(){CN("USE_NEW_LOG")?wN("UPLOAD_LOG",!1):rA.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new MV},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=uA.reportApiInvoke(null,{tag:zO.TRACER,name:HO.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof LP||e instanceof HD)){const e=new hA(CO.INVALID_TRACK,"the parameter is not a audio track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof LP?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let o=i,a=i;const s=Date.now();return new np((i=>{const c=setInterval((()=>{const l=e.getVolumeLevel();o=l>o?l:o,a=l<a?l:a;const d=o-a>1e-4,u=Date.now()-s;if(d||u>t){clearInterval(c);const t=d,a={duration:u,deviceLabel:r,maxVolumeLevel:o,result:t};rA.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(a))),n.onSuccess(a),i(t)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=uA.reportApiInvoke(null,{tag:zO.TRACER,name:HO.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof kD||e instanceof GD)){const e=new hA(CO.INVALID_TRACK,"the parameter is not a video track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof kD?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,($k()||Qk())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([i]),o.play();const a=document.createElement("canvas");a.width=160,a.height=120;let s=0,c=0;try{const e=Date.now();s=await function(e,t,n,r){let i,o=0,a=null;return new np(((s,c)=>{function l(){o>r&&i&&(i(),s(o));const t=n.getContext("2d");if(!t){const e=new hA(CO.UNEXPECTED_ERROR,"can not get canvas 2d context.");return rA.error(e.toString()),void c(e)}t.drawImage(e,0,0,160,120);const l=t.getImageData(0,0,n.width,n.height),d=Math.floor(l.data.length/3);if(a){for(let e=0;e<d;e+=3)if(l.data[e]!==a[e])return o+=1,void(a=l.data);a=l.data}else a=l.data}setTimeout((()=>{i&&(i(),s(o))}),t),i=px((()=>{l()}),30)}))}(o,t,a,4),c=Date.now()-e}catch(e){throw n.onError(e),e}QF===Gk.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;const l=s>4,d={duration:c,changedPicNum:s,deviceLabel:r,result:l};return rA.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(d))),n.onSuccess(d),l},setArea:tV,audioElementPlayCenter:Px,resumeAudioContext:function(){Px.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){XW.processExternalMediaAEC(e)},registerExtensions:function(e){const t=CN("PLUGIN_INFO")||[];e.forEach((e=>{"name"in e&&!Dr(t).call(t,e.name)&&t.push(e.name);const n=e;n.__registered__=!0,n.logger.hookLog=rA.extLog,n.reporter.hookApiInvoke=uA.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach((e=>{n.parameters[e]=CN(e)}))})),yY("PLUGIN_INFO",t)},ChannelMediaRelayError:zM,ChannelMediaRelayEvent:GM,ChannelMediaRelayState:HM,RemoteStreamFallbackType:MA,RemoteStreamType:LA,ConnectionDisconnectedReason:YO,AudienceLatencyLevelType:qO,AREAS:XM,preload:async function(e,t,n,r){return uB(e,t,n,r)}});return Object.defineProperties(bY,{onAudioAutoplayFailed:{get:()=>Ix.onAudioAutoplayFailed,set:e=>{Ix.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Ix.onAutoplayFailed,set:e=>{Ix.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>bY._onSecurityPolicyViolation,set(e){bY._onSecurityPolicyViolation=e,eG(e)}},__CLIENT_LIST__:{get:()=>CN("SHOW_GLOBAL_CLIENT_LIST")?xL:[]}}),kx.on(XA.CAMERA_DEVICE_CHANGED,(e=>{rA.info("camera device changed",JSON.stringify(e)),bY.onCameraChanged&&bY.onCameraChanged(e),bY.safeEmit(mj.CAMERA_CHANGED,e)})),kx.on(XA.RECORDING_DEVICE_CHANGED,(e=>{rA.info("microphone device changed",JSON.stringify(e)),bY.onMicrophoneChanged&&bY.onMicrophoneChanged(e),bY.safeEmit(mj.MICROPHONE_CHANGED,e)})),kx.on(XA.PLAYOUT_DEVICE_CHANGED,(e=>{rA.debug("playout device changed",JSON.stringify(e)),bY.onPlaybackDeviceChanged&&bY.onPlaybackDeviceChanged(e),bY.safeEmit(mj.PLAYBACK_DEVICE_CHANGED,e)})),Px.onAutoplayFailed=()=>{rA.info("detect audio element autoplay failed"),Ix.onAudioAutoplayFailed&&Ix.onAudioAutoplayFailed()},lx.on("autoplay-failed",(()=>{rA.info("detect webaudio autoplay failed"),Ix.onAudioAutoplayFailed&&Ix.onAudioAutoplayFailed(),bY.safeEmit(mj.AUTOPLAY_FAILED)})),lx.on(gA.STATE_CHANGE,((e,t)=>{rA.info("audio context state changed: ".concat(t," => ").concat(e)),bY.onAudioContextStateChanged&&bY.onAudioContextStateChanged(e,t),bY.safeEmit(mj.AUDIO_CONTEXT_STATE_CHANGED,e,t)})),aI.on(tI.NETWORK_STATE_CHANGE,((e,t)=>{rA.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=bY),bY}()},3175:(e,t)=>{"use strict";const n=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,r=/^[\u0021-\u003A\u003C-\u007E]*$/,i=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,o=/^[\u0020-\u003A\u003D-\u007E]*$/,a=Object.prototype.toString,s=(()=>{const e=function(){};return e.prototype=Object.create(null),e})();function c(e,t,n){do{const n=e.charCodeAt(t);if(32!==n&&9!==n)return t}while(++t<n);return n}function l(e,t,n){for(;t>n;){const n=e.charCodeAt(--t);if(32!==n&&9!==n)return t+1}return n}function d(e){if(-1===e.indexOf("%"))return e;try{return decodeURIComponent(e)}catch(t){return e}}},7284:e=>{"use strict";var t,n="object"===typeof Reflect?Reflect:null,r=n&&"function"===typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"===typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!==e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"===typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}m(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&m(e,"error",t,n)}(e,i,{once:!0})}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var i,o,a,l;if(s(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"===typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=c(e))>0&&a.length>i&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=a.length,l=d,console&&console.warn&&console.warn(l)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=d.bind(r);return i.listener=n,r.wrapFn=i,i}function h(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"===typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):f(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function m(e,t,n,r){if("function"===typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[e];if(void 0===c)return!1;if("function"===typeof c)r(c,this,t);else{var l=c.length,d=f(c,l);for(n=0;n<l;++n)r(d[n],this,t)}return!0},o.prototype.addListener=function(e,t){return l(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return l(this,e,t,!0)},o.prototype.once=function(e,t){return s(t),this.on(e,u(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,u(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,a;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7004:(e,t,n)=>{"use strict";var r=n(8853),i=n(5043),o=n(7950);function a(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}var c=Symbol.for("react.element"),l=Symbol.for("react.transitional.element"),d=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),m=Symbol.for("react.consumer"),_=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),y=Symbol.for("react.suspense_list"),b=Symbol.for("react.memo"),E=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var S=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var T=Symbol.for("react.memo_cache_sentinel"),w=Symbol.iterator;function C(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=w&&e[w]||e["@@iterator"])?e:null}var R=Symbol.for("react.client.reference");function k(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===R?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case u:return"Fragment";case d:return"Portal";case p:return"Profiler";case h:return"StrictMode";case v:return"Suspense";case y:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case _:return(e.displayName||"Context")+".Provider";case m:return(e._context.displayName||"Context")+".Consumer";case g:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case b:return null!==(t=e.displayName||null)?t:k(e.type)||"Memo";case E:t=e._payload,e=e._init;try{return k(e(t))}catch(n){}}return null}var O,I,N=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,A=Object.assign;function x(e){if(void 0===O)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||"",I=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+O+e+I}var P=!1;function D(e,t){if(!e||P)return"";P=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(i){var r=i}Reflect.construct(e,[],n)}else{try{n.call()}catch(o){r=o}e.call(n.prototype)}}else{try{throw Error()}catch(a){r=a}(n=e())&&"function"===typeof n.catch&&n.catch((function(){}))}}catch(s){if(s&&r&&"string"===typeof s.stack)return[s.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var o=r.DetermineComponentFrameRoot(),a=o[0],s=o[1];if(a&&s){var c=a.split("\n"),l=s.split("\n");for(i=r=0;r<c.length&&!c[r].includes("DetermineComponentFrameRoot");)r++;for(;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;if(r===c.length||i===l.length)for(r=c.length-1,i=l.length-1;1<=r&&0<=i&&c[r]!==l[i];)i--;for(;1<=r&&0<=i;r--,i--)if(c[r]!==l[i]){if(1!==r||1!==i)do{if(r--,0>--i||c[r]!==l[i]){var d="\n"+c[r].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}}while(1<=r&&0<=i);break}}}finally{P=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?x(n):""}function L(e){switch(e.tag){case 26:case 27:case 5:return x(e.type);case 16:return x("Lazy");case 13:return x("Suspense");case 19:return x("SuspenseList");case 0:case 15:return e=D(e.type,!1);case 11:return e=D(e.type.render,!1);case 1:return e=D(e.type,!0);default:return""}}function M(e){try{var t="";do{t+=L(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function j(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function U(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function V(e){if(j(e)!==e)throw Error(a(188))}function F(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=F(e)))return t;e=e.sibling}return null}var B=Array.isArray,W=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G={pending:!1,data:null,method:null,action:null},H=[],z=-1;function K(e){return{current:e}}function q(e){0>z||(e.current=H[z],H[z]=null,z--)}function Y(e,t){z++,H[z]=e.current,e.current=t}var J=K(null),X=K(null),Q=K(null),Z=K(null);function $(e,t){switch(Y(Q,t),Y(X,e),Y(J,null),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)&&(t=t.namespaceURI)?Xd(t):0;break;default:if(t=(e=8===e?t.parentNode:t).tagName,e=e.namespaceURI)t=Qd(e=Xd(e),t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}q(J),Y(J,t)}function ee(){q(J),q(X),q(Q)}function te(e){null!==e.memoizedState&&Y(Z,e);var t=J.current,n=Qd(t,e.type);t!==n&&(Y(X,e),Y(J,n))}function ne(e){X.current===e&&(q(J),q(X)),Z.current===e&&(q(Z),Mu._currentValue=G)}var re=Object.prototype.hasOwnProperty,ie=r.unstable_scheduleCallback,oe=r.unstable_cancelCallback,ae=r.unstable_shouldYield,se=r.unstable_requestPaint,ce=r.unstable_now,le=r.unstable_getCurrentPriorityLevel,de=r.unstable_ImmediatePriority,ue=r.unstable_UserBlockingPriority,he=r.unstable_NormalPriority,pe=r.unstable_LowPriority,fe=r.unstable_IdlePriority,me=r.log,_e=r.unstable_setDisableYieldValue,ge=null,ve=null;function ye(e){if("function"===typeof me&&_e(e),ve&&"function"===typeof ve.setStrictMode)try{ve.setStrictMode(ge,e)}catch(t){}}var be=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(Ee(e)/Se|0)|0},Ee=Math.log,Se=Math.LN2;var Te=128,we=4194304;function Ce(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194176&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Re(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,a=e.warmLanes;e=0!==e.finishedLanes;var s=134217727&n;return 0!==s?0!==(n=s&~i)?r=Ce(n):0!==(o&=s)?r=Ce(o):e||0!==(a=s&~a)&&(r=Ce(a)):0!==(s=n&~i)?r=Ce(s):0!==o?r=Ce(o):e||0!==(a=n&~a)&&(r=Ce(a)),0===r?0:0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(a=t&-t)||32===i&&0!==(4194176&a))?t:r}function ke(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Oe(e,t){switch(e){case 1:case 2:case 4:case 8:return t+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Ie(){var e=Te;return 0===(4194176&(Te<<=1))&&(Te=128),e}function Ne(){var e=we;return 0===(62914560&(we<<=1))&&(we=4194304),e}function Ae(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function xe(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Pe(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-be(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|4194218&n}function De(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-be(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}function Le(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Me(){var e=W.p;return 0!==e?e:void 0===(e=window.event)?32:Qu(e.type)}var je=Math.random().toString(36).slice(2),Ue="__reactFiber$"+je,Ve="__reactProps$"+je,Fe="__reactContainer$"+je,Be="__reactEvents$"+je,We="__reactListeners$"+je,Ge="__reactHandles$"+je,He="__reactResources$"+je,ze="__reactMarker$"+je;function Ke(e){delete e[Ue],delete e[Ve],delete e[Be],delete e[We],delete e[Ge]}function qe(e){var t=e[Ue];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Fe]||n[Ue]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=cu(e);null!==e;){if(n=e[Ue])return n;e=cu(e)}return t}n=(e=n).parentNode}return null}function Ye(e){if(e=e[Ue]||e[Fe]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function Je(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(a(33))}function Xe(e){var t=e[He];return t||(t=e[He]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Qe(e){e[ze]=!0}var Ze=new Set,$e={};function et(e,t){tt(e,t),tt(e+"Capture",t)}function tt(e,t){for($e[e]=t,e=0;e<t.length;e++)Ze.add(t[e])}var nt=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),rt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),it={},ot={};function at(e,t,n){if(i=t,re.call(ot,i)||!re.call(it,i)&&(rt.test(i)?ot[i]=!0:(it[i]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var i}function st(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function ct(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function lt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function dt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ut(e){e._valueTracker||(e._valueTracker=function(e){var t=dt(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function ht(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=dt(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function pt(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var ft=/[\n"\\]/g;function mt(e){return e.replace(ft,(function(e){return"\\"+e.charCodeAt(0).toString(16)+" "}))}function _t(e,t,n,r,i,o,a,s){e.name="",null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?e.type=a:e.removeAttribute("type"),null!=t?"number"===a?(0===t&&""===e.value||e.value!=t)&&(e.value=""+lt(t)):e.value!==""+lt(t)&&(e.value=""+lt(t)):"submit"!==a&&"reset"!==a||e.removeAttribute("value"),null!=t?vt(e,a,lt(t)):null!=n?vt(e,a,lt(n)):null!=r&&e.removeAttribute("value"),null==i&&null!=o&&(e.defaultChecked=!!o),null!=i&&(e.checked=i&&"function"!==typeof i&&"symbol"!==typeof i),null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?e.name=""+lt(s):e.removeAttribute("name")}function gt(e,t,n,r,i,o,a,s){if(null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o&&(e.type=o),null!=t||null!=n){if(!("submit"!==o&&"reset"!==o||void 0!==t&&null!==t))return;n=null!=n?""+lt(n):"",t=null!=t?""+lt(t):n,s||t===e.value||(e.value=t),e.defaultValue=t}r="function"!==typeof(r=null!=r?r:i)&&"symbol"!==typeof r&&!!r,e.checked=s?e.checked:!!r,e.defaultChecked=!!r,null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a&&(e.name=a)}function vt(e,t,n){"number"===t&&pt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function yt(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+lt(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function bt(e,t,n){null==t||((t=""+lt(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+lt(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function Et(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(a(92));if(B(r)){if(1<r.length)throw Error(a(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=lt(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r)}function St(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Tt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function wt(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!==typeof n||0===n||Tt.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Ct(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(a(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var i in t)r=t[i],t.hasOwnProperty(i)&&n[i]!==r&&wt(e,i,r)}else for(var o in t)t.hasOwnProperty(o)&&wt(e,o,t[o])}function Rt(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ot=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function It(e){return Ot.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Nt=null;function At(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var xt=null,Pt=null;function Dt(e){var t=Ye(e);if(t&&(e=t.stateNode)){var n=e[Ve]||null;e:switch(e=t.stateNode,t.type){case"input":if(_t(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+mt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=r[Ve]||null;if(!i)throw Error(a(90));_t(r,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&ht(r)}break e;case"textarea":bt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&yt(e,!!n.multiple,t,!1)}}}var Lt=!1;function Mt(e,t,n){if(Lt)return e(t,n);Lt=!0;try{return e(t)}finally{if(Lt=!1,(null!==xt||null!==Pt)&&(Ul(),xt&&(t=xt,e=Pt,Pt=xt=null,Dt(t),e)))for(t=0;t<e.length;t++)Dt(e[t])}}function jt(e,t){var n=e.stateNode;if(null===n)return null;var r=n[Ve]||null;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Ut=!1;if(nt)try{var Vt={};Object.defineProperty(Vt,"passive",{get:function(){Ut=!0}}),window.addEventListener("test",Vt,Vt),window.removeEventListener("test",Vt,Vt)}catch(Eh){Ut=!1}var Ft=null,Bt=null,Wt=null;function Gt(){if(Wt)return Wt;var e,t,n=Bt,r=n.length,i="value"in Ft?Ft.value:Ft.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[o-t];t++);return Wt=i.slice(e,1<t?1-t:void 0)}function Ht(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function zt(){return!0}function Kt(){return!1}function qt(e){function t(t,n,r,i,o){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?zt:Kt,this.isPropagationStopped=Kt,this}return A(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=zt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=zt)},persist:function(){},isPersistent:zt}),t}var Yt,Jt,Xt,Qt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zt=qt(Qt),$t=A({},Qt,{view:0,detail:0}),en=qt($t),tn=A({},$t,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Xt&&(Xt&&"mousemove"===e.type?(Yt=e.screenX-Xt.screenX,Jt=e.screenY-Xt.screenY):Jt=Yt=0,Xt=e),Yt)},movementY:function(e){return"movementY"in e?e.movementY:Jt}}),nn=qt(tn),rn=qt(A({},tn,{dataTransfer:0})),on=qt(A({},$t,{relatedTarget:0})),an=qt(A({},Qt,{animationName:0,elapsedTime:0,pseudoElement:0})),sn=qt(A({},Qt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),cn=qt(A({},Qt,{data:0})),ln={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},dn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},un={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=un[e])&&!!t[e]}function pn(){return hn}var fn=qt(A({},$t,{key:function(e){if(e.key){var t=ln[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Ht(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?dn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pn,charCode:function(e){return"keypress"===e.type?Ht(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Ht(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),mn=qt(A({},tn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),_n=qt(A({},$t,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pn})),gn=qt(A({},Qt,{propertyName:0,elapsedTime:0,pseudoElement:0})),vn=qt(A({},tn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),yn=qt(A({},Qt,{newState:0,oldState:0})),bn=[9,13,27,32],En=nt&&"CompositionEvent"in window,Sn=null;nt&&"documentMode"in document&&(Sn=document.documentMode);var Tn=nt&&"TextEvent"in window&&!Sn,wn=nt&&(!En||Sn&&8<Sn&&11>=Sn),Cn=String.fromCharCode(32),Rn=!1;function kn(e,t){switch(e){case"keyup":return-1!==bn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function On(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var In=!1;var Nn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function An(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Nn[e.type]:"textarea"===t}function xn(e,t,n,r){xt?Pt?Pt.push(r):Pt=[r]:xt=r,0<(t=Md(t,"onChange")).length&&(n=new Zt("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Pn=null,Dn=null;function Ln(e){Od(e,0)}function Mn(e){if(ht(Je(e)))return e}function jn(e,t){if("change"===e)return t}var Un=!1;if(nt){var Vn;if(nt){var Fn="oninput"in document;if(!Fn){var Bn=document.createElement("div");Bn.setAttribute("oninput","return;"),Fn="function"===typeof Bn.oninput}Vn=Fn}else Vn=!1;Un=Vn&&(!document.documentMode||9<document.documentMode)}function Wn(){Pn&&(Pn.detachEvent("onpropertychange",Gn),Dn=Pn=null)}function Gn(e){if("value"===e.propertyName&&Mn(Dn)){var t=[];xn(t,Dn,e,At(e)),Mt(Ln,t)}}function Hn(e,t,n){"focusin"===e?(Wn(),Dn=n,(Pn=t).attachEvent("onpropertychange",Gn)):"focusout"===e&&Wn()}function zn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Mn(Dn)}function Kn(e,t){if("click"===e)return Mn(t)}function qn(e,t){if("input"===e||"change"===e)return Mn(t)}var Yn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Jn(e,t){if(Yn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!re.call(t,i)||!Yn(e[i],t[i]))return!1}return!0}function Xn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Qn(e,t){var n,r=Xn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Xn(r)}}function Zn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Zn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function $n(e){for(var t=pt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=pt((e=t.contentWindow).document)}return t}function er(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function tr(e,t){var n=$n(t);t=e.focusedElem;var r=e.selectionRange;if(n!==t&&t&&t.ownerDocument&&Zn(t.ownerDocument.documentElement,t)){if(null!==r&&er(t))if(e=r.start,void 0===(n=r.end)&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if((n=(e=t.ownerDocument||document)&&e.defaultView||window).getSelection){n=n.getSelection();var i=t.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!n.extend&&o>r&&(i=r,r=o,o=i),i=Qn(t,o);var a=Qn(t,r);i&&a&&(1!==n.rangeCount||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&((e=e.createRange()).setStart(i.node,i.offset),n.removeAllRanges(),o>r?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}for(e=[],n=t;n=n.parentNode;)1===n.nodeType&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for("function"===typeof t.focus&&t.focus(),t=0;t<e.length;t++)(n=e[t]).element.scrollLeft=n.left,n.element.scrollTop=n.top}}var nr=nt&&"documentMode"in document&&11>=document.documentMode,rr=null,ir=null,or=null,ar=!1;function sr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;ar||null==rr||rr!==pt(r)||("selectionStart"in(r=rr)&&er(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},or&&Jn(or,r)||(or=r,0<(r=Md(ir,"onSelect")).length&&(t=new Zt("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=rr)))}function cr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var lr={animationend:cr("Animation","AnimationEnd"),animationiteration:cr("Animation","AnimationIteration"),animationstart:cr("Animation","AnimationStart"),transitionrun:cr("Transition","TransitionRun"),transitionstart:cr("Transition","TransitionStart"),transitioncancel:cr("Transition","TransitionCancel"),transitionend:cr("Transition","TransitionEnd")},dr={},ur={};function hr(e){if(dr[e])return dr[e];if(!lr[e])return e;var t,n=lr[e];for(t in n)if(n.hasOwnProperty(t)&&t in ur)return dr[e]=n[t];return e}nt&&(ur=document.createElement("div").style,"AnimationEvent"in window||(delete lr.animationend.animation,delete lr.animationiteration.animation,delete lr.animationstart.animation),"TransitionEvent"in window||delete lr.transitionend.transition);var pr=hr("animationend"),fr=hr("animationiteration"),mr=hr("animationstart"),_r=hr("transitionrun"),gr=hr("transitionstart"),vr=hr("transitioncancel"),yr=hr("transitionend"),br=new Map,Er="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function Sr(e,t){br.set(e,t),et(t,[e])}var Tr=[],wr=0,Cr=0;function Rr(){for(var e=wr,t=Cr=wr=0;t<e;){var n=Tr[t];Tr[t++]=null;var r=Tr[t];Tr[t++]=null;var i=Tr[t];Tr[t++]=null;var o=Tr[t];if(Tr[t++]=null,null!==r&&null!==i){var a=r.pending;null===a?i.next=i:(i.next=a.next,a.next=i),r.pending=i}0!==o&&Nr(n,i,o)}}function kr(e,t,n,r){Tr[wr++]=e,Tr[wr++]=t,Tr[wr++]=n,Tr[wr++]=r,Cr|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function Or(e,t,n,r){return kr(e,t,n,r),Ar(e)}function Ir(e,t){return kr(e,null,null,t),Ar(e)}function Nr(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var i=!1,o=e.return;null!==o;)o.childLanes|=n,null!==(r=o.alternate)&&(r.childLanes|=n),22===o.tag&&(null===(e=o.stateNode)||1&e._visibility||(i=!0)),e=o,o=o.return;i&&null!==t&&3===e.tag&&(o=e.stateNode,i=31-be(n),null===(e=(o=o.hiddenUpdates)[i])?o[i]=[t]:e.push(t),t.lane=536870912|n)}function Ar(e){if(50<Ol)throw Ol=0,Il=null,Error(a(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var xr={},Pr=new WeakMap;function Dr(e,t){if("object"===typeof e&&null!==e){var n=Pr.get(e);return void 0!==n?n:(t={value:e,source:t,stack:M(t)},Pr.set(e,t),t)}return{value:e,source:t,stack:M(t)}}var Lr=[],Mr=0,jr=null,Ur=0,Vr=[],Fr=0,Br=null,Wr=1,Gr="";function Hr(e,t){Lr[Mr++]=Ur,Lr[Mr++]=jr,jr=e,Ur=t}function zr(e,t,n){Vr[Fr++]=Wr,Vr[Fr++]=Gr,Vr[Fr++]=Br,Br=e;var r=Wr;e=Gr;var i=32-be(r)-1;r&=~(1<<i),n+=1;var o=32-be(t)+i;if(30<o){var a=i-i%5;o=(r&(1<<a)-1).toString(32),r>>=a,i-=a,Wr=1<<32-be(t)+i|n<<i|r,Gr=o+e}else Wr=1<<o|n<<i|r,Gr=e}function Kr(e){null!==e.return&&(Hr(e,1),zr(e,1,0))}function qr(e){for(;e===jr;)jr=Lr[--Mr],Lr[Mr]=null,Ur=Lr[--Mr],Lr[Mr]=null;for(;e===Br;)Br=Vr[--Fr],Vr[Fr]=null,Gr=Vr[--Fr],Vr[Fr]=null,Wr=Vr[--Fr],Vr[Fr]=null}var Yr=null,Jr=null,Xr=!1,Qr=null,Zr=!1,$r=Error(a(519));function ei(e){throw oi(Dr(Error(a(418,"")),e)),$r}function ti(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[Ue]=e,t[Ve]=r,n){case"dialog":Id("cancel",t),Id("close",t);break;case"iframe":case"object":case"embed":Id("load",t);break;case"video":case"audio":for(n=0;n<Rd.length;n++)Id(Rd[n],t);break;case"source":Id("error",t);break;case"img":case"image":case"link":Id("error",t),Id("load",t);break;case"details":Id("toggle",t);break;case"input":Id("invalid",t),gt(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0),ut(t);break;case"select":Id("invalid",t);break;case"textarea":Id("invalid",t),Et(t,r.value,r.defaultValue,r.children),ut(t)}"string"!==typeof(n=r.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||Wd(t.textContent,n)?(null!=r.popover&&(Id("beforetoggle",t),Id("toggle",t)),null!=r.onScroll&&Id("scroll",t),null!=r.onScrollEnd&&Id("scrollend",t),null!=r.onClick&&(t.onclick=Gd),t=!0):t=!1,t||ei(e)}function ni(e){for(Yr=e.return;Yr;)switch(Yr.tag){case 3:case 27:return void(Zr=!0);case 5:case 13:return void(Zr=!1);default:Yr=Yr.return}}function ri(e){if(e!==Yr)return!1;if(!Xr)return ni(e),Xr=!0,!1;var t,n=!1;if((t=3!==e.tag&&27!==e.tag)&&((t=5===e.tag)&&(t=!("form"!==(t=e.type)&&"button"!==t)||Zd(e.type,e.memoizedProps)),t=!t),t&&(n=!0),n&&Jr&&ei(e),ni(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){Jr=su(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}Jr=null}}else Jr=Yr?su(e.stateNode.nextSibling):null;return!0}function ii(){Jr=Yr=null,Xr=!1}function oi(e){null===Qr?Qr=[e]:Qr.push(e)}var ai=Error(a(460)),si=Error(a(474)),ci={then:function(){}};function li(e){return"fulfilled"===(e=e.status)||"rejected"===e}function di(){}function ui(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(di,di),t=n),t.status){case"fulfilled":return t.value;case"rejected":if((e=t.reason)===ai)throw Error(a(483));throw e;default:if("string"===typeof t.status)t.then(di,di);else{if(null!==(e=tl)&&100<e.shellSuspendCounter)throw Error(a(482));(e=t).status="pending",e.then((function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}}),(function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}}))}switch(t.status){case"fulfilled":return t.value;case"rejected":if((e=t.reason)===ai)throw Error(a(483));throw e}throw hi=t,ai}}var hi=null;function pi(){if(null===hi)throw Error(a(459));var e=hi;return hi=null,e}var fi=null,mi=0;function _i(e){var t=mi;return mi+=1,null===fi&&(fi=[]),ui(fi,e,t)}function gi(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function vi(e,t){if(t.$$typeof===c)throw Error(a(525));throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function yi(e){return(0,e._init)(e._payload)}function bi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function i(e,t){return(e=jc(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=33554434,n):r:(t.flags|=33554434,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=33554434),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=Wc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n,r){var o=n.type;return o===u?f(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===E&&yi(o)===t.type)?(gi(t=i(t,n.props),n),t.return=e,t):(gi(t=Vc(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function p(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Gc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function f(e,t,n,r,o){return null===t||7!==t.tag?((t=Fc(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function m(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=Wc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case l:return gi(n=Vc(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case d:return(t=Gc(t,e.mode,n)).return=e,t;case E:return m(e,t=(0,t._init)(t._payload),n)}if(B(t)||C(t))return(t=Fc(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return m(e,_i(t),n);if(t.$$typeof===_)return m(e,Rs(e,t),n);vi(e,t)}return null}function g(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==i?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case l:return n.key===i?h(e,t,n,r):null;case d:return n.key===i?p(e,t,n,r):null;case E:return g(e,t,n=(i=n._init)(n._payload),r)}if(B(n)||C(n))return null!==i?null:f(e,t,n,r,null);if("function"===typeof n.then)return g(e,t,_i(n),r);if(n.$$typeof===_)return g(e,t,Rs(e,n),r);vi(e,n)}return null}function v(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r||"bigint"===typeof r)return c(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case l:return h(t,e=e.get(null===r.key?n:r.key)||null,r,i);case d:return p(t,e=e.get(null===r.key?n:r.key)||null,r,i);case E:return v(e,t,n,r=(0,r._init)(r._payload),i)}if(B(r)||C(r))return f(t,e=e.get(n)||null,r,i,null);if("function"===typeof r.then)return v(e,t,n,_i(r),i);if(r.$$typeof===_)return v(e,t,n,Rs(t,r),i);vi(t,r)}return null}function y(c,h,p,f){if("object"===typeof p&&null!==p&&p.type===u&&null===p.key&&(p=p.props.children),"object"===typeof p&&null!==p){switch(p.$$typeof){case l:e:{for(var b=p.key;null!==h;){if(h.key===b){if((b=p.type)===u){if(7===h.tag){n(c,h.sibling),(f=i(h,p.props.children)).return=c,c=f;break e}}else if(h.elementType===b||"object"===typeof b&&null!==b&&b.$$typeof===E&&yi(b)===h.type){n(c,h.sibling),gi(f=i(h,p.props),p),f.return=c,c=f;break e}n(c,h);break}t(c,h),h=h.sibling}p.type===u?((f=Fc(p.props.children,c.mode,f,p.key)).return=c,c=f):(gi(f=Vc(p.type,p.key,p.props,null,c.mode,f),p),f.return=c,c=f)}return s(c);case d:e:{for(b=p.key;null!==h;){if(h.key===b){if(4===h.tag&&h.stateNode.containerInfo===p.containerInfo&&h.stateNode.implementation===p.implementation){n(c,h.sibling),(f=i(h,p.children||[])).return=c,c=f;break e}n(c,h);break}t(c,h),h=h.sibling}(f=Gc(p,c.mode,f)).return=c,c=f}return s(c);case E:return y(c,h,p=(b=p._init)(p._payload),f)}if(B(p))return function(i,a,s,c){for(var l=null,d=null,u=a,h=a=0,p=null;null!==u&&h<s.length;h++){u.index>h?(p=u,u=null):p=u.sibling;var f=g(i,u,s[h],c);if(null===f){null===u&&(u=p);break}e&&u&&null===f.alternate&&t(i,u),a=o(f,a,h),null===d?l=f:d.sibling=f,d=f,u=p}if(h===s.length)return n(i,u),Xr&&Hr(i,h),l;if(null===u){for(;h<s.length;h++)null!==(u=m(i,s[h],c))&&(a=o(u,a,h),null===d?l=u:d.sibling=u,d=u);return Xr&&Hr(i,h),l}for(u=r(u);h<s.length;h++)null!==(p=v(u,i,h,s[h],c))&&(e&&null!==p.alternate&&u.delete(null===p.key?h:p.key),a=o(p,a,h),null===d?l=p:d.sibling=p,d=p);return e&&u.forEach((function(e){return t(i,e)})),Xr&&Hr(i,h),l}(c,h,p,f);if(C(p)){if("function"!==typeof(b=C(p)))throw Error(a(150));return function(i,s,c,l){if(null==c)throw Error(a(151));for(var d=null,u=null,h=s,p=s=0,f=null,_=c.next();null!==h&&!_.done;p++,_=c.next()){h.index>p?(f=h,h=null):f=h.sibling;var y=g(i,h,_.value,l);if(null===y){null===h&&(h=f);break}e&&h&&null===y.alternate&&t(i,h),s=o(y,s,p),null===u?d=y:u.sibling=y,u=y,h=f}if(_.done)return n(i,h),Xr&&Hr(i,p),d;if(null===h){for(;!_.done;p++,_=c.next())null!==(_=m(i,_.value,l))&&(s=o(_,s,p),null===u?d=_:u.sibling=_,u=_);return Xr&&Hr(i,p),d}for(h=r(h);!_.done;p++,_=c.next())null!==(_=v(h,i,p,_.value,l))&&(e&&null!==_.alternate&&h.delete(null===_.key?p:_.key),s=o(_,s,p),null===u?d=_:u.sibling=_,u=_);return e&&h.forEach((function(e){return t(i,e)})),Xr&&Hr(i,p),d}(c,h,p=b.call(p),f)}if("function"===typeof p.then)return y(c,h,_i(p),f);if(p.$$typeof===_)return y(c,h,Rs(c,p),f);vi(c,p)}return"string"===typeof p&&""!==p||"number"===typeof p||"bigint"===typeof p?(p=""+p,null!==h&&6===h.tag?(n(c,h.sibling),(f=i(h,p)).return=c,c=f):(n(c,h),(f=Wc(p,c.mode,f)).return=c,c=f),s(c)):n(c,h)}return function(e,t,n,r){try{mi=0;var i=y(e,t,n,r);return fi=null,i}catch(a){if(a===ai)throw a;var o=Lc(29,a,null,e.mode);return o.lanes=r,o.return=e,o}}}var Ei=bi(!0),Si=bi(!1),Ti=K(null),wi=K(0);function Ci(e,t){Y(wi,e=ll),Y(Ti,t),ll=e|t.baseLanes}function Ri(){Y(wi,ll),Y(Ti,Ti.current)}function ki(){ll=wi.current,q(Ti),q(wi)}var Oi=K(null),Ii=null;function Ni(e){var t=e.alternate;Y(Di,1&Di.current),Y(Oi,e),null===Ii&&(null===t||null!==Ti.current||null!==t.memoizedState)&&(Ii=e)}function Ai(e){if(22===e.tag){if(Y(Di,Di.current),Y(Oi,e),null===Ii){var t=e.alternate;null!==t&&null!==t.memoizedState&&(Ii=e)}}else xi()}function xi(){Y(Di,Di.current),Y(Oi,Oi.current)}function Pi(e){q(Oi),Ii===e&&(Ii=null),q(Di)}var Di=K(0);function Li(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Mi="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach((function(e){return e()}))}},ji=r.unstable_scheduleCallback,Ui=r.unstable_NormalPriority,Vi={$$typeof:_,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Fi(){return{controller:new Mi,data:new Map,refCount:0}}function Bi(e){e.refCount--,0===e.refCount&&ji(Ui,(function(){e.controller.abort()}))}var Wi=null,Gi=0,Hi=0,zi=null;function Ki(){if(0===--Gi&&null!==Wi){null!==zi&&(zi.status="fulfilled");var e=Wi;Wi=null,Hi=0,zi=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var qi=N.S;N.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Wi){var n=Wi=[];Gi=0,Hi=Ed(),zi={status:"pending",value:void 0,then:function(e){n.push(e)}}}Gi++,t.then(Ki,Ki)}(0,t),null!==qi&&qi(e,t)};var Yi=K(null);function Ji(){var e=Yi.current;return null!==e?e:tl.pooledCache}function Xi(e,t){Y(Yi,null===t?Yi.current:t.pool)}function Qi(){var e=Ji();return null===e?null:{parent:Vi._currentValue,pool:e}}var Zi=0,$i=null,eo=null,to=null,no=!1,ro=!1,io=!1,oo=0,ao=0,so=null,co=0;function lo(){throw Error(a(321))}function uo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Yn(e[n],t[n]))return!1;return!0}function ho(e,t,n,r,i,o){return Zi=o,$i=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,N.H=null===e||null===e.memoizedState?Ra:ka,io=!1,o=n(r,i),io=!1,ro&&(o=fo(t,n,r,i)),po(e),o}function po(e){N.H=Ca;var t=null!==eo&&null!==eo.next;if(Zi=0,to=eo=$i=null,no=!1,ao=0,so=null,t)throw Error(a(300));null===e||Ha||null!==(e=e.dependencies)&&Ts(e)&&(Ha=!0)}function fo(e,t,n,r){$i=e;var i=0;do{if(ro&&(so=null),ao=0,ro=!1,25<=i)throw Error(a(301));if(i+=1,to=eo=null,null!=e.updateQueue){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}N.H=Oa,o=t(n,r)}while(ro);return o}function mo(){var e=N.H,t=e.useState()[0];return t="function"===typeof t.then?Eo(t):t,e=e.useState()[0],(null!==eo?eo.memoizedState:null)!==e&&($i.flags|=1024),t}function _o(){var e=0!==oo;return oo=0,e}function go(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function vo(e){if(no){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}no=!1}Zi=0,to=eo=$i=null,ro=!1,ao=oo=0,so=null}function yo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===to?$i.memoizedState=to=e:to=to.next=e,to}function bo(){if(null===eo){var e=$i.alternate;e=null!==e?e.memoizedState:null}else e=eo.next;var t=null===to?$i.memoizedState:to.next;if(null!==t)to=t,eo=e;else{if(null===e){if(null===$i.alternate)throw Error(a(467));throw Error(a(310))}e={memoizedState:(eo=e).memoizedState,baseState:eo.baseState,baseQueue:eo.baseQueue,queue:eo.queue,next:null},null===to?$i.memoizedState=to=e:to=to.next=e}return to}function Eo(e){var t=ao;return ao+=1,null===so&&(so=[]),e=ui(so,e,t),t=$i,null===(null===to?t.memoizedState:to.next)&&(t=t.alternate,N.H=null===t||null===t.memoizedState?Ra:ka),e}function So(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return Eo(e);if(e.$$typeof===_)return Cs(e)}throw Error(a(438,String(e)))}function To(e){var t=null,n=$i.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=$i.alternate;null!==r&&(null!==(r=r.updateQueue)&&(null!=(r=r.memoCache)&&(t={data:r.data.map((function(e){return e.slice()})),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},$i.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=T;return t.index++,n}function wo(e,t){return"function"===typeof t?t(e):t}function Co(e){return Ro(bo(),eo,e)}function Ro(e,t,n){var r=e.queue;if(null===r)throw Error(a(311));r.lastRenderedReducer=n;var i=e.baseQueue,o=r.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}t.baseQueue=i=o,r.pending=null}if(o=e.baseState,null===i)e.memoizedState=o;else{var c=s=null,l=null,d=t=i.next,u=!1;do{var h=-536870913&d.lane;if(h!==d.lane?(rl&h)===h:(Zi&h)===h){var p=d.revertLane;if(0===p)null!==l&&(l=l.next={lane:0,revertLane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),h===Hi&&(u=!0);else{if((Zi&p)===p){d=d.next,p===Hi&&(u=!0);continue}h={lane:0,revertLane:d.revertLane,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===l?(c=l=h,s=o):l=l.next=h,$i.lanes|=p,ul|=p}h=d.action,io&&n(o,h),o=d.hasEagerState?d.eagerState:n(o,h)}else p={lane:h,revertLane:d.revertLane,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===l?(c=l=p,s=o):l=l.next=p,$i.lanes|=h,ul|=h;d=d.next}while(null!==d&&d!==t);if(null===l?s=o:l.next=c,!Yn(o,e.memoizedState)&&(Ha=!0,u&&null!==(n=zi)))throw n;e.memoizedState=o,e.baseState=s,e.baseQueue=l,r.lastRenderedState=o}return null===i&&(r.lanes=0),[e.memoizedState,r.dispatch]}function ko(e){var t=bo(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);Yn(o,t.memoizedState)||(Ha=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Oo(e,t,n){var r=$i,i=bo(),o=Xr;if(o){if(void 0===n)throw Error(a(407));n=n()}else n=t();var s=!Yn((eo||i).memoizedState,n);if(s&&(i.memoizedState=n,Ha=!0),i=i.queue,$o(Ao.bind(null,r,i,e),[e]),i.getSnapshot!==t||s||null!==to&&1&to.memoizedState.tag){if(r.flags|=2048,Yo(9,No.bind(null,r,i,n,t),{destroy:void 0},null),null===tl)throw Error(a(349));o||0!==(60&Zi)||Io(r,t,n)}return n}function Io(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=$i.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},$i.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function No(e,t,n,r){t.value=n,t.getSnapshot=r,xo(t)&&Po(e)}function Ao(e,t,n){return n((function(){xo(t)&&Po(e)}))}function xo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Yn(e,n)}catch(r){return!0}}function Po(e){var t=Ir(e,2);null!==t&&xl(t,e,2)}function Do(e){var t=yo();if("function"===typeof e){var n=e;if(e=n(),io){ye(!0);try{n()}finally{ye(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:wo,lastRenderedState:e},t}function Lo(e,t,n,r){return e.baseState=n,Ro(e,eo,"function"===typeof r?r:wo)}function Mo(e,t,n,r,i){if(Sa(e))throw Error(a(485));if(null!==(e=t.action)){var o={payload:i,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};null!==N.T?n(!0):o.isTransition=!1,r(o),null===(n=t.pending)?(o.next=t.pending=o,jo(t,o)):(o.next=n.next,t.pending=n.next=o)}}function jo(e,t){var n=t.action,r=t.payload,i=e.state;if(t.isTransition){var o=N.T,a={};N.T=a;try{var s=n(i,r),c=N.S;null!==c&&c(a,s),Uo(e,t,s)}catch(l){Fo(e,t,l)}finally{N.T=o}}else try{Uo(e,t,o=n(i,r))}catch(d){Fo(e,t,d)}}function Uo(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then((function(n){Vo(e,t,n)}),(function(n){return Fo(e,t,n)})):Vo(e,t,n)}function Vo(e,t,n){t.status="fulfilled",t.value=n,Bo(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,jo(e,n)))}function Fo(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,Bo(t),t=t.next}while(t!==r)}e.action=null}function Bo(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Wo(e,t){return t}function Go(e,t){if(Xr){var n=tl.formState;if(null!==n){e:{var r=$i;if(Xr){if(Jr){t:{for(var i=Jr,o=Zr;8!==i.nodeType;){if(!o){i=null;break t}if(null===(i=su(i.nextSibling))){i=null;break t}}i="F!"===(o=i.data)||"F"===o?i:null}if(i){Jr=su(i.nextSibling),r="F!"===i.data;break e}}ei(r)}r=!1}r&&(t=n[0])}}return(n=yo()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wo,lastRenderedState:t},n.queue=r,n=ya.bind(null,$i,r),r.dispatch=n,r=Do(!1),o=Ea.bind(null,$i,!1,r.queue),i={state:t,dispatch:null,action:e,pending:null},(r=yo()).queue=i,n=Mo.bind(null,$i,i,o,n),i.dispatch=n,r.memoizedState=e,[t,n,!1]}function Ho(e){return zo(bo(),eo,e)}function zo(e,t,n){t=Ro(e,t,Wo)[0],e=Co(wo)[0],t="object"===typeof t&&null!==t&&"function"===typeof t.then?Eo(t):t;var r=bo(),i=r.queue,o=i.dispatch;return n!==r.memoizedState&&($i.flags|=2048,Yo(9,Ko.bind(null,i,n),{destroy:void 0},null)),[t,o,e]}function Ko(e,t){e.action=t}function qo(e){var t=bo(),n=eo;if(null!==n)return zo(t,n,e);bo(),t=t.memoizedState;var r=(n=bo()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function Yo(e,t,n,r){return e={tag:e,create:t,inst:n,deps:r,next:null},null===(t=$i.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},$i.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Jo(){return bo().memoizedState}function Xo(e,t,n,r){var i=yo();$i.flags|=e,i.memoizedState=Yo(1|t,n,{destroy:void 0},void 0===r?null:r)}function Qo(e,t,n,r){var i=bo();r=void 0===r?null:r;var o=i.memoizedState.inst;null!==eo&&null!==r&&uo(r,eo.memoizedState.deps)?i.memoizedState=Yo(t,n,o,r):($i.flags|=e,i.memoizedState=Yo(1|t,n,o,r))}function Zo(e,t){Xo(8390656,8,e,t)}function $o(e,t){Qo(2048,8,e,t)}function ea(e,t){return Qo(4,2,e,t)}function ta(e,t){return Qo(4,4,e,t)}function na(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function ra(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,Qo(4,4,na.bind(null,t,e),n)}function ia(){}function oa(e,t){var n=bo();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&uo(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function aa(e,t){var n=bo();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&uo(t,r[1]))return r[0];if(r=e(),io){ye(!0);try{e()}finally{ye(!1)}}return n.memoizedState=[r,t],r}function sa(e,t,n){return void 0===n||0!==(1073741824&Zi)?e.memoizedState=t:(e.memoizedState=n,e=Al(),$i.lanes|=e,ul|=e,n)}function ca(e,t,n,r){return Yn(n,t)?n:null!==Ti.current?(e=sa(e,n,r),Yn(e,t)||(Ha=!0),e):0===(42&Zi)?(Ha=!0,e.memoizedState=n):(e=Al(),$i.lanes|=e,ul|=e,t)}function la(e,t,n,r,i){var o=W.p;W.p=0!==o&&8>o?o:8;var a=N.T,s={};N.T=s,Ea(e,!1,t,n);try{var c=i(),l=N.S;if(null!==l&&l(s,c),null!==c&&"object"===typeof c&&"function"===typeof c.then)ba(e,t,function(e,t){var n=[],r={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then((function(){r.status="fulfilled",r.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)}),(function(e){for(r.status="rejected",r.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)})),r}(c,r),Nl());else ba(e,t,r,Nl())}catch(d){ba(e,t,{then:function(){},status:"rejected",reason:d},Nl())}finally{W.p=o,N.T=a}}function da(){}function ua(e,t,n,r){if(5!==e.tag)throw Error(a(476));var i=ha(e).queue;la(e,i,t,G,null===n?da:function(){return pa(e),n(r)})}function ha(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:G,baseState:G,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:wo,lastRenderedState:G},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:wo,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function pa(e){ba(e,ha(e).next.queue,{},Nl())}function fa(){return Cs(Mu)}function ma(){return bo().memoizedState}function _a(){return bo().memoizedState}function ga(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Nl(),r=xs(t,e=As(n),n);return null!==r&&(xl(r,t,n),Ps(r,t,n)),t={cache:Fi()},void(e.payload=t)}t=t.return}}function va(e,t,n){var r=Nl();n={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},Sa(e)?Ta(t,n):null!==(n=Or(e,t,n,r))&&(xl(n,e,r),wa(n,t,r))}function ya(e,t,n){ba(e,t,n,Nl())}function ba(e,t,n,r){var i={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(Sa(e))Ta(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n);if(i.hasEagerState=!0,i.eagerState=s,Yn(s,a))return kr(e,t,i,0),null===tl&&Rr(),!1}catch(c){}if(null!==(n=Or(e,t,i,r)))return xl(n,e,r),wa(n,t,r),!0}return!1}function Ea(e,t,n,r){if(r={lane:2,revertLane:Ed(),action:r,hasEagerState:!1,eagerState:null,next:null},Sa(e)){if(t)throw Error(a(479))}else null!==(t=Or(e,n,r,2))&&xl(t,e,2)}function Sa(e){var t=e.alternate;return e===$i||null!==t&&t===$i}function Ta(e,t){ro=no=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function wa(e,t,n){if(0!==(4194176&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,De(e,n)}}var Ca={readContext:Cs,use:So,useCallback:lo,useContext:lo,useEffect:lo,useImperativeHandle:lo,useLayoutEffect:lo,useInsertionEffect:lo,useMemo:lo,useReducer:lo,useRef:lo,useState:lo,useDebugValue:lo,useDeferredValue:lo,useTransition:lo,useSyncExternalStore:lo,useId:lo};Ca.useCacheRefresh=lo,Ca.useMemoCache=lo,Ca.useHostTransitionStatus=lo,Ca.useFormState=lo,Ca.useActionState=lo,Ca.useOptimistic=lo;var Ra={readContext:Cs,use:So,useCallback:function(e,t){return yo().memoizedState=[e,void 0===t?null:t],e},useContext:Cs,useEffect:Zo,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,Xo(4194308,4,na.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Xo(4194308,4,e,t)},useInsertionEffect:function(e,t){Xo(4,2,e,t)},useMemo:function(e,t){var n=yo();t=void 0===t?null:t;var r=e();if(io){ye(!0);try{e()}finally{ye(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=yo();if(void 0!==n){var i=n(t);if(io){ye(!0);try{n(t)}finally{ye(!1)}}}else i=t;return r.memoizedState=r.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},r.queue=e,e=e.dispatch=va.bind(null,$i,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},yo().memoizedState=e},useState:function(e){var t=(e=Do(e)).queue,n=ya.bind(null,$i,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:ia,useDeferredValue:function(e,t){return sa(yo(),e,t)},useTransition:function(){var e=Do(!1);return e=la.bind(null,$i,e.queue,!0,!1),yo().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=$i,i=yo();if(Xr){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===tl)throw Error(a(349));0!==(60&rl)||Io(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,Zo(Ao.bind(null,r,o,e),[e]),r.flags|=2048,Yo(9,No.bind(null,r,o,n,t),{destroy:void 0},null),n},useId:function(){var e=yo(),t=tl.identifierPrefix;if(Xr){var n=Gr;t=":"+t+"R"+(n=(Wr&~(1<<32-be(Wr)-1)).toString(32)+n),0<(n=oo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=co++).toString(32)+":";return e.memoizedState=t},useCacheRefresh:function(){return yo().memoizedState=ga.bind(null,$i)}};Ra.useMemoCache=To,Ra.useHostTransitionStatus=fa,Ra.useFormState=Go,Ra.useActionState=Go,Ra.useOptimistic=function(e){var t=yo();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Ea.bind(null,$i,!0,n),n.dispatch=t,[e,t]};var ka={readContext:Cs,use:So,useCallback:oa,useContext:Cs,useEffect:$o,useImperativeHandle:ra,useInsertionEffect:ea,useLayoutEffect:ta,useMemo:aa,useReducer:Co,useRef:Jo,useState:function(){return Co(wo)},useDebugValue:ia,useDeferredValue:function(e,t){return ca(bo(),eo.memoizedState,e,t)},useTransition:function(){var e=Co(wo)[0],t=bo().memoizedState;return["boolean"===typeof e?e:Eo(e),t]},useSyncExternalStore:Oo,useId:ma};ka.useCacheRefresh=_a,ka.useMemoCache=To,ka.useHostTransitionStatus=fa,ka.useFormState=Ho,ka.useActionState=Ho,ka.useOptimistic=function(e,t){return Lo(bo(),0,e,t)};var Oa={readContext:Cs,use:So,useCallback:oa,useContext:Cs,useEffect:$o,useImperativeHandle:ra,useInsertionEffect:ea,useLayoutEffect:ta,useMemo:aa,useReducer:ko,useRef:Jo,useState:function(){return ko(wo)},useDebugValue:ia,useDeferredValue:function(e,t){var n=bo();return null===eo?sa(n,e,t):ca(n,eo.memoizedState,e,t)},useTransition:function(){var e=ko(wo)[0],t=bo().memoizedState;return["boolean"===typeof e?e:Eo(e),t]},useSyncExternalStore:Oo,useId:ma};function Ia(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:A({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}Oa.useCacheRefresh=_a,Oa.useMemoCache=To,Oa.useHostTransitionStatus=fa,Oa.useFormState=qo,Oa.useActionState=qo,Oa.useOptimistic=function(e,t){var n=bo();return null!==eo?Lo(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])};var Na={isMounted:function(e){return!!(e=e._reactInternals)&&j(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Nl(),i=As(r);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=xs(e,i,r))&&(xl(t,e,r),Ps(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Nl(),i=As(r);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=xs(e,i,r))&&(xl(t,e,r),Ps(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Nl(),r=As(n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=xs(e,r,n))&&(xl(t,e,n),Ps(t,e,n))}};function Aa(e,t,n,r,i,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!Jn(n,r)||!Jn(i,o))}function xa(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Na.enqueueReplaceState(t,t.state,null)}function Pa(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var i in n===t&&(n=A({},n)),e)void 0===n[i]&&(n[i]=e[i]);return n}var Da="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function La(e){Da(e)}function Ma(e){console.error(e)}function ja(e){Da(e)}function Ua(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout((function(){throw n}))}}function Va(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout((function(){throw r}))}}function Fa(e,t,n){return(n=As(n)).tag=3,n.payload={element:null},n.callback=function(){Ua(e,t)},n}function Ba(e){return(e=As(e)).tag=3,e}function Wa(e,t,n,r){var i=n.type.getDerivedStateFromError;if("function"===typeof i){var o=r.value;e.payload=function(){return i(o)},e.callback=function(){Va(t,n,r)}}var a=n.stateNode;null!==a&&"function"===typeof a.componentDidCatch&&(e.callback=function(){Va(t,n,r),"function"!==typeof i&&(null===Sl?Sl=new Set([this]):Sl.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var Ga=Error(a(461)),Ha=!1;function za(e,t,n,r){t.child=null===e?Si(t,null,n,r):Ei(t,e.child,n,r)}function Ka(e,t,n,r,i){n=n.render;var o=t.ref;if("ref"in r){var a={};for(var s in r)"ref"!==s&&(a[s]=r[s])}else a=r;return ws(t),r=ho(e,t,n,a,o,i),s=_o(),null===e||Ha?(Xr&&s&&Kr(t),t.flags|=1,za(e,t,r,i),t.child):(go(e,t,i),hs(e,t,i))}function qa(e,t,n,r,i){if(null===e){var o=n.type;return"function"!==typeof o||Mc(o)||void 0!==o.defaultProps||null!==n.compare?((e=Vc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ya(e,t,o,r,i))}if(o=e.child,!ps(e,i)){var a=o.memoizedProps;if((n=null!==(n=n.compare)?n:Jn)(a,r)&&e.ref===t.ref)return hs(e,t,i)}return t.flags|=1,(e=jc(o,r)).ref=t.ref,e.return=t,t.child=e}function Ya(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(Jn(o,r)&&e.ref===t.ref){if(Ha=!1,t.pendingProps=r=o,!ps(e,i))return t.lanes=e.lanes,hs(e,t,i);0!==(131072&e.flags)&&(Ha=!0)}}return Za(e,t,n,r,i)}function Ja(e,t,n){var r=t.pendingProps,i=r.children,o=0!==(2&t.stateNode._pendingVisibility),a=null!==e?e.memoizedState:null;if(Qa(e,t),"hidden"===r.mode||o){if(0!==(128&t.flags)){if(r=null!==a?a.baseLanes|n:n,null!==e){for(i=t.child=e.child,o=0;null!==i;)o=o|i.lanes|i.childLanes,i=i.sibling;t.childLanes=o&~r}else t.childLanes=0,t.child=null;return Xa(e,t,r,n)}if(0===(536870912&n))return t.lanes=t.childLanes=536870912,Xa(e,t,null!==a?a.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Xi(0,null!==a?a.cachePool:null),null!==a?Ci(t,a):Ri(),Ai(t)}else null!==a?(Xi(0,a.cachePool),Ci(t,a),xi(),t.memoizedState=null):(null!==e&&Xi(0,null),Ri(),xi());return za(e,t,i,n),t.child}function Xa(e,t,n,r){var i=Ji();return i=null===i?null:{parent:Vi._currentValue,pool:i},t.memoizedState={baseLanes:n,cachePool:i},null!==e&&Xi(0,null),Ri(),Ai(t),null!==e&&Ss(e,t,r,!0),null}function Qa(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=2097664);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(a(284));null!==e&&e.ref===n||(t.flags|=2097664)}}function Za(e,t,n,r,i){return ws(t),n=ho(e,t,n,r,void 0,i),r=_o(),null===e||Ha?(Xr&&r&&Kr(t),t.flags|=1,za(e,t,n,i),t.child):(go(e,t,i),hs(e,t,i))}function $a(e,t,n,r,i,o){return ws(t),t.updateQueue=null,n=fo(t,r,n,i),po(e),r=_o(),null===e||Ha?(Xr&&r&&Kr(t),t.flags|=1,za(e,t,n,o),t.child):(go(e,t,o),hs(e,t,o))}function es(e,t,n,r,i){if(ws(t),null===t.stateNode){var o=xr,a=n.contextType;"object"===typeof a&&null!==a&&(o=Cs(a)),o=new n(r,o),t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,o.updater=Na,t.stateNode=o,o._reactInternals=t,(o=t.stateNode).props=r,o.state=t.memoizedState,o.refs={},Is(t),a=n.contextType,o.context="object"===typeof a&&null!==a?Cs(a):xr,o.state=t.memoizedState,"function"===typeof(a=n.getDerivedStateFromProps)&&(Ia(t,n,a,r),o.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(a=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),a!==o.state&&Na.enqueueReplaceState(o,o.state,null),js(t,r,o,i),Ms(),o.state=t.memoizedState),"function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){o=t.stateNode;var s=t.memoizedProps,c=Pa(n,s);o.props=c;var l=o.context,d=n.contextType;a=xr,"object"===typeof d&&null!==d&&(a=Cs(d));var u=n.getDerivedStateFromProps;d="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate,s=t.pendingProps!==s,d||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s||l!==a)&&xa(t,o,r,a),Os=!1;var h=t.memoizedState;o.state=h,js(t,r,o,i),Ms(),l=t.memoizedState,s||h!==l||Os?("function"===typeof u&&(Ia(t,n,u,r),l=t.memoizedState),(c=Os||Aa(t,n,c,r,h,l,a))?(d||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),o.props=r,o.state=l,o.context=a,r=c):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Ns(e,t),d=Pa(n,a=t.memoizedProps),o.props=d,u=t.pendingProps,h=o.context,l=n.contextType,c=xr,"object"===typeof l&&null!==l&&(c=Cs(l)),(l="function"===typeof(s=n.getDerivedStateFromProps)||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==u||h!==c)&&xa(t,o,r,c),Os=!1,h=t.memoizedState,o.state=h,js(t,r,o,i),Ms();var p=t.memoizedState;a!==u||h!==p||Os||null!==e&&null!==e.dependencies&&Ts(e.dependencies)?("function"===typeof s&&(Ia(t,n,s,r),p=t.memoizedState),(d=Os||Aa(t,n,d,r,h,p,c)||null!==e&&null!==e.dependencies&&Ts(e.dependencies))?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,c)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=c,r=d):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return o=r,Qa(e,t),r=0!==(128&t.flags),o||r?(o=t.stateNode,n=r&&"function"!==typeof n.getDerivedStateFromError?null:o.render(),t.flags|=1,null!==e&&r?(t.child=Ei(t,e.child,null,i),t.child=Ei(t,null,n,i)):za(e,t,n,i),t.memoizedState=o.state,e=t.child):e=hs(e,t,i),e}function ts(e,t,n,r){return ii(),t.flags|=256,za(e,t,n,r),t.child}var ns={dehydrated:null,treeContext:null,retryLane:0};function rs(e){return{baseLanes:e,cachePool:Qi()}}function is(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=fl),e}function os(e,t,n){var r,i=t.pendingProps,o=!1,s=0!==(128&t.flags);if((r=s)||(r=(null===e||null!==e.memoizedState)&&0!==(2&Di.current)),r&&(o=!0,t.flags&=-129),r=0!==(32&t.flags),t.flags&=-33,null===e){if(Xr){if(o?Ni(t):xi(),Xr){var c,l=Jr;if(c=l){e:{for(c=l,l=Zr;8!==c.nodeType;){if(!l){l=null;break e}if(null===(c=su(c.nextSibling))){l=null;break e}}l=c}null!==l?(t.memoizedState={dehydrated:l,treeContext:null!==Br?{id:Wr,overflow:Gr}:null,retryLane:536870912},(c=Lc(18,null,null,0)).stateNode=l,c.return=t,t.child=c,Yr=t,Jr=null,c=!0):c=!1}c||ei(t)}if(null!==(l=t.memoizedState)&&null!==(l=l.dehydrated))return"$!"===l.data?t.lanes=16:t.lanes=536870912,null;Pi(t)}return l=i.children,i=i.fallback,o?(xi(),l=ss({mode:"hidden",children:l},o=t.mode),i=Fc(i,o,n,null),l.return=t,i.return=t,l.sibling=i,t.child=l,(o=t.child).memoizedState=rs(n),o.childLanes=is(e,r,n),t.memoizedState=ns,i):(Ni(t),as(t,l))}if(null!==(c=e.memoizedState)&&null!==(l=c.dehydrated)){if(s)256&t.flags?(Ni(t),t.flags&=-257,t=cs(e,t,n)):null!==t.memoizedState?(xi(),t.child=e.child,t.flags|=128,t=null):(xi(),o=i.fallback,l=t.mode,i=ss({mode:"visible",children:i.children},l),(o=Fc(o,l,n,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,Ei(t,e.child,null,n),(i=t.child).memoizedState=rs(n),i.childLanes=is(e,r,n),t.memoizedState=ns,t=o);else if(Ni(t),"$!"===l.data){if(r=l.nextSibling&&l.nextSibling.dataset)var d=r.dgst;r=d,(i=Error(a(419))).stack="",i.digest=r,oi({value:i,source:null,stack:null}),t=cs(e,t,n)}else if(Ha||Ss(e,t,n,!1),r=0!==(n&e.childLanes),Ha||r){if(null!==(r=tl)){if(0!==(42&(i=n&-n)))i=1;else switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=64;break;case 268435456:i=134217728;break;default:i=0}if(0!==(i=0!==(i&(r.suspendedLanes|n))?0:i)&&i!==c.retryLane)throw c.retryLane=i,Ir(e,i),xl(r,e,i),Ga}"$?"===l.data||Hl(),t=cs(e,t,n)}else"$?"===l.data?(t.flags|=128,t.child=e.child,t=sd.bind(null,e),l._reactRetry=t,t=null):(e=c.treeContext,Jr=su(l.nextSibling),Yr=t,Xr=!0,Qr=null,Zr=!1,null!==e&&(Vr[Fr++]=Wr,Vr[Fr++]=Gr,Vr[Fr++]=Br,Wr=e.id,Gr=e.overflow,Br=t),(t=as(t,i.children)).flags|=4096);return t}return o?(xi(),o=i.fallback,l=t.mode,d=(c=e.child).sibling,(i=jc(c,{mode:"hidden",children:i.children})).subtreeFlags=31457280&c.subtreeFlags,null!==d?o=jc(d,o):(o=Fc(o,l,n,null)).flags|=2,o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,null===(l=e.child.memoizedState)?l=rs(n):(null!==(c=l.cachePool)?(d=Vi._currentValue,c=c.parent!==d?{parent:d,pool:d}:c):c=Qi(),l={baseLanes:l.baseLanes|n,cachePool:c}),o.memoizedState=l,o.childLanes=is(e,r,n),t.memoizedState=ns,i):(Ni(t),e=(n=e.child).sibling,(n=jc(n,{mode:"visible",children:i.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function as(e,t){return(t=ss({mode:"visible",children:t},e.mode)).return=e,e.child=t}function ss(e,t){return Bc(e,t,0,null)}function cs(e,t,n){return Ei(t,e.child,null,n),(e=as(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ls(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),bs(e.return,t,n)}function ds(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function us(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(za(e,t,r.children,n),0!==(2&(r=Di.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ls(e,n,t);else if(19===e.tag)ls(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}switch(Y(Di,r),i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Li(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),ds(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Li(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}ds(t,!0,n,null,o);break;case"together":ds(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function hs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),ul|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(Ss(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=jc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=jc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function ps(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Ts(e))}function fs(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Ha=!0;else{if(!ps(e,n)&&0===(128&t.flags))return Ha=!1,function(e,t,n){switch(t.tag){case 3:$(t,t.stateNode.containerInfo),vs(t,Vi,e.memoizedState.cache),ii();break;case 27:case 5:te(t);break;case 4:$(t,t.stateNode.containerInfo);break;case 10:vs(t,t.type,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(Ni(t),t.flags|=128,null):0!==(n&t.child.childLanes)?os(e,t,n):(Ni(t),null!==(e=hs(e,t,n))?e.sibling:null);Ni(t);break;case 19:var i=0!==(128&e.flags);if((r=0!==(n&t.childLanes))||(Ss(e,t,n,!1),r=0!==(n&t.childLanes)),i){if(r)return us(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Y(Di,Di.current),r)break;return null;case 22:case 23:return t.lanes=0,Ja(e,t,n);case 24:vs(t,Vi,e.memoizedState.cache)}return hs(e,t,n)}(e,t,n);Ha=0!==(131072&e.flags)}else Ha=!1,Xr&&0!==(1048576&t.flags)&&zr(t,Ur,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var r=t.elementType,i=r._init;if(r=i(r._payload),t.type=r,"function"!==typeof r){if(void 0!==r&&null!==r){if((i=r.$$typeof)===g){t.tag=11,t=Ka(null,t,r,e,n);break e}if(i===b){t.tag=14,t=qa(null,t,r,e,n);break e}}throw t=k(r)||r,Error(a(306,t,""))}Mc(r)?(e=Pa(r,e),t.tag=1,t=es(null,t,r,e,n)):(t.tag=0,t=Za(null,t,r,e,n))}return t;case 0:return Za(e,t,t.type,t.pendingProps,n);case 1:return es(e,t,r=t.type,i=Pa(r,t.pendingProps),n);case 3:e:{if($(t,t.stateNode.containerInfo),null===e)throw Error(a(387));var o=t.pendingProps;r=(i=t.memoizedState).element,Ns(e,t),js(t,o,null,n);var s=t.memoizedState;if(o=s.cache,vs(t,Vi,o),o!==i.cache&&Es(t,[Vi],n,!0),Ms(),o=s.element,i.isDehydrated){if(i={element:o,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=ts(e,t,o,n);break e}if(o!==r){oi(r=Dr(Error(a(424)),t)),t=ts(e,t,o,n);break e}for(Jr=su(t.stateNode.containerInfo.firstChild),Yr=t,Xr=!0,Qr=null,Zr=!0,n=Si(t,null,o,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ii(),o===r){t=hs(e,t,n);break e}za(e,t,o,n)}t=t.child}return t;case 26:return Qa(e,t),null===e?(n=_u(t.type,null,t.pendingProps,null))?t.memoizedState=n:Xr||(n=t.type,e=t.pendingProps,(r=Jd(Q.current).createElement(n))[Ue]=t,r[Ve]=e,Kd(r,n,e),Qe(r),t.stateNode=r):t.memoizedState=_u(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return te(t),null===e&&Xr&&(r=t.stateNode=lu(t.type,t.pendingProps,Q.current),Yr=t,Zr=!0,Jr=su(r.firstChild)),r=t.pendingProps.children,null!==e||Xr?za(e,t,r,n):t.child=Ei(t,null,r,n),Qa(e,t),t.child;case 5:return null===e&&Xr&&((i=r=Jr)&&(null!==(r=function(e,t,n,r){for(;1===e.nodeType;){var i=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[ze])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(o=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(o!==i.rel||e.getAttribute("href")!==(null==i.href?null:i.href)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin)||e.getAttribute("title")!==(null==i.title?null:i.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((o=e.getAttribute("src"))!==(null==i.src?null:i.src)||e.getAttribute("type")!==(null==i.type?null:i.type)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin))&&o&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var o=null==i.name?null:""+i.name;if("hidden"===i.type&&e.getAttribute("name")===o)return e}if(null===(e=su(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,Zr))?(t.stateNode=r,Yr=t,Jr=su(r.firstChild),Zr=!1,i=!0):i=!1),i||ei(t)),te(t),i=t.type,o=t.pendingProps,s=null!==e?e.memoizedProps:null,r=o.children,Zd(i,o)?r=null:null!==s&&Zd(i,s)&&(t.flags|=32),null!==t.memoizedState&&(i=ho(e,t,mo,null,null,n),Mu._currentValue=i),Qa(e,t),za(e,t,r,n),t.child;case 6:return null===e&&Xr&&((e=n=Jr)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=su(e.nextSibling)))return null}return e}(n,t.pendingProps,Zr))?(t.stateNode=n,Yr=t,Jr=null,e=!0):e=!1),e||ei(t)),null;case 13:return os(e,t,n);case 4:return $(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ei(t,null,r,n):za(e,t,r,n),t.child;case 11:return Ka(e,t,t.type,t.pendingProps,n);case 7:return za(e,t,t.pendingProps,n),t.child;case 8:case 12:return za(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,vs(t,t.type,r.value),za(e,t,r.children,n),t.child;case 9:return i=t.type._context,r=t.pendingProps.children,ws(t),r=r(i=Cs(i)),t.flags|=1,za(e,t,r,n),t.child;case 14:return qa(e,t,t.type,t.pendingProps,n);case 15:return Ya(e,t,t.type,t.pendingProps,n);case 19:return us(e,t,n);case 22:return Ja(e,t,n);case 24:return ws(t),r=Cs(Vi),null===e?(null===(i=Ji())&&(i=tl,o=Fi(),i.pooledCache=o,o.refCount++,null!==o&&(i.pooledCacheLanes|=n),i=o),t.memoizedState={parent:r,cache:i},Is(t),vs(t,Vi,i)):(0!==(e.lanes&n)&&(Ns(e,t),js(t,null,null,n),Ms()),i=e.memoizedState,o=t.memoizedState,i.parent!==r?(i={parent:r,cache:r},t.memoizedState=i,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=i),vs(t,Vi,r)):(r=o.cache,vs(t,Vi,r),r!==i.cache&&Es(t,[Vi],n,!0))),za(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(a(156,t.tag))}var ms=K(null),_s=null,gs=null;function vs(e,t,n){Y(ms,t._currentValue),t._currentValue=n}function ys(e){e._currentValue=ms.current,q(ms)}function bs(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Es(e,t,n,r){var i=e.child;for(null!==i&&(i.return=e);null!==i;){var o=i.dependencies;if(null!==o){var s=i.child;o=o.firstContext;e:for(;null!==o;){var c=o;o=i;for(var l=0;l<t.length;l++)if(c.context===t[l]){o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),bs(o.return,n,e),r||(s=null);break e}o=c.next}}else if(18===i.tag){if(null===(s=i.return))throw Error(a(341));s.lanes|=n,null!==(o=s.alternate)&&(o.lanes|=n),bs(s,n,e),s=null}else s=i.child;if(null!==s)s.return=i;else for(s=i;null!==s;){if(s===e){s=null;break}if(null!==(i=s.sibling)){i.return=s.return,s=i;break}s=s.return}i=s}}function Ss(e,t,n,r){e=null;for(var i=t,o=!1;null!==i;){if(!o)if(0!==(524288&i.flags))o=!0;else if(0!==(262144&i.flags))break;if(10===i.tag){var s=i.alternate;if(null===s)throw Error(a(387));if(null!==(s=s.memoizedProps)){var c=i.type;Yn(i.pendingProps.value,s.value)||(null!==e?e.push(c):e=[c])}}else if(i===Z.current){if(null===(s=i.alternate))throw Error(a(387));s.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(null!==e?e.push(Mu):e=[Mu])}i=i.return}null!==e&&Es(t,e,n,r),t.flags|=262144}function Ts(e){for(e=e.firstContext;null!==e;){if(!Yn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function ws(e){_s=e,gs=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Cs(e){return ks(_s,e)}function Rs(e,t){return null===_s&&ws(e),ks(e,t)}function ks(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===gs){if(null===e)throw Error(a(308));gs=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else gs=gs.next=t;return n}var Os=!1;function Is(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ns(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function As(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function xs(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&el)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,t=Ar(e),Nr(e,null,n),t}return kr(e,r,t,n),Ar(e)}function Ps(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194176&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,De(e,n)}}function Ds(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===o?i=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var Ls=!1;function Ms(){if(Ls){if(null!==zi)throw zi}}function js(e,t,n,r){Ls=!1;var i=e.updateQueue;Os=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var c=s,l=c.next;c.next=null,null===a?o=l:a.next=l,a=c;var d=e.alternate;null!==d&&((s=(d=d.updateQueue).lastBaseUpdate)!==a&&(null===s?d.firstBaseUpdate=l:s.next=l,d.lastBaseUpdate=c))}if(null!==o){var u=i.baseState;for(a=0,d=l=c=null,s=o;;){var h=-536870913&s.lane,p=h!==s.lane;if(p?(rl&h)===h:(r&h)===h){0!==h&&h===Hi&&(Ls=!0),null!==d&&(d=d.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});e:{var f=e,m=s;h=t;var _=n;switch(m.tag){case 1:if("function"===typeof(f=m.payload)){u=f.call(_,u,h);break e}u=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=m.payload)?f.call(_,u,h):f)||void 0===h)break e;u=A({},u,h);break e;case 2:Os=!0}}null!==(h=s.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=i.callbacks)?i.callbacks=[h]:p.push(h))}else p={lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===d?(l=d=p,c=u):d=d.next=p,a|=h;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(p=s).next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}null===d&&(c=u),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=d,null===o&&(i.shared.lanes=0),ul|=a,e.lanes=a,e.memoizedState=u}}function Us(e,t){if("function"!==typeof e)throw Error(a(191,e));e.call(t)}function Vs(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)Us(n[e],t)}function Fs(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var i=r.next;n=i;do{if((n.tag&e)===e){r=void 0;var o=n.create,a=n.inst;r=o(),a.destroy=r}n=n.next}while(n!==i)}}catch(s){rd(t,t.return,s)}}function Bs(e,t,n){try{var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var o=i.next;r=o;do{if((r.tag&e)===e){var a=r.inst,s=a.destroy;if(void 0!==s){a.destroy=void 0,i=t;var c=n;try{s()}catch(l){rd(i,c,l)}}}r=r.next}while(r!==o)}}catch(l){rd(t,t.return,l)}}function Ws(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{Vs(t,n)}catch(r){rd(e,e.return,r)}}}function Gs(e,t,n){n.props=Pa(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(r){rd(e,t,r)}}function Hs(e,t){try{var n=e.ref;if(null!==n){var r=e.stateNode;switch(e.tag){case 26:case 27:case 5:var i=r;break;default:i=r}"function"===typeof n?e.refCleanup=n(i):n.current=i}}catch(o){rd(e,t,o)}}function zs(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"===typeof r)try{r()}catch(i){rd(e,t,i)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(o){rd(e,t,o)}else n.current=null}function Ks(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(i){rd(e,e.return,i)}}function qs(e,t,n){try{var r=e.stateNode;!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,o=null,s=null,c=null,l=null,d=null,u=null;for(f in n){var h=n[f];if(n.hasOwnProperty(f)&&null!=h)switch(f){case"checked":case"value":break;case"defaultValue":l=h;default:r.hasOwnProperty(f)||Hd(e,t,f,null,r,h)}}for(var p in r){var f=r[p];if(h=n[p],r.hasOwnProperty(p)&&(null!=f||null!=h))switch(p){case"type":o=f;break;case"name":i=f;break;case"checked":d=f;break;case"defaultChecked":u=f;break;case"value":s=f;break;case"defaultValue":c=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(a(137,t));break;default:f!==h&&Hd(e,t,p,f,r,h)}}return void _t(e,s,c,l,d,u,o,i);case"select":for(o in f=s=c=p=null,n)if(l=n[o],n.hasOwnProperty(o)&&null!=l)switch(o){case"value":break;case"multiple":f=l;default:r.hasOwnProperty(o)||Hd(e,t,o,null,r,l)}for(i in r)if(o=r[i],l=n[i],r.hasOwnProperty(i)&&(null!=o||null!=l))switch(i){case"value":p=o;break;case"defaultValue":c=o;break;case"multiple":s=o;default:o!==l&&Hd(e,t,i,o,r,l)}return t=c,n=s,r=f,void(null!=p?yt(e,!!n,p,!1):!!r!==!!n&&(null!=t?yt(e,!!n,t,!0):yt(e,!!n,n?[]:"",!1)));case"textarea":for(c in f=p=null,n)if(i=n[c],n.hasOwnProperty(c)&&null!=i&&!r.hasOwnProperty(c))switch(c){case"value":case"children":break;default:Hd(e,t,c,null,r,i)}for(s in r)if(i=r[s],o=n[s],r.hasOwnProperty(s)&&(null!=i||null!=o))switch(s){case"value":p=i;break;case"defaultValue":f=i;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=i)throw Error(a(91));break;default:i!==o&&Hd(e,t,s,i,r,o)}return void bt(e,p,f);case"option":for(var m in n)if(p=n[m],n.hasOwnProperty(m)&&null!=p&&!r.hasOwnProperty(m))if("selected"===m)e.selected=!1;else Hd(e,t,m,null,r,p);for(l in r)if(p=r[l],f=n[l],r.hasOwnProperty(l)&&p!==f&&(null!=p||null!=f))if("selected"===l)e.selected=p&&"function"!==typeof p&&"symbol"!==typeof p;else Hd(e,t,l,p,r,f);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var _ in n)p=n[_],n.hasOwnProperty(_)&&null!=p&&!r.hasOwnProperty(_)&&Hd(e,t,_,null,r,p);for(d in r)if(p=r[d],f=n[d],r.hasOwnProperty(d)&&p!==f&&(null!=p||null!=f))switch(d){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(a(137,t));break;default:Hd(e,t,d,p,r,f)}return;default:if(Rt(t)){for(var g in n)p=n[g],n.hasOwnProperty(g)&&void 0!==p&&!r.hasOwnProperty(g)&&zd(e,t,g,void 0,r,p);for(u in r)p=r[u],f=n[u],!r.hasOwnProperty(u)||p===f||void 0===p&&void 0===f||zd(e,t,u,p,r,f);return}}for(var v in n)p=n[v],n.hasOwnProperty(v)&&null!=p&&!r.hasOwnProperty(v)&&Hd(e,t,v,null,r,p);for(h in r)p=r[h],f=n[h],!r.hasOwnProperty(h)||p===f||null==p&&null==f||Hd(e,t,h,p,r,f)}(r,e.type,n,t),r[Ve]=t}catch(i){rd(e,e.return,i)}}function Ys(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag||4===e.tag}function Js(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Ys(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&27!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Xs(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Gd));else if(4!==r&&27!==r&&null!==(e=e.child))for(Xs(e,t,n),e=e.sibling;null!==e;)Xs(e,t,n),e=e.sibling}function Qs(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&27!==r&&null!==(e=e.child))for(Qs(e,t,n),e=e.sibling;null!==e;)Qs(e,t,n),e=e.sibling}var Zs=!1,$s=!1,ec=!1,tc="function"===typeof WeakSet?WeakSet:Set,nc=null,rc=!1;function ic(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:gc(e,n),4&r&&Fs(5,n);break;case 1:if(gc(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(s){rd(n,n.return,s)}else{var i=Pa(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(c){rd(n,n.return,c)}}64&r&&Ws(n),512&r&&Hs(n,n.return);break;case 3:if(gc(e,n),64&r&&null!==(r=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:e=n.child.stateNode}try{Vs(r,e)}catch(s){rd(n,n.return,s)}}break;case 26:gc(e,n),512&r&&Hs(n,n.return);break;case 27:case 5:gc(e,n),null===t&&4&r&&Ks(n),512&r&&Hs(n,n.return);break;case 12:default:gc(e,n);break;case 13:gc(e,n),4&r&&dc(e,n);break;case 22:if(!(i=null!==n.memoizedState||Zs)){t=null!==t&&null!==t.memoizedState||$s;var o=Zs,a=$s;Zs=i,($s=t)&&!a?yc(e,n,0!==(8772&n.subtreeFlags)):gc(e,n),Zs=o,$s=a}512&r&&("manual"===n.memoizedProps.mode?Hs(n,n.return):zs(n,n.return))}}function oc(e){var t=e.alternate;null!==t&&(e.alternate=null,oc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Ke(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var ac=null,sc=!1;function cc(e,t,n){for(n=n.child;null!==n;)lc(e,t,n),n=n.sibling}function lc(e,t,n){if(ve&&"function"===typeof ve.onCommitFiberUnmount)try{ve.onCommitFiberUnmount(ge,n)}catch(a){}switch(n.tag){case 26:$s||zs(n,t),cc(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:$s||zs(n,t);var r=ac,i=sc;for(ac=n.stateNode,cc(e,t,n),t=(n=n.stateNode).attributes;t.length;)n.removeAttributeNode(t[0]);Ke(n),ac=r,sc=i;break;case 5:$s||zs(n,t);case 6:i=ac;var o=sc;if(ac=null,cc(e,t,n),sc=o,null!==(ac=i))if(sc)try{e=ac,r=n.stateNode,8===e.nodeType?e.parentNode.removeChild(r):e.removeChild(r)}catch(s){rd(n,t,s)}else try{ac.removeChild(n.stateNode)}catch(s){rd(n,t,s)}break;case 18:null!==ac&&(sc?(t=ac,n=n.stateNode,8===t.nodeType?ou(t.parentNode,n):1===t.nodeType&&ou(t,n),mh(t)):ou(ac,n.stateNode));break;case 4:r=ac,i=sc,ac=n.stateNode.containerInfo,sc=!0,cc(e,t,n),ac=r,sc=i;break;case 0:case 11:case 14:case 15:$s||Bs(2,n,t),$s||Bs(4,n,t),cc(e,t,n);break;case 1:$s||(zs(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount&&Gs(n,t,r)),cc(e,t,n);break;case 21:cc(e,t,n);break;case 22:$s||zs(n,t),$s=(r=$s)||null!==n.memoizedState,cc(e,t,n),$s=r;break;default:cc(e,t,n)}}function dc(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{mh(e)}catch(n){rd(t,t.return,n)}}function uc(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new tc),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new tc),t;default:throw Error(a(435,e.tag))}}(e);t.forEach((function(t){var r=cd.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}function hc(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r],o=e,s=t,c=s;e:for(;null!==c;){switch(c.tag){case 27:case 5:ac=c.stateNode,sc=!1;break e;case 3:case 4:ac=c.stateNode.containerInfo,sc=!0;break e}c=c.return}if(null===ac)throw Error(a(160));lc(o,s,i),ac=null,sc=!1,null!==(o=i.alternate)&&(o.return=null),i.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)fc(t,e),t=t.sibling}var pc=null;function fc(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:hc(t,e),mc(e),4&r&&(Bs(3,e,e.return),Fs(3,e),Bs(5,e,e.return));break;case 1:hc(t,e),mc(e),512&r&&($s||null===n||zs(n,n.return)),64&r&&Zs&&(null!==(e=e.updateQueue)&&(null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r))));break;case 26:var i=pc;if(hc(t,e),mc(e),512&r&&($s||null===n||zs(n,n.return)),4&r){var o=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,i=i.ownerDocument||i;t:switch(r){case"title":(!(o=i.getElementsByTagName("title")[0])||o[ze]||o[Ue]||"http://www.w3.org/2000/svg"===o.namespaceURI||o.hasAttribute("itemprop"))&&(o=i.createElement(r),i.head.insertBefore(o,i.querySelector("head > title"))),Kd(o,r,n),o[Ue]=e,Qe(o),r=o;break e;case"link":var s=ku("link","href",i).get(r+(n.href||""));if(s)for(var c=0;c<s.length;c++)if((o=s[c]).getAttribute("href")===(null==n.href?null:n.href)&&o.getAttribute("rel")===(null==n.rel?null:n.rel)&&o.getAttribute("title")===(null==n.title?null:n.title)&&o.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){s.splice(c,1);break t}Kd(o=i.createElement(r),r,n),i.head.appendChild(o);break;case"meta":if(s=ku("meta","content",i).get(r+(n.content||"")))for(c=0;c<s.length;c++)if((o=s[c]).getAttribute("content")===(null==n.content?null:""+n.content)&&o.getAttribute("name")===(null==n.name?null:n.name)&&o.getAttribute("property")===(null==n.property?null:n.property)&&o.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&o.getAttribute("charset")===(null==n.charSet?null:n.charSet)){s.splice(c,1);break t}Kd(o=i.createElement(r),r,n),i.head.appendChild(o);break;default:throw Error(a(468,r))}o[Ue]=e,Qe(o),r=o}e.stateNode=r}else Ou(i,e.type,e.stateNode);else e.stateNode=Su(i,r,e.memoizedProps);else o!==r?(null===o?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):o.count--,null===r?Ou(i,e.type,e.stateNode):Su(i,r,e.memoizedProps)):null===r&&null!==e.stateNode&&qs(e,e.memoizedProps,n.memoizedProps)}break;case 27:if(4&r&&null===e.alternate){i=e.stateNode,o=e.memoizedProps;try{for(var l=i.firstChild;l;){var d=l.nextSibling,u=l.nodeName;l[ze]||"HEAD"===u||"BODY"===u||"SCRIPT"===u||"STYLE"===u||"LINK"===u&&"stylesheet"===l.rel.toLowerCase()||i.removeChild(l),l=d}for(var h=e.type,p=i.attributes;p.length;)i.removeAttributeNode(p[0]);Kd(i,h,o),i[Ue]=e,i[Ve]=o}catch(m){rd(e,e.return,m)}}case 5:if(hc(t,e),mc(e),512&r&&($s||null===n||zs(n,n.return)),32&e.flags){i=e.stateNode;try{St(i,"")}catch(m){rd(e,e.return,m)}}4&r&&null!=e.stateNode&&qs(e,i=e.memoizedProps,null!==n?n.memoizedProps:i),1024&r&&(ec=!0);break;case 6:if(hc(t,e),mc(e),4&r){if(null===e.stateNode)throw Error(a(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(m){rd(e,e.return,m)}}break;case 3:if(Ru=null,i=pc,pc=hu(t.containerInfo),hc(t,e),pc=i,mc(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{mh(t.containerInfo)}catch(m){rd(e,e.return,m)}ec&&(ec=!1,_c(e));break;case 4:r=pc,pc=hu(e.stateNode.containerInfo),hc(t,e),mc(e),pc=r;break;case 12:hc(t,e),mc(e);break;case 13:hc(t,e),mc(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(yl=ce()),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,uc(e,r)));break;case 22:if(512&r&&($s||null===n||zs(n,n.return)),l=null!==e.memoizedState,d=null!==n&&null!==n.memoizedState,Zs=(u=Zs)||l,$s=(h=$s)||d,hc(t,e),$s=h,Zs=u,mc(e),(t=e.stateNode)._current=e,t._visibility&=-3,t._visibility|=2&t._pendingVisibility,8192&r&&(t._visibility=l?-2&t._visibility:1|t._visibility,l&&(t=Zs||$s,null===n||d||t||vc(e)),null===e.memoizedProps||"manual"!==e.memoizedProps.mode))e:for(n=null,t=e;;){if(5===t.tag||26===t.tag||27===t.tag){if(null===n){d=n=t;try{if(i=d.stateNode,l)"function"===typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none";else{s=d.stateNode;var f=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null;s.style.display=null==f||"boolean"===typeof f?"":(""+f).trim()}}catch(m){rd(d,d.return,m)}}}else if(6===t.tag){if(null===n){d=t;try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(m){rd(d,d.return,m)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&(null!==(r=e.updateQueue)&&(null!==(n=r.retryQueue)&&(r.retryQueue=null,uc(e,n))));break;case 19:hc(t,e),mc(e),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,uc(e,r)));break;case 21:break;default:hc(t,e),mc(e)}}function mc(e){var t=e.flags;if(2&t){try{if(27!==e.tag){e:{for(var n=e.return;null!==n;){if(Ys(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 27:var i=r.stateNode;Qs(e,Js(e),i);break;case 5:var o=r.stateNode;32&r.flags&&(St(o,""),r.flags&=-33),Qs(e,Js(e),o);break;case 3:case 4:var s=r.stateNode.containerInfo;Xs(e,Js(e),s);break;default:throw Error(a(161))}}}catch(c){rd(e,e.return,c)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function _c(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;_c(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function gc(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)ic(e,t.alternate,t),t=t.sibling}function vc(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Bs(4,t,t.return),vc(t);break;case 1:zs(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&Gs(t,t.return,n),vc(t);break;case 26:case 27:case 5:zs(t,t.return),vc(t);break;case 22:zs(t,t.return),null===t.memoizedState&&vc(t);break;default:vc(t)}e=e.sibling}}function yc(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,i=e,o=t,a=o.flags;switch(o.tag){case 0:case 11:case 15:yc(i,o,n),Fs(4,o);break;case 1:if(yc(i,o,n),"function"===typeof(i=(r=o).stateNode).componentDidMount)try{i.componentDidMount()}catch(l){rd(r,r.return,l)}if(null!==(i=(r=o).updateQueue)){var s=r.stateNode;try{var c=i.shared.hiddenCallbacks;if(null!==c)for(i.shared.hiddenCallbacks=null,i=0;i<c.length;i++)Us(c[i],s)}catch(l){rd(r,r.return,l)}}n&&64&a&&Ws(o),Hs(o,o.return);break;case 26:case 27:case 5:yc(i,o,n),n&&null===r&&4&a&&Ks(o),Hs(o,o.return);break;case 12:default:yc(i,o,n);break;case 13:yc(i,o,n),n&&4&a&&dc(i,o);break;case 22:null===o.memoizedState&&yc(i,o,n),Hs(o,o.return)}t=t.sibling}}function bc(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Bi(n))}function Ec(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Bi(e))}function Sc(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Tc(e,t,n,r),t=t.sibling}function Tc(e,t,n,r){var i=t.flags;switch(t.tag){case 0:case 11:case 15:Sc(e,t,n,r),2048&i&&Fs(9,t);break;case 3:Sc(e,t,n,r),2048&i&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Bi(e)));break;case 12:if(2048&i){Sc(e,t,n,r),e=t.stateNode;try{var o=t.memoizedProps,a=o.id,s=o.onPostCommit;"function"===typeof s&&s(a,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(c){rd(t,t.return,c)}}else Sc(e,t,n,r);break;case 23:break;case 22:o=t.stateNode,null!==t.memoizedState?4&o._visibility?Sc(e,t,n,r):Cc(e,t):4&o._visibility?Sc(e,t,n,r):(o._visibility|=4,wc(e,t,n,r,0!==(10256&t.subtreeFlags))),2048&i&&bc(t.alternate,t);break;case 24:Sc(e,t,n,r),2048&i&&Ec(t.alternate,t);break;default:Sc(e,t,n,r)}}function wc(e,t,n,r,i){for(i=i&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var o=e,a=t,s=n,c=r,l=a.flags;switch(a.tag){case 0:case 11:case 15:wc(o,a,s,c,i),Fs(8,a);break;case 23:break;case 22:var d=a.stateNode;null!==a.memoizedState?4&d._visibility?wc(o,a,s,c,i):Cc(o,a):(d._visibility|=4,wc(o,a,s,c,i)),i&&2048&l&&bc(a.alternate,a);break;case 24:wc(o,a,s,c,i),i&&2048&l&&Ec(a.alternate,a);break;default:wc(o,a,s,c,i)}t=t.sibling}}function Cc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,i=r.flags;switch(r.tag){case 22:Cc(n,r),2048&i&&bc(r.alternate,r);break;case 24:Cc(n,r),2048&i&&Ec(r.alternate,r);break;default:Cc(n,r)}t=t.sibling}}var Rc=8192;function kc(e){if(e.subtreeFlags&Rc)for(e=e.child;null!==e;)Oc(e),e=e.sibling}function Oc(e){switch(e.tag){case 26:kc(e),e.flags&Rc&&null!==e.memoizedState&&function(e,t,n){if(null===Nu)throw Error(a(475));var r=Nu;if("stylesheet"===t.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var i=gu(n.href),o=e.querySelector(vu(i));if(o)return null!==(e=o._p)&&"object"===typeof e&&"function"===typeof e.then&&(r.count++,r=xu.bind(r),e.then(r,r)),t.state.loading|=4,t.instance=o,void Qe(o);o=e.ownerDocument||e,n=yu(n),(i=du.get(i))&&wu(n,i),Qe(o=o.createElement("link"));var s=o;s._p=new Promise((function(e,t){s.onload=e,s.onerror=t})),Kd(o,"link",n),t.instance=o}null===r.stylesheets&&(r.stylesheets=new Map),r.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(r.count++,t=xu.bind(r),e.addEventListener("load",t),e.addEventListener("error",t))}}(pc,e.memoizedState,e.memoizedProps);break;case 5:default:kc(e);break;case 3:case 4:var t=pc;pc=hu(e.stateNode.containerInfo),kc(e),pc=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Rc,Rc=16777216,kc(e),Rc=t):kc(e))}}function Ic(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Nc(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];nc=r,Pc(r,e)}Ic(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Ac(e),e=e.sibling}function Ac(e){switch(e.tag){case 0:case 11:case 15:Nc(e),2048&e.flags&&Bs(9,e,e.return);break;case 3:case 12:default:Nc(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&4&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-5,xc(e)):Nc(e)}}function xc(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];nc=r,Pc(r,e)}Ic(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:Bs(8,t,t.return),xc(t);break;case 22:4&(n=t.stateNode)._visibility&&(n._visibility&=-5,xc(t));break;default:xc(t)}e=e.sibling}}function Pc(e,t){for(;null!==nc;){var n=nc;switch(n.tag){case 0:case 11:case 15:Bs(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:Bi(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,nc=r;else e:for(n=e;null!==nc;){var i=(r=nc).sibling,o=r.return;if(oc(r),r===n){nc=null;break e}if(null!==i){i.return=o,nc=i;break e}nc=o}}}function Dc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lc(e,t,n,r){return new Dc(e,t,n,r)}function Mc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function jc(e,t){var n=e.alternate;return null===n?((n=Lc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=31457280&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Uc(e,t){e.flags&=31457282;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Vc(e,t,n,r,i,o){var s=0;if(r=e,"function"===typeof e)Mc(e)&&(s=1);else if("string"===typeof e)s=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,J.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case u:return Fc(n.children,i,o,t);case h:s=8,i|=24;break;case p:return(e=Lc(12,n,t,2|i)).elementType=p,e.lanes=o,e;case v:return(e=Lc(13,n,t,i)).elementType=v,e.lanes=o,e;case y:return(e=Lc(19,n,t,i)).elementType=y,e.lanes=o,e;case S:return Bc(n,i,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case f:case _:s=10;break e;case m:s=9;break e;case g:s=11;break e;case b:s=14;break e;case E:s=16,r=null;break e}s=29,n=Error(a(130,null===e?"null":typeof e,"")),r=null}return(t=Lc(s,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Fc(e,t,n,r){return(e=Lc(7,e,r,t)).lanes=n,e}function Bc(e,t,n,r){(e=Lc(22,e,r,t)).elementType=S,e.lanes=n;var i={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var e=i._current;if(null===e)throw Error(a(456));if(0===(2&i._pendingVisibility)){var t=Ir(e,2);null!==t&&(i._pendingVisibility|=2,xl(t,e,2))}},attach:function(){var e=i._current;if(null===e)throw Error(a(456));if(0!==(2&i._pendingVisibility)){var t=Ir(e,2);null!==t&&(i._pendingVisibility&=-3,xl(t,e,2))}}};return e.stateNode=i,e}function Wc(e,t,n){return(e=Lc(6,e,null,t)).lanes=n,e}function Gc(e,t,n){return(t=Lc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Hc(e){e.flags|=4}function zc(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!Iu(t)){if(null!==(t=Oi.current)&&((4194176&rl)===rl?null!==Ii:(62914560&rl)!==rl&&0===(536870912&rl)||t!==Ii))throw hi=ci,si;e.flags|=8192}}function Kc(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Ne():536870912,e.lanes|=t,ml|=t)}function qc(e,t){if(!Xr)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Yc(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=31457280&i.subtreeFlags,r|=31457280&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Jc(e,t,n){var r=t.pendingProps;switch(qr(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return Yc(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),ys(Vi),ee(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ri(t)?Hc(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==Qr&&(Dl(Qr),Qr=null))),Yc(t),null;case 26:return n=t.memoizedState,null===e?(Hc(t),null!==n?(Yc(t),zc(t,n)):(Yc(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Hc(t),Yc(t),zc(t,n)):(Yc(t),t.flags&=-16777217):(e.memoizedProps!==r&&Hc(t),Yc(t),t.flags&=-16777217),null;case 27:ne(t),n=Q.current;var i=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Hc(t);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Yc(t),null}e=J.current,ri(t)?ti(t):(e=lu(i,r,n),t.stateNode=e,Hc(t))}return Yc(t),null;case 5:if(ne(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Hc(t);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Yc(t),null}if(e=J.current,ri(t))ti(t);else{switch(i=Jd(Q.current),e){case 1:e=i.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=i.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=i.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=i.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=i.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof r.is?i.createElement("select",{is:r.is}):i.createElement("select"),r.multiple?e.multiple=!0:r.size&&(e.size=r.size);break;default:e="string"===typeof r.is?i.createElement(n,{is:r.is}):i.createElement(n)}}e[Ue]=t,e[Ve]=r;e:for(i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&27!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break e;for(;null===i.sibling;){if(null===i.return||i.return===t)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}t.stateNode=e;e:switch(Kd(e,n,r),n){case"button":case"input":case"select":case"textarea":e=!!r.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Hc(t)}}return Yc(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&Hc(t);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(e=Q.current,ri(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(i=Yr))switch(i.tag){case 27:case 5:r=i.memoizedProps}e[Ue]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||Wd(e.nodeValue,n)))||ei(t)}else(e=Jd(e).createTextNode(r))[Ue]=t,t.stateNode=e}return Yc(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(i=ri(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(a(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(a(317));i[Ue]=t}else ii(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Yc(t),i=!1}else null!==Qr&&(Dl(Qr),Qr=null),i=!0;if(!i)return 256&t.flags?(Pi(t),t):(Pi(t),null)}if(Pi(t),0!==(128&t.flags))return t.lanes=n,t;if(n=null!==r,e=null!==e&&null!==e.memoizedState,n){i=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(i=r.alternate.memoizedState.cachePool.pool);var o=null;null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(o=r.memoizedState.cachePool.pool),o!==i&&(r.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),Kc(t,t.updateQueue),Yc(t),null;case 4:return ee(),null===e&&xd(t.stateNode.containerInfo),Yc(t),null;case 10:return ys(t.type),Yc(t),null;case 19:if(q(Di),null===(i=t.memoizedState))return Yc(t),null;if(r=0!==(128&t.flags),null===(o=i.rendering))if(r)qc(i,!1);else{if(0!==dl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(o=Li(e))){for(t.flags|=128,qc(i,!1),e=o.updateQueue,t.updateQueue=e,Kc(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Uc(n,e),n=n.sibling;return Y(Di,1&Di.current|2),t.child}e=e.sibling}null!==i.tail&&ce()>bl&&(t.flags|=128,r=!0,qc(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=Li(o))){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,Kc(t,e),qc(i,!0),null===i.tail&&"hidden"===i.tailMode&&!o.alternate&&!Xr)return Yc(t),null}else 2*ce()-i.renderingStartTime>bl&&536870912!==n&&(t.flags|=128,r=!0,qc(i,!1),t.lanes=4194304);i.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=i.last)?e.sibling=o:t.child=o,i.last=o)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=ce(),t.sibling=null,e=Di.current,Y(Di,r?1&e|2:1&e),t):(Yc(t),null);case 22:case 23:return Pi(t),ki(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?0!==(536870912&n)&&0===(128&t.flags)&&(Yc(t),6&t.subtreeFlags&&(t.flags|=8192)):Yc(t),null!==(n=t.updateQueue)&&Kc(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&q(Yi),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),ys(Vi),Yc(t),null;case 25:return null}throw Error(a(156,t.tag))}function Xc(e,t){switch(qr(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ys(Vi),ee(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return ne(t),null;case 13:if(Pi(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));ii()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return q(Di),null;case 4:return ee(),null;case 10:return ys(t.type),null;case 22:case 23:return Pi(t),ki(),null!==e&&q(Yi),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return ys(Vi),null;default:return null}}function Qc(e,t){switch(qr(t),t.tag){case 3:ys(Vi),ee();break;case 26:case 27:case 5:ne(t);break;case 4:ee();break;case 13:Pi(t);break;case 19:q(Di);break;case 10:ys(t.type);break;case 22:case 23:Pi(t),ki(),null!==e&&q(Yi);break;case 24:ys(Vi)}}var Zc={getCacheForType:function(e){var t=Cs(Vi),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},$c="function"===typeof WeakMap?WeakMap:Map,el=0,tl=null,nl=null,rl=0,il=0,ol=null,al=!1,sl=!1,cl=!1,ll=0,dl=0,ul=0,hl=0,pl=0,fl=0,ml=0,_l=null,gl=null,vl=!1,yl=0,bl=1/0,El=null,Sl=null,Tl=!1,wl=null,Cl=0,Rl=0,kl=null,Ol=0,Il=null;function Nl(){if(0!==(2&el)&&0!==rl)return rl&-rl;if(null!==N.T){return 0!==Hi?Hi:Ed()}return Me()}function Al(){0===fl&&(fl=0===(536870912&rl)||Xr?Ie():536870912);var e=Oi.current;return null!==e&&(e.flags|=32),fl}function xl(e,t,n){(e===tl&&2===il||null!==e.cancelPendingCommit)&&(Fl(e,0),jl(e,rl,fl,!1)),xe(e,n),0!==(2&el)&&e===tl||(e===tl&&(0===(2&el)&&(hl|=n),4===dl&&jl(e,rl,fl,!1)),md(e))}function Pl(e,t,n){if(0!==(6&el))throw Error(a(327));for(var r=!n&&0===(60&t)&&0===(t&e.expiredLanes)||ke(e,t),i=r?function(e,t){var n=el;el|=2;var r=Wl(),i=Gl();tl!==e||rl!==t?(El=null,bl=ce()+500,Fl(e,t)):sl=ke(e,t);e:for(;;)try{if(0!==il&&null!==nl){t=nl;var o=ol;t:switch(il){case 1:il=0,ol=null,Xl(e,t,o,1);break;case 2:if(li(o)){il=0,ol=null,Jl(t);break}t=function(){2===il&&tl===e&&(il=7),md(e)},o.then(t,t);break e;case 3:il=7;break e;case 4:il=5;break e;case 7:li(o)?(il=0,ol=null,Jl(t)):(il=0,ol=null,Xl(e,t,o,7));break;case 5:var s=null;switch(nl.tag){case 26:s=nl.memoizedState;case 5:case 27:var c=nl;if(!s||Iu(s)){il=0,ol=null;var l=c.sibling;if(null!==l)nl=l;else{var d=c.return;null!==d?(nl=d,Ql(d)):nl=null}break t}}il=0,ol=null,Xl(e,t,o,5);break;case 6:il=0,ol=null,Xl(e,t,o,6);break;case 8:Vl(),dl=6;break e;default:throw Error(a(462))}}ql();break}catch(u){Bl(e,u)}return gs=_s=null,N.H=r,N.A=i,el=n,null!==nl?0:(tl=null,rl=0,Rr(),dl)}(e,t):zl(e,t,!0),o=r;;){if(0===i){sl&&!r&&jl(e,t,0,!1);break}if(6===i)jl(e,t,0,!al);else{if(n=e.current.alternate,o&&!Ml(n)){i=zl(e,t,!1),o=!1;continue}if(2===i){if(o=t,e.errorRecoveryDisabledLanes&o)var s=0;else s=0!==(s=-536870913&e.pendingLanes)?s:536870912&s?536870912:0;if(0!==s){t=s;e:{var c=e;i=_l;var l=c.current.memoizedState.isDehydrated;if(l&&(Fl(c,s).flags|=256),2!==(s=zl(c,s,!1))){if(cl&&!l){c.errorRecoveryDisabledLanes|=o,hl|=o,i=4;break e}o=gl,gl=i,null!==o&&Dl(o)}i=s}if(o=!1,2!==i)continue}}if(1===i){Fl(e,0),jl(e,t,0,!0);break}e:{switch(r=e,i){case 0:case 1:throw Error(a(345));case 4:if((4194176&t)===t){jl(r,t,fl,!al);break e}break;case 2:gl=null;break;case 3:case 5:break;default:throw Error(a(329))}if(r.finishedWork=n,r.finishedLanes=t,(62914560&t)===t&&10<(o=yl+300-ce())){if(jl(r,t,fl,!al),0!==Re(r,0))break e;r.timeoutHandle=eu(Ll.bind(null,r,n,gl,El,vl,t,fl,hl,ml,al,2,-0,0),o)}else Ll(r,n,gl,El,vl,t,fl,hl,ml,al,0,-0,0)}}break}md(e)}function Dl(e){null===gl?gl=e:gl.push.apply(gl,e)}function Ll(e,t,n,r,i,o,s,c,l,d,u,h,p){var f=t.subtreeFlags;if((8192&f||16785408===(16785408&f))&&(Nu={stylesheets:null,count:0,unsuspend:Au},Oc(t),null!==(t=function(){if(null===Nu)throw Error(a(475));var e=Nu;return e.stylesheets&&0===e.count&&Du(e,e.stylesheets),0<e.count?function(t){var n=setTimeout((function(){if(e.stylesheets&&Du(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}}),6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=t($l.bind(null,e,n,r,i,s,c,l,1,h,p)),void jl(e,o,s,!d);$l(e,n,r,i,s,c,l,u,h,p)}function Ml(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!Yn(o(),i))return!1}catch(a){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function jl(e,t,n,r){t&=~pl,t&=~hl,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var i=t;0<i;){var o=31-be(i),a=1<<o;r[o]=-1,i&=~a}0!==n&&Pe(e,n,t)}function Ul(){return 0!==(6&el)||(_d(0,!1),!1)}function Vl(){if(null!==nl){if(0===il)var e=nl.return;else gs=_s=null,vo(e=nl),fi=null,mi=0,e=nl;for(;null!==e;)Qc(e.alternate,e),e=e.return;nl=null}}function Fl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,tu(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Vl(),tl=e,nl=n=jc(e.current,null),rl=t,il=0,ol=null,al=!1,sl=ke(e,t),cl=!1,ml=fl=pl=hl=ul=dl=0,gl=_l=null,vl=!1,0!==(8&t)&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var i=31-be(r),o=1<<i;t|=e[i],r&=~o}return ll=t,Rr(),n}function Bl(e,t){$i=null,N.H=Ca,t===ai?(t=pi(),il=3):t===si?(t=pi(),il=4):il=t===Ga?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,ol=t,null===nl&&(dl=1,Ua(e,Dr(t,e.current)))}function Wl(){var e=N.H;return N.H=Ca,null===e?Ca:e}function Gl(){var e=N.A;return N.A=Zc,e}function Hl(){dl=4,al||(4194176&rl)!==rl&&null!==Oi.current||(sl=!0),0===(134217727&ul)&&0===(134217727&hl)||null===tl||jl(tl,rl,fl,!1)}function zl(e,t,n){var r=el;el|=2;var i=Wl(),o=Gl();tl===e&&rl===t||(El=null,Fl(e,t)),t=!1;var a=dl;e:for(;;)try{if(0!==il&&null!==nl){var s=nl,c=ol;switch(il){case 8:Vl(),a=6;break e;case 3:case 2:case 6:null===Oi.current&&(t=!0);var l=il;if(il=0,ol=null,Xl(e,s,c,l),n&&sl){a=0;break e}break;default:l=il,il=0,ol=null,Xl(e,s,c,l)}}Kl(),a=dl;break}catch(d){Bl(e,d)}return t&&e.shellSuspendCounter++,gs=_s=null,el=r,N.H=i,N.A=o,null===nl&&(tl=null,rl=0,Rr()),a}function Kl(){for(;null!==nl;)Yl(nl)}function ql(){for(;null!==nl&&!ae();)Yl(nl)}function Yl(e){var t=fs(e.alternate,e,ll);e.memoizedProps=e.pendingProps,null===t?Ql(e):nl=t}function Jl(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=$a(n,t,t.pendingProps,t.type,void 0,rl);break;case 11:t=$a(n,t,t.pendingProps,t.type.render,t.ref,rl);break;case 5:vo(t);default:Qc(n,t),t=fs(n,t=nl=Uc(t,ll),ll)}e.memoizedProps=e.pendingProps,null===t?Ql(e):nl=t}function Xl(e,t,n,r){gs=_s=null,vo(t),fi=null,mi=0;var i=t.return;try{if(function(e,t,n,r,i){if(n.flags|=32768,null!==r&&"object"===typeof r&&"function"===typeof r.then){if(null!==(t=n.alternate)&&Ss(t,n,i,!0),null!==(n=Oi.current)){switch(n.tag){case 13:return null===Ii?Hl():null===n.alternate&&0===dl&&(dl=3),n.flags&=-257,n.flags|=65536,n.lanes=i,r===ci?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),id(e,r,i)),!1;case 22:return n.flags|=65536,r===ci?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),id(e,r,i)),!1}throw Error(a(435,n.tag))}return id(e,r,i),Hl(),!1}if(Xr)return null!==(t=Oi.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=i,r!==$r&&oi(Dr(e=Error(a(422),{cause:r}),n))):(r!==$r&&oi(Dr(t=Error(a(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,i&=-i,e.lanes|=i,r=Dr(r,n),Ds(e,i=Fa(e.stateNode,r,i)),4!==dl&&(dl=2)),!1;var o=Error(a(520),{cause:r});if(o=Dr(o,n),null===_l?_l=[o]:_l.push(o),4!==dl&&(dl=2),null===t)return!0;r=Dr(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=i&-i,n.lanes|=e,Ds(n,e=Fa(n.stateNode,r,e)),!1;case 1:if(t=n.type,o=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==o&&"function"===typeof o.componentDidCatch&&(null===Sl||!Sl.has(o))))return n.flags|=65536,i&=-i,n.lanes|=i,Wa(i=Ba(i),e,n,r),Ds(n,i),!1}n=n.return}while(null!==n);return!1}(e,i,t,n,rl))return dl=1,Ua(e,Dr(n,e.current)),void(nl=null)}catch(o){if(null!==i)throw nl=i,o;return dl=1,Ua(e,Dr(n,e.current)),void(nl=null)}32768&t.flags?(Xr||1===r?e=!0:sl||0!==(536870912&rl)?e=!1:(al=e=!0,(2===r||3===r||6===r)&&(null!==(r=Oi.current)&&13===r.tag&&(r.flags|=16384))),Zl(t,e)):Ql(t)}function Ql(e){var t=e;do{if(0!==(32768&t.flags))return void Zl(t,al);e=t.return;var n=Jc(t.alternate,t,ll);if(null!==n)return void(nl=n);if(null!==(t=t.sibling))return void(nl=t);nl=t=e}while(null!==t);0===dl&&(dl=5)}function Zl(e,t){do{var n=Xc(e.alternate,e);if(null!==n)return n.flags&=32767,void(nl=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(nl=e);nl=e=n}while(null!==e);dl=6,nl=null}function $l(e,t,n,r,i,o,s,c,l,d){var u=N.T,h=W.p;try{W.p=2,N.T=null,function(e,t,n,r,i,o,s,c){do{td()}while(null!==wl);if(0!==(6&el))throw Error(a(327));var l=e.finishedWork;if(r=e.finishedLanes,null===l)return null;if(e.finishedWork=null,e.finishedLanes=0,l===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0,e.cancelPendingCommit=null;var d=l.lanes|l.childLanes;if(function(e,t,n,r,i,o){var a=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var s=e.entanglements,c=e.expirationTimes,l=e.hiddenUpdates;for(n=a&~n;0<n;){var d=31-be(n),u=1<<d;s[d]=0,c[d]=-1;var h=l[d];if(null!==h)for(l[d]=null,d=0;d<h.length;d++){var p=h[d];null!==p&&(p.lane&=-536870913)}n&=~u}0!==r&&Pe(e,r,0),0!==o&&0===i&&0!==e.tag&&(e.suspendedLanes|=o&~(a&~t))}(e,r,d|=Cr,o,s,c),e===tl&&(nl=tl=null,rl=0),0===(10256&l.subtreeFlags)&&0===(10256&l.flags)||Tl||(Tl=!0,Rl=d,kl=n,function(e,t){ie(e,t)}(he,(function(){return td(),null}))),n=0!==(15990&l.flags),0!==(15990&l.subtreeFlags)||n?(n=N.T,N.T=null,o=W.p,W.p=2,s=el,el|=4,function(e,t){if(e=e.containerInfo,qd=Hu,er(e=$n(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(_){n=null;break e}var s=0,c=-1,l=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==i&&3!==h.nodeType||(c=s+i),h!==o||0!==r&&3!==h.nodeType||(l=s+r),3===h.nodeType&&(s+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++d===i&&(c=s),p===o&&++u===r&&(l=s),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Yd={focusedElem:e,selectionRange:n},Hu=!1,nc=t;null!==nc;)if(e=(t=nc).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,nc=e;else for(;null!==nc;){switch(o=(t=nc).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==o){e=void 0,n=t,i=o.memoizedProps,o=o.memoizedState,r=n.stateNode;try{var m=Pa(n.type,i,(n.elementType,n.type));e=r.getSnapshotBeforeUpdate(m,o),r.__reactInternalSnapshotBeforeUpdate=e}catch(g){rd(n,n.return,g)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))au(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":au(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(a(163))}if(null!==(e=t.sibling)){e.return=t.return,nc=e;break}nc=t.return}m=rc,rc=!1}(e,l),fc(l,e),tr(Yd,e.containerInfo),Hu=!!qd,Yd=qd=null,e.current=l,ic(e,l.alternate,l),se(),el=s,W.p=o,N.T=n):e.current=l,Tl?(Tl=!1,wl=e,Cl=r):ed(e,d),d=e.pendingLanes,0===d&&(Sl=null),function(e){if(ve&&"function"===typeof ve.onCommitFiberRoot)try{ve.onCommitFiberRoot(ge,e,void 0,128===(128&e.current.flags))}catch(t){}}(l.stateNode),md(e),null!==t)for(i=e.onRecoverableError,l=0;l<t.length;l++)d=t[l],i(d.value,{componentStack:d.stack});0!==(3&Cl)&&td(),d=e.pendingLanes,0!==(4194218&r)&&0!==(42&d)?e===Il?Ol++:(Ol=0,Il=e):Ol=0,_d(0,!1)}(e,t,n,r,h,i,o,s)}finally{N.T=u,W.p=h}}function ed(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Bi(t)))}function td(){if(null!==wl){var e=wl,t=Rl;Rl=0;var n=Le(Cl),r=N.T,i=W.p;try{if(W.p=32>n?32:n,N.T=null,null===wl)var o=!1;else{n=kl,kl=null;var s=wl,c=Cl;if(wl=null,Cl=0,0!==(6&el))throw Error(a(331));var l=el;if(el|=4,Ac(s.current),Tc(s,s.current,c,n),el=l,_d(0,!1),ve&&"function"===typeof ve.onPostCommitFiberRoot)try{ve.onPostCommitFiberRoot(ge,s)}catch(d){}o=!0}return o}finally{W.p=i,N.T=r,ed(e,t)}}return!1}function nd(e,t,n){t=Dr(n,t),null!==(e=xs(e,t=Fa(e.stateNode,t,2),2))&&(xe(e,2),md(e))}function rd(e,t,n){if(3===e.tag)nd(e,e,n);else for(;null!==t;){if(3===t.tag){nd(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Sl||!Sl.has(r))){e=Dr(n,e),null!==(r=xs(t,n=Ba(2),2))&&(Wa(n,r,t,e),xe(r,2),md(r));break}}t=t.return}}function id(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new $c;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(cl=!0,i.add(n),e=od.bind(null,e,t,n),t.then(e,e))}function od(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,tl===e&&(rl&n)===n&&(4===dl||3===dl&&(62914560&rl)===rl&&300>ce()-yl?0===(2&el)&&Fl(e,0):pl|=n,ml===rl&&(ml=0)),md(e)}function ad(e,t){0===t&&(t=Ne()),null!==(e=Ir(e,t))&&(xe(e,t),md(e))}function sd(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),ad(e,n)}function cd(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(a(314))}null!==r&&r.delete(t),ad(e,n)}var ld=null,dd=null,ud=!1,hd=!1,pd=!1,fd=0;function md(e){var t;e!==dd&&null===e.next&&(null===dd?ld=dd=e:dd=dd.next=e),hd=!0,ud||(ud=!0,t=gd,ru((function(){0!==(6&el)?ie(de,t):t()})))}function _d(e,t){if(!pd&&hd){pd=!0;do{for(var n=!1,r=ld;null!==r;){if(!t)if(0!==e){var i=r.pendingLanes;if(0===i)var o=0;else{var a=r.suspendedLanes,s=r.pingedLanes;o=(1<<31-be(42|e)+1)-1,o=201326677&(o&=i&~(a&~s))?201326677&o|1:o?2|o:0}0!==o&&(n=!0,bd(r,o))}else o=rl,0===(3&(o=Re(r,r===tl?o:0)))||ke(r,o)||(n=!0,bd(r,o));r=r.next}}while(n);pd=!1}}function gd(){hd=ud=!1;var e=0;0!==fd&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==$d&&($d=e,!0);return $d=null,!1}()&&(e=fd),fd=0);for(var t=ce(),n=null,r=ld;null!==r;){var i=r.next,o=vd(r,t);0===o?(r.next=null,null===n?ld=i:n.next=i,null===i&&(dd=n)):(n=r,(0!==e||0!==(3&o))&&(hd=!0)),r=i}_d(e,!1)}function vd(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=-62914561&e.pendingLanes;0<o;){var a=31-be(o),s=1<<a,c=i[a];-1===c?0!==(s&n)&&0===(s&r)||(i[a]=Oe(s,t)):c<=t&&(e.expiredLanes|=s),o&=~s}if(n=rl,n=Re(e,e===(t=tl)?n:0),r=e.callbackNode,0===n||e===t&&2===il||null!==e.cancelPendingCommit)return null!==r&&null!==r&&oe(r),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||ke(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&oe(r),Le(n)){case 2:case 8:n=ue;break;case 32:default:n=he;break;case 268435456:n=fe}return r=yd.bind(null,e),n=ie(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&oe(r),e.callbackPriority=2,e.callbackNode=null,2}function yd(e,t){var n=e.callbackNode;if(td()&&e.callbackNode!==n)return null;var r=rl;return 0===(r=Re(e,e===tl?r:0))?null:(Pl(e,r,t),vd(e,ce()),null!=e.callbackNode&&e.callbackNode===n?yd.bind(null,e):null)}function bd(e,t){if(td())return null;Pl(e,t,!0)}function Ed(){return 0===fd&&(fd=Ie()),fd}function Sd(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:It(""+e)}function Td(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var wd=0;wd<Er.length;wd++){var Cd=Er[wd];Sr(Cd.toLowerCase(),"on"+(Cd[0].toUpperCase()+Cd.slice(1)))}Sr(pr,"onAnimationEnd"),Sr(fr,"onAnimationIteration"),Sr(mr,"onAnimationStart"),Sr("dblclick","onDoubleClick"),Sr("focusin","onFocus"),Sr("focusout","onBlur"),Sr(_r,"onTransitionRun"),Sr(gr,"onTransitionStart"),Sr(vr,"onTransitionCancel"),Sr(yr,"onTransitionEnd"),tt("onMouseEnter",["mouseout","mouseover"]),tt("onMouseLeave",["mouseout","mouseover"]),tt("onPointerEnter",["pointerout","pointerover"]),tt("onPointerLeave",["pointerout","pointerover"]),et("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),et("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),et("onBeforeInput",["compositionend","keypress","textInput","paste"]),et("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),et("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),et("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kd=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Rd));function Od(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var a=r.length-1;0<=a;a--){var s=r[a],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==o&&i.isPropagationStopped())break e;o=s,i.currentTarget=l;try{o(i)}catch(d){Da(d)}i.currentTarget=null,o=c}else for(a=0;a<r.length;a++){if(c=(s=r[a]).instance,l=s.currentTarget,s=s.listener,c!==o&&i.isPropagationStopped())break e;o=s,i.currentTarget=l;try{o(i)}catch(d){Da(d)}i.currentTarget=null,o=c}}}}function Id(e,t){var n=t[Be];void 0===n&&(n=t[Be]=new Set);var r=e+"__bubble";n.has(r)||(Pd(t,e,2,!1),n.add(r))}function Nd(e,t,n){var r=0;t&&(r|=4),Pd(n,e,r,t)}var Ad="_reactListening"+Math.random().toString(36).slice(2);function xd(e){if(!e[Ad]){e[Ad]=!0,Ze.forEach((function(t){"selectionchange"!==t&&(kd.has(t)||Nd(t,!1,e),Nd(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ad]||(t[Ad]=!0,Nd("selectionchange",!1,t))}}function Pd(e,t,n,r){switch(Qu(t)){case 2:var i=zu;break;case 8:i=Ku;break;default:i=qu}n=i.bind(null,t,n,e),i=void 0,!Ut||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Dd(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===a)for(a=r.return;null!==a;){var c=a.tag;if((3===c||4===c)&&((c=a.stateNode.containerInfo)===i||8===c.nodeType&&c.parentNode===i))return;a=a.return}for(;null!==s;){if(null===(a=qe(s)))return;if(5===(c=a.tag)||6===c||26===c||27===c){r=o=a;continue e}s=s.parentNode}}r=r.return}Mt((function(){var r=o,i=At(n),a=[];e:{var s=br.get(e);if(void 0!==s){var c=Zt,l=e;switch(e){case"keypress":if(0===Ht(n))break e;case"keydown":case"keyup":c=fn;break;case"focusin":l="focus",c=on;break;case"focusout":l="blur",c=on;break;case"beforeblur":case"afterblur":c=on;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=nn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=rn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=_n;break;case pr:case fr:case mr:c=an;break;case yr:c=gn;break;case"scroll":case"scrollend":c=en;break;case"wheel":c=vn;break;case"copy":case"cut":case"paste":c=sn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=mn;break;case"toggle":case"beforetoggle":c=yn}var d=0!==(4&t),u=!d&&("scroll"===e||"scrollend"===e),h=d?null!==s?s+"Capture":null:s;d=[];for(var p,f=r;null!==f;){var m=f;if(p=m.stateNode,5!==(m=m.tag)&&26!==m&&27!==m||null===p||null===h||null!=(m=jt(f,h))&&d.push(Ld(f,m,p)),u)break;f=f.return}0<d.length&&(s=new c(s,l,null,n,i),a.push({event:s,listeners:d}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===Nt||!(l=n.relatedTarget||n.fromElement)||!qe(l)&&!l[Fe])&&(c||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=r,null!==(l=(l=n.relatedTarget||n.toElement)?qe(l):null)&&(u=j(l),d=l.tag,l!==u||5!==d&&27!==d&&6!==d)&&(l=null)):(c=null,l=r),c!==l)){if(d=nn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(d=mn,m="onPointerLeave",h="onPointerEnter",f="pointer"),u=null==c?s:Je(c),p=null==l?s:Je(l),(s=new d(m,f+"leave",c,n,i)).target=u,s.relatedTarget=p,m=null,qe(i)===r&&((d=new d(h,f+"enter",l,n,i)).target=p,d.relatedTarget=u,m=d),u=m,c&&l)e:{for(h=l,f=0,p=d=c;p;p=jd(p))f++;for(p=0,m=h;m;m=jd(m))p++;for(;0<f-p;)d=jd(d),f--;for(;0<p-f;)h=jd(h),p--;for(;f--;){if(d===h||null!==h&&d===h.alternate)break e;d=jd(d),h=jd(h)}d=null}else d=null;null!==c&&Ud(a,s,c,d,!1),null!==l&&null!==u&&Ud(a,u,l,d,!0)}if("select"===(c=(s=r?Je(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var _=jn;else if(An(s))if(Un)_=qn;else{_=zn;var g=Hn}else!(c=s.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==s.type&&"radio"!==s.type?r&&Rt(r.elementType)&&(_=jn):_=Kn;switch(_&&(_=_(e,r))?xn(a,_,n,i):(g&&g(e,s,r),"focusout"===e&&r&&"number"===s.type&&null!=r.memoizedProps.value&&vt(s,"number",s.value)),g=r?Je(r):window,e){case"focusin":(An(g)||"true"===g.contentEditable)&&(rr=g,ir=r,or=null);break;case"focusout":or=ir=rr=null;break;case"mousedown":ar=!0;break;case"contextmenu":case"mouseup":case"dragend":ar=!1,sr(a,n,i);break;case"selectionchange":if(nr)break;case"keydown":case"keyup":sr(a,n,i)}var v;if(En)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else In?kn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(wn&&"ko"!==n.locale&&(In||"onCompositionStart"!==y?"onCompositionEnd"===y&&In&&(v=Gt()):(Bt="value"in(Ft=i)?Ft.value:Ft.textContent,In=!0)),0<(g=Md(r,y)).length&&(y=new cn(y,e,null,n,i),a.push({event:y,listeners:g}),v?y.data=v:null!==(v=On(n))&&(y.data=v))),(v=Tn?function(e,t){switch(e){case"compositionend":return On(t);case"keypress":return 32!==t.which?null:(Rn=!0,Cn);case"textInput":return(e=t.data)===Cn&&Rn?null:e;default:return null}}(e,n):function(e,t){if(In)return"compositionend"===e||!En&&kn(e,t)?(e=Gt(),Wt=Bt=Ft=null,In=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return wn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(y=Md(r,"onBeforeInput")).length&&(g=new cn("onBeforeInput","beforeinput",null,n,i),a.push({event:g,listeners:y}),g.data=v)),function(e,t,n,r,i){if("submit"===t&&n&&n.stateNode===i){var o=Sd((i[Ve]||null).action),a=r.submitter;a&&null!==(t=(t=a[Ve]||null)?Sd(t.formAction):a.getAttribute("formAction"))&&(o=t,a=null);var s=new Zt("action","action",null,r,i);e.push({event:s,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==fd){var e=a?Td(i,a):new FormData(i);ua(n,{pending:!0,data:e,method:i.method,action:o},null,e)}}else"function"===typeof o&&(s.preventDefault(),e=a?Td(i,a):new FormData(i),ua(n,{pending:!0,data:e,method:i.method,action:o},o,e))},currentTarget:i}]})}}(a,e,r,n,i)}Od(a,t)}))}function Ld(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Md(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5!==(i=i.tag)&&26!==i&&27!==i||null===o||(null!=(i=jt(e,n))&&r.unshift(Ld(e,i,o)),null!=(i=jt(e,t))&&r.push(Ld(e,i,o))),e=e.return}return r}function jd(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Ud(e,t,n,r,i){for(var o=t._reactName,a=[];null!==n&&n!==r;){var s=n,c=s.alternate,l=s.stateNode;if(s=s.tag,null!==c&&c===r)break;5!==s&&26!==s&&27!==s||null===l||(c=l,i?null!=(l=jt(n,o))&&a.unshift(Ld(n,l,c)):i||null!=(l=jt(n,o))&&a.push(Ld(n,l,c))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Vd=/\r\n?/g,Fd=/\u0000|\uFFFD/g;function Bd(e){return("string"===typeof e?e:""+e).replace(Vd,"\n").replace(Fd,"")}function Wd(e,t){return t=Bd(t),Bd(e)===t}function Gd(){}function Hd(e,t,n,r,i,o){switch(n){case"children":"string"===typeof r?"body"===t||"textarea"===t&&""===r||St(e,r):("number"===typeof r||"bigint"===typeof r)&&"body"!==t&&St(e,""+r);break;case"className":st(e,"class",r);break;case"tabIndex":st(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":st(e,n,r);break;case"style":Ct(e,r,o);break;case"data":if("object"!==t){st(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==r||"function"===typeof r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=It(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"===typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof o&&("formAction"===n?("input"!==t&&Hd(e,t,"name",i.name,i,null),Hd(e,t,"formEncType",i.formEncType,i,null),Hd(e,t,"formMethod",i.formMethod,i,null),Hd(e,t,"formTarget",i.formTarget,i,null)):(Hd(e,t,"encType",i.encType,i,null),Hd(e,t,"method",i.method,i,null),Hd(e,t,"target",i.target,i,null))),null==r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=It(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=Gd);break;case"onScroll":null!=r&&Id("scroll",e);break;case"onScrollEnd":null!=r&&Id("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(a(61));if(null!=(n=r.__html)){if(null!=i.children)throw Error(a(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"muted":e.muted=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==r||"function"===typeof r||"boolean"===typeof r||"symbol"===typeof r){e.removeAttribute("xlink:href");break}n=It(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!==typeof r&&"symbol"!==typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"===typeof r||"symbol"===typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":Id("beforetoggle",e),Id("toggle",e),at(e,"popover",r);break;case"xlinkActuate":ct(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":ct(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":ct(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":ct(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":ct(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":ct(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":ct(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":ct(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":ct(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":at(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&at(e,n=kt.get(n)||n,r)}}function zd(e,t,n,r,i,o){switch(n){case"style":Ct(e,r,o);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(a(61));if(null!=(n=r.__html)){if(null!=i.children)throw Error(a(60));e.innerHTML=n}}break;case"children":"string"===typeof r?St(e,r):("number"===typeof r||"bigint"===typeof r)&&St(e,""+r);break;case"onScroll":null!=r&&Id("scroll",e);break;case"onScrollEnd":null!=r&&Id("scrollend",e);break;case"onClick":null!=r&&(e.onclick=Gd);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:$e.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(i=n.endsWith("Capture"),t=n.slice(2,i?n.length-7:void 0),"function"===typeof(o=null!=(o=e[Ve]||null)?o[n]:null)&&e.removeEventListener(t,o,i),"function"!==typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):at(e,n,r):("function"!==typeof o&&null!==o&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,i)))}}function Kd(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Id("error",e),Id("load",e);var r,i=!1,o=!1;for(r in n)if(n.hasOwnProperty(r)){var s=n[r];if(null!=s)switch(r){case"src":i=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:Hd(e,t,r,s,n,null)}}return o&&Hd(e,t,"srcSet",n.srcSet,n,null),void(i&&Hd(e,t,"src",n.src,n,null));case"input":Id("invalid",e);var c=r=s=o=null,l=null,d=null;for(i in n)if(n.hasOwnProperty(i)){var u=n[i];if(null!=u)switch(i){case"name":o=u;break;case"type":s=u;break;case"checked":l=u;break;case"defaultChecked":d=u;break;case"value":r=u;break;case"defaultValue":c=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(a(137,t));break;default:Hd(e,t,i,u,n,null)}}return gt(e,r,c,l,d,s,o,!1),void ut(e);case"select":for(o in Id("invalid",e),i=s=r=null,n)if(n.hasOwnProperty(o)&&null!=(c=n[o]))switch(o){case"value":r=c;break;case"defaultValue":s=c;break;case"multiple":i=c;default:Hd(e,t,o,c,n,null)}return t=r,n=s,e.multiple=!!i,void(null!=t?yt(e,!!i,t,!1):null!=n&&yt(e,!!i,n,!0));case"textarea":for(s in Id("invalid",e),r=o=i=null,n)if(n.hasOwnProperty(s)&&null!=(c=n[s]))switch(s){case"value":i=c;break;case"defaultValue":o=c;break;case"children":r=c;break;case"dangerouslySetInnerHTML":if(null!=c)throw Error(a(91));break;default:Hd(e,t,s,c,n,null)}return Et(e,i,o,r),void ut(e);case"option":for(l in n)if(n.hasOwnProperty(l)&&null!=(i=n[l]))if("selected"===l)e.selected=i&&"function"!==typeof i&&"symbol"!==typeof i;else Hd(e,t,l,i,n,null);return;case"dialog":Id("cancel",e),Id("close",e);break;case"iframe":case"object":Id("load",e);break;case"video":case"audio":for(i=0;i<Rd.length;i++)Id(Rd[i],e);break;case"image":Id("error",e),Id("load",e);break;case"details":Id("toggle",e);break;case"embed":case"source":case"link":Id("error",e),Id("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(d in n)if(n.hasOwnProperty(d)&&null!=(i=n[d]))switch(d){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:Hd(e,t,d,i,n,null)}return;default:if(Rt(t)){for(u in n)n.hasOwnProperty(u)&&(void 0!==(i=n[u])&&zd(e,t,u,i,n,void 0));return}}for(c in n)n.hasOwnProperty(c)&&(null!=(i=n[c])&&Hd(e,t,c,i,n,null))}var qd=null,Yd=null;function Jd(e){return 9===e.nodeType?e:e.ownerDocument}function Xd(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Qd(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function Zd(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var $d=null;var eu="function"===typeof setTimeout?setTimeout:void 0,tu="function"===typeof clearTimeout?clearTimeout:void 0,nu="function"===typeof Promise?Promise:void 0,ru="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof nu?function(e){return nu.resolve(null).then(e).catch(iu)}:eu;function iu(e){setTimeout((function(){throw e}))}function ou(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void mh(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);mh(t)}function au(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":au(n),Ke(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function su(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}function cu(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function lu(e,t,n){switch(t=Jd(n),e){case"html":if(!(e=t.documentElement))throw Error(a(452));return e;case"head":if(!(e=t.head))throw Error(a(453));return e;case"body":if(!(e=t.body))throw Error(a(454));return e;default:throw Error(a(451))}}var du=new Map,uu=new Set;function hu(e){return"function"===typeof e.getRootNode?e.getRootNode():e.ownerDocument}var pu=W.d;W.d={f:function(){var e=pu.f(),t=Ul();return e||t},r:function(e){var t=Ye(e);null!==t&&5===t.tag&&"form"===t.type?pa(t):pu.r(e)},D:function(e){pu.D(e),mu("dns-prefetch",e,null)},C:function(e,t){pu.C(e,t),mu("preconnect",e,t)},L:function(e,t,n){pu.L(e,t,n);var r=fu;if(r&&e&&t){var i='link[rel="preload"][as="'+mt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(i+='[imagesrcset="'+mt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(i+='[imagesizes="'+mt(n.imageSizes)+'"]')):i+='[href="'+mt(e)+'"]';var o=i;switch(t){case"style":o=gu(e);break;case"script":o=bu(e)}du.has(o)||(e=A({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),du.set(o,e),null!==r.querySelector(i)||"style"===t&&r.querySelector(vu(o))||"script"===t&&r.querySelector(Eu(o))||(Kd(t=r.createElement("link"),"link",e),Qe(t),r.head.appendChild(t)))}},m:function(e,t){pu.m(e,t);var n=fu;if(n&&e){var r=t&&"string"===typeof t.as?t.as:"script",i='link[rel="modulepreload"][as="'+mt(r)+'"][href="'+mt(e)+'"]',o=i;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":o=bu(e)}if(!du.has(o)&&(e=A({rel:"modulepreload",href:e},t),du.set(o,e),null===n.querySelector(i))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Eu(o)))return}Kd(r=n.createElement("link"),"link",e),Qe(r),n.head.appendChild(r)}}},X:function(e,t){pu.X(e,t);var n=fu;if(n&&e){var r=Xe(n).hoistableScripts,i=bu(e),o=r.get(i);o||((o=n.querySelector(Eu(i)))||(e=A({src:e,async:!0},t),(t=du.get(i))&&Cu(e,t),Qe(o=n.createElement("script")),Kd(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},r.set(i,o))}},S:function(e,t,n){pu.S(e,t,n);var r=fu;if(r&&e){var i=Xe(r).hoistableStyles,o=gu(e);t=t||"default";var a=i.get(o);if(!a){var s={loading:0,preload:null};if(a=r.querySelector(vu(o)))s.loading=5;else{e=A({rel:"stylesheet",href:e,"data-precedence":t},n),(n=du.get(o))&&wu(e,n);var c=a=r.createElement("link");Qe(c),Kd(c,"link",e),c._p=new Promise((function(e,t){c.onload=e,c.onerror=t})),c.addEventListener("load",(function(){s.loading|=1})),c.addEventListener("error",(function(){s.loading|=2})),s.loading|=4,Tu(a,t,r)}a={type:"stylesheet",instance:a,count:1,state:s},i.set(o,a)}}},M:function(e,t){pu.M(e,t);var n=fu;if(n&&e){var r=Xe(n).hoistableScripts,i=bu(e),o=r.get(i);o||((o=n.querySelector(Eu(i)))||(e=A({src:e,async:!0,type:"module"},t),(t=du.get(i))&&Cu(e,t),Qe(o=n.createElement("script")),Kd(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},r.set(i,o))}}};var fu="undefined"===typeof document?null:document;function mu(e,t,n){var r=fu;if(r&&"string"===typeof t&&t){var i=mt(t);i='link[rel="'+e+'"][href="'+i+'"]',"string"===typeof n&&(i+='[crossorigin="'+n+'"]'),uu.has(i)||(uu.add(i),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(i)&&(Kd(t=r.createElement("link"),"link",e),Qe(t),r.head.appendChild(t)))}}function _u(e,t,n,r){var i,o,s,c,l=(l=Q.current)?hu(l):null;if(!l)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=gu(n.href),(r=(n=Xe(l).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=gu(n.href);var d=Xe(l).hoistableStyles,u=d.get(e);if(u||(l=l.ownerDocument||l,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,u),(d=l.querySelector(vu(e)))&&!d._p&&(u.instance=d,u.state.loading=5),du.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},du.set(e,n),d||(i=l,o=e,s=n,c=u.state,i.querySelector('link[rel="preload"][as="style"]['+o+"]")?c.loading=1:(o=i.createElement("link"),c.preload=o,o.addEventListener("load",(function(){return c.loading|=1})),o.addEventListener("error",(function(){return c.loading|=2})),Kd(o,"link",s),Qe(o),i.head.appendChild(o))))),t&&null===r)throw Error(a(528,""));return u}if(t&&null!==r)throw Error(a(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=bu(n),(r=(n=Xe(l).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function gu(e){return'href="'+mt(e)+'"'}function vu(e){return'link[rel="stylesheet"]['+e+"]"}function yu(e){return A({},e,{"data-precedence":e.precedence,precedence:null})}function bu(e){return'[src="'+mt(e)+'"]'}function Eu(e){return"script[async]"+e}function Su(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+mt(n.href)+'"]');if(r)return t.instance=r,Qe(r),r;var i=A({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return Qe(r=(e.ownerDocument||e).createElement("style")),Kd(r,"style",i),Tu(r,n.precedence,e),t.instance=r;case"stylesheet":i=gu(n.href);var o=e.querySelector(vu(i));if(o)return t.state.loading|=4,t.instance=o,Qe(o),o;r=yu(n),(i=du.get(i))&&wu(r,i),Qe(o=(e.ownerDocument||e).createElement("link"));var s=o;return s._p=new Promise((function(e,t){s.onload=e,s.onerror=t})),Kd(o,"link",r),t.state.loading|=4,Tu(o,n.precedence,e),t.instance=o;case"script":return o=bu(n.src),(i=e.querySelector(Eu(o)))?(t.instance=i,Qe(i),i):(r=n,(i=du.get(o))&&Cu(r=A({},n),i),Qe(i=(e=e.ownerDocument||e).createElement("script")),Kd(i,"link",r),e.head.appendChild(i),t.instance=i);case"void":return null;default:throw Error(a(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,Tu(r,n.precedence,e));return t.instance}function Tu(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=r.length?r[r.length-1]:null,o=i,a=0;a<r.length;a++){var s=r[a];if(s.dataset.precedence===t)o=s;else if(o!==i)break}o?o.parentNode.insertBefore(e,o.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function wu(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Cu(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var Ru=null;function ku(e,t,n){if(null===Ru){var r=new Map,i=Ru=new Map;i.set(n,r)}else(r=(i=Ru).get(n))||(r=new Map,i.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),i=0;i<n.length;i++){var o=n[i];if(!(o[ze]||o[Ue]||"link"===e&&"stylesheet"===o.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==o.namespaceURI){var a=o.getAttribute(t)||"";a=e+a;var s=r.get(a);s?s.push(o):r.set(a,[o])}}return r}function Ou(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Iu(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var Nu=null;function Au(){}function xu(){if(this.count--,0===this.count)if(this.stylesheets)Du(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Pu=null;function Du(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Pu=new Map,t.forEach(Lu,e),Pu=null,xu.call(e))}function Lu(e,t){if(!(4&t.state.loading)){var n=Pu.get(e);if(n)var r=n.get(null);else{n=new Map,Pu.set(e,n);for(var i=e.querySelectorAll("link[data-precedence],style[data-precedence]"),o=0;o<i.length;o++){var a=i[o];"LINK"!==a.nodeName&&"not all"===a.getAttribute("media")||(n.set(a.dataset.precedence,a),r=a)}r&&n.set(null,r)}a=(i=t.instance).getAttribute("data-precedence"),(o=n.get(a)||r)===r&&n.set(null,i),n.set(a,i),this.count++,r=xu.bind(this),i.addEventListener("load",r),i.addEventListener("error",r),o?o.parentNode.insertBefore(i,o.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(i,e.firstChild),t.state.loading|=4}}var Mu={$$typeof:_,Provider:null,Consumer:null,_currentValue:G,_currentValue2:G,_threadCount:0};function ju(e,t,n,r,i,o,a,s){this.tag=1,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ae(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ae(0),this.hiddenUpdates=Ae(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=o,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=s,this.incompleteTransitions=new Map}function Uu(e,t,n,r,i,o,a,s,c,l,d,u){return e=new ju(e,t,n,a,s,c,l,u),t=1,!0===o&&(t|=24),o=Lc(3,null,null,t),e.current=o,o.stateNode=e,(t=Fi()).refCount++,e.pooledCache=t,t.refCount++,o.memoizedState={element:r,isDehydrated:n,cache:t},Is(o),e}function Vu(e){return e?e=xr:xr}function Fu(e,t,n,r,i,o){i=Vu(i),null===r.context?r.context=i:r.pendingContext=i,(r=As(t)).payload={element:n},null!==(o=void 0===o?null:o)&&(r.callback=o),null!==(n=xs(e,r,t))&&(xl(n,0,t),Ps(n,e,t))}function Bu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Wu(e,t){Bu(e,t),(e=e.alternate)&&Bu(e,t)}function Gu(e){if(13===e.tag){var t=Ir(e,67108864);null!==t&&xl(t,0,67108864),Wu(e,67108864)}}var Hu=!0;function zu(e,t,n,r){var i=N.T;N.T=null;var o=W.p;try{W.p=2,qu(e,t,n,r)}finally{W.p=o,N.T=i}}function Ku(e,t,n,r){var i=N.T;N.T=null;var o=W.p;try{W.p=8,qu(e,t,n,r)}finally{W.p=o,N.T=i}}function qu(e,t,n,r){if(Hu){var i=Yu(r);if(null===i)Dd(e,t,r,Ju,n),ah(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return $u=sh($u,e,t,n,r,i),!0;case"dragenter":return eh=sh(eh,e,t,n,r,i),!0;case"mouseover":return th=sh(th,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return nh.set(o,sh(nh.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,rh.set(o,sh(rh.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(ah(e,r),4&t&&-1<oh.indexOf(e)){for(;null!==i;){var o=Ye(i);if(null!==o)switch(o.tag){case 3:if((o=o.stateNode).current.memoizedState.isDehydrated){var a=Ce(o.pendingLanes);if(0!==a){var s=o;for(s.pendingLanes|=2,s.entangledLanes|=2;a;){var c=1<<31-be(a);s.entanglements[1]|=c,a&=~c}md(o),0===(6&el)&&(bl=ce()+500,_d(0,!1))}}break;case 13:null!==(s=Ir(o,2))&&xl(s,0,2),Ul(),Wu(o,2)}if(null===(o=Yu(r))&&Dd(e,t,r,Ju,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else Dd(e,t,r,null,n)}}function Yu(e){return Xu(e=At(e))}var Ju=null;function Xu(e){if(Ju=null,null!==(e=qe(e))){var t=j(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=U(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Ju=e,null}function Qu(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(le()){case de:return 2;case ue:return 8;case he:case pe:return 32;case fe:return 268435456;default:return 32}default:return 32}}var Zu=!1,$u=null,eh=null,th=null,nh=new Map,rh=new Map,ih=[],oh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ah(e,t){switch(e){case"focusin":case"focusout":$u=null;break;case"dragenter":case"dragleave":eh=null;break;case"mouseover":case"mouseout":th=null;break;case"pointerover":case"pointerout":nh.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":rh.delete(t.pointerId)}}function sh(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=Ye(t))&&Gu(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function ch(e){var t=qe(e.target);if(null!==t){var n=j(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=U(n)))return e.blockedOn=t,void function(e,t){var n=W.p;try{return W.p=e,t()}finally{W.p=n}}(e.priority,(function(){if(13===n.tag){var e=Nl(),t=Ir(n,e);null!==t&&xl(t,0,e),Wu(n,e)}}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function lh(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yu(e.nativeEvent);if(null!==n)return null!==(t=Ye(n))&&Gu(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Nt=r,n.target.dispatchEvent(r),Nt=null,t.shift()}return!0}function dh(e,t,n){lh(e)&&n.delete(t)}function uh(){Zu=!1,null!==$u&&lh($u)&&($u=null),null!==eh&&lh(eh)&&(eh=null),null!==th&&lh(th)&&(th=null),nh.forEach(dh),rh.forEach(dh)}function hh(e,t){e.blockedOn===t&&(e.blockedOn=null,Zu||(Zu=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,uh)))}var ph=null;function fh(e){ph!==e&&(ph=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,(function(){ph===e&&(ph=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],i=e[t+2];if("function"!==typeof r){if(null===Xu(r||n))continue;break}var o=Ye(n);null!==o&&(e.splice(t,3),t-=3,ua(o,{pending:!0,data:i,method:n.method,action:r},r,i))}})))}function mh(e){function t(t){return hh(t,e)}null!==$u&&hh($u,e),null!==eh&&hh(eh,e),null!==th&&hh(th,e),nh.forEach(t),rh.forEach(t);for(var n=0;n<ih.length;n++){var r=ih[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<ih.length&&null===(n=ih[0]).blockedOn;)ch(n),null===n.blockedOn&&ih.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var i=n[r],o=n[r+1],a=i[Ve]||null;if("function"===typeof o)a||fh(n);else if(a){var s=null;if(o&&o.hasAttribute("formAction")){if(i=o,a=o[Ve]||null)s=a.formAction;else if(null!==Xu(i))continue}else s=a.action;"function"===typeof s?n[r+1]=s:(n.splice(r,3),r-=3),fh(n)}}}function _h(e){this._internalRoot=e}function gh(e){this._internalRoot=e}gh.prototype.render=_h.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Fu(t.current,Nl(),e,t,null,null)},gh.prototype.unmount=_h.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;0===e.tag&&td(),Fu(e.current,2,null,e,null,null),Ul(),t[Fe]=null}},gh.prototype.unstable_scheduleHydration=function(e){if(e){var t=Me();e={blockedOn:null,target:e,priority:t};for(var n=0;n<ih.length&&0!==t&&t<ih[n].priority;n++);ih.splice(n,0,e),0===n&&ch(e)}};var vh=i.version;if("19.0.0"!==vh)throw Error(a(527,vh,"19.0.0"));W.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=j(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return V(i),e;if(o===r)return V(i),t;o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,c=i.child;c;){if(c===n){s=!0,n=i,r=o;break}if(c===r){s=!0,r=i,n=o;break}c=c.sibling}if(!s){for(c=o.child;c;){if(c===n){s=!0,n=o,r=i;break}if(c===r){s=!0,r=o,n=i;break}c=c.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?F(e):null)?null:e.stateNode};var yh={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:N,findFiberByHostInstance:qe,reconcilerVersion:"19.0.0"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var bh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bh.isDisabled&&bh.supportsFiber)try{ge=bh.inject(yh),ve=bh}catch(Sh){}}t.createRoot=function(e,t){if(!s(e))throw Error(a(299));var n=!1,r="",i=La,o=Ma,c=ja;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(i=t.onUncaughtError),void 0!==t.onCaughtError&&(o=t.onCaughtError),void 0!==t.onRecoverableError&&(c=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Uu(e,1,!1,null,0,n,r,i,o,c,0,null),e[Fe]=t.current,xd(8===e.nodeType?e.parentNode:e),new _h(t)},t.hydrateRoot=function(e,t,n){if(!s(e))throw Error(a(299));var r=!1,i="",o=La,c=Ma,l=ja,d=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onUncaughtError&&(o=n.onUncaughtError),void 0!==n.onCaughtError&&(c=n.onCaughtError),void 0!==n.onRecoverableError&&(l=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(d=n.formState)),(t=Uu(e,1,!0,t,0,r,i,o,c,l,0,d)).context=Vu(null),n=t.current,(i=As(r=Nl())).callback=null,xs(n,i,r),t.current.lanes=r,xe(t,r),md(t),e[Fe]=t.current,xd(e),new gh(t)},t.version="19.0.0"},6672:(e,t,n)=>{"use strict";var r=n(5043);function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(){}var a={d:{f:o,r:function(){throw Error(i(522))},D:o,C:o,L:o,m:o,X:o,S:o,M:o},p:0,findDOMNode:null},s=Symbol.for("react.portal");var c=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(i(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:s,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=c.T,n=a.p;try{if(c.T=null,a.p=2,e)return e()}finally{c.T=t,a.p=n,a.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,a.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&a.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,r=l(n,t.crossOrigin),i="string"===typeof t.integrity?t.integrity:void 0,o="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?a.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:i,fetchPriority:o}):"script"===n&&a.d.X(e,{crossOrigin:r,integrity:i,fetchPriority:o,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=l(t.as,t.crossOrigin);a.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&a.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,r=l(n,t.crossOrigin);a.d.L(e,n,{crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=l(t.as,t.crossOrigin);a.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else a.d.m(e)},t.requestFormReset=function(e){a.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return c.H.useFormState(e,t,n)},t.useFormStatus=function(){return c.H.useHostTransitionStatus()},t.version="19.0.0"},4391:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(7004)},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(6672)},2799:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function i(e,t,r){var i=null;if(void 0!==r&&(i=""+r),void 0!==t.key&&(i=""+t.key),"key"in t)for(var o in r={},t)"key"!==o&&(r[o]=t[o]);else r=t;return t=r.ref,{$$typeof:n,type:e,key:i,ref:void 0!==t?t:null,props:r}}t.Fragment=r,t.jsx=i,t.jsxs=i},4288:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,_={};function g(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||f}function v(){}function y(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||f}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=g.prototype;var b=y.prototype=new v;b.constructor=y,m(b,g.prototype),b.isPureReactComponent=!0;var E=Array.isArray,S={H:null,A:null,T:null,S:null},T=Object.prototype.hasOwnProperty;function w(e,t,r,i,o,a){return r=a.ref,{$$typeof:n,type:e,key:t,ref:void 0!==r?r:null,props:a}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var R=/\/+/g;function k(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function O(){}function I(e,t,i,o,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c,l,d=!1;if(null===e)d=!0;else switch(s){case"bigint":case"string":case"number":d=!0;break;case"object":switch(e.$$typeof){case n:case r:d=!0;break;case h:return I((d=e._init)(e._payload),t,i,o,a)}}if(d)return a=a(e),d=""===o?"."+k(e,0):o,E(a)?(i="",null!=d&&(i=d.replace(R,"$&/")+"/"),I(a,t,i,"",(function(e){return e}))):null!=a&&(C(a)&&(c=a,l=i+(null==a.key||e&&e.key===a.key?"":(""+a.key).replace(R,"$&/")+"/")+d,a=w(c.type,l,void 0,0,0,c.props)),t.push(a)),1;d=0;var u,f=""===o?".":o+":";if(E(e))for(var m=0;m<e.length;m++)d+=I(o=e[m],t,i,s=f+k(o,m),a);else if("function"===typeof(m=null===(u=e)||"object"!==typeof u?null:"function"===typeof(u=p&&u[p]||u["@@iterator"])?u:null))for(e=m.call(e),m=0;!(o=e.next()).done;)d+=I(o=o.value,t,i,s=f+k(o,m++),a);else if("object"===s){if("function"===typeof e.then)return I(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(O,O):(e.status="pending",e.then((function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)}),(function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)}))),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,i,o,a);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return d}function N(e,t,n){if(null==e)return e;var r=[],i=0;return I(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function A(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var x="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function P(){}t.Children={map:N,forEach:function(e,t,n){N(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return N(e,(function(){t++})),t},toArray:function(e){return N(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=i,t.Profiler=a,t.PureComponent=y,t.StrictMode=o,t.Suspense=d,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,t.act=function(){throw Error("act(...) is not supported in production builds of React.")},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var r=m({},e.props),i=e.key;if(null!=t)for(o in void 0!==t.ref&&void 0,void 0!==t.key&&(i=""+t.key),t)!T.call(t,o)||"key"===o||"__self"===o||"__source"===o||"ref"===o&&void 0===t.ref||(r[o]=t[o]);var o=arguments.length-2;if(1===o)r.children=n;else if(1<o){for(var a=Array(o),s=0;s<o;s++)a[s]=arguments[s+2];r.children=a}return w(e.type,i,void 0,0,0,r)},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:s,_context:e},e},t.createElement=function(e,t,n){var r,i={},o=null;if(null!=t)for(r in void 0!==t.key&&(o=""+t.key),t)T.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(i[r]=t[r]);var a=arguments.length-2;if(1===a)i.children=n;else if(1<a){for(var s=Array(a),c=0;c<a;c++)s[c]=arguments[c+2];i.children=s}if(e&&e.defaultProps)for(r in a=e.defaultProps)void 0===i[r]&&(i[r]=a[r]);return w(e,o,void 0,0,0,i)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:A}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=S.T,n={};S.T=n;try{var r=e(),i=S.S;null!==i&&i(n,r),"object"===typeof r&&null!==r&&"function"===typeof r.then&&r.then(P,x)}catch(o){x(o)}finally{S.T=t}},t.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},t.use=function(e){return S.H.use(e)},t.useActionState=function(e,t,n){return S.H.useActionState(e,t,n)},t.useCallback=function(e,t){return S.H.useCallback(e,t)},t.useContext=function(e){return S.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return S.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return S.H.useEffect(e,t)},t.useId=function(){return S.H.useId()},t.useImperativeHandle=function(e,t,n){return S.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return S.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return S.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return S.H.useMemo(e,t)},t.useOptimistic=function(e,t){return S.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return S.H.useReducer(e,t,n)},t.useRef=function(e){return S.H.useRef(e)},t.useState=function(e){return S.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return S.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return S.H.useTransition()},t.version="19.0.0"},5043:(e,t,n)=>{"use strict";e.exports=n(4288)},579:(e,t,n)=>{"use strict";e.exports=n(2799)},5896:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,a=i>>>1;r<a;){var s=2*(r+1)-1,c=e[s],l=s+1,d=e[l];if(0>o(c,n))l<i&&0>o(d,c)?(e[r]=d,e[l]=n,r=l):(e[r]=c,e[s]=n,r=s);else{if(!(l<i&&0>o(d,n)))break e;e[r]=d,e[l]=n,r=l}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,c=s.now();t.unstable_now=function(){return s.now()-c}}var l=[],d=[],u=1,h=null,p=3,f=!1,m=!1,_=!1,g="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(d);null!==t;){if(null===t.callback)i(d);else{if(!(t.startTime<=e))break;i(d),t.sortIndex=t.expirationTime,n(l,t)}t=r(d)}}function E(e){if(_=!1,b(e),!m)if(null!==r(l))m=!0,A();else{var t=r(d);null!==t&&x(E,t.startTime-e)}}var S,T=!1,w=-1,C=5,R=-1;function k(){return!(t.unstable_now()-R<C)}function O(){if(T){var e=t.unstable_now();R=e;var n=!0;try{e:{m=!1,_&&(_=!1,v(w),w=-1),f=!0;var o=p;try{t:{for(b(e),h=r(l);null!==h&&!(h.expirationTime>e&&k());){var a=h.callback;if("function"===typeof a){h.callback=null,p=h.priorityLevel;var s=a(h.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof s){h.callback=s,b(e),n=!0;break t}h===r(l)&&i(l),b(e)}else i(l);h=r(l)}if(null!==h)n=!0;else{var c=r(d);null!==c&&x(E,c.startTime-e),n=!1}}break e}finally{h=null,p=o,f=!1}n=void 0}}finally{n?S():T=!1}}}if("function"===typeof y)S=function(){y(O)};else if("undefined"!==typeof MessageChannel){var I=new MessageChannel,N=I.port2;I.port1.onmessage=O,S=function(){N.postMessage(null)}}else S=function(){g(O,0)};function A(){T||(T=!0,S())}function x(e,n){w=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,A())},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,o){var a=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?a+o:a:o=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:u++,callback:i,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,n(d,e),null===r(l)&&e===r(d)&&(_?(v(w),w=-1):_=!0,x(E,o-a))):(e.sortIndex=s,n(l,e),m||f||(m=!0,A())),e},t.unstable_shouldYield=k,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},8853:(e,t,n)=>{"use strict";e.exports=n(5896)},2480:(e,t,n)=>{"use strict";var r=n(3172);e.exports=function(e,t,n,i){var o,a=new Error("Canceled");return new r((function(s,c,l){var d;e((function(e){return l()?r.reject(a):(d=t(e),n(d).then((function(e){if(l())throw a;return o=e()})))})).then((function(e){if(l())throw e.disconnect(),a;s(i(d,e))})).catch((function(e){c(e)}))}),(function(){o&&o.cancel()}))}},9636:(e,t,n)=>{"use strict";var r=n(7422).MediaStreamTrack,i=n(295),o=i.guessBrowser,a=i.guessBrowserVersion,s=i.isCodecSupported,c=n(2480),l=n(7829),d=n(9652),u=n(1339),h=n(3702),p=n(2001),f=p.LocalAudioTrack,m=p.LocalDataTrack,_=p.LocalVideoTrack,g=n(2221),v=n(9459),y=n(3850),b=n(6803),E=b.asLocalTrack,S=b.buildLogLevels,T=b.filterObject,w=b.isNonArrayObject,C=n(6262),R=C.DEFAULT_ENVIRONMENT,k=C.DEFAULT_LOG_LEVEL,O=C.DEFAULT_LOGGER_NAME,I=C.DEFAULT_REALM,N=C.DEFAULT_REGION,A=C.WS_SERVER,x=C.SDK_NAME,P=C.SDK_VERSION,D=C.typeErrors,L=n(3172),M=n(7173),j=n(5765),U=n(9961).Pn,V="safari"===o()&&a(),F=0,B=!1,W=!1;if(V){var G=V.major,H=V.minor;W=G<12||12===G&&H<1}var z=new Set([{didWarn:!1,shouldDelete:!0,name:"abortOnIceServersTimeout"},{didWarn:!1,shouldDelete:!0,name:"dscpTagging",newName:"enableDscp"},{didWarn:!1,shouldDelete:!0,name:"iceServersTimeout"},{didWarn:!1,shouldDelete:!1,name:"eventListener",newName:"Video.Logger"},{didWarn:!1,shouldDelete:!1,name:"logLevel",newName:"Video.Logger"}]),K=new Set([{didWarn:!1,shouldDelete:!1,name:"maxTracks",newName:"bandwidthProfile.video.clientTrackSwitchOffControl"},{didWarn:!1,shouldDelete:!1,name:"renderDimensions",newName:"bandwidthProfile.video.contentPreferencesMode"}]);function q(e,t,n){n.forEach((function(n){var r=n.didWarn,i=n.name,o=n.newName,a=n.shouldDelete;i in e&&"undefined"!==typeof e[i]&&(o&&a&&(e[o]=e[i]),a&&delete e[i],r||["error","off"].includes(t.level)||(t.warn('The ConnectOptions "'+i+'" is '+(o?'deprecated and scheduled for removal. Please use "'+o+'" instead.':"no longer applicable and will be ignored.")),n.didWarn=!0))}))}function Y(e,t,n,r,i,o){var a=e.createLocalParticipantSignaling(n,r);return t.debug("Creating a new LocalParticipant:",a),new i.LocalParticipant(a,o,i)}function J(e,t,n){var r=new v(t,n,e),i=e.log;return i.debug("Creating a new Room:",r),n.on("stateChanged",(function e(t){"disconnected"===t&&(i.info("Disconnected from Room:",r.toString()),n.removeListener("stateChanged",e))})),r}function X(e,t,n,r,i,o){return t.log.debug("Creating a new RoomSignaling"),n.connect(o._signaling,e,r,i,t)}function Q(e,t){var n=e.log;return e.shouldStopLocalTracks=!e.tracks,e.shouldStopLocalTracks?n.info("LocalTracks were not provided, so they will be acquired automatically before connecting to the Room. LocalTracks will be released if connecting to the Room fails or if the Room is disconnected"):(n.info("Getting LocalTracks"),n.debug("Options:",e)),e.createLocalTracks(e).then((function(r){var i=t(r);return i.catch((function(){e.shouldStopLocalTracks&&(n.info("The automatically acquired LocalTracks will now be stopped"),r.forEach((function(e){e.stop()})))})),i}))}function Z(e){var t="string"===typeof e?{codec:e}:e;switch(t.codec.toLowerCase()){case"opus":return Object.assign({dtx:!0},t);case"vp8":return Object.assign({simulcast:!1},t);default:return t}}e.exports=function(e,t){if("undefined"===typeof t&&(t={}),!w(t))return L.reject(D.INVALID_TYPE("options","object"));var n,i=t.Log||j,o=t.loggerName||O,a=t.logLevel||k,p=S(a),v="[connect #"+ ++F+"]";try{n=new i("default",v,p,o)}catch(ee){return L.reject(ee)}q(t,n,z);var b="auto"===t.preferredVideoCodecs;if(b&&(t.preferredVideoCodecs=[{codec:"VP8",simulcast:!0,adaptiveSimulcast:!0}]),t.maxVideoBitrate&&b)return n.error('ConnectOptions "maxVideoBitrate" is not compatible with "preferredVideoCodecs=auto"'),L.reject(D.ILLEGAL_INVOKE("connect",'ConnectOptions "maxVideoBitrate" is not compatible with "preferredVideoCodecs=auto"'));var C={};"string"===typeof(t=Object.assign({automaticSubscription:!0,dominantSpeaker:!1,enableDscp:!1,environment:R,eventListener:null,insights:!0,LocalAudioTrack:f,LocalDataTrack:m,LocalParticipant:d,LocalVideoTrack:_,Log:i,MediaStreamTrack:r,loggerName:o,logLevel:a,maxAudioBitrate:null,maxVideoBitrate:null,name:null,networkMonitor:!0,networkQuality:!1,preferredAudioCodecs:[],preferredVideoCodecs:[],realm:I,region:N,signaling:y},T(t))).wsServerInsights&&(C.gateway=t.wsServerInsights);var V=new(t.insights?u:h)(e,x,P,t.environment,t.realm,C),G=A(t.environment,t.region),H=new M(V,Date.now(),n,t.eventListener);if((t=Object.assign({eventObserver:H,wsServer:G},t)).log=n,W&&!B&&"error"!==n.logLevel&&"off"!==n.logLevel&&(B=!0,n.warn(["Support for Safari 12.0 and below is limited because it does not support VP8.","This means you may experience codec issues in Group Rooms. You may also","experience codec issues in Peer-to-Peer (P2P) Rooms containing Android- or","iOS-based Participants who do not support H.264. However, P2P Rooms","with browser-based Participants should work. For more information, please","refer to this guide: https://www.twilio.com/docs/video/javascript-v2-developing-safari-11"].join(" "))),"string"!==typeof e)return L.reject(D.INVALID_TYPE("token","string"));var $=Object.assign({},t);if(delete $.name,"tracks"in t){if(!Array.isArray(t.tracks))return L.reject(D.INVALID_TYPE("options.tracks","Array of LocalAudioTrack, LocalVideoTrack or MediaStreamTrack"));try{t.tracks=t.tracks.map((function(e){return E(e,$)}))}catch(ee){return L.reject(ee)}}var ee=U(t.bandwidthProfile);if(ee)return L.reject(ee);t.clientTrackSwitchOffControl="disabled",t.contentPreferencesMode="disabled",t.bandwidthProfile&&(t.clientTrackSwitchOffControl="auto",t.contentPreferencesMode="auto",t.bandwidthProfile.video&&(q(t.bandwidthProfile.video,n,K),"maxTracks"in t.bandwidthProfile.video?t.clientTrackSwitchOffControl="disabled":"manual"===t.bandwidthProfile.video.clientTrackSwitchOffControl?t.clientTrackSwitchOffControl="manual":t.clientTrackSwitchOffControl="auto","renderDimensions"in t.bandwidthProfile.video?t.contentPreferencesMode="disabled":"manual"===t.bandwidthProfile.video.contentPreferencesMode?t.contentPreferencesMode="manual":t.contentPreferencesMode="auto"));var te=new(0,t.signaling)(t.wsServer,t);n.info("Connecting to a Room"),n.debug("Options:",t);var ne=new l({maxAudioBitrate:t.maxAudioBitrate,maxVideoBitrate:t.maxVideoBitrate},b),re={audio:t.preferredAudioCodecs.map(Z),video:t.preferredVideoCodecs.map(Z)},ie=new g(w(t.networkQuality)?t.networkQuality:{});["audio","video"].forEach((function(e){return re[e].forEach((function(t){var r=t.codec;return s(r,e).then((function(t){return!t&&n.warn("The preferred "+e+' codec "'+r+'" will be ignored as it is not supported by the browser.')}))}))}));var oe=c(Q.bind(null,t),Y.bind(null,te,n,ne,ie,t),X.bind(null,e,t,te,ne,re),J.bind(null,t));return oe.then((function(e){return V.connect(e.sid,e.localParticipant.sid),n.info("Connected to Room:",e.toString()),n.info("Room name:",e.name),n.debug("Room:",e),e.once("disconnected",(function(){return V.disconnect()})),e}),(function(e){V.disconnect(),oe._isCanceled?n.info("Attempt to connect to a Room was canceled"):n.info("Error while connecting to a Room:",e)})),oe}},7490:(e,t,n)=>{"use strict";var r=n(6262),i=r.DEFAULT_LOG_LEVEL,o=r.DEFAULT_LOGGER_NAME;function a(e,t){t=Object.assign({loggerName:o,logLevel:i},t);var n={};n.loggerName=t.loggerName,n.logLevel=t.logLevel,delete t.loggerName,delete t.logLevel;["getUserMedia","enumerateDevices","MediaStream","mapMediaElement","disposeMediaElement"].forEach((function(e){e in t&&(n[e]=t[e],delete t[e])}));var r=t.createLocalTracks;return delete t.createLocalTracks,n[e]=!(Object.keys(t).length>0)||t,r(n).then((function(e){return e[0]}))}e.exports={audio:function(e){return a("audio",e)},video:function(e){return a("video",e)}}},5745:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},s=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.createLocalTracks=void 0;var c=n(9918),l=n(6803).buildLogLevels,d=n(7422),u=d.getUserMedia,h=d.MediaStreamTrack,p=n(2001),f=p.LocalAudioTrack,m=p.LocalDataTrack,_=p.LocalVideoTrack,g=n(5765),v=n(6262),y=v.DEFAULT_LOG_LEVEL,b=v.DEFAULT_LOGGER_NAME,E=v.typeErrors.INVALID_VALUE,S=n(5355),T=0;t.createLocalTracks=function(e){return i(this,void 0,void 0,(function(){var t,n,d,p,v,w,C,R,k,O,I,N,A,x=this;return o(this,(function(P){switch(P.label){case 0:if(n=r({audio:t=!(e&&("audio"in e||"video"in e)),getUserMedia:u,loggerName:b,logLevel:y,LocalAudioTrack:f,LocalDataTrack:m,LocalVideoTrack:_,MediaStreamTrack:h,Log:g,video:t},e),d="[createLocalTracks #"+ ++T+"]",p=l(n.logLevel),v=new n.Log("default",d,p,n.loggerName),delete(w=Object.assign({log:v},n)).name,!1===n.audio&&!1===n.video)return v.info("Neither audio nor video requested, so returning empty LocalTracks"),[2,[]];if(n.tracks)return v.info("Adding user-provided LocalTracks"),v.debug("LocalTracks:",n.tracks),[2,n.tracks];if((C={audio:"object"===typeof n.audio&&n.audio.name?{name:n.audio.name}:{defaultDeviceCaptureMode:"auto"},video:"object"===typeof n.video&&n.video.name?{name:n.video.name}:{}}).audio.isCreatedByCreateLocalTracks=!0,C.video.isCreatedByCreateLocalTracks=!0,"object"===typeof n.audio)if("boolean"===typeof n.audio.workaroundWebKitBug1208516&&(C.audio.workaroundWebKitBug1208516=n.audio.workaroundWebKitBug1208516),"noiseCancellationOptions"in n.audio&&(R=n.audio.noiseCancellationOptions,delete n.audio.noiseCancellationOptions),"defaultDeviceCaptureMode"in n.audio){if(["auto","manual"].every((function(e){return e!==n.audio.defaultDeviceCaptureMode})))throw E("CreateLocalAudioTrackOptions.defaultDeviceCaptureMode",["auto","manual"]);C.audio.defaultDeviceCaptureMode=n.audio.defaultDeviceCaptureMode}else C.audio.defaultDeviceCaptureMode="auto";"object"===typeof n.video&&"boolean"===typeof n.video.workaroundWebKitBug1208516&&(C.video.workaroundWebKitBug1208516=n.video.workaroundWebKitBug1208516),"object"===typeof n.audio&&delete n.audio.name,"object"===typeof n.video&&delete n.video.name,k={audio:n.audio,video:n.video},O="object"===typeof n.audio&&n.audio.workaroundWebKitBug180748,P.label=1;case 1:return P.trys.push([1,4,,5]),[4,O?S(v,n.getUserMedia,k):n.getUserMedia(k)];case 2:return I=P.sent(),N=s(s([],a(I.getAudioTracks())),a(I.getVideoTracks())),v.info("Call to getUserMedia successful; got tracks:",N),[4,Promise.all(N.map((function(e){return i(x,void 0,void 0,(function(){var t,n,i;return o(this,(function(o){switch(o.label){case 0:return"audio"===e.kind&&R?[4,c.applyNoiseCancellation(e,R,v)]:[3,2];case 1:return t=o.sent(),n=t.cleanTrack,i=t.noiseCancellation,[2,new w.LocalAudioTrack(n,r(r(r({},C.audio),w),{noiseCancellation:i}))];case 2:if("audio"===e.kind)return[2,new w.LocalAudioTrack(e,r(r({},C.audio),w))];o.label=3;case 3:return[2,new w.LocalVideoTrack(e,r(r({},C.video),w))]}}))}))})))];case 3:return[2,P.sent()];case 4:throw A=P.sent(),v.warn("Call to getUserMedia failed:",A),A;case 5:return[2]}}))}))}},9842:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(6941),o=n(6490),a=function(e){function t(t){var n=e.call(this,t.label,t.maxPacketLifeTime,t.maxRetransmits,t.ordered)||this;return Object.defineProperties(n,{_dataChannel:{value:t}}),t.binaryType="arraybuffer",t.addEventListener("message",(function(e){n.emit("message",e.data)})),t.addEventListener("close",(function(){n.emit("close")})),n}return r(t,e),t.prototype.stop=function(){this._dataChannel.close(),e.prototype.stop.call(this)},t.prototype.toDataTransport=function(){return new o(this._dataChannel)},t}(i);e.exports=a},1206:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(6941),o=n(6803).makeUUID,a=function(e){function t(t,n,r){var i=e.call(this,o(),t,n,r)||this;return Object.defineProperties(i,{_clones:{value:new Set},_dataChannels:{value:new Set}}),i}return r(t,e),t.prototype._addClone=function(e){this._clones.add(e)},t.prototype.removeClone=function(e){this._clones.delete(e)},t.prototype.addDataChannel=function(e){return this._dataChannels.add(e),this},t.prototype.clone=function(){var e=this,n=new t(this.maxPacketLifeTime,this.maxRetransmits,this.ordered);return this._addClone(n),n.once("stopped",(function(){return e.removeClone(n)})),n},t.prototype.removeDataChannel=function(e){return this._dataChannels.delete(e),this},t.prototype.send=function(e){return this._dataChannels.forEach((function(t){try{t.send(e)}catch(n){}})),this._clones.forEach((function(t){try{t.send(e)}catch(n){}})),this},t.prototype.stop=function(){this._dataChannels.forEach((function(e){return e.close()})),this._clones.forEach((function(e){return e.stop()})),e.prototype.stop.call(this)},t}(i);e.exports=a},6941:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n,r,i){var o=e.call(this,t,"data")||this;return Object.defineProperties(o,{maxPacketLifeTime:{enumerable:!0,value:n},maxRetransmits:{enumerable:!0,value:r},ordered:{enumerable:!0,value:i}}),o}return r(t,e),t}(n(956));e.exports=i},6490:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t){var n=e.call(this)||this;return Object.defineProperties(n,{_dataChannel:{value:t},_messageQueue:{value:[]}}),t.addEventListener("open",(function(){n._messageQueue.splice(0).forEach((function(e){return n._publish(e)}))})),t.addEventListener("message",(function(e){var t=e.data;try{var r=JSON.parse(t);n.emit("message",r)}catch(i){}})),n.publish({type:"ready"}),n}return r(t,e),t.prototype._publish=function(e){var t=JSON.stringify(e);try{this._dataChannel.send(t)}catch(n){}},t.prototype.publish=function(e){var t=this._dataChannel;return"closing"!==t.readyState&&"closed"!==t.readyState&&("connecting"===t.readyState?(this._messageQueue.push(e),!0):(this._publish(e),!0))},t}(n(7284).EventEmitter);e.exports=i},7829:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){var r=e.call(this)||this;return t=Object.assign({maxAudioBitrate:null,maxVideoBitrate:null},t),Object.defineProperties(r,{maxAudioBitrate:{value:t.maxAudioBitrate,writable:!0},maxVideoBitrate:{value:t.maxVideoBitrate,writable:!0},adaptiveSimulcast:{value:n}}),r}return r(t,e),t.prototype.toJSON=function(){return{maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate}},t.prototype.update=function(e){var t=this;e=Object.assign({maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate},e),["maxAudioBitrate","maxVideoBitrate"].reduce((function(n,r){return t[r]!==e[r]&&(t[r]=e[r],n=!0),n}),!1)&&this.emit("changed")},t}(n(7284).EventEmitter);e.exports=i},1906:(e,t,n)=>{"use strict";var r=n(7284).EventEmitter,i=n(6803).hidePrivateAndCertainPublicPropertiesInClass;e.exports=i(r,["domain"])},523:function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},o=n(7284).EventEmitter,a=function(){function e(){Object.defineProperties(this,{_eventEmitter:{value:new o}})}return e.prototype.dispatchEvent=function(e){return this._eventEmitter.emit(e.type,e)},e.prototype.addEventListener=function(){var e;return(e=this._eventEmitter).addListener.apply(e,i([],r(arguments)))},e.prototype.removeEventListener=function(){var e;return(e=this._eventEmitter).removeListener.apply(e,i([],r(arguments)))},e}();e.exports=a},1282:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(5745),o=n(5649),a={connect:n(9636),createLocalAudioTrack:n(7490).audio,createLocalVideoTrack:n(7490).video,isSupported:n(244)(),version:n(4084).version,Logger:n(6553),LocalAudioTrack:n(2001).LocalAudioTrack,LocalDataTrack:n(2001).LocalDataTrack,LocalVideoTrack:n(2001).LocalVideoTrack};var s=a.isSupported,c=a.version,l=a.Logger,d=a.LocalAudioTrack,u=a.LocalVideoTrack,h=a.LocalDataTrack;e.exports={connect:function(e,t){var n=r({createLocalTracks:i.createLocalTracks},t);return a.connect(e,n)},createLocalAudioTrack:function(e){var t=r({createLocalTracks:i.createLocalTracks},e);return a.createLocalAudioTrack(t)},createLocalVideoTrack:function(e){var t=r({createLocalTracks:i.createLocalTracks},e);return a.createLocalVideoTrack(t)},createLocalTracks:i.createLocalTracks,runPreflight:o.runPreflight,isSupported:s,version:c,Logger:l,LocalAudioTrack:d,LocalVideoTrack:u,LocalDataTrack:h}},9652:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(7422).MediaStreamTrack,o=n(6803),a=o.asLocalTrack,s=o.asLocalTrackPublication,c=o.trackClass,l=n(6262),d=l.typeErrors,u=l.trackPriority,h=n(9961).ZS,p=n(2001),f=p.LocalAudioTrack,m=p.LocalDataTrack,_=p.LocalVideoTrack,g=n(3173),v=n(8185),y=n(8556),b=function(e){function t(t,n,r){var o=this,a=(r=Object.assign({LocalAudioTrack:f,LocalVideoTrack:_,LocalDataTrack:m,MediaStreamTrack:i,LocalAudioTrackPublication:g,LocalVideoTrackPublication:y,LocalDataTrackPublication:v,shouldStopLocalTracks:!1,tracks:n},r)).shouldStopLocalTracks?new Set(n.filter((function(e){return"data"!==e.kind}))):new Set;return o=e.call(this,t,r)||this,Object.defineProperties(o,{_eventObserver:{value:r.eventObserver},_LocalAudioTrack:{value:r.LocalAudioTrack},_LocalDataTrack:{value:r.LocalDataTrack},_LocalVideoTrack:{value:r.LocalVideoTrack},_MediaStreamTrack:{value:r.MediaStreamTrack},_LocalAudioTrackPublication:{value:r.LocalAudioTrackPublication},_LocalDataTrackPublication:{value:r.LocalDataTrackPublication},_LocalVideoTrackPublication:{value:r.LocalVideoTrackPublication},_tracksToStop:{value:a},signalingRegion:{enumerable:!0,get:function(){return t.signalingRegion}}}),o._handleTrackSignalingEvents(),o}return r(t,e),t.prototype._addTrack=function(t,n,r){var i=e.prototype._addTrack.call(this,t,n);return i&&"disconnected"!==this.state&&this._addLocalTrack(t,r),i},t.prototype._addLocalTrack=function(e,t){var n,r=null===(n=e.noiseCancellation)||void 0===n?void 0:n.vendor;this._signaling.addTrack(e._trackSender,e.name,t,r),this._log.info("Added a new "+c(e,!0)+":",e.id),this._log.debug(c(e,!0)+":",e)},t.prototype._removeTrack=function(t,n){var r=e.prototype._removeTrack.call(this,t,n);return r&&"disconnected"!==this.state&&(this._signaling.removeTrack(t._trackSender),this._log.info("Removed a "+c(t,!0)+":",t.id),this._log.debug(c(t,!0)+":",t)),r},t.prototype._getTrackEvents=function(){return e.prototype._getTrackEvents.call(this).concat([["disabled","trackDisabled"],["enabled","trackEnabled"],["stopped","trackStopped"]])},t.prototype.toString=function(){return"[LocalParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"},t.prototype._handleTrackSignalingEvents=function(){var e=this,t=this._log;if("disconnected"!==this.state){var n=function(n){var r=e._signaling.getPublication(n._trackSender);r&&(r.disable(),t.debug("Disabled the "+c(n,!0)+":",n.id))},r=function(n){var r=e._signaling.getPublication(n._trackSender);r&&(r.enable(),t.debug("Enabled the "+c(n,!0)+":",n.id))},i=function(t){var n=e._signaling.getPublication(t._trackSender);return n&&n.stop(),n},o=function(a){t.debug("Transitioned to state:",a),"disconnected"===a?(t.debug("Removing LocalTrack event listeners"),e._signaling.removeListener("stateChanged",o),e.removeListener("trackDisabled",n),e.removeListener("trackEnabled",r),e.removeListener("trackStopped",i),e._tracks.forEach((function(e){var t=i(e);t&&e._trackSender.removeClone(t._trackTransceiver)})),t.info("LocalParticipant disconnected. Stopping "+e._tracksToStop.size+" automatically-acquired LocalTracks"),e._tracksToStop.forEach((function(e){e.stop()}))):"connected"===a&&(t.info("reconnected"),setTimeout((function(){return e.emit("reconnected")}),0))};this.on("trackDisabled",n),this.on("trackEnabled",r),this.on("trackStopped",i),this._signaling.on("stateChanged",o),this._tracks.forEach((function(n){e._addLocalTrack(n,u.PRIORITY_STANDARD),e._getOrCreateLocalTrackPublication(n).catch((function(e){t.warn("Failed to get or create LocalTrackPublication for "+n+":",e)}))}))}},t.prototype._getOrCreateLocalTrackPublication=function(e){var t=E(this.tracks,e);if(t)return Promise.resolve(t);var n=this._log,r=this,i=this._signaling.getPublication(e._trackSender);return i?new Promise((function(o,a){i.on("updated",(function l(){var d=i.error;if(d)return i.removeListener("updated",l),n.warn("Failed to publish the "+c(e,!0)+": "+d.message),r._removeTrack(e,e.id),setTimeout((function(){r.emit("trackPublicationFailed",d,e)})),void a(d);if(!r._tracks.has(e.id))return i.removeListener("updated",l),void a(new Error("The "+e+" was unpublished"));if(i.sid){i.removeListener("updated",l);var u={log:n,LocalAudioTrackPublication:r._LocalAudioTrackPublication,LocalDataTrackPublication:r._LocalDataTrackPublication,LocalVideoTrackPublication:r._LocalVideoTrackPublication};t=E(r.tracks,e);var h=function(e){return r.emit("trackWarning",e,t)},p=function(){return r.emit("trackWarningsCleared",t)};t||(t=s(e,i,(function(e){t.removeListener("trackWarning",h),t.removeListener("trackWarningsCleared",p),r.unpublishTrack(e.track)}),u),r._addTrackPublication(t)),t.on("warning",h),t.on("warningsCleared",p);var f=r._signaling.state;"connected"!==f&&"connecting"!==f||(e._processorEventObserver&&e._processorEventObserver.on("event",(function(e){r._eventObserver.emit("event",{name:e.name,payload:e.data,group:"video-processor",level:"info"})})),e.processedTrack&&(e._captureFrames(),e._setSenderMediaStreamTrack(!0))),"connected"===f&&setTimeout((function(){r.emit("trackPublished",t)})),o(t)}}))})):Promise.reject(new Error("Unexpected error: The "+e+" cannot be published"))},t.prototype.publishTrack=function(e,t){var n,r=E(this.tracks,e);if(r)return Promise.resolve(r);t=Object.assign({log:this._log,priority:u.PRIORITY_STANDARD,LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack},t);try{n=a(e,t)}catch(l){return Promise.reject(l)}var i=n.noiseCancellation,o=this._signaling.audioProcessors;i&&!o.includes(i.vendor)&&(this._log.warn(i.vendor+" is not supported in this room. disabling it permanently"),i.disablePermanently());var s=Object.values(u);if(!s.includes(t.priority))return Promise.reject(d.INVALID_VALUE("LocalTrackPublishOptions.priority",s));var c=this._addTrack(n,n.id,t.priority)||this._tracks.get(n.id);return this._getOrCreateLocalTrackPublication(c)},t.prototype.publishTracks=function(e){if(!Array.isArray(e))throw d.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return Promise.all(e.map(this.publishTrack,this))},t.prototype.setBandwidthProfile=function(){this._log.warn("setBandwidthProfile is not implemented yet and may be available in future versions of twilio-video.js")},t.prototype.setNetworkQualityConfiguration=function(e){if("object"!==typeof e||null===e)throw d.INVALID_TYPE("networkQualityConfiguration","NetworkQualityConfiguration");return["local","remote"].forEach((function(t){if(t in e&&("number"!==typeof e[t]||isNaN(e[t])))throw d.INVALID_TYPE("networkQualityConfiguration."+t,"number")})),this._signaling.setNetworkQualityConfiguration(e),this},t.prototype.setParameters=function(e){if("undefined"!==typeof e&&"object"!==typeof e)throw d.INVALID_TYPE("encodingParameters","EncodingParameters, null or undefined");if(e){if(this._signaling.getParameters().adaptiveSimulcast&&e.maxVideoBitrate)throw d.INVALID_TYPE("encodingParameters",'encodingParameters.maxVideoBitrate is not compatible with "preferredVideoCodecs=auto"');["maxAudioBitrate","maxVideoBitrate"].forEach((function(t){if("undefined"!==typeof e[t]&&"number"!==typeof e[t]&&null!==e[t])throw d.INVALID_TYPE("encodingParameters."+t,"number, null or undefined")}))}else null===e&&(e={maxAudioBitrate:null,maxVideoBitrate:null});return this._signaling.setParameters(e),this},t.prototype.unpublishTrack=function(e){h(e,{LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack});var t=this._tracks.get(e.id);if(!t)return null;if(this._signaling.getPublication(t._trackSender).publishFailed(new Error("The "+t+" was unpublished")),!(t=this._removeTrack(t,t.id)))return null;var n=E(this.tracks,t);return n&&this._removeTrackPublication(n),n},t.prototype.unpublishTracks=function(e){var t=this;if(!Array.isArray(e))throw d.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return e.reduce((function(e,n){var r=t.unpublishTrack(n);return r?e.concat(r):e}),[])},t}(n(8715));function E(e,t){return Array.from(e.values()).find((function(e){return e.track===t||e.track.mediaStreamTrack===t}))||null}e.exports=b},9860:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t.prototype.attach=function(){return e.prototype.attach.apply(this,arguments)},t.prototype.detach=function(){return e.prototype.detach.apply(this,arguments)},t}(n(2342));e.exports=i},5782:function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=n(6262).DEFAULT_FRAME_RATE;e.exports="function"===typeof MediaStreamTrackGenerator&&"function"===typeof MediaStreamTrackProcessor?function(e,t,n){var i=r(e.srcObject.getVideoTracks(),1)[0],o=new MediaStreamTrackProcessor({track:i}).readable,a=new MediaStreamTrackGenerator({kind:"video"}),s=!1,c=new TransformStream({transform:function(e,r){return("videoframe"===n?t(e):Promise.resolve(e.close()).then(t)).finally((function(){s&&r.terminate()}))}});return o.pipeThrough(c).pipeTo(a.writable).then((function(){})),function(){s=!0}}:function(e,t){var n,o=r(e.srcObject.getVideoTracks(),1)[0].getSettings().frameRate,a=void 0===o?i:o,s=new ReadableStream({start:function(e){n=setInterval((function(){return e.enqueue()}),1e3/a)}}),c=new TransformStream({transform:function(){return t()}});return s.pipeThrough(c).pipeTo(new WritableStream).then((function(){})),function(){clearInterval(n)}}},2001:(e,t,n)=>{"use strict";e.exports={LocalAudioTrack:n(8587),LocalVideoTrack:n(4836),LocalDataTrack:n(7151)}},8587:(e,t,n)=>{"use strict";var r=n(6209),i=n(423);function o(e,t){var n=new i(e,t);return Object.setPrototypeOf(n,o.prototype),n}r(o,i),e.exports=o},7151:(e,t,n)=>{"use strict";var r=n(6209),i=n(4059);function o(e){var t=new i(e);return Object.setPrototypeOf(t,o.prototype),t}r(o,i),e.exports=o},4836:(e,t,n)=>{"use strict";var r=n(6209),i=n(4680);function o(e,t){var n=new i(e,t);return Object.setPrototypeOf(n,o.prototype),n}r(o,i),e.exports=o},4957:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(1906),o=n(6803),a=o.buildLogLevels,s=o.valueToJSON,c=n(6262).DEFAULT_LOG_LEVEL,l=n(5765),d=0,u=function(e){function t(t,n,r){var i;r=Object.assign({name:t,log:null,logLevel:c},r),i=e.call(this)||this;var o=String(r.name),s=a(r.logLevel),u=r.log?r.log.createLog("media",i):new l("media",i,s,r.loggerName);return Object.defineProperties(i,{_instanceId:{value:++d},_log:{value:u},kind:{enumerable:!0,value:n},name:{enumerable:!0,value:o}}),i}return r(t,e),t.prototype.toJSON=function(){return s(this)},t}(i);e.exports=u},423:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(4136).isIOS,o=n(119),a=n(295).isIOSChrome,s=n(9860),c=function(e){function t(t,n){var r=this,o=(null===n||void 0===n?void 0:n.noiseCancellation)||null,a=(r=e.call(this,t,n)||this)._log,s=t.label,c=void 0===s?"":s,l=t.getSettings(),d=l.deviceId,u=void 0===d?"":d,h=l.groupId,p=void 0===h?"":h;return Object.defineProperties(r,{_currentDefaultDeviceInfo:{value:{deviceId:u,groupId:p,label:c},writable:!0},_enumerateDevices:{value:"function"===typeof(null===n||void 0===n?void 0:n.enumerateDevices)?n.enumerateDevices:navigator.mediaDevices.enumerateDevices},_defaultDeviceCaptureMode:{value:i()&&!o||!r._isCreatedByCreateLocalTracks||"object"!==typeof navigator||"object"!==typeof navigator.mediaDevices||"function"!==typeof navigator.mediaDevices.addEventListener||"function"!==typeof(null===n||void 0===n?void 0:n.enumerateDevices)&&"function"!==typeof navigator.mediaDevices.enumerateDevices?"manual":(null===n||void 0===n?void 0:n.defaultDeviceCaptureMode)||"auto"},_onDeviceChange:{value:function(){r._enumerateDevices().then((function(e){var t=e.find((function(e){var t=e.deviceId;return"audioinput"===e.kind&&"default"!==t}));t&&["deviceId","groupId"].some((function(e){return t[e]!==r._currentDefaultDeviceInfo[e]}))&&(a.info("Default device changed, restarting the LocalAudioTrack"),a.debug('Old default device: "'+r._currentDefaultDeviceInfo.deviceId+'" => "'+r._currentDefaultDeviceInfo.label+'"'),a.debug('New default device: "'+t.deviceId+'" => "'+t.label+'"'),r._currentDefaultDeviceInfo=t,r._restartDefaultDevice().catch((function(e){return a.warn("Failed to restart: "+e.message)})))}),(function(e){a.warn("Failed to run enumerateDevices(): "+e.message)}))}},_restartOnDefaultDeviceChangeCleanup:{value:null,writable:!0},noiseCancellation:{enumerable:!0,value:o,writable:!1}}),a.debug("defaultDeviceCaptureMode:",r._defaultDeviceCaptureMode),r._maybeRestartOnDefaultDeviceChange(),r}return r(t,e),t.prototype.toString=function(){return"[LocalAudioTrack #"+this._instanceId+": "+this.id+"]"},t.prototype.attach=function(t){return(t=e.prototype.attach.call(this,t)).muted=!0,t},t.prototype._end=function(){return e.prototype._end.apply(this,arguments)},t.prototype._maybeRestartOnDefaultDeviceChange=function(){var e=this,t=this,n=t._constraints,r=t._defaultDeviceCaptureMode,i=t._log,o=(this.noiseCancellation?this.noiseCancellation.sourceTrack:this.mediaStreamTrack).getSettings().deviceId,a=function(e){return e!==o||"default"===e},s=function e(t){return void 0===t&&(t={}),"string"===typeof t?a(t):Array.isArray(t)?t.every(a):t.exact?e(t.exact):!t.ideal||e(t.ideal)}(n.deviceId);"auto"===r&&s?this._restartOnDefaultDeviceChangeCleanup||(i.info("LocalAudioTrack will be restarted if the default device changes"),navigator.mediaDevices.addEventListener("devicechange",this._onDeviceChange),this._restartOnDefaultDeviceChangeCleanup=function(){i.info("Cleaning up the listener to restart the LocalAudioTrack if the default device changes"),navigator.mediaDevices.removeEventListener("devicechange",e._onDeviceChange),e._restartOnDefaultDeviceChangeCleanup=null}):(i.info("LocalAudioTrack will NOT be restarted if the default device changes"),this._restartOnDefaultDeviceChangeCleanup&&this._restartOnDefaultDeviceChangeCleanup())},t.prototype._reacquireTrack=function(t){var n=this;return this._log.debug("_reacquireTrack: ",t),this.noiseCancellation?this.noiseCancellation.reacquireTrack((function(){return e.prototype._reacquireTrack.call(n,t)})):e.prototype._reacquireTrack.call(this,t)},t.prototype._restartDefaultDevice=function(){var e=this,t=Object.assign({},this._constraints),n=Object.assign({},t,{deviceId:this._currentDefaultDeviceInfo.deviceId});return this.restart(n).then((function(){e._constraints=t,e._maybeRestartOnDefaultDeviceChange()}))},t.prototype._setMediaStreamTrack=function(t){var n=this,r=this._log,i=this.noiseCancellation,s=e.prototype._setMediaStreamTrack.call(this,t);return a()&&i&&(r.debug("iOS Chrome detected, checking if the restarted Krisp audio is silent"),s=s.then((function(){return o(n._dummyEl)})).then((function(t){return r.debug("Krisp audio is "+(t?"silent, using source audio":"not silent")),t&&i.disablePermanently().then((function(){return e.prototype._setMediaStreamTrack.call(n,i.sourceTrack)}))}))),s},t.prototype.disable=function(){return e.prototype.disable.apply(this,arguments)},t.prototype.enable=function(){return e.prototype.enable.apply(this,arguments)},t.prototype.restart=function(){return e.prototype.restart.apply(this,arguments)},t.prototype.stop=function(){return this.noiseCancellation&&this.noiseCancellation.stop(),this._restartOnDefaultDeviceChangeCleanup&&this._restartOnDefaultDeviceChangeCleanup(),e.prototype.stop.apply(this,arguments)},t}(n(5309)(s));e.exports=c},3173:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i)||this}return r(t,e),t.prototype.toString=function(){return"[LocalAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},t}(n(8505));e.exports=i},4059:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(4957),o=n(1206),a=function(e){function t(t){var n,r=new(0,(t=Object.assign({DataTrackSender:o,maxPacketLifeTime:null,maxRetransmits:null,ordered:!0},t)).DataTrackSender)(t.maxPacketLifeTime,t.maxRetransmits,t.ordered);return n=e.call(this,r.id,"data",t)||this,Object.defineProperties(n,{_trackSender:{value:r},id:{enumerable:!0,value:r.id},maxPacketLifeTime:{enumerable:!0,value:t.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:t.maxRetransmits},ordered:{enumerable:!0,value:t.ordered},reliable:{enumerable:!0,value:null===t.maxPacketLifeTime&&null===t.maxRetransmits}}),n}return r(t,e),t.prototype.send=function(e){this._trackSender.send(e)},t}(i);e.exports=a},8185:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i)||this}return r(t,e),t.prototype.toString=function(){return"[LocalDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},t}(n(8505));e.exports=i},5309:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(7422).getUserMedia,o=n(4136).isIOS,a=n(6803),s=a.capitalize,c=a.defer,l=a.waitForSometime,d=a.waitForEvent,u=n(6262).typeErrors.ILLEGAL_INVOKE,h=n(119),p=n(6918),f=n(3558),m=n(5843),_=n(5355),g=n(224);function v(e){var t=e._log,n=e.kind,r=e._noiseCancellation,i={audio:h,video:p}[n],o=function(){return r?r.sourceTrack:e.mediaStreamTrack},a=e._dummyEl,s=o(),u=null;function _(){var n=e._workaroundWebKitBug1208516Cleanup,r=e.isStopped&&!!n,s=o().muted;return Promise.resolve().then((function(){return"visible"===document.visibilityState&&!u&&(s||r||a.play().then((function(){return i(a)})).then((function(e){return e?t.warn("Silence detected"):t.info("Non-silence detected"),e})).catch((function(e){t.warn("Failed to detect silence:",e)})).finally((function(){e.processedTrack||a.pause()})))}))}function g(){return Promise.race([d(s,"unmute"),l(50)]).then((function(){return _()})).then((function(r){return r&&!u&&(u=c(),e._restart().finally((function(){a=e._dummyEl,b(),s=o(),y(),u.resolve(),u=null})).catch((function(e){t.error("failed to restart track: ",e)}))),(u&&u.promise||Promise.resolve()).finally((function(){return m.resolveDeferred(n)}))})).catch((function(e){t.error("error in maybeRestart: "+e.message)}))}function v(){var t=e._log,n=e.kind;t.info("Muted"),t.debug("LocalMediaTrack:",e),m.startDeferred(n)}function y(){s.addEventListener?(s.addEventListener("ended",g),s.addEventListener("mute",v),s.addEventListener("unmute",g)):(s.onended=g,s.onmute=v,s.onunmute=g)}function b(){s.removeEventListener?(s.removeEventListener("ended",g),s.removeEventListener("mute",v),s.removeEventListener("unmute",g)):(s.onended=null,s.onmute=null,s.onunmute=null)}var E=function(e){return!!e&&g()};return f.onVisibilityChange(1,E),y(),function(){f.offVisibilityChange(1,E),b()}}e.exports=function(e){return function(e){function t(t,n){var r=this,a=o()&&"object"===typeof document&&"function"===typeof document.addEventListener&&"string"===typeof document.visibilityState;n=Object.assign({getUserMedia:i,isCreatedByCreateLocalTracks:!1,workaroundWebKitBug1208516:a,gUMSilentTrackWorkaround:_},n);var s=new g(t),c=s.kind;return r=e.call(this,s,n)||this,Object.defineProperties(r,{_constraints:{value:"object"===typeof n[c]?n[c]:{},writable:!0},_getUserMedia:{value:n.getUserMedia},_gUMSilentTrackWorkaround:{value:n.gUMSilentTrackWorkaround},_eventsToReemitters:{value:new Map([["muted",function(){return r.emit("muted",r)}],["unmuted",function(){return r.emit("unmuted",r)}]])},_workaroundWebKitBug1208516:{value:n.workaroundWebKitBug1208516},_workaroundWebKitBug1208516Cleanup:{value:null,writable:!0},_didCallEnd:{value:!1,writable:!0},_isCreatedByCreateLocalTracks:{value:n.isCreatedByCreateLocalTracks},_noiseCancellation:{value:n.noiseCancellation||null},_trackSender:{value:s},id:{enumerable:!0,value:s.id},isEnabled:{enumerable:!0,get:function(){return s.enabled}},isMuted:{enumerable:!0,get:function(){return s.muted}},isStopped:{enumerable:!0,get:function(){return"ended"===s.readyState}}}),r._workaroundWebKitBug1208516&&(r._workaroundWebKitBug1208516Cleanup=v(r)),r._reemitTrackSenderEvents(),r}return r(t,e),t.prototype._end=function(){var t=this;this._didCallEnd||(e.prototype._end.call(this),this._didCallEnd=!0,this._eventsToReemitters.forEach((function(e,n){return t._trackSender.removeListener(n,e)})),this.emit("stopped",this))},t.prototype._initialize=function(){this._didCallEnd&&(this._didCallEnd=!1),this._eventsToReemitters&&this._reemitTrackSenderEvents(),e.prototype._initialize.call(this)},t.prototype._reacquireTrack=function(e){var t,n=this,r=n._getUserMedia,i=n._gUMSilentTrackWorkaround,o=n._log,a=n.mediaStreamTrack.kind;o.info("Re-acquiring the MediaStreamTrack"),o.debug("Constraints:",e);var s=Object.assign({audio:!1,video:!1},((t={})[a]=e,t));return(this._workaroundWebKitBug1208516Cleanup?i(o,r,s):r(s)).then((function(e){return e.getTracks()[0]}))},t.prototype._reemitTrackSenderEvents=function(){var e=this;this._eventsToReemitters.forEach((function(t,n){return e._trackSender.on(n,t)})),this._trackSender.dequeue("muted"),this._trackSender.dequeue("unmuted")},t.prototype._restart=function(e){var t=this,n=this._log;return e=e||this._constraints,this._stop(),this._reacquireTrack(e).catch((function(t){throw n.error("Failed to re-acquire the MediaStreamTrack:",{error:t,constraints:e}),t})).then((function(r){return n.info("Re-acquired the MediaStreamTrack"),n.debug("MediaStreamTrack:",r),t._constraints=Object.assign({},e),t._setMediaStreamTrack(r)}))},t.prototype._setMediaStreamTrack=function(e){var t=this;return e.enabled=this.mediaStreamTrack.enabled,this._stop(),(this._unprocessedTrack?Promise.resolve().then((function(){t._unprocessedTrack=e})):this._trackSender.setMediaStreamTrack(e).catch((function(n){t._log.warn("setMediaStreamTrack failed:",{error:n,mediaStreamTrack:e})}))).then((function(){t._initialize(),t._getAllAttachedElements().forEach((function(e){return t._attach(e)}))}))},t.prototype._stop=function(){return this.mediaStreamTrack.stop(),this._end(),this},t.prototype.enable=function(e){return(e="boolean"!==typeof e||e)!==this.mediaStreamTrack.enabled&&(this._log.info((e?"En":"Dis")+"abling"),this.mediaStreamTrack.enabled=e,this.emit(e?"enabled":"disabled",this)),this},t.prototype.disable=function(){return this.enable(!1)},t.prototype.restart=function(e){var t=this,n=this.kind;if(!this._isCreatedByCreateLocalTracks)return Promise.reject(u("restart","can only be called on a Local"+s(n)+"Track that is created using createLocalTracks or createLocal"+s(n)+"Track."));this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null);var r=this._restart(e);return this._workaroundWebKitBug1208516&&(r=r.finally((function(){t._workaroundWebKitBug1208516Cleanup=v(t)}))),r},t.prototype.stop=function(){return this._log.info("Stopping"),this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null),this._stop()},t}(e)}},8505:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=n(5630),s=n(6262),c=s.typeErrors,l=s.trackPriority,d=function(e){function t(t,n,r,a){var s=e.call(this,n.name,t.sid,a)||this;return Object.defineProperties(s,{_reemitSignalingEvent:{value:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s.emit.apply(s,o([e&&e.length?"warning":"warningsCleared"],i(e)))}},_reemitTrackEvent:{value:function(){return s.emit(s.isTrackEnabled?"trackEnabled":"trackDisabled")}},_signaling:{value:t},_unpublish:{value:r},isTrackEnabled:{enumerable:!0,get:function(){return"data"===this.track.kind||this.track.isEnabled}},kind:{enumerable:!0,value:n.kind},priority:{enumerable:!0,get:function(){return t.updatedPriority}},track:{enumerable:!0,value:n}}),["disabled","enabled"].forEach((function(e){return n.on(e,s._reemitTrackEvent)})),["warning","warningsCleared"].forEach((function(e){return t.on(e,s._reemitSignalingEvent)})),s}return r(t,e),t.prototype.toString=function(){return"[LocalTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},t.prototype.setPriority=function(e){var t=Object.values(l);if(!t.includes(e))throw c.INVALID_VALUE("priority",t);return this._signaling.setPriority(e),this},t.prototype.unpublish=function(){var e=this;return["disabled","enabled"].forEach((function(t){return e.track.removeListener(t,e._reemitTrackEvent)})),["warning","warningsCleared"].forEach((function(t){return e._signaling.removeListener(t,e._reemitSignalingEvent)})),this._unpublish(this),this},t}(a);e.exports=d},4680:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(4136).isIOS,o=n(6918),a=function(e){function t(t,n){var r=this;return n=Object.assign({workaroundSilentLocalVideo:i()&&"undefined"!==typeof document&&"function"===typeof document.createElement},n),r=e.call(this,t,n)||this,Object.defineProperties(r,{_workaroundSilentLocalVideo:{value:n.workaroundSilentLocalVideo?s:null},_workaroundSilentLocalVideoCleanup:{value:null,writable:!0}}),r._workaroundSilentLocalVideo&&(r._workaroundSilentLocalVideoCleanup=r._workaroundSilentLocalVideo(r,document)),r}return r(t,e),t.prototype.toString=function(){return"[LocalVideoTrack #"+this._instanceId+": "+this.id+"]"},t.prototype._checkIfCanCaptureFrames=function(){return e.prototype._checkIfCanCaptureFrames.call(this,this._trackSender.isPublishing)},t.prototype._end=function(){return e.prototype._end.apply(this,arguments)},t.prototype._setSenderMediaStreamTrack=function(e){var t=this,n=this.mediaStreamTrack,r=e?this.processedTrack:n;return this._trackSender.setMediaStreamTrack(r).catch((function(e){return t._log.warn("setMediaStreamTrack failed on LocalVideoTrack RTCRtpSender",{error:e,mediaStreamTrack:r})})).then((function(){t._unprocessedTrack=e?n:null}))},t.prototype.addProcessor=function(){this._log.debug("Adding VideoProcessor to the LocalVideoTrack");var t=e.prototype.addProcessor.apply(this,arguments);return this.processedTrack?(this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0),t):this._log.warn("Unable to add a VideoProcessor to the LocalVideoTrack")},t.prototype.removeProcessor=function(){var t=this;this._log.debug("Removing VideoProcessor from the LocalVideoTrack");var n=e.prototype.removeProcessor.apply(this,arguments);return this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the original MediaStreamTrack"),this._setSenderMediaStreamTrack().then((function(){return t._updateElementsMediaStreamTrack()})),n},t.prototype.disable=function(){var t=e.prototype.disable.apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=!1),t},t.prototype.enable=function(t){void 0===t&&(t=!0);var n=e.prototype.enable.apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=t,t&&(this._captureFrames(),this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0))),n},t.prototype.restart=function(){var t=this;this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null);var n=e.prototype.restart.apply(this,arguments);return this.processor&&n.then((function(){t._restartProcessor()})),this._workaroundSilentLocalVideo&&n.finally((function(){t._workaroundSilentLocalVideoCleanup=t._workaroundSilentLocalVideo(t,document)})),n},t.prototype.stop=function(){return this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null),e.prototype.stop.apply(this,arguments)},t}(n(5309)(n(4955)));function s(e,t){var n=e._log,r=e._dummyEl,i=e.mediaStreamTrack;function a(){e.isEnabled&&(n.info("Unmuted, checking silence"),r.play().then((function(){return o(r,t)})).then((function(t){if(t)return n.warn("Silence detected, restarting"),e._stop(),e._restart();n.info("Non-silent frames detected, so no need to restart")})).catch((function(e){n.warn("Failed to detect silence and restart:",e)})).finally((function(){!(r=e._dummyEl)||r.paused||e.processedTrack||r.pause(),i.removeEventListener("unmute",a),(i=e.mediaStreamTrack).addEventListener?i.addEventListener("unmute",a):i.onunmute=a})))}return i.addEventListener?i.addEventListener("unmute",a):i.onunmute=a,function(){i.removeEventListener?i.removeEventListener("unmute",a):i.onunmute=null}}e.exports=a},8556:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i)||this}return r(t,e),t.prototype.toString=function(){return"[LocalVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},t}(n(8505));e.exports=i},2342:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(4136).isIOS,o=n(7422).MediaStream,a=n(6803),s=a.waitForEvent,c=a.waitForSometime,l=n(5843),d=function(e){function t(t,n){var r=this;n=Object.assign({playPausedElementsIfNotBackgrounded:i()&&"object"===typeof document&&"function"===typeof document.addEventListener&&"string"===typeof document.visibilityState},n),r=e.call(this,t.id,t.kind,n)||this;var a=!1;if("function"!==typeof(n=Object.assign({MediaStream:o},n)).MediaStream)throw new Error("MediaTrack received an invalid MediaStream constructor: "+n.MediaStream);return Object.defineProperties(r,{_attachments:{value:new Set},_dummyEl:{value:null,writable:!0},_elShims:{value:new WeakMap},_isStarted:{get:function(){return a},set:function(e){a=e}},_playPausedElementsIfNotBackgrounded:{value:n.playPausedElementsIfNotBackgrounded},_shouldShimAttachedElements:{value:n.workaroundWebKitBug212780||n.playPausedElementsIfNotBackgrounded},_unprocessedTrack:{value:null,writable:!0},_MediaStream:{value:n.MediaStream},_mapMediaElement:{value:n.mapMediaElement},_disposeMediaElement:{value:n.disposeMediaElement},isStarted:{enumerable:!0,get:function(){return a}},mediaStreamTrack:{enumerable:!0,get:function(){return this._unprocessedTrack||t.track}},processedTrack:{enumerable:!0,value:null,writable:!0}}),r._initialize(),r}return r(t,e),t.prototype._start=function(){this._log.debug("Started"),this._isStarted=!0,this._dummyEl&&(this._dummyEl.oncanplay=null),this.emit("started",this)},t.prototype._initialize=function(){var e=this;this._log.debug("Initializing"),this._dummyEl=this._createElement(),this.mediaStreamTrack&&this.mediaStreamTrack.addEventListener?this.mediaStreamTrack.addEventListener("ended",(function t(){e._end(),e.mediaStreamTrack.removeEventListener("ended",t)})):this.mediaStreamTrack&&(this.mediaStreamTrack.onended=function(){e._end(),e.mediaStreamTrack.onended=null}),this._dummyEl&&(this._dummyEl.muted=!0,this._dummyEl.oncanplay=this._start.bind(this,this._dummyEl),this._attach(this._dummyEl,this.mediaStreamTrack),this._attachments.delete(this._dummyEl))},t.prototype._end=function(){this._log.debug("Ended"),this._dummyEl&&(this._dummyEl.remove(),this._disposeMediaElement?this._disposeMediaElement(this._dummyEl):this._dummyEl.srcObject=null,this._dummyEl.oncanplay=null,this._dummyEl=null)},t.prototype.attach=function(e){var t=this;if("string"===typeof e?e=this._selectElement(e):e||(e=this._createElement()),this._log.debug("Attempting to attach to element:",e),e=this._attach(e),this._shouldShimAttachedElements&&!this._elShims.has(e)){var n=this._playPausedElementsIfNotBackgrounded?function(){return function(e,t){var n=e.tagName.toLowerCase();t.warn("Unintentionally paused:",e),Promise.race([s(document,"visibilitychange"),c(1e3)]).then((function(){"visible"===document.visibilityState&&l.whenResolved("audio").then((function(){return t.info("Playing unintentionally paused <"+n+"> element"),t.debug("Element:",e),e.play()})).then((function(){t.info("Successfully played unintentionally paused <"+n+"> element"),t.debug("Element:",e)})).catch((function(r){t.warn("Error while playing unintentionally paused <"+n+"> element:",{error:r,el:e})}))}))}(e,t._log)}:null;this._elShims.set(e,function(e,t){void 0===t&&(t=null);var n=e.pause,r=e.play,i=!1;e.pause=function(){return i=!0,n.call(e)},e.play=function(){return i=!1,r.call(e)};var o=t?function(){i||t()}:null;o&&e.addEventListener("pause",o);return{pausedIntentionally:function(){return i},unShim:function(){e.pause=n,e.play=r,o&&e.removeEventListener("pause",o)}}}(e,n))}return e},t.prototype._attach=function(e,t){void 0===t&&(t=this.processedTrack||this.mediaStreamTrack);var n=e.srcObject;n instanceof this._MediaStream||(n=new this._MediaStream);var r="audio"===t.kind?"getAudioTracks":"getVideoTracks";return n[r]().forEach((function(e){n.removeTrack(e)})),n.addTrack(t),this._mapMediaElement&&(this._log.debug("Mapping element using mapMediaElement before attaching media to element"),this._mapMediaElement(e)),e.srcObject=n,e.autoplay=!0,e.playsInline=!0,this._attachments.has(e)||this._attachments.add(e),e},t.prototype._selectElement=function(e){var t=document.querySelector(e);if(!t)throw new Error("Selector matched no element: "+e);return t},t.prototype._updateElementsMediaStreamTrack=function(){var e=this;this._log.debug("Reattaching all elements to update mediaStreamTrack"),this._getAllAttachedElements().forEach((function(t){return e._attach(t)}))},t.prototype._createElement=function(){return"undefined"!==typeof document?document.createElement(this.kind):null},t.prototype.detach=function(e){var t;return t="string"===typeof e?[this._selectElement(e)]:e?[e]:this._getAllAttachedElements(),this._log.debug("Attempting to detach from elements:",t),this._detachElements(t),e?t[0]:t},t.prototype._detachElements=function(e){return e.map(this._detachElement.bind(this))},t.prototype._detachElement=function(e){if(!this._attachments.has(e))return e;var t=e.srcObject;(t instanceof this._MediaStream&&t.removeTrack(this.processedTrack||this.mediaStreamTrack),this._disposeMediaElement&&(this._log.debug("Disposing element using disposeMediaElement after removing media from element"),this._disposeMediaElement(e)),this._attachments.delete(e),this._shouldShimAttachedElements&&this._elShims.has(e))&&(this._elShims.get(e).unShim(),this._elShims.delete(e));return e},t.prototype._getAllAttachedElements=function(){var e=[];return this._attachments.forEach((function(t){e.push(t)})),e},t}(n(4957));e.exports=d},9918:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.applyNoiseCancellation=t.NoiseCancellationImpl=void 0;var o=n(3864),a=(n(5765),function(){function e(e,t){this._processor=e,this._sourceTrack=t,this._disabledPermanent=!1}return Object.defineProperty(e.prototype,"vendor",{get:function(){return this._processor.vendor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sourceTrack",{get:function(){return this._sourceTrack},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._processor.isEnabled()},enumerable:!1,configurable:!0}),e.prototype.enable=function(){if(this._disabledPermanent)throw new Error(this.vendor+" noise cancellation is disabled permanently for this track");return this._processor.enable(),Promise.resolve()},e.prototype.disable=function(){return this._processor.disable(),Promise.resolve()},e.prototype.reacquireTrack=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return t=this._processor.isEnabled(),this._processor.disconnect(),[4,e()];case 1:return n=i.sent(),this._sourceTrack=n,[4,this._processor.connect(n)];case 2:return r=i.sent(),t?this._processor.enable():this._processor.disable(),[2,r]}}))}))},e.prototype.disablePermanently=function(){return this._disabledPermanent=!0,this.disable()},e.prototype.stop=function(){this._processor.disconnect(),this._sourceTrack.stop()},e}());t.NoiseCancellationImpl=a,t.applyNoiseCancellation=function(e,t,n){return r(this,void 0,void 0,(function(){var r,s,c,l;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,o.createNoiseCancellationAudioProcessor(t,n)];case 1:return r=i.sent(),s=r.connect(e),c=new a(r,e),[2,{cleanTrack:s,noiseCancellation:c}];case 2:return l=i.sent(),n.warn("Failed to create noise cancellation. Returning normal audio track: "+l),[2,{cleanTrack:e}];case 3:return[2]}}))}))}},3016:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t}(n(1239));e.exports=i},1254:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(9860),o=function(e){function t(t,n,r,i,o,a,s){return e.call(this,t,n,r,i,o,a,s)||this}return r(t,e),t.prototype.toString=function(){return"[RemoteAudioTrack #"+this._instanceId+": "+this.sid+"]"},t.prototype._start=function(){e.prototype._start.call(this),this._dummyEl&&(this._disposeMediaElement?this._disposeMediaElement(this._dummyEl):this._dummyEl.srcObject=null,this._dummyEl=null)},t.prototype.setPriority=function(t){return e.prototype.setPriority.call(this,t)},t}(n(9972)(i));e.exports=o},8558:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t.prototype.toString=function(){return"[RemoteAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},t}(n(6668));e.exports=i},9072:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=n(4957),s=n(6262),c=s.typeErrors,l=s.trackPriority,d=function(e){function t(t,n,r){var i=e.call(this,n.id,"data",r)||this;return Object.defineProperties(i,{_isSwitchedOff:{value:!1,writable:!0},_priority:{value:null,writable:!0},isEnabled:{enumerable:!0,value:!0},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},maxPacketLifeTime:{enumerable:!0,value:n.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:n.maxRetransmits},ordered:{enumerable:!0,value:n.ordered},priority:{enumerable:!0,get:function(){return this._priority}},reliable:{enumerable:!0,value:null===n.maxPacketLifeTime&&null===n.maxRetransmits},sid:{enumerable:!0,value:t}}),n.on("message",(function(e){i.emit("message",e,i)})),i}return r(t,e),t.prototype.setPriority=function(e){var t=o([null],i(Object.values(l)));if(!t.includes(e))throw c.INVALID_VALUE("priority",t);return this._priority=e,this},t.prototype._setEnabled=function(){},t.prototype._setSwitchedOff=function(e){this._isSwitchedOff!==e&&(this._isSwitchedOff=e,this.emit(e?"switchedOff":"switchedOn",this))},t}(a);e.exports=d},5428:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t.prototype.toString=function(){return"[RemoteDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},t}(n(6668));e.exports=i},9972:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=n(6262),s=a.typeErrors,c=a.trackPriority,l=n(4136).isIOS,d=n(3558);e.exports=function(e){return function(e){function t(t,n,r,i,o,a,s){var c=this;return s=Object.assign({workaroundWebKitBug212780:l()&&"object"===typeof document&&"function"===typeof document.addEventListener&&"string"===typeof document.visibilityState},s),c=e.call(this,n,s)||this,Object.defineProperties(c,{_isEnabled:{value:r,writable:!0},_isSwitchedOff:{value:i,writable:!0},_priority:{value:null,writable:!0},_setPriority:{value:o},_setRenderHint:{value:function(e){c._log.debug("updating render hint:",e),a(e)}},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},priority:{enumerable:!0,get:function(){return this._priority}},sid:{enumerable:!0,value:t},_workaroundWebKitBug212780:{value:s.workaroundWebKitBug212780},_workaroundWebKitBug212780Cleanup:{value:null,writable:!0}}),c}return r(t,e),t.prototype.setPriority=function(e){var t=o([null],i(Object.values(c)));if(!t.includes(e))throw s.INVALID_VALUE("priority",t);return this._priority!==e&&(this._priority=e,this._setPriority(e)),this},t.prototype._setEnabled=function(e){this._isEnabled!==e&&(this._isEnabled=e,this.emit(this._isEnabled?"enabled":"disabled",this))},t.prototype._setSwitchedOff=function(e){this._isSwitchedOff!==e&&(this._isSwitchedOff=e,this.emit(e?"switchedOff":"switchedOn",this))},t.prototype.attach=function(t){var n=e.prototype.attach.call(this,t);return!0!==this.mediaStreamTrack.enabled&&(this.mediaStreamTrack.enabled=!0,this.processedTrack&&(this.processedTrack.enabled=!0),this.processor&&this._captureFrames()),this._workaroundWebKitBug212780&&(this._workaroundWebKitBug212780Cleanup=this._workaroundWebKitBug212780Cleanup||function(e){var t=e._log,n=e.kind;function r(r){r&&e._attachments.forEach((function(r){var i=e._elShims.get(r);r.paused&&i&&!i.pausedIntentionally()&&(t.info("Playing inadvertently paused <"+n+"> element"),t.debug("Element:",r),t.debug("RemoteMediaTrack:",e),r.play().then((function(){t.info("Successfully played inadvertently paused <"+n+"> element"),t.debug("Element:",r),t.debug("RemoteMediaTrack:",e)})).catch((function(i){t.warn("Error while playing inadvertently paused <"+n+"> element:",{err:i,el:r,remoteMediaTrack:e})})))}))}return d.onVisibilityChange(2,r),function(){d.offVisibilityChange(2,r)}}(this)),n},t.prototype.detach=function(t){var n=e.prototype.detach.call(this,t);return 0===this._attachments.size&&(this.mediaStreamTrack.enabled=!1,this.processedTrack&&(this.processedTrack.enabled=!1),this._workaroundWebKitBug212780Cleanup&&(this._workaroundWebKitBug212780Cleanup(),this._workaroundWebKitBug212780Cleanup=null)),n},t}(e)}},6668:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){var r=e.call(this,t.name,t.sid,n)||this;Object.defineProperties(r,{_signaling:{value:t},_track:{value:null,writable:!0},isSubscribed:{enumerable:!0,get:function(){return!!this._track}},isTrackEnabled:{enumerable:!0,get:function(){return t.isEnabled}},kind:{enumerable:!0,value:t.kind},publishPriority:{enumerable:!0,get:function(){return t.priority}},track:{enumerable:!0,get:function(){return this._track}}});var i=t.error,o=t.isEnabled,a=t.isSwitchedOff,s=t.priority;return t.on("updated",(function(){if(i!==t.error)return i=t.error,void r.emit("subscriptionFailed",t.error);o!==t.isEnabled&&(o=t.isEnabled,r.track&&r.track._setEnabled(t.isEnabled),r.emit(t.isEnabled?"trackEnabled":"trackDisabled")),a!==t.isSwitchedOff&&(r._log.debug(r.trackSid+": "+(a?"OFF":"ON")+" => "+(t.isSwitchedOff?"OFF":"ON")),a=t.isSwitchedOff,r.track?(r.track._setSwitchedOff(t.isSwitchedOff),r.emit(a?"trackSwitchedOff":"trackSwitchedOn",r.track)):a&&r._log.warn("Track was not subscribed when switched Off.")),s!==t.priority&&(s=t.priority,r.emit("publishPriorityChanged",s))})),r}return r(t,e),t.prototype.toString=function(){return"[RemoteTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},t.prototype._subscribed=function(e){!this._track&&e&&(this._track=e,this.emit("subscribed",e))},t.prototype._unsubscribe=function(){if(this._track){var e=this._track;this._track=null,this.emit("unsubscribed",e)}},t}(n(5630));e.exports=i},8617:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=n(9972),a=n(4955),s=n(3558),c=n(428).NullObserver,l=n(2016),d=o(a),u=function(e){function t(t,n,r,i,o,a,s){var d=this;return s=Object.assign({clientTrackSwitchOffControl:"auto",contentPreferencesMode:"auto",enableDocumentVisibilityTurnOff:!0},s),s=Object.assign({IntersectionObserver:"undefined"===typeof IntersectionObserver||"auto"!==s.clientTrackSwitchOffControl?c:IntersectionObserver,ResizeObserver:"undefined"===typeof ResizeObserver||"auto"!==s.contentPreferencesMode?c:ResizeObserver},s),d=e.call(this,t,n,r,i,o,a,s)||this,Object.defineProperties(d,{_enableDocumentVisibilityTurnOff:{value:!0===s.enableDocumentVisibilityTurnOff&&"auto"===s.clientTrackSwitchOffControl},_documentVisibilityTurnOffCleanup:{value:null,writable:!0},_clientTrackSwitchOffControl:{value:s.clientTrackSwitchOffControl},_contentPreferencesMode:{value:s.contentPreferencesMode},_invisibleElements:{value:new WeakSet},_elToPipCallbacks:{value:new WeakMap},_elToPipWindows:{value:new WeakMap},_turnOffTimer:{value:new l((function(){d._setRenderHint({enabled:!1})}),50,!1)},_resizeObserver:{value:new s.ResizeObserver((function(e){e.find((function(e){return!d._invisibleElements.has(e.target)}))&&p(d)}))},_intersectionObserver:{value:new s.IntersectionObserver((function(e){var t=!1;e.forEach((function(e){!d._invisibleElements.has(e.target)!==e.isIntersecting&&(e.isIntersecting?(d._log.debug("intersectionObserver detected: Off => On"),d._invisibleElements.delete(e.target)):(d._log.debug("intersectionObserver detected: On => Off"),d._invisibleElements.add(e.target)),t=!0)})),t&&(h(d),p(d))}),{threshold:.25})}}),d}return r(t,e),t.prototype._start=function(t){var n=e.prototype._start.call(this,t);return h(this),n},t.prototype.switchOn=function(){if("manual"!==this._clientTrackSwitchOffControl)throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!0}),this},t.prototype.switchOff=function(){if("manual"!==this._clientTrackSwitchOffControl)throw new Error('Invalid state. You can call switchOff only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!1}),this},t.prototype.setContentPreferences=function(e){if("manual"!==this._contentPreferencesMode)throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.contentPreferencesMode is set to "manual"');return e.renderDimensions&&this._setRenderHint({renderDimensions:e.renderDimensions}),this},t.prototype._unObservePip=function(e){var t=this._elToPipCallbacks.get(e);t&&(e.removeEventListener("enterpictureinpicture",t.onEnterPip),e.removeEventListener("leavepictureinpicture",t.onLeavePip),this._elToPipCallbacks.delete(e))},t.prototype._observePip=function(e){var t=this;if(!this._elToPipCallbacks.get(e)){var n=function(n){return t._onEnterPip(n,e)},r=function(n){return t._onLeavePip(n,e)};e.addEventListener("enterpictureinpicture",n),e.addEventListener("leavepictureinpicture",r),this._elToPipCallbacks.set(e,{onEnterPip:n,onLeavePip:r,onResizePip:function(n){return t._onResizePip(n,e)}})}},t.prototype._onEnterPip=function(e,t){this._log.debug("onEnterPip");var n=e.pictureInPictureWindow;this._elToPipWindows.set(t,n);var r=this._elToPipCallbacks.get(t).onResizePip;n.addEventListener("resize",r),h(this)},t.prototype._onLeavePip=function(e,t){this._log.debug("onLeavePip"),this._elToPipWindows.delete(t);var n=this._elToPipCallbacks.get(t).onResizePip;e.pictureInPictureWindow.removeEventListener("resize",n),h(this)},t.prototype._onResizePip=function(){p(this)},t.prototype.attach=function(t){var n=e.prototype.attach.call(this,t);return"auto"===this._clientTrackSwitchOffControl&&this._invisibleElements.add(n),this._intersectionObserver.observe(n),this._resizeObserver.observe(n),this._enableDocumentVisibilityTurnOff&&(this._documentVisibilityTurnOffCleanup=this._documentVisibilityTurnOffCleanup||function(e){function t(){h(e)}return s.onVisibilityChange(1,t),function(){s.offVisibilityChange(1,t)}}(this)),this._observePip(n),n},t.prototype.detach=function(t){var n=this,r=e.prototype.detach.call(this,t);return(Array.isArray(r)?r:[r]).forEach((function(e){n._intersectionObserver.unobserve(e),n._resizeObserver.unobserve(e),n._invisibleElements.delete(e),n._unObservePip(e)})),0===this._attachments.size&&this._documentVisibilityTurnOffCleanup&&(this._documentVisibilityTurnOffCleanup(),this._documentVisibilityTurnOffCleanup=null),h(this),p(this),r},t.prototype.addProcessor=function(){return e.prototype.addProcessor.apply(this,arguments)},t.prototype.removeProcessor=function(){return e.prototype.removeProcessor.apply(this,arguments)},t.prototype.toString=function(){return"[RemoteVideoTrack #"+this._instanceId+": "+this.sid+"]"},t.prototype.setPriority=function(t){return e.prototype.setPriority.call(this,t)},t}(d);function h(e){if("auto"===e._clientTrackSwitchOffControl){var t=e._getAllAttachedElements().filter((function(t){return!e._invisibleElements.has(t)}));!0===(e._getAllAttachedElements().filter((function(t){return e._elToPipWindows.has(t)})).length>0||function(e){if(!("documentPictureInPicture"in globalThis))return!1;var t=globalThis.documentPictureInPicture.window;if(!t)return!1;var n=new WeakSet(t.document.querySelectorAll("video"));return e._getAllAttachedElements().some((function(e){return n.has(e)}))}(e)||"visible"===document.visibilityState&&t.length>0)?(e._turnOffTimer.clear(),e._setRenderHint({enabled:!0})):e._turnOffTimer.isSet||e._turnOffTimer.start()}}function p(e){if("auto"===e._contentPreferencesMode){var t=e._getAllAttachedElements().filter((function(t){return!e._invisibleElements.has(t)})),n=e._getAllAttachedElements().map((function(t){var n=e._elToPipWindows.get(t);return n?{clientHeight:n.height,clientWidth:n.width}:{clientHeight:0,clientWidth:0}})),r=t.concat(n);if(r.length>0){var o=i(r.sort((function(e,t){return t.clientHeight+t.clientWidth-e.clientHeight-e.clientWidth-1})),1)[0],a={height:o.clientHeight,width:o.clientWidth};e._setRenderHint({renderDimensions:a})}}}e.exports=u},4307:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t.prototype.toString=function(){return"[RemoteVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"},t}(n(6668));e.exports=i},224:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=function(e){function t(t){var n=e.call(this,t.id,t)||this;return Object.defineProperties(n,{_clones:{value:new Set},_eventsToReemitters:{value:new Map([["mute",function(){return n.queue("muted")}],["unmute",function(){return n.queue("unmuted")}]])},_senders:{value:new Set},_senderToPublisherHintCallbacks:{value:new Map},isPublishing:{enumerable:!0,get:function(){return!!this._clones.size}},muted:{enumerable:!0,get:function(){return this._track.muted}}}),n._reemitMediaStreamTrackEvents(),n}return r(t,e),t.prototype._reemitMediaStreamTrackEvents=function(e){void 0===e&&(e=this._track);var t=this._eventsToReemitters,n=this._track;(e.addEventListener?t.forEach((function(t,n){return e.addEventListener(n,t)})):t.forEach((function(t,n){e["on"+n]=t})),n!==e)&&(t.forEach((function(e,t){return n.removeEventListener(t,e)})),n.muted!==e.muted&&t.get(e.muted?"mute":"unmute")())},t.prototype.clone=function(){var e=new t(this.track.clone());return this._clones.add(e),e},t.prototype.removeClone=function(e){this._clones.delete(e)},t.prototype.setMediaStreamTrack=function(e){var t=this,n=Array.from(this._clones),r=Array.from(this._senders);return Promise.all(n.map((function(t){return t.setMediaStreamTrack(e.clone())})).concat(r.map((function(n){return t._replaceTrack(n,e)})))).finally((function(){t._reemitMediaStreamTrackEvents(e),t._track=e}))},t.prototype.addSender=function(e,t){return this._senders.add(e),t&&this._senderToPublisherHintCallbacks.set(e,t),this},t.prototype.removeSender=function(e){return this._senders.delete(e),this._senderToPublisherHintCallbacks.delete(e),this},t.prototype.setPublisherHint=function(e){var t=i(Array.from(this._senderToPublisherHintCallbacks.values()),1)[0];return t?t(e):Promise.resolve("COULD_NOT_APPLY_HINT")},t.prototype._replaceTrack=function(e,t){var n=this;return e.replaceTrack(t).then((function(e){return n.setPublisherHint(null).catch((function(){})),n.emit("replaced"),e}))},t}(n(1239));e.exports=o},5630:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(1906),o=n(6803),a=o.buildLogLevels,s=o.valueToJSON,c=n(6262).DEFAULT_LOG_LEVEL,l=n(5765),d=0,u=function(e){function t(t,n,r){var i=e.call(this)||this;r=Object.assign({logLevel:c},r);var o=a(r.logLevel);return Object.defineProperties(i,{_instanceId:{value:d++},_log:{value:r.log?r.log.createLog("default",i):new l("default",i,o,r.loggerName)},trackName:{enumerable:!0,value:t},trackSid:{enumerable:!0,value:n}}),i}return r(t,e),t.prototype.toJSON=function(){return s(this)},t.prototype.toString=function(){return"[TrackPublication #"+this._instanceId+": "+this.trackSid+"]"},t}(i);e.exports=u},1239:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){var r=e.call(this,t,n.kind)||this;return Object.defineProperties(r,{_track:{value:n,writable:!0},enabled:{enumerable:!0,get:function(){return this._track.enabled}},readyState:{enumerable:!0,get:function(){return this._track.readyState}},track:{enumerable:!0,get:function(){return this._track}}}),r}return r(t,e),t.prototype.stop=function(){this.track.stop(),e.prototype.stop.call(this)},t}(n(956));e.exports=i},2476:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(7284).EventEmitter,o=n(6262).DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS,a=function(e){function t(t){var n=e.call(this)||this;return Object.defineProperties(n,{_lastStatsSaveTime:{value:null,writable:!0},_lastStatsPublishTime:{value:null,writable:!0},_log:{value:t},_processorInfo:{value:null,writable:!0},_stats:{value:null,writable:!0}}),n.on("add",(function(e){n._lastStatsSaveTime=Date.now(),n._lastStatsPublishTime=Date.now(),n._processorInfo=e,n._stats=[],n._reemitEvent("add",n._getEventData())})),n.on("remove",(function(){var e=n._getEventData();n._lastStatsSaveTime=null,n._lastStatsPublishTime=null,n._processorInfo=null,n._stats=null,n._reemitEvent("remove",e)})),n.on("start",(function(){n._reemitEvent("start",n._getEventData())})),n.on("stop",(function(e){n._reemitEvent("stop",Object.assign({message:e},n._getEventData()))})),n.on("stats",(function(){return n._maybeEmitStats()})),n}return r(t,e),t.prototype._getEventData=function(){if(!this._processorInfo)return{};var e=this._processorInfo,t=e.processor,n={captureHeight:e.captureHeight,captureWidth:e.captureWidth,inputFrameRate:e.inputFrameRate,isRemoteVideoTrack:e.isRemoteVideoTrack,inputFrameBufferType:e.inputFrameBufferType,outputFrameBufferContextType:e.outputFrameBufferContextType};return n.name=t._name||"VideoProcessor",["assetsPath","blurFilterRadius","debounce","fitType","isSimdEnabled","maskBlurRadius","pipeline","version"].forEach((function(e){var r=t["_"+e];"undefined"!==typeof r&&(n[e]=r)})),Object.keys(n).forEach((function(e){var t=n[e];"boolean"===typeof t&&(n[e]=t?"true":"false")})),n},t.prototype._maybeEmitStats=function(){if(this._stats&&this._processorInfo){var e=this._processorInfo.processor._benchmark;if(e){var t=Date.now();if(!(t-this._lastStatsSaveTime<1e3)){var n={outputFrameRate:e.getRate("totalProcessingDelay")};if(["captureFrameDelay","imageCompositionDelay","inputImageResizeDelay","processFrameDelay","segmentationDelay"].forEach((function(t){n[t]=e.getAverageDelay(t)})),this._lastStatsSaveTime=t,this._stats.push(n),!(t-this._lastStatsPublishTime<o)){this._lastStatsPublishTime=t;var r=this._stats.splice(0).reduce((function(e,t,r){return Object.keys(n).forEach((function(n){e[n]||(e[n]=0),e[n]=(e[n]*r+t[n])/(r+1)})),e}),{});Object.keys(r).forEach((function(e){r[e]=parseFloat(r[e].toFixed(2))})),this._reemitEvent("stats",Object.assign({},r,this._getEventData()))}}}}},t.prototype._reemitEvent=function(e,t){this._log.debug("VideoProcessor:"+e,t),this.emit("event",{name:e,data:t})},t}(i);e.exports=a},4955:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(2342),o=n(5782),a=n(2476),s=(n(295).guessBrowser,n(6262).DEFAULT_FRAME_RATE),c=function(e){function t(t,n){var r=e.call(this,t,n)||this;return Object.defineProperties(r,{_isCapturing:{value:!1,writable:!0},_inputFrame:{value:null,writable:!0},_outputFrame:{value:null,writable:!0},_processorEventObserver:{value:null,writable:!0},_processorOptions:{value:{},writable:!0},_stopCapture:{value:function(){},writable:!0},_unmuteHandler:{value:null,writable:!0},dimensions:{enumerable:!0,value:{width:null,height:null}},processor:{enumerable:!0,value:null,writable:!0}}),r._processorEventObserver=new(n.VideoProcessorEventObserver||a)(r._log),r}return r(t,e),t.prototype._checkIfCanCaptureFrames=function(e){void 0===e&&(e=!1);var t=!0,n="",r=this.mediaStreamTrack;return r.enabled||(t=!1,n="MediaStreamTrack is disabled"),"ended"===r.readyState&&(t=!1,n="MediaStreamTrack is ended"),this.processor||(t=!1,n="VideoProcessor not detected."),this._attachments.size||e||(t=!1,n="VideoTrack is not publishing and there is no attached element."),n&&this._log.debug(n),{canCaptureFrames:t,message:n}},t.prototype._captureFrames=function(){var e=this;if(this._isCapturing)this._log.debug("Ignoring captureFrames call. Capture is already in progress");else{if(!this._checkIfCanCaptureFrames().canCaptureFrames)return this._isCapturing=!1,void this._log.debug("Cannot capture frames. Ignoring captureFrames call.");this._isCapturing=!0,this._processorEventObserver.emit("start"),this._log.debug("Start capturing frames");var t=this._processorOptions.inputFrameBufferType;this._dummyEl.play().then((function(){e._stopCapture=o(e._dummyEl,(function(n){var r=e._checkIfCanCaptureFrames();if(!r.canCaptureFrames)return n&&n.close(),e._isCapturing=!1,e._stopCapture(),e._processorEventObserver.emit("stop",r.message),e._log.debug("Cannot capture frames. Stopping capturing frames."),Promise.resolve();var i=e.mediaStreamTrack.getSettings(),o=i.width,a=void 0===o?0:o,s=i.height,c=void 0===s?0:s;e._outputFrame&&e._outputFrame.width!==a&&(e._outputFrame.width=a,e._outputFrame.height=c),e._inputFrame&&(e._inputFrame.width!==a&&(e._inputFrame.width=a,e._inputFrame.height=c),e._inputFrame.getContext("2d").drawImage(e._dummyEl,0,0,a,c));var l=n||(["video","videoframe"].includes(t)?e._dummyEl:e._inputFrame),d=null;try{d=e.processor.processFrame(l,e._outputFrame)}catch(u){e._log.debug("Exception detected after calling processFrame.",u)}return(d instanceof Promise?d:Promise.resolve(d)).then((function(){e._outputFrame&&("function"===typeof e.processedTrack.requestFrame&&e.processedTrack.requestFrame(),e._processorEventObserver.emit("stats"))}))}),t)})).catch((function(t){return e._log.error("Video element cannot be played",{error:t,track:e})}))}},t.prototype._initialize=function(){var n=this;e.prototype._initialize.call(this),this._dummyEl&&(this._dummyEl.onloadedmetadata=function(){l(n,n._dummyEl)&&(n.dimensions.width=n._dummyEl.videoWidth,n.dimensions.height=n._dummyEl.videoHeight)},this._dummyEl.onresize=function(){l(n,n._dummyEl)&&(n.dimensions.width=n._dummyEl.videoWidth,n.dimensions.height=n._dummyEl.videoHeight,n.isStarted&&(n._log.debug("Dimensions changed:",n.dimensions),n.emit(t.DIMENSIONS_CHANGED,n)))})},t.prototype._restartProcessor=function(){var e=this.processor;if(e){var t=Object.assign({},this._processorOptions);this.removeProcessor(e),this.addProcessor(e,t)}},t.prototype._start=function(n){return this.dimensions.width=n.videoWidth,this.dimensions.height=n.videoHeight,this._log.debug("Dimensions:",this.dimensions),this.emit(t.DIMENSIONS_CHANGED,this),e.prototype._start.call(this,n)},t.prototype.addProcessor=function(e,t){var n=this;if(!e||"function"!==typeof e.processFrame)throw new Error("Received an invalid VideoProcessor from addProcessor.");if(this.processor)throw new Error("A VideoProcessor has already been added.");if(!this._dummyEl)throw new Error("VideoTrack has not been initialized.");this._log.debug("Adding VideoProcessor to the VideoTrack",e),this._unmuteHandler||(this._unmuteHandler=function(){n._log.debug("mediaStreamTrack unmuted"),n.processedTrack.muted&&(n._log.debug("mediaStreamTrack is unmuted but processedTrack is muted. Restarting processor."),n._restartProcessor())},this.mediaStreamTrack.addEventListener?this.mediaStreamTrack.addEventListener("unmute",this._unmuteHandler):this.mediaStreamTrack.onunmute=this._unmuteHandler.bind(this)),this._processorOptions=t||{};var r=this._processorOptions,i=r.inputFrameBufferType,o=r.outputFrameBufferContextType;if("undefined"===typeof OffscreenCanvas&&"offscreencanvas"===i)throw new Error("OffscreenCanvas is not supported by this browser.");if(i&&"videoframe"!==i&&"video"!==i&&"canvas"!==i&&"offscreencanvas"!==i)throw new Error("Invalid inputFrameBufferType of "+i);i||(i="undefined"===typeof OffscreenCanvas?"canvas":"offscreencanvas");var a=this.mediaStreamTrack.getSettings(),c=a.width,l=void 0===c?0:c,d=a.height,u=void 0===d?0:d,h=a.frameRate,p=void 0===h?s:h;if("offscreencanvas"===i&&(this._inputFrame=new OffscreenCanvas(l,u)),"canvas"===i&&(this._inputFrame=document.createElement("canvas")),this._inputFrame&&(this._inputFrame.width=l,this._inputFrame.height=u),this._outputFrame=document.createElement("canvas"),this._outputFrame.width=l,this._outputFrame.height=u,o=o||"2d",!this._outputFrame.getContext(o))throw new Error("Cannot get outputFrameBufferContextType: "+o+".");var f="undefined"!==typeof CanvasCaptureMediaStreamTrack&&CanvasCaptureMediaStreamTrack.prototype&&"function"===typeof CanvasCaptureMediaStreamTrack.prototype.requestFrame?0:void 0;return this.processedTrack=this._outputFrame.captureStream(f).getTracks()[0],this.processedTrack.enabled=this.mediaStreamTrack.enabled,this.processor=e,this._processorEventObserver.emit("add",{processor:e,captureHeight:u,captureWidth:l,inputFrameRate:p,isRemoteVideoTrack:this.toString().includes("RemoteVideoTrack"),inputFrameBufferType:i,outputFrameBufferContextType:o}),this._updateElementsMediaStreamTrack(),this._captureFrames(),this},t.prototype.attach=function(){var t=e.prototype.attach.apply(this,arguments);return this.processor&&this._captureFrames(),t},t.prototype.detach=function(){return e.prototype.detach.apply(this,arguments)},t.prototype.removeProcessor=function(e){if(!e)throw new Error("Received an invalid VideoProcessor from removeProcessor.");if(!this.processor)throw new Error("No existing VideoProcessor detected.");if(e!==this.processor)throw new Error("The provided VideoProcessor is different than the existing one.");return this._processorEventObserver.emit("remove"),this._log.debug("Removing VideoProcessor from the VideoTrack",e),this._stopCapture(),this._stopCapture=function(){},this.mediaStreamTrack.removeEventListener("unmute",this._unmuteHandler),this._processorOptions={},this._unmuteHandler=null,this._isCapturing=!1,this.processor=null,this.processedTrack=null,this._inputFrame=null,this._outputFrame=null,this._updateElementsMediaStreamTrack(),this},t}(i);function l(e,t){return e.dimensions.width!==t.videoWidth||e.dimensions.height!==t.videoHeight}c.DIMENSIONS_CHANGED="dimensionsChanged",e.exports=c},2221:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=n(7284).EventEmitter,a=n(6262),s=a.DEFAULT_NQ_LEVEL_LOCAL,c=a.DEFAULT_NQ_LEVEL_REMOTE,l=a.MAX_NQ_LEVEL,d=n(6803).inRange,u=function(e){function t(t){var n=e.call(this)||this;return t=Object.assign({local:s,remote:c},t),Object.defineProperties(n,{local:{value:d(t.local,s,l)?t.local:s,writable:!0},remote:{value:d(t.remote,c,l)?t.remote:c,writable:!0}}),n}return r(t,e),t.prototype.update=function(e){var t=this;e=Object.assign({local:this.local,remote:this.remote},e),[["local",s,3],["remote",c,3]].forEach((function(n){var r=i(n,3),o=r[0],a=r[1],s=r[2];t[o]="number"===typeof e[o]&&d(e[o],a,s)?e[o]:a}))},t}(o);e.exports=u},3864:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.createNoiseCancellationAudioProcessor=void 0;var o=n(6367),a=(n(5765),{krisp:{supportedVersion:"1.0.0",pluginFile:"krispsdk.mjs"},rnnoise:{supportedVersion:"0.6.0",pluginFile:"rnnoise_sdk.mjs"}}),s=new Map;t.createNoiseCancellationAudioProcessor=function(e,t){return r(this,void 0,void 0,(function(){var n,r,c,l,d,u,h,p,f;return i(this,(function(i){switch(i.label){case 0:if(n=s.get(e.vendor))return[3,6];if(!(r=a[e.vendor]))throw new Error("Unsupported NoiseCancellationOptions.vendor: "+e.vendor);c=r.supportedVersion,l=r.pluginFile,d=e.sdkAssetsPath,u=d+"/"+l,i.label=1;case 1:return i.trys.push([1,5,,6]),t.debug("loading noise cancellation sdk: ",u),[4,o(u)];case 2:return h=i.sent(),t.debug("Loaded noise cancellation sdk:",h),p=h.default,function(e){var t=e.supportedVersion,n=e.plugin,r=e.log;if(!n.getVersion||!n.isSupported)throw new Error("Plugin does not export getVersion/isSupported api. Are you using old version of the plugin ?");var i=n.getVersion();r.debug("Plugin Version = "+i);var o=t.split(".").map((function(e){return Number(e)})),a=i.split(".").map((function(e){return Number(e)}));if(3!==o.length||3!==a.length)throw new Error("Unsupported Plugin version format: "+t+", "+i);if(o[0]!==a[0])throw new Error("Major version mismatch: [Plugin version "+i+"],  [Supported Version "+t+"]");if(a[1]<o[1])throw new Error("Minor version mismatch: [Plugin version "+i+"] < [Supported Version "+t+"]");var s=new AudioContext,c=n.isSupported(s);if(s.close(),!c)throw new Error("Noise Cancellation plugin is not supported on your browser")}({supportedVersion:c,plugin:p,log:t}),p.isInitialized()?[3,4]:(t.debug("initializing noise cancellation sdk: ",d),[4,p.init({rootDir:d})]);case 3:i.sent(),t.debug("noise cancellation sdk initialized!"),i.label=4;case 4:return n={vendor:e.vendor,isInitialized:function(){return p.isInitialized()},isConnected:function(){return p.isConnected()},isEnabled:function(){return p.isEnabled()},disconnect:function(){return p.disconnect()},enable:function(){return p.enable()},disable:function(){return p.disable()},destroy:function(){return p.destroy()},setLogging:function(e){return p.setLogging(e)},connect:function(e){t.debug("connect: ",e.id),p.isConnected()&&p.disconnect();var n=p.connect(new MediaStream([e]));if(!n)throw new Error("Error connecting with noise cancellation sdk");var r=n.getAudioTracks()[0];if(!r)throw new Error("Error getting clean track from noise cancellation sdk");return p.enable(),r}},s.set(e.vendor,n),[3,6];case 5:throw f=i.sent(),t.error("Error loading noise cancellation sdk:"+u,f),f;case 6:return[2,n]}}))}))}},8715:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=n(1906),s=n(1254),c=n(8558),l=n(9072),d=n(5428),u=n(8617),h=n(4307),p=n(6803),f=0,m=function(e){function t(t,n){var r=e.call(this)||this,i=function(e){var t=e.map((function(e){return[e.id,e]})),n=t.filter((function(e){return"audio"===e[1].kind})),r=t.filter((function(e){return"video"===e[1].kind})),i=t.filter((function(e){return"data"===e[1].kind}));return{audioTracks:n,dataTracks:i,tracks:t,videoTracks:r}}((n=Object.assign({RemoteAudioTrack:s,RemoteAudioTrackPublication:c,RemoteDataTrack:l,RemoteDataTrackPublication:d,RemoteVideoTrack:u,RemoteVideoTrackPublication:h,tracks:[]},n)).tracks),o=n.log.createLog("default",r),a=new Map(i.audioTracks),p=new Map(i.dataTracks),m=new Map(i.tracks),g=new Map(i.videoTracks);return Object.defineProperties(r,{_RemoteAudioTrack:{value:n.RemoteAudioTrack},_RemoteAudioTrackPublication:{value:n.RemoteAudioTrackPublication},_RemoteDataTrack:{value:n.RemoteDataTrack},_RemoteDataTrackPublication:{value:n.RemoteDataTrackPublication},_RemoteVideoTrack:{value:n.RemoteVideoTrack},_RemoteVideoTrackPublication:{value:n.RemoteVideoTrackPublication},_audioTracks:{value:a},_dataTracks:{value:p},_instanceId:{value:++f},_clientTrackSwitchOffControl:{value:n.clientTrackSwitchOffControl},_contentPreferencesMode:{value:n.contentPreferencesMode},_log:{value:o},_signaling:{value:t},_tracks:{value:m},_trackEventReemitters:{value:new Map},_trackPublicationEventReemitters:{value:new Map},_trackSignalingUpdatedEventCallbacks:{value:new Map},_videoTracks:{value:g},audioTracks:{enumerable:!0,value:new Map},dataTracks:{enumerable:!0,value:new Map},identity:{enumerable:!0,get:function(){return t.identity}},networkQualityLevel:{enumerable:!0,get:function(){return t.networkQualityLevel}},networkQualityStats:{enumerable:!0,get:function(){return t.networkQualityStats}},sid:{enumerable:!0,get:function(){return t.sid}},state:{enumerable:!0,get:function(){return t.state}},tracks:{enumerable:!0,value:new Map},videoTracks:{enumerable:!0,value:new Map},_MediaStream:{value:n.MediaStream},_mapMediaElement:{value:n.mapMediaElement},_disposeMediaElement:{value:n.disposeMediaElement}}),r._tracks.forEach(_.bind(null,r)),t.on("networkQualityLevelChanged",(function(){return r.emit("networkQualityLevelChanged",r.networkQualityLevel,r.networkQualityStats&&(r.networkQualityStats.audio||r.networkQualityStats.video)?r.networkQualityStats:null)})),function(e,t){var n=e._log;if("disconnected"===e.state)return;t.on("stateChanged",(function r(i){n.debug("Transitioned to state:",i),e.emit(i,e),"disconnected"===i&&(n.debug("Removing Track event reemitters"),t.removeListener("stateChanged",r),e._tracks.forEach((function(t){var n=e._trackEventReemitters.get(t.id);t&&n&&n.forEach((function(e,n){t.removeListener(n,e)}))})),t.tracks.forEach((function(t){var n=e._tracks.get(t.id),r=e._trackEventReemitters.get(t.id);n&&r&&r.forEach((function(e,t){n.removeListener(t,e)}))})),e._trackEventReemitters.clear(),e.tracks.forEach((function(t){e._trackPublicationEventReemitters.get(t.trackSid).forEach((function(e,n){t.removeListener(n,e)}))})),e._trackPublicationEventReemitters.clear())}))}(r,t),o.info("Created a new Participant"+(r.identity?": "+r.identity:"")),r}return r(t,e),t.prototype._getTrackEvents=function(){return[["dimensionsChanged","trackDimensionsChanged"],["message","trackMessage"],["started","trackStarted"]]},t.prototype._getTrackPublicationEvents=function(){return[]},t.prototype.toString=function(){return"[Participant #"+this._instanceId+": "+this.sid+"]"},t.prototype._addTrack=function(e,t){var n=this._log;return this._tracks.has(t)?null:(this._tracks.set(t,e),{audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[e.kind].set(t,e),_(this,e,t),n.info("Added a new "+p.trackClass(e)+":",t),n.debug(p.trackClass(e)+":",e),e)},t.prototype._addTrackPublication=function(e){var t=this._log;return this.tracks.has(e.trackSid)?null:(this.tracks.set(e.trackSid,e),{audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[e.kind].set(e.trackSid,e),function(e,t){var n=new Map;if("disconnected"===e.state)return;e._getTrackPublicationEvents().forEach((function(r){var a=i(r,2),s=a[0],c=a[1];n.set(s,(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];e.emit.apply(e,o(o([c],i(n)),[t]))})),t.on(s,n.get(s))})),e._trackPublicationEventReemitters.set(t.trackSid,n)}(this,e),t.info("Added a new "+p.trackPublicationClass(e)+":",e.trackSid),t.debug(p.trackPublicationClass(e)+":",e),e)},t.prototype._handleTrackSignalingEvents=function(){var e=this,t=e._log,n=e._clientTrackSwitchOffControl,r=e._contentPreferencesMode,o=e._MediaStream,a=e._mapMediaElement,s=e._disposeMediaElement,c=this;if("disconnected"!==this.state){var l=this._RemoteAudioTrack,d=this._RemoteAudioTrackPublication,u=this._RemoteVideoTrack,h=this._RemoteVideoTrackPublication,p=this._RemoteDataTrack,f=this._RemoteDataTrackPublication,m=this._signaling;m.on("trackAdded",_),m.on("trackRemoved",g),m.tracks.forEach(_),m.on("stateChanged",(function e(n){"disconnected"===n?(t.debug("Removing event listeners"),m.removeListener("stateChanged",e),m.removeListener("trackAdded",_),m.removeListener("trackRemoved",g)):"connected"===n&&(t.info("reconnected"),setTimeout((function(){return c.emit("reconnected")}),0))}))}function _(e){var n=new(0,{audio:d,data:f,video:h}[e.kind])(e,{log:t});c._addTrackPublication(n);var r=e.isSubscribed;r&&v(e),c._trackSignalingUpdatedEventCallbacks.set(e.sid,(function(){if(r!==e.isSubscribed){if(r=e.isSubscribed)return void v(e);!function(e){var t=i(Array.from(c._tracks.entries()).find((function(t){return i(t,2)[1].sid===e.sid})),2),n=t[0],r=t[1],o=c.tracks.get(e.sid);r&&c._removeTrack(r,o,n)}(e)}})),e.on("updated",c._trackSignalingUpdatedEventCallbacks.get(e.sid))}function g(e){e.isSubscribed&&e.setTrackTransceiver(null);var t=c._trackSignalingUpdatedEventCallbacks.get(e.sid);t&&(e.removeListener("updated",t),c._trackSignalingUpdatedEventCallbacks.delete(e.sid));var n=c.tracks.get(e.sid);n&&c._removeTrackPublication(n)}function v(e){var i=e.isEnabled,d=e.name,h=e.kind,f=e.sid,_=e.trackTransceiver,g=e.isSwitchedOff,v={audio:l,video:u,data:p}[h],y=c.tracks.get(f);if(v&&h===_.kind){var b={log:t,name:d,clientTrackSwitchOffControl:n,contentPreferencesMode:r,mapMediaElement:a,disposeMediaElement:s};o&&(b.MediaStream=o);var E="data"===h?new v(f,_,b):new v(f,_,i,g,(function(e){return m.updateSubscriberTrackPriority(f,e)}),(function(t){e.isSubscribed&&m.updateTrackRenderHint(f,t)}),b);c._addTrack(E,y,_.id)}}},t.prototype._removeTrack=function(e,t){if(!this._tracks.has(t))return null;this._tracks.delete(t),{audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[e.kind].delete(t),(this._trackEventReemitters.get(t)||new Map).forEach((function(t,n){e.removeListener(n,t)}));var n=this._log;return n.info("Removed a "+p.trackClass(e)+":",t),n.debug(p.trackClass(e)+":",e),e},t.prototype._removeTrackPublication=function(e){if(!(e=this.tracks.get(e.trackSid)))return null;this.tracks.delete(e.trackSid),{audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[e.kind].delete(e.trackSid),(this._trackPublicationEventReemitters.get(e.trackSid)||new Map).forEach((function(t,n){e.removeListener(n,t)}));var t=this._log;return t.info("Removed a "+p.trackPublicationClass(e)+":",e.trackSid),t.debug(p.trackPublicationClass(e)+":",e),e},t.prototype.toJSON=function(){return p.valueToJSON(this)},t}(a);function _(e,t,n){var r=new Map;"disconnected"!==e.state&&(e._getTrackEvents().forEach((function(n){var a=n[0],s=n[1];r.set(a,(function(){var t=[s].concat([].slice.call(arguments));return e.emit.apply(e,o([],i(t)))})),t.on(a,r.get(a))})),e._trackEventReemitters.set(n,r))}e.exports=m},8378:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};function o(e,t,n,r){var i=[];return e.forEach((function(e){0!==r.length&&!r.includes(e.type)||0!==n.length&&!n.includes(e.kind)||"number"!==typeof e[t]||i.push(e[t])})),i}function a(e){return[{key:"transportId",type:"string"},{key:"candidateType",type:"string"},{key:"port",altKeys:["portNumber"],type:"number"},{key:"address",altKeys:["ip","ipAddress"],type:"string"},{key:"priority",type:"number"},{key:"protocol",altKeys:["transport"],type:"string"},{key:"url",type:"string"},{key:"relayProtocol",type:"string"}].reduce((function(t,n){var r=[n.key];n.altKeys&&(r=r.concat(n.altKeys));var i=r.find((function(t){return t in e}));return i&&typeof e[i]===n.type&&(t[n.key]=e[i]),t}),{})}Object.defineProperty(t,"__esModule",{value:!0}),t.getCombinedConnectionStats=void 0,t.getCombinedConnectionStats=function(e){var t=e.publisher,s=e.subscriber;return n(this,void 0,void 0,(function(){var e,n,c,l,d,u,h,p,f,m,_,g,v,y,b;return r(this,(function(r){switch(r.label){case 0:return[4,Promise.all([t,s].map((function(e){return e.getStats()})))];case 1:return e=i.apply(void 0,[r.sent(),2]),n=e[0],c=e[1],l=o(c,"timestamp",["audio"],["inbound-rtp"]),d=l.length>0?l[0]:0,u=o(c,"jitter",["audio"],["inbound-rtp"]).reduce((function(e,t){return Math.max(e,t)}),0),h=o(c,"packetsReceived",["audio","video"],["inbound-rtp"]).reduce((function(e,t){return e+t}),0),p=o(c,"packetsLost",["audio","video"],["inbound-rtp"]).reduce((function(e,t){return e+t}),0),f=o(n,"roundTripTime",["audio","video"],["remote-inbound-rtp"]).reduce((function(e,t){return Math.max(e,t)}),0),m=o(c,"currentRoundTripTime",[],["candidate-pair"]).reduce((function(e,t){return Math.max(e,t)}),0),_=1e3*(m||f),g=o(n,"bytesSent",[],["candidate-pair"]).reduce((function(e,t){return e+t}),0),v=o(c,"bytesReceived",[],["candidate-pair"]).reduce((function(e,t){return e+t}),0),y=function(e){var t=null,n=[];e.forEach((function(e){"transport"===e.type&&e.selectedCandidatePairId?t=e.selectedCandidatePairId:"candidate-pair"===e.type&&n.push(e)}));var r=n.find((function(e){return e.selected||t&&e.id===t}));if(!r)return null;var i=r,o=e.get(i.localCandidateId),s=e.get(i.remoteCandidateId);if(!o||!s)return null;return{localCandidate:a(o),remoteCandidate:a(s)}}(c),b=[],c.forEach((function(e){"local-candidate"!==e.type&&"remote-candidate"!==e.type||b.push(a(e))})),[2,{timestamp:d,jitter:u,packets:h,packetsLost:p,roundTripTime:_,bytesSent:g,bytesReceived:v,selectedIceCandidatePairStats:y,iceCandidateStats:b}]}}))}))}},4167:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTurnCredentials=void 0;var r=n(896),i=n(6262).ICE_VERSION,o=n(569),a=o.createTwilioError,s=o.SignalingConnectionError,c=n(7284);t.getTurnCredentials=function(e,t){return new Promise((function(n,o){var l=new c.EventEmitter,d=new r(t,{networkMonitor:null,eventObserver:l,helloBody:{edge:"roaming",preflight:!0,token:e,type:"ice",version:i}}),u=!1;d.once("close",(function(){u||(u=!0,o(new s))})),d.on("message",(function(e){var t=e.code,r=e.message,i=e.ice_servers,s=e.type;"iced"!==s&&"error"!==s||u||(u=!0,"iced"===s?n(i):o(a(t,r)),d.close())}))}))}},6308:function(e,t){"use strict";var n=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.makeStat=void 0,t.makeStat=function(e){return e&&e.length?{min:Math.min.apply(Math,r([],n(e))),max:Math.max.apply(Math,r([],n(e))),average:e.reduce((function(e,t){return e+t}),0)/e.length}:null}},5399:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mosToScore=t.calculateMOS=void 0;var n=94.768;t.calculateMOS=function(e,t,r){var i=e+2*t+10,o=0;switch(!0){case i<160:o=n-i/40;break;case i<1e3:o=n-(i-120)/10}if(!0===r<=o/2.5)o=Math.max(o-2.5*r,6.52);else o=0;return 1+.035*o+7e-6*o*(o-60)*(100-o)},t.mosToScore=function(e){return e?e>4.2?5:e>4?4:e>3.6?3:e>3?2:1:0}},5649:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.runPreflight=t.PreflightTest=void 0;var s=n(6262),c=n(6931),l=n(5399),d=n(8378),u=n(4167),h=n(6308),p=n(8611),f=n(6170),m=n(6803),_=n(6262).WS_SERVER,g=n(5765),v=n(1906),y=n(442),b=n(7173),E=n(1339),S=n(483),T=S.createSID,w=S.sessionSID,C=n(569),R=C.SignalingConnectionTimeoutError,k=C.MediaConnectionError,O="mediaAcquired",I="connected",N="mediaSubscribed",A="mediaStarted",x="dtlsConnected",P="peerConnectionConnected",D="iceConnected";function L(e){return null!==e&&"undefined"!==typeof e}var M=0,j=function(e){function t(t,n){var r=e.call(this)||this;r._testTiming=new c.Timer,r._dtlsTiming=new c.Timer,r._iceTiming=new c.Timer,r._peerConnectionTiming=new c.Timer,r._mediaTiming=new c.Timer,r._connectTiming=new c.Timer,r._sentBytesMovingAverage=new y,r._packetLossMovingAverage=new y,r._progressEvents=[],r._receivedBytesMovingAverage=new y;var i=n,o=i.environment,a=void 0===o?"prod":o,l=i.region,d=void 0===l?"gll":l,u=i.duration,h=void 0===u?1e4:u,p=i.wsServer||_(a,d);return r._log=new g("default",r,s.DEFAULT_LOG_LEVEL,s.DEFAULT_LOGGER_NAME),r._testDuration=h,r._instanceId=M++,r._testTiming.start(),r._runPreflightTest(t,a,p),r}return r(t,e),t.prototype.toString=function(){return"[Preflight #"+this._instanceId+"]"},t.prototype.stop=function(){this._stopped=!0},t.prototype._generatePreflightReport=function(e){return this._testTiming.stop(),{testTiming:this._testTiming.getTimeMeasurement(),networkTiming:{dtls:this._dtlsTiming.getTimeMeasurement(),ice:this._iceTiming.getTimeMeasurement(),peerConnection:this._peerConnectionTiming.getTimeMeasurement(),connect:this._connectTiming.getTimeMeasurement(),media:this._mediaTiming.getTimeMeasurement()},stats:{jitter:h.makeStat(null===e||void 0===e?void 0:e.jitter),rtt:h.makeStat(null===e||void 0===e?void 0:e.rtt),packetLoss:h.makeStat(null===e||void 0===e?void 0:e.packetLoss)},selectedIceCandidatePairStats:e?e.selectedIceCandidatePairStats:null,iceCandidateStats:e?e.iceCandidateStats:[],progressEvents:this._progressEvents,mos:h.makeStat(null===e||void 0===e?void 0:e.mos)}},t.prototype._executePreflightStep=function(e,t,n){return o(this,void 0,void 0,(function(){var r,i,o,s;return a(this,(function(a){switch(a.label){case 0:if(this._log.debug("Executing step: ",e),r=this._testDuration+1e4,this._stopped)throw new Error("stopped");i=Promise.resolve().then(t),o=null,s=new Promise((function(t,i){o=setTimeout((function(){i(n||new Error(e+" timeout."))}),r)})),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,Promise.race([s,i])];case 2:return[2,a.sent()];case 3:return null!==o&&clearTimeout(o),[7];case 4:return[2]}}))}))},t.prototype._collectNetworkTimings=function(e){var t=this;return new Promise((function(n){var r;e.addEventListener("iceconnectionstatechange",(function(){"checking"===e.iceConnectionState&&t._iceTiming.start(),"connected"===e.iceConnectionState&&(t._iceTiming.stop(),t._updateProgress(D),(!r||r&&"connected"===r.state)&&n())})),e.addEventListener("connectionstatechange",(function(){"connecting"===e.connectionState&&t._peerConnectionTiming.start(),"connected"===e.connectionState&&(t._peerConnectionTiming.stop(),t._updateProgress(P))}));var i=e.getSenders().map((function(e){return e.transport})).find(L);"undefined"!==typeof i&&(r=i).addEventListener("statechange",(function(){"connecting"===r.state&&t._dtlsTiming.start(),"connected"===r.state&&(t._dtlsTiming.stop(),t._updateProgress(x),"connected"===e.iceConnectionState&&n())}))}))},t.prototype._setupInsights=function(e){var t=e.token,n=e.environment,r=void 0===n?s.DEFAULT_ENVIRONMENT:n,i=e.realm,o=void 0===i?s.DEFAULT_REALM:i,a=new E(t,s.SDK_NAME,s.SDK_VERSION,r,o,{});a.connect("PREFLIGHT_ROOM_SID","PREFLIGHT_PARTICIPANT");var c=new b(a,Date.now(),this._log),l=void 0;return{reportToInsights:function(e){var t,n,r=e.report,i=r.stats.jitter||l,o=r.stats.rtt||l,s=r.stats.packetLoss||l,d=r.mos||l,u=new Map;r.iceCandidateStats.forEach((function(e){if(e.candidateType&&e.protocol){var t=u.get(e.candidateType)||[];t.indexOf(e.protocol)<0&&t.push(e.protocol),u.set(e.candidateType,t)}}));var h=JSON.stringify(Object.fromEntries(u)),p={name:"report",group:"preflight",level:r.error?"error":"info",payload:{sessionSID:w,preflightSID:T("PF"),progressEvents:JSON.stringify(r.progressEvents),testTiming:r.testTiming,dtlsTiming:r.networkTiming.dtls,iceTiming:r.networkTiming.ice,peerConnectionTiming:r.networkTiming.peerConnection,connectTiming:r.networkTiming.connect,mediaTiming:r.networkTiming.media,selectedLocalCandidate:null===(t=r.selectedIceCandidatePairStats)||void 0===t?void 0:t.localCandidate,selectedRemoteCandidate:null===(n=r.selectedIceCandidatePairStats)||void 0===n?void 0:n.remoteCandidate,iceCandidateStats:h,jitterStats:i,rttStats:o,packetLossStats:s,mosStats:d,error:r.error}};c.emit("event",p),setTimeout((function(){return a.disconnect()}),2e3)}}},t.prototype._runPreflightTest=function(e,t,n){return o(this,void 0,void 0,(function(){var r,s,c,l,d,h,m,_,g,v,y,b,E=this;return a(this,(function(S){switch(S.label){case 0:r=[],s=[],c=this._setupInsights({token:e,environment:t}).reportToInsights,S.label=1;case 1:return S.trys.push([1,8,9,10]),l=[],[4,this._executePreflightStep("Acquire media",(function(){return[p.syntheticAudio(),f.syntheticVideo({width:640,height:480})]}))];case 2:return r=S.sent(),this._updateProgress(O),this.emit("debug",{localTracks:r}),this._connectTiming.start(),[4,this._executePreflightStep("Get turn credentials",(function(){return u.getTurnCredentials(e,n)}),new R)];case 3:return d=S.sent(),this._connectTiming.stop(),this._updateProgress(I),h=new RTCPeerConnection({iceServers:d,iceTransportPolicy:"relay",bundlePolicy:"max-bundle"}),m=new RTCPeerConnection({iceServers:d,bundlePolicy:"max-bundle"}),s.push(h),s.push(m),this._mediaTiming.start(),[4,this._executePreflightStep("Setup Peer Connections",(function(){return o(E,void 0,void 0,(function(){var e,t,n,i;return a(this,(function(o){switch(o.label){case 0:return h.addEventListener("icecandidate",(function(e){return e.candidate&&m.addIceCandidate(e.candidate)})),m.addEventListener("icecandidate",(function(e){return e.candidate&&h.addIceCandidate(e.candidate)})),r.forEach((function(e){return h.addTrack(e)})),e=new Promise((function(e){var t=[];m.addEventListener("track",(function(n){t.push(n.track),t.length===r.length&&e(t)}))})),[4,h.createOffer()];case 1:return t=o.sent(),n=t,[4,h.setLocalDescription(n)];case 2:return o.sent(),[4,m.setRemoteDescription(n)];case 3:return o.sent(),[4,m.createAnswer()];case 4:return i=o.sent(),[4,m.setLocalDescription(i)];case 5:return o.sent(),[4,h.setRemoteDescription(i)];case 6:return o.sent(),[4,this._collectNetworkTimings(h)];case 7:return o.sent(),[2,e]}}))}))}),new k)];case 4:return _=S.sent(),this.emit("debug",{remoteTracks:_}),_.forEach((function(e){e.addEventListener("ended",(function(){return E._log.warn(e.kind+":ended")})),e.addEventListener("mute",(function(){return E._log.warn(e.kind+":muted")})),e.addEventListener("unmute",(function(){return E._log.warn(e.kind+":unmuted")}))})),this._updateProgress(N),[4,this._executePreflightStep("Wait for tracks to start",(function(){return new Promise((function(e){var t=document.createElement("video");t.autoplay=!0,t.playsInline=!0,t.muted=!0,t.srcObject=new MediaStream(_),l.push(t),E.emit("debugElement",t),t.oncanplay=e}))}),new k)];case 5:return S.sent(),this._mediaTiming.stop(),this._updateProgress(A),[4,this._executePreflightStep("Collect stats for duration",(function(){return E._collectRTCStatsForDuration(E._testDuration,{mos:[],jitter:[],rtt:[],outgoingBitrate:[],incomingBitrate:[],packetLoss:[],selectedIceCandidatePairStats:null,iceCandidateStats:[]},h,m)}))];case 6:return g=S.sent(),[4,this._executePreflightStep("Generate report",(function(){return E._generatePreflightReport(g)}))];case 7:return v=S.sent(),c({report:v}),this.emit("completed",v),[3,10];case 8:return y=S.sent(),b=this._generatePreflightReport(),c({report:i(i({},b),{error:null===y||void 0===y?void 0:y.toString()})}),this.emit("failed",y,b),[3,10];case 9:return s.forEach((function(e){return e.close()})),r.forEach((function(e){return e.stop()})),[7];case 10:return[2]}}))}))},t.prototype._collectRTCStats=function(e,t,n){return o(this,void 0,void 0,(function(){var r,i,o,s,c,u,h,p,f,m,_,g,v,y;return a(this,(function(a){switch(a.label){case 0:return[4,d.getCombinedConnectionStats({publisher:t,subscriber:n})];case 1:return r=a.sent(),i=r.timestamp,o=r.bytesSent,s=r.bytesReceived,c=r.packets,u=r.packetsLost,h=r.roundTripTime,p=r.jitter,f=r.selectedIceCandidatePairStats,m=r.iceCandidateStats,_=e.jitter.length>0,e.jitter.push(p),e.rtt.push(h),this._sentBytesMovingAverage.putSample(o,i),this._receivedBytesMovingAverage.putSample(s,i),this._packetLossMovingAverage.putSample(u,c),_&&(e.outgoingBitrate.push(1e3*this._sentBytesMovingAverage.get()*8),e.incomingBitrate.push(1e3*this._receivedBytesMovingAverage.get()*8),g=this._packetLossMovingAverage.get(),v=Math.min(100,100*g),e.packetLoss.push(v),y=l.calculateMOS(h,p,g),e.mos.push(y)),e.selectedIceCandidatePairStats||(e.selectedIceCandidatePairStats=f),0===e.iceCandidateStats.length&&(e.iceCandidateStats=m),[2]}}))}))},t.prototype._collectRTCStatsForDuration=function(e,t,n,r){return o(this,void 0,void 0,(function(){var i,o,s;return a(this,(function(a){switch(a.label){case 0:return i=Date.now(),o=Math.min(1e3,e),[4,m.waitForSometime(o)];case 1:return a.sent(),[4,this._collectRTCStats(t,n,r)];case 2:return a.sent(),(s=e-(Date.now()-i))>0?[4,this._collectRTCStatsForDuration(s,t,n,r)]:[3,4];case 3:t=a.sent(),a.label=4;case 4:return[2,t]}}))}))},t.prototype._updateProgress=function(e){var t=Date.now()-this._testTiming.getTimeMeasurement().start;this._progressEvents.push({duration:t,name:e}),this.emit("progress",e)},t}(v);t.PreflightTest=j,t.runPreflight=function(e,t){return void 0===t&&(t={}),new j(e,t)}},8611:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syntheticAudio=void 0,t.syntheticAudio=function(){var e=n(902),t={},r=e.getOrCreate(t),i=r.createOscillator(),o=i.connect(r.createMediaStreamDestination());i.start();var a=o.stream.getAudioTracks()[0],s=a.stop;return a.stop=function(){s.call(a),e.release(t)},a}},6170:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syntheticVideo=void 0,t.syntheticVideo=function(e){var t=void 0===e?{}:e,n=t.width,r=void 0===n?640:n,i=t.height,o=void 0===i?480:i,a=Object.assign(document.createElement("canvas"),{width:r,height:o}),s=a.getContext("2d");s.fillStyle="green",s.fillRect(0,0,a.width,a.height);var c=!1;requestAnimationFrame((function e(){if(!c){var t=Math.round(255*Math.random()),n=Math.round(255*Math.random()),i=Math.round(255*Math.random()),a=Math.round(255*Math.random());s.fillStyle="rgba("+t+", "+n+", "+i+", "+a+")",s.fillRect(Math.random()*r,Math.random()*o,50,50),requestAnimationFrame(e)}}));var l=a.captureStream(30).getTracks()[0],d=l.stop;return l.stop=function(){c=!0,d.call(l)},l}},6931:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Timer=void 0;var n=function(){function e(){this._end=void 0,this.start()}return e.prototype.start=function(){return this._start=Date.now(),this},e.prototype.stop=function(){return this._end=Date.now(),this},e.prototype.getTimeMeasurement=function(){return{start:this._start,end:this._end,duration:void 0===this._end?void 0:this._end-this._start}},e}();t.Timer=n},9223:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=function(e){function t(){var t=e.call(this)||this;return Object.defineProperties(t,{_queuedEvents:{value:new Map}}),t}return r(t,e),t.prototype.dequeue=function(e){var t=this,n=!0;if(!e)return this._queuedEvents.forEach((function(e,t){n=this.dequeue(t)&&n}),this),n;var r=this._queuedEvents.get(e)||[];return this._queuedEvents.delete(e),r.reduce((function(n,r){return t.emit.apply(t,o([],i([e].concat(r))))&&n}),n)},t.prototype.queue=function(){var e=[].slice.call(arguments);if(this.emit.apply(this,o([],i(e))))return!0;var t=e[0];return this._queuedEvents.has(t)||this._queuedEvents.set(t,[]),this._queuedEvents.get(t).push(e.slice(1)),!1},t}(n(7284).EventEmitter);e.exports=a},6525:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r._handleTrackSignalingEvents(),r.once("disconnected",r._unsubscribeTracks.bind(r)),r}return r(t,e),t.prototype.toString=function(){return"[RemoteParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"},t.prototype._addTrack=function(t,n,r){return e.prototype._addTrack.call(this,t,r)?(n._subscribed(t),this.emit("trackSubscribed",t,n),t):null},t.prototype._addTrackPublication=function(t){var n=e.prototype._addTrackPublication.call(this,t);return n?(this.emit("trackPublished",n),n):null},t.prototype._getTrackPublicationEvents=function(){return o(o([],i(e.prototype._getTrackPublicationEvents.call(this))),[["subscriptionFailed","trackSubscriptionFailed"],["trackDisabled","trackDisabled"],["trackEnabled","trackEnabled"],["publishPriorityChanged","trackPublishPriorityChanged"],["trackSwitchedOff","trackSwitchedOff"],["trackSwitchedOn","trackSwitchedOn"]])},t.prototype._unsubscribeTracks=function(){var e=this;this.tracks.forEach((function(t){if(t.isSubscribed){var n=t.track;t._unsubscribe(),e.emit("trackUnsubscribed",n,t)}}))},t.prototype._removeTrack=function(t,n,r){var i=this._tracks.get(r);return i?(e.prototype._removeTrack.call(this,i,r),n._unsubscribe(),this.emit("trackUnsubscribed",i,n),i):null},t.prototype._removeTrackPublication=function(t){this._signaling.clearTrackHint(t.trackSid);var n=e.prototype._removeTrackPublication.call(this,t);return n?(this.emit("trackUnpublished",n),n):null},t}(n(8715));e.exports=a},9459:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=n(1906),s=n(6525),c=n(5051),l=n(6803),d=l.flatMap,u=l.valueToJSON,h=0,p=function(e){function t(t,n,r){var a,s,c=e.call(this)||this,l=r.log.createLog("default",c),d=new Map;return Object.defineProperties(c,{_log:{value:l},_clientTrackSwitchOffControl:{value:r.clientTrackSwitchOffControl||"disabled"},_contentPreferencesMode:{value:r.contentPreferencesMode||"disabled"},_instanceId:{value:++h},_options:{value:r},_participants:{value:d},_signaling:{value:n},dominantSpeaker:{enumerable:!0,get:function(){return this.participants.get(n.dominantSpeakerSid)||null}},isRecording:{enumerable:!0,get:function(){return n.recording.isEnabled||!1}},localParticipant:{enumerable:!0,value:t},name:{enumerable:!0,value:n.name},participants:{enumerable:!0,value:d},sid:{enumerable:!0,value:n.sid},state:{enumerable:!0,get:function(){return n.state}},mediaRegion:{enumerable:!0,value:n.mediaRegion}}),function(e,t){var n=["trackWarning","trackWarningsCleared"].map((function(n){return{eventName:n,handler:function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];return e.emit.apply(e,o([n],i(o(o([],i(r)),[t]))))}}}));n.forEach((function(e){var n=e.eventName,r=e.handler;return t.on(n,r)})),e.once("disconnected",(function(){return n.forEach((function(e){var n=e.eventName,r=e.handler;return t.removeListener(n,r)}))}))}(c,t),a=c,(s=n.recording).on("updated",(function(){var e=s.isEnabled;a._log.info("Recording "+(e?"started":"stopped")),a.emit("recording"+(e?"Started":"Stopped"))})),function(e,t){var n=e._log;n.debug("Creating a new RemoteParticipant for each ParticipantSignaling in the RoomSignaling"),t.participants.forEach(m.bind(null,e)),n.debug("Setting up RemoteParticipant creation for all subsequent ParticipantSignalings that connect to the RoomSignaling"),t.on("participantConnected",m.bind(null,e)),t.on("dominantSpeakerChanged",(function(){return e.emit("dominantSpeakerChanged",e.dominantSpeaker)})),t.on("stateChanged",(function r(i,o){switch(n.info("Transitioned to state:",i),i){case"disconnected":e.participants.forEach((function(e){e._unsubscribeTracks()})),e.emit(i,e,o),e.localParticipant.tracks.forEach((function(e){e.unpublish()})),t.removeListener("stateChanged",r);break;case"reconnecting":setTimeout((function(){return e.emit("reconnecting",o)}),0);break;default:setTimeout((function(){return e.emit("reconnected")}),0)}}))}(c,n),function(e){var t=e.localParticipant._signaling.audioProcessors;e.localParticipant.audioTracks.forEach((function(n){var r=n.track.noiseCancellation;r&&!t.includes(r.vendor)&&(e._log.warn(r.vendor+" is not supported in this room. disabling it permanently"),r.disablePermanently())}))}(c),l.info("Created a new Room:",c.name),l.debug("Initial RemoteParticipants:",Array.from(c._participants.values())),c}return r(t,e),t.prototype.toString=function(){return"[Room #"+this._instanceId+": "+this.sid+"]"},t.prototype.disconnect=function(){return this._log.info("Disconnecting"),this._signaling.disconnect(),this},t.prototype.getStats=function(){var e=this;return this._signaling.getStats().then((function(t){return Array.from(t).map((function(t){var n=i(t,2),r=n[0],o=n[1];return new c(r,Object.assign({},o,{localAudioTrackStats:f(e,o.localAudioTrackStats),localVideoTrackStats:f(e,o.localVideoTrackStats)}))}))}))},t.prototype.refreshInactiveMedia=function(){var e=this.localParticipant.tracks,t=Array.from(e.values()).filter((function(e){return"data"!==e.track.kind})).map((function(e){return e.track})),n=d(this.participants,(function(e){return Array.from(e.tracks.values())})).filter((function(e){var t=e.track;return t&&"data"!==t.kind})).map((function(e){return e.track})),r=t.concat(n),i=new Event("unmute");t.forEach((function(e){var t=e.isMuted,n=e.mediaStreamTrack;t&&n.dispatchEvent(i)}));var o=new Event("pause");return r.forEach((function(e){var t=e._attachments,n=e._elShims;return t.forEach((function(e){var t=n.get(e);e.paused&&t&&!t.pausedIntentionally()&&e.dispatchEvent(o)}))})),this},t.prototype.toJSON=function(){return u(this)},t}(a);function f(e,t){var n=e.localParticipant._signaling;return t.reduce((function(e,t){var r=n.tracks.get(t.trackId),i=n.getSender(r);return i?[Object.assign({},t,{trackId:i.id})].concat(e):e}),[])}function m(e,t){var n=e._log,r=e._clientTrackSwitchOffControl,a=e._contentPreferencesMode,c=e._options,l=c.MediaStream,d=c.mapMediaElement,u=c.disposeMediaElement,h=new s(t,{log:n,clientTrackSwitchOffControl:r,contentPreferencesMode:a,MediaStream:l,mapMediaElement:d,disposeMediaElement:u});n.info("A new RemoteParticipant connected:",h),e._participants.set(h.sid,h),e.emit("participantConnected",h);var p=[["reconnected","participantReconnected"],["reconnecting","participantReconnecting"],"trackDimensionsChanged","trackDisabled","trackEnabled","trackMessage","trackPublished","trackPublishPriorityChanged","trackStarted","trackSubscribed","trackSubscriptionFailed","trackSwitchedOff","trackSwitchedOn","trackUnpublished","trackUnsubscribed"].map((function(t){var n=i(Array.isArray(t)?t:[t,t],2),r=n[0],a=n[1];function s(){var t=[].slice.call(arguments);t.unshift(a),t.push(h),e.emit.apply(e,o([],i(t)))}return h.on(r,s),[r,s]}));h.once("disconnected",(function(){var t=e.dominantSpeaker;n.info("RemoteParticipant disconnected:",h),e._participants.delete(h.sid),p.forEach((function(e){h.removeListener(e[0],e[1])})),e.emit("participantDisconnected",h),h===t&&e.emit("dominantSpeakerChanged",e.dominantSpeaker)}))}e.exports=p},7205:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(8168),o=n(8910),a=n(6546),s={closed:["opening"],opening:["closed","open"],open:["closed","closing"],closing:["closed","open"]},c=function(e){function t(){return e.call(this,"closed",s)||this}return r(t,e),t.prototype._close=function(e){return this.transition("closing",e),this.transition("closed",e),Promise.resolve(this)},t.prototype._connect=function(e,t,n,r,i){e.connect("PA00000000000000000000000000000000","test");var a=Promise.resolve(new o(e,"RM00000000000000000000000000000000",i));return a.cancel=function(){},a},t.prototype._open=function(e){return this.transition("opening",e),this.transition("open",e),Promise.resolve(this)},t.prototype.close=function(){var e=this;return this.bracket("close",(function(t){switch(e.state){case"closed":return e;case"open":return e._close(t);default:throw new Error('Unexpected Signaling state "'+e.state+'"')}}))},t.prototype.connect=function(e,t,n,r,i){var o=this;return this.bracket("connect",(function a(s){switch(o.state){case"closed":return o._open(s).then(a.bind(null,s));case"open":return o.releaseLockCompletely(s),o._connect(e,t,n,r,i);default:throw new Error('Unexpected Signaling state "'+o.state+'"')}}))},t.prototype.createLocalParticipantSignaling=function(){return new i},t.prototype.open=function(){var e=this;return this.bracket("open",(function(t){switch(e.state){case"closed":return e._open(t);case"open":return e;default:throw new Error('Unexpected Signaling state "'+e.state+'"')}}))},t}(a);e.exports=c},6121:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(){var t=e.call(this)||this;return Object.defineProperties(t,{_publicationsToTrackSenders:{value:new Map},_trackSendersToPublications:{value:new Map}}),t}return r(t,e),t.prototype.addTrack=function(t,n,r,i){void 0===i&&(i=null);var o=this._createLocalTrackPublicationSignaling(t,n,r,i);return this._trackSendersToPublications.set(t,o),this._publicationsToTrackSenders.set(o,t),e.prototype.addTrack.call(this,o),this},t.prototype.getPublication=function(e){return this._trackSendersToPublications.get(e)||null},t.prototype.getSender=function(e){return this._publicationsToTrackSenders.get(e)||null},t.prototype.removeTrack=function(t){var n=this._trackSendersToPublications.get(t);return n?(this._trackSendersToPublications.delete(t),this._publicationsToTrackSenders.delete(n),e.prototype.removeTrack.call(this,n)&&n.stop(),n):null},t}(n(8168));e.exports=i},6593:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n,r){var i=this,o=t.clone();"data"!==t.kind&&(o.track.enabled=t.track.enabled);var a="data"===(t=o).kind||t.track.enabled;return(i=e.call(this,n,t.kind,a,r)||this).setTrackTransceiver(t),Object.defineProperties(i,{_updatedPriority:{value:r,writable:!0},id:{enumerable:!0,value:t.id}}),i}return r(t,e),Object.defineProperty(t.prototype,"updatedPriority",{get:function(){return this._updatedPriority},enumerable:!1,configurable:!0}),t.prototype.enable=function(t){return t="boolean"!==typeof t||t,this.trackTransceiver.track.enabled=t,e.prototype.enable.call(this,t)},t.prototype.publishFailed=function(e){return function(e,t){if(null!==e._sid||e._error)return!1;return e._error=t,!0}(this,e)&&this.emit("updated"),this},t.prototype.setPriority=function(e){return this._updatedPriority!==e&&(this._updatedPriority=e,this.emit("updated")),this},t.prototype.setSid=function(t){return this._error?this:e.prototype.setSid.call(this,t)},t.prototype.stop=function(){this.trackTransceiver.stop()},t}(n(2478));e.exports=i},8168:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(6546),o=n(4440),a={connecting:["connected"],connected:["disconnected","reconnecting"],reconnecting:["connected","disconnected"],disconnected:[]},s=function(e){function t(){var t=e.call(this,"connecting",a)||this;return Object.defineProperties(t,{_identity:{writable:!0,value:null},_networkQualityLevel:{value:null,writable:!0},_networkQualityStats:{value:null,writable:!0},_sid:{writable:!0,value:null},identity:{enumerable:!0,get:function(){return this._identity}},sid:{enumerable:!0,get:function(){return this._sid}},tracks:{enumerable:!0,value:new Map}}),t}return r(t,e),Object.defineProperty(t.prototype,"networkQualityLevel",{get:function(){return this._networkQualityLevel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"networkQualityStats",{get:function(){return this._networkQualityStats},enumerable:!1,configurable:!0}),t.prototype.addTrack=function(e){return this.tracks.set(e.id||e.sid,e),this.emit("trackAdded",e),this},t.prototype.disconnect=function(){return"disconnected"!==this.state&&(this.preempt("disconnected"),!0)},t.prototype.removeTrack=function(e){var t=this.tracks.get(e.id||e.sid);return this.tracks.delete(e.id||e.sid),t&&this.emit("trackRemoved",e),t||null},t.prototype.setNetworkQualityLevel=function(e,t){this._networkQualityLevel!==e&&(this._networkQualityLevel=e,this._networkQualityStats=t&&(t.audio||t.video)?new o(t):null,this.emit("networkQualityLevelChanged"))},t.prototype.connect=function(e,t){return("connecting"===this.state||"reconnecting"===this.state)&&(this._sid||(this._sid=e),this._identity||(this._identity=t),this.preempt("connected"),!0)},t.prototype.reconnecting=function(){return("connecting"===this.state||"connected"===this.state)&&(this.preempt("reconnecting"),!0)},t}(i);e.exports=s},3198:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(){var t=e.call(this)||this;return Object.defineProperties(t,{_isEnabled:{value:null,writable:!0},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}}}),t}return r(t,e),t.prototype.disable=function(){return this.enable(!1)},t.prototype.enable=function(e){return e="boolean"!==typeof e||e,this.isEnabled!==e&&(this._isEnabled=e,this.emit("updated")),this},t}(n(7284).EventEmitter);e.exports=i},1274:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){var r=e.call(this)||this;return r.connect(t,n),r}return r(t,e),t}(n(8168));e.exports=i},532:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n,r,i,o,a){var s=e.call(this,n,r,i,o)||this;return Object.defineProperties(s,{_isSwitchedOff:{value:a,writable:!0}}),s.setSid(t),s}return r(t,e),Object.defineProperty(t.prototype,"isSubscribed",{get:function(){return!!this.trackTransceiver},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSwitchedOff",{get:function(){return this._isSwitchedOff},enumerable:!1,configurable:!0}),t.prototype.subscribeFailed=function(e){return this.error||(this._error=e,this.emit("updated")),this},t.prototype.setPriority=function(e){return this._priority!==e&&(this._priority=e,this.emit("updated")),this},t.prototype.setSwitchedOff=function(e){return this._isSwitchedOff!==e&&(this._isSwitchedOff=e,this.emit("updated")),this},t}(n(2478));e.exports=i},8910:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(3198),o=n(6546),a=n(2016),s=n(6803).buildLogLevels,c=n(6262).DEFAULT_LOG_LEVEL,l=n(5765),d=n(569),u=d.MediaConnectionError,h=d.MediaDTLSTransportFailedError,p=d.SignalingConnectionDisconnectedError,f=0,m={connected:["reconnecting","disconnected"],reconnecting:["connected","disconnected"],disconnected:[]},_=function(e){function t(t,n,r,o){var d=this;o=Object.assign({logLevel:c,RecordingSignaling:i,Timeout:a},o);var u=s(o.logLevel);d=e.call(this,"connected",m)||this;var p=o.RecordingSignaling,_=new o.Timeout((function(){d._disconnect(d._reconnectingError)}),o.sessionTimeout,!1);return Object.defineProperties(d,{_instanceId:{value:f++},_log:{value:o.log?o.log.createLog("default",d):new l("default",d,u,o.loggerName)},_mediaConnectionIsReconnecting:{writable:!0,value:!1},_options:{value:o},_reconnectingError:{value:null,writable:!0},_sessionTimeout:{value:_},dominantSpeakerSid:{enumerable:!0,value:null,writable:!0},localParticipant:{enumerable:!0,value:t},name:{enumerable:!0,value:r},participants:{enumerable:!0,value:new Map},recording:{enumerable:!0,value:new p},sid:{enumerable:!0,value:n}}),d.on("connectionStateChanged",(function(){"failed"!==d.connectionState||["disconnected","failed"].includes(d.iceConnectionState)||d._disconnect(new h)})),d.on("iceConnectionStateChanged",(function(){return g(d)})),d.on("signalingConnectionStateChanged",(function(){return g(d)})),setTimeout((function(){return g(d)})),d}return r(t,e),t.prototype._disconnect=function(e){return"disconnected"!==this.state&&(this.preempt("disconnected",null,[e]),!0)},t.prototype.toString=function(){return"[RoomSignaling #"+this._instanceId+": "+(this.localParticipant?this.localParticipant.sid:"null")+"]"},t.prototype.connectParticipant=function(e){var t=this;return"disconnected"!==e.state&&(!this.participants.has(e.sid)&&(this.participants.set(e.sid,e),e.on("stateChanged",(function n(r){"disconnected"===r&&(e.removeListener("stateChanged",n),t.participants.delete(e.sid),t.emit("participantDisconnected",e))})),this.emit("participantConnected",e),!0))},t.prototype.disconnect=function(){return this._disconnect()},t.prototype.setDominantSpeaker=function(e){this.dominantSpeakerSid=e,this.emit("dominantSpeakerChanged")},t}(o);function g(e){var t;"disconnected"!==e.state&&"disconnected"!==e.signalingConnectionState?("reconnecting"===e.signalingConnectionState?t=e.signalingConnectionState:"failed"===e.iceConnectionState?(e._mediaConnectionIsReconnecting=!0,t="reconnecting"):"new"===e.iceConnectionState||"checking"===e.iceConnectionState?t=e._mediaConnectionIsReconnecting?"reconnecting":"connected":(e._mediaConnectionIsReconnecting=!1,e._reconnectingError=null,e._sessionTimeout.clear(),t="connected"),t!==e.state&&("reconnecting"===t?(e._reconnectingError="reconnecting"===e.signalingConnectionState?new p:new u,e._sessionTimeout.start(),e.preempt(t,null,[e._reconnectingError])):e.preempt(t))):e._sessionTimeout.clear()}e.exports=_},2478:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n,r,i){var o=e.call(this)||this,a=null;return Object.defineProperties(o,{_error:{value:null,writable:!0},_isEnabled:{value:r,writable:!0},_priority:{value:i,writable:!0},_trackTransceiver:{value:null,writable:!0},_sid:{get:function(){return a},set:function(e){null===a&&(a=e)}},kind:{enumerable:!0,value:n},name:{enumerable:!0,value:t}}),o}return r(t,e),Object.defineProperty(t.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"priority",{get:function(){return this._priority},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sid",{get:function(){return this._sid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trackTransceiver",{get:function(){return this._trackTransceiver},enumerable:!1,configurable:!0}),t.prototype.disable=function(){return this.enable(!1)},t.prototype.enable=function(e){return e="boolean"!==typeof e||e,this.isEnabled!==e&&(this._isEnabled=e,this.emit("updated")),this},t.prototype.setTrackTransceiver=function(e){return e=e||null,this.trackTransceiver!==e&&(this._trackTransceiver=e,this.emit("updated")),this},t.prototype.setSid=function(e){return null===this.sid&&(this._sid=e,this.emit("updated")),this},t}(n(7284).EventEmitter);e.exports=i},9500:(e,t,n)=>{"use strict";var r=n(3172),i=n(7085),o=n(3963),a=n(9263),s=n(569),c=s.SignalingConnectionDisconnectedError,l=s.SignalingIncomingMessageInvalidError,d=n(6803),u=d.flatMap,h=d.createRoomConnectEventPayload;e.exports=function(e,t,n,s,d,p){p=Object.assign({PeerConnectionManager:i,RoomV2:o,Transport:a},p);var f=d.video[0]&&!0===d.video[0].adaptiveSimulcast,m=p.PeerConnectionManager,_=p.RoomV2,g=p.Transport,v=p.iceServers,y=p.log,b=new m(s,d,p),E=u(n.tracks,(function(e){return[e.trackTransceiver]}));b.setTrackSenders(E);var S,T=new Error("Canceled"),w=new r((function(r,i,o){var a=p.automaticSubscription,s=p.bandwidthProfile,d=p.dominantSpeaker,u=p.environment,m=p.eventObserver,E=p.loggerName,w=p.logLevel,C=p.name,R=p.networkMonitor,k=p.networkQuality,O=p.notifyWarnings,I=p.realm,N=p.sdpSemantics,A=!!s,x=!!s,P=!!s&&("disabled"!==p.clientTrackSwitchOffControl||"disabled"!==p.contentPreferencesMode),D=Object.assign({adaptiveSimulcast:f,automaticSubscription:a,dominantSpeaker:d,environment:u,eventObserver:m,loggerName:E,logLevel:w,networkMonitor:R,networkQuality:k,notifyWarnings:O,iceServers:v,onIced:function(e){return o()?(i(T),Promise.reject(T)):(y.debug("Got ICE servers:",e),p.iceServers=e,b.setConfiguration(p),b.createAndOffer().then((function(){if(o())throw i(T),T;y.debug("createAndOffer() succeeded."),b.dequeue("description")})).catch((function(e){throw y.error("createAndOffer() failed:",e),i(e),e})))},realm:I,renderHints:P,sdpSemantics:N,trackPriority:A,trackSwitchOff:x},s?{bandwidthProfile:s}:{});S=new g(C,e,n,b,t,D);var L=h(p);m.emit("event",L),S.once("connected",(function(e){(y.debug("Transport connected:",e),o())?i(T):e.participant?r(new _(n,e,S,b,p)):i(new l)})),S.once("stateChanged",(function(e,t){"disconnected"===e?(S=null,i(t||new c)):y.debug("Transport state changed:",e)}))}),(function(){S&&(S.disconnect(),S=null)}));return w.catch((function(){S&&(S.disconnect(),S=null),b.close()})),w}},2035:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){var r=e.call(this,t,"active_speaker",n)||this;return Object.defineProperties(r,{_loudestParticipantSid:{value:null,writable:!0}}),r.on("ready",(function(e){e.on("message",(function(e){if("active_speaker"===e.type)r._setLoudestParticipantSid(e.participant)}))})),r}return r(t,e),Object.defineProperty(t.prototype,"loudestParticipantSid",{get:function(){return this._loudestParticipantSid},enumerable:!1,configurable:!0}),t.prototype._setLoudestParticipantSid=function(e){this.loudestParticipantSid!==e&&(this._loudestParticipantSid=e,this.emit("updated"))},t}(n(9996));e.exports=i},5344:(e,t,n)=>{"use strict";var r=n(3253),i=function(){function e(){Object.defineProperties(this,{_filter:{value:new r({getKey:function(e){return e.ufrag},isLessThanOrEqualTo:function(e,t){return e.revision<=t.revision}})},_ufrag:{writable:!0,value:null},ufrag:{enumerable:!0,get:function(){return this._ufrag}}})}return e.prototype.setUfrag=function(e){this._ufrag=e;var t=this._filter.toMap().get(e);return t?t.candidates:[]},e.prototype.update=function(e){e.candidates=e.candidates||[];var t=this._filter.toMap().get(e.ufrag),n=t?t.candidates:[];return this._filter.update(e)&&this._ufrag===e.ufrag?e.candidates.slice(n.length):[]},e}();e.exports=i},6603:(e,t,n)=>{"use strict";var r=n(6262),i=r.ICE_ACTIVITY_CHECK_PERIOD_MS,o=r.ICE_INACTIVITY_THRESHOLD_MS,a=function(){function e(e,t){t=Object.assign({activityCheckPeriodMs:i,inactivityThresholdMs:o},t),Object.defineProperties(this,{_activityCheckPeriodMs:{value:t.activityCheckPeriodMs},_inactivityThresholdMs:{value:t.inactivityThresholdMs},_lastActivity:{value:null,writable:!0},_peerConnection:{value:e},_timer:{value:null,writable:!0},_onIceConnectionStateChanged:{value:null,writable:!0}})}return e.prototype._getActivePairStat=function(e){return Array.from(e.values()).find((function(e){return"candidate-pair"===e.type&&e.nominated}))||{bytesReceived:0,timestamp:Math.round((new Date).getTime())}},e.prototype._getIceConnectionStats=function(){var e=this;return this._peerConnection.getStats().then((function(t){return e._getActivePairStat(t)})).catch((function(){return null}))},e.prototype._scheduleInactivityCallback=function(e){var t=this;e&&null===this._onIceConnectionStateChanged?(this._onIceConnectionStateChanged=function(){"disconnected"===t._peerConnection.iceConnectionState&&e()},this._peerConnection.addEventListener?this._peerConnection.addEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged):this._peerConnection.oniceconnectionstatechange=this._onIceConnectionStateChanged):!e&&this._onIceConnectionStateChanged&&(this._peerConnection.removeEventListener?this._peerConnection.removeEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged):this._peerConnection.oniceconnectionstatechange=null,this._onIceConnectionStateChanged=null)},e.prototype.start=function(e){var t=this;this.stop(),this._timer=setInterval((function(){t._getIceConnectionStats().then((function(n){n&&(t._lastActivity&&t._lastActivity.bytesReceived===n.bytesReceived||(t._lastActivity=n,t._scheduleInactivityCallback(null)),n.timestamp-t._lastActivity.timestamp>=t._inactivityThresholdMs&&("disconnected"===t._peerConnection.iceConnectionState?e():null===t._onIceConnectionStateChanged&&t._scheduleInactivityCallback(e)))}))}),this._activityCheckPeriodMs)},e.prototype.stop=function(){this._scheduleInactivityCallback(null),null!==this._timer&&(clearInterval(this._timer),this._timer=null,this._lastActivity=null)},e}();e.exports=a},3850:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(9500),o=n(6284),a=function(e){function t(t,n){var r;return n=Object.assign({createCancelableRoomSignalingPromise:i},n),r=e.call(this)||this,Object.defineProperties(r,{_createCancelableRoomSignalingPromise:{value:n.createCancelableRoomSignalingPromise},_options:{value:n},_wsServer:{value:t}}),r}return r(t,e),t.prototype._connect=function(e,t,n,r,i){return i=Object.assign({},this._options,i),this._createCancelableRoomSignalingPromise.bind(null,t,this._wsServer,e,n,r,i)},t.prototype.createLocalParticipantSignaling=function(e,t){return new o(e,t)},t}(n(7205));e.exports=a},6284:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(6121),o=n(3210),a=n(6262).DEFAULT_LOG_LEVEL,s=n(5765),c=n(6803),l=c.buildLogLevels,d=c.isDeepEqual,u=function(e){function t(t,n,r){var i;r=Object.assign({logLevel:a,LocalTrackPublicationV2:o},r),i=e.call(this)||this;var c=l(r.logLevel);return Object.defineProperties(i,{_bandwidthProfile:{value:null,writable:!0},_bandwidthProfileRevision:{value:0,writable:!0},_encodingParameters:{value:t},_removeListeners:{value:new Map},_LocalTrackPublicationV2:{value:r.LocalTrackPublicationV2},_log:{value:r.log?r.log.createLog("default",i):new s("default",i,c,r.loggerName)},_publishedRevision:{writable:!0,value:0},_revision:{writable:!0,value:1},_signalingRegion:{value:null,writable:!0},audioProcessors:{value:[],writable:!0},bandwidthProfile:{enumerable:!0,get:function(){return this._bandwidthProfile}},bandwidthProfileRevision:{enumerable:!0,get:function(){return this._bandwidthProfileRevision}},networkQualityConfiguration:{enumerable:!0,value:n},revision:{enumerable:!0,get:function(){return this._revision}},signalingRegion:{enumerable:!0,get:function(){return this._signalingRegion}}}),i}return r(t,e),t.prototype.toString=function(){return"[LocalParticipantSignaling: "+this.sid+"]"},t.prototype.setSignalingRegion=function(e){this._signalingRegion||(this._signalingRegion=e)},t.prototype.setBandwidthProfile=function(e){d(this._bandwidthProfile,e)||(this._bandwidthProfile=JSON.parse(JSON.stringify(e)),this._bandwidthProfileRevision++,this.didUpdate())},t.prototype.setAudioProcessors=function(e){this.audioProcessors=e},t.prototype.getParameters=function(){return this._encodingParameters},t.prototype.setParameters=function(e){return this._encodingParameters.update(e),this},t.prototype.update=function(e){return this._publishedRevision>=e.revision||(this._publishedRevision=e.revision,e.tracks.forEach((function(e){var t=this.tracks.get(e.id);t&&t.update(e)}),this)),this},t.prototype.updateMediaStates=function(e){return e&&e.tracks?(Array.from(this.tracks.values()).forEach((function(t){var n=e.tracks[t.sid];n&&t.updateMediaStates(n)})),this):this},t.prototype._createLocalTrackPublicationSignaling=function(e,t,n,r){return new this._LocalTrackPublicationV2(e,t,n,r,{log:this._log})},t.prototype.addTrack=function(t,n,r,i){var o=this;e.prototype.addTrack.call(this,t,n,r,i);var a=this.getPublication(t),s=a.isEnabled,c=a.updatedPriority,l=function(){s===a.isEnabled&&c===a.updatedPriority||(o.didUpdate(),s=a.isEnabled,c=a.updatedPriority)};return a.on("updated",l),this._removeListener(a),this._removeListeners.set(a,(function(){return a.removeListener("updated",l)})),this.didUpdate(),this},t.prototype._removeListener=function(e){var t=this._removeListeners.get(e);t&&t()},t.prototype.getState=function(){return{revision:this.revision,tracks:Array.from(this.tracks.values()).map((function(e){return e.getState()}))}},t.prototype.didUpdate=function(){this._revision++,this.emit("updated")},t.prototype.removeTrack=function(t){var n=e.prototype.removeTrack.call(this,t);return n&&(t.removeClone(n.trackTransceiver),this._removeListener(n),this.didUpdate()),n},t.prototype.setNetworkQualityConfiguration=function(e){this.networkQualityConfiguration.update(e)},t.prototype.setPublisherHint=function(e,t){var n=Array.from(this.tracks.values()).find((function(t){return t.sid===e}));return n?n.trackTransceiver.setPublisherHint(t):(this._log.warn("track:"+e+" not found"),Promise.resolve("UNKNOWN_TRACK"))},t}(i);e.exports=u},3210:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(6593),o=n(3691),a=n(569).createTwilioError,s=function(e){function t(t,n,r,i,o){var a=e.call(this,t,n,r)||this;return Object.defineProperties(a,{_log:{value:o.log.createLog("default",a)},_mediaStates:{value:{recordings:null},writable:!0},_noiseCancellationVendor:{value:i}}),a}return r(t,e),t.prototype.getState=function(){var e={enabled:this.isEnabled,id:this.id,kind:this.kind,name:this.name,priority:this.updatedPriority};return this._noiseCancellationVendor&&(e.audio_processor=this._noiseCancellationVendor),e},t.prototype.toString=function(){return"[LocalTrackPublicationV2: "+this.sid+"]"},t.prototype.update=function(e){switch(e.state){case"ready":this.setSid(e.sid);break;case"failed":var t=e.error;this.publishFailed(a(t.code,t.message))}return this},t.prototype.updateMediaStates=function(e){if(!e||!e.recordings||this._mediaStates.recordings===e.recordings)return this;switch(this._mediaStates.recordings=e.recordings,this._mediaStates.recordings){case"OK":this._log.info("Warnings have cleared."),this.emit("warningsCleared");break;case"NO_MEDIA":this._log.warn("Recording media lost."),this.emit("warning",o.recordingMediaLost);break;default:this._log.warn("Unknown media state detected: "+this._mediaStates.recordings)}return this},t}(i);e.exports=s},9996:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(7284),o=0,a=function(e){function t(t,n,r){var i=e.call(this)||this;return Object.defineProperties(i,{_instanceId:{value:o++},channel:{value:n},_log:{value:r.log.createLog("default",i)},_getReceiver:{value:t},_receiverPromise:{value:null,writable:!0},_transport:{value:null,writable:!0}}),i}return r(t,e),Object.defineProperty(t.prototype,"isSetup",{get:function(){return!!this._receiverPromise},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"[MediaSignaling #"+this._instanceId+":"+this.channel+"]"},t.prototype.setup=function(e){var t=this;this._teardown(),this._log.info("setting up msp transport for id:",e);var n=this._getReceiver(e).then((function(e){if("data"!==e.kind&&t._log.error("Expected a DataTrackReceiver"),t._receiverPromise===n){try{t._transport=e.toDataTransport(),t.emit("ready",t._transport)}catch(r){t._log.error("Failed to toDataTransport: "+r.message)}e.once("close",(function(){return t._teardown()}))}}));this._receiverPromise=n},t.prototype._teardown=function(){this._transport&&(this._log.info("Tearing down"),this._transport=null,this._receiverPromise=null,this.emit("teardown"))},t}(i);e.exports=a},7817:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=n(7284),a=n(5278),s=function(e){function t(t,n){var r=e.call(this)||this;return Object.defineProperties(r,{_factories:{value:new WeakMap},_manager:{value:t},_signaling:{value:n}}),n.on("updated",(function(){return r.emit("updated")})),r}return r(t,e),Object.defineProperty(t.prototype,"level",{get:function(){return this._signaling.level},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"levels",{get:function(){return this._signaling.levels},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteLevels",{get:function(){return this._signaling.remoteLevels},enumerable:!1,configurable:!0}),t.prototype.start=function(){var e=this;this.stop();var t=setTimeout((function(){e._timeout===t&&function(e){var t=(e._manager._peerConnections?Array.from(e._manager._peerConnections.values()):[]).map((function(e){return e._peerConnection})).filter((function(e){return"closed"!==e.signalingState})).map((function(t){if(e._factories.has(t))return e._factories.get(t);var n=new a(t);return e._factories.set(t,n),n})).map((function(e){return e.next().catch((function(){return null}))}));return Promise.all(t).then((function(e){return e.filter((function(e){return e})).map((function(e){return e.summarize()}))}))}(e).then((function(n){if(e._timeout===t){if(n.length){var r=i(n,1)[0];e._signaling.put(r)}e.start()}}))}),200);this._timeout=t},t.prototype.stop=function(){clearTimeout(this._timeout),this._timeout=null},t}(o);e.exports=s},1267:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(9996),o=n(5766),a=n(2016),s=function(e){function t(t,n,r){var i=e.call(this,t,"network_quality",r)||this;return Object.defineProperties(i,{_level:{value:null,writable:!0},_levels:{value:null,writable:!0},_remoteLevels:{value:new Map,writable:!0},_networkQualityInputs:{value:new o},_resendTimer:{value:new a((function(){i._resendTimer.setDelay(1.5*i._resendTimer.delay),i._sendNetworkQualityInputs()}),5e3,!1)},_networkQualityReportLevels:{get:function(){return{reportLevel:n.local,remoteReportLevel:n.remote}}}}),i.on("ready",(function(e){e.on("message",(function(e){if(i._log.debug("Incoming: ",e),"network_quality"===e.type)i._handleNetworkQualityMessage(e)}))})),i._sendNetworkQualityInputs(),i}return r(t,e),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"levels",{get:function(){return this._levels},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteLevels",{get:function(){return this._remoteLevels},enumerable:!1,configurable:!0}),t.prototype._handleNetworkQualityMessage=function(e){var t=this,n=!1,r=null,i=e?e.local:null;"number"===typeof i?(r=i,this._levels=null):"object"===typeof i&&i&&(this._levels=i,r="number"===typeof i.level?i.level:Math.min(i.audio.send,i.audio.recv,i.video.send,i.video.recv)),null!==r&&this.level!==r&&(this._level=r,n=!0),this._remoteLevels=e&&e.remotes?e.remotes.reduce((function(e,r){return(t._remoteLevels.get(r.sid)||{}).level!==r.level&&(n=!0),e.set(r.sid,r)}),new Map):this._remoteLevels,n&&this.emit("updated"),this._resendTimer.setDelay(5e3),this._resendTimer.isSet&&setTimeout((function(){return t._sendNetworkQualityInputs()}),1e3)},t.prototype._sendNetworkQualityInputs=function(){var e=this;return this._resendTimer.clear(),this._networkQualityInputs.take().then((function(t){e._transport&&e._transport.publish(function(e,t){return Object.assign({type:"network_quality"},e,t)}(t,e._networkQualityReportLevels))})).finally((function(){e._resendTimer.start()}))},t.prototype.put=function(e){this._networkQualityInputs.put(e)},t}(i);e.exports=s},5400:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=n(2935),s=n(7422),c=s.RTCIceCandidate,l=s.RTCPeerConnection,d=s.RTCSessionDescription,u=s.getStats,h=n(295),p=n(6262),f=p.DEFAULT_ICE_GATHERING_TIMEOUT_MS,m=p.DEFAULT_LOG_LEVEL,_=p.DEFAULT_SESSION_TIMEOUT_SEC,g=p.iceRestartBackoffConfig,v=n(981),y=v.addOrRewriteNewTrackIds,b=v.addOrRewriteTrackIds,E=v.createCodecMapForMediaSection,S=v.disableRtx,T=v.enableDtxForOpus,w=v.filterLocalCodecs,C=v.getMediaSections,R=v.removeSSRCAttributes,k=v.revertSimulcast,O=v.setCodecPreferences,I=v.setSimulcast,N=n(2016),A=n(569),x=A.MediaClientLocalDescFailedError,P=A.MediaClientRemoteDescFailedError,D=n(6803),L=D.buildLogLevels,M=D.getPlatform,j=D.isChromeScreenShareTrack,U=D.oncePerTick,V=D.defer,F=n(5344),B=n(6603),W=n(9842),G=n(3016),H=n(6546),z=n(5765),K=n(4690),q=n(7898),Y=h.guessBrowser(),J=M(),X=/android/.test(J),Q="chrome"===Y,Z="firefox"===Y,$="safari"===Y,ee=0,te={open:["closed","updating"],updating:["closed","open"],closed:[]},ne=function(e){function t(t,n,r,i){var o=e.call(this,"open",te)||this;i=Object.assign({enableDscp:!1,dummyAudioMediaStreamTrack:null,isChromeScreenShareTrack:j,iceServers:[],logLevel:m,offerOptions:{},revertSimulcast:k,sessionTimeout:1e3*_,setCodecPreferences:O,setSimulcast:I,Backoff:a,IceConnectionMonitor:B,RTCIceCandidate:c,RTCPeerConnection:l,RTCSessionDescription:d,Timeout:N},i);var s=ae(Object.assign({},i,i.rtcConfiguration)),u=L(i.logLevel),h=i.RTCPeerConnection;!0===i.enableDscp&&(i.chromeSpecificConstraints=i.chromeSpecificConstraints||{},i.chromeSpecificConstraints.optional=i.chromeSpecificConstraints.optional||[],i.chromeSpecificConstraints.optional.push({googDscp:!0}));var p=i.log?i.log.createLog("webrtc",o):new z("webrtc",o,u,i.loggerName),v=new h(s,i.chromeSpecificConstraints);i.dummyAudioMediaStreamTrack&&v.addTrack(i.dummyAudioMediaStreamTrack),Object.defineProperties(o,{_appliedTrackIdsToAttributes:{value:new Map,writable:!0},_dataChannels:{value:new Map},_dataTrackReceivers:{value:new Set},_descriptionRevision:{writable:!0,value:0},_didGenerateLocalCandidates:{writable:!0,value:!1},_enableDscp:{value:i.enableDscp},_encodingParameters:{value:n},_isChromeScreenShareTrack:{value:i.isChromeScreenShareTrack},_iceGatheringFailed:{value:!1,writable:!0},_iceGatheringTimeout:{value:new i.Timeout((function(){return o._handleIceGatheringTimeout()}),f,!1)},_iceRestartBackoff:{value:new i.Backoff(g)},_instanceId:{value:++ee},_isIceConnectionInactive:{writable:!0,value:!1},_isIceLite:{writable:!0,value:!1},_isIceRestartBackoffInProgress:{writable:!0,value:!1},_isRestartingIce:{writable:!0,value:!1},_lastIceConnectionState:{writable:!0,value:null},_lastStableDescriptionRevision:{writable:!0,value:0},_localCandidates:{writable:!0,value:[]},_localCodecs:{value:new Set},_localCandidatesRevision:{writable:!0,value:1},_localDescriptionWithoutSimulcast:{writable:!0,value:null},_localDescription:{writable:!0,value:null},_localUfrag:{writable:!0,value:null},_log:{value:p},_eventObserver:{value:i.eventObserver},_remoteCodecMaps:{value:new Map},_rtpSenders:{value:new Map},_rtpNewSenders:{value:new Set},_iceConnectionMonitor:{value:new i.IceConnectionMonitor(v)},_mediaTrackReceivers:{value:new Set},_needsAnswer:{writable:!0,value:!1},_negotiationRole:{writable:!0,value:null},_offerOptions:{writable:!0,value:i.offerOptions},_onEncodingParametersChanged:{value:U((function(){o._needsAnswer||le(o)}))},_peerConnection:{value:v},_preferredAudioCodecs:{value:r.audio},_preferredVideoCodecs:{value:r.video},_shouldApplyDtx:{value:r.audio.every((function(e){return"opus"!==e.codec}))||r.audio.some((function(e){var t=e.codec,n=e.dtx;return"opus"===t&&n}))},_queuedDescription:{writable:!0,value:null},_iceReconnectTimeout:{value:new i.Timeout((function(){p.debug("ICE reconnect timed out"),o.close()}),i.sessionTimeout,!1)},_recycledTransceivers:{value:{audio:[],video:[]}},_replaceTrackPromises:{value:new Map},_remoteCandidates:{writable:!0,value:new F},_setCodecPreferences:{value:Z&&X&&r.video[0]&&"h264"!==r.video[0].codec.toLowerCase()?function(e){return e}:i.setCodecPreferences},_setSimulcast:{value:i.setSimulcast},_revertSimulcast:{value:i.revertSimulcast},_RTCIceCandidate:{value:i.RTCIceCandidate},_RTCPeerConnection:{value:i.RTCPeerConnection},_RTCSessionDescription:{value:i.RTCSessionDescription},_shouldOffer:{writable:!0,value:!1},_shouldRestartIce:{writable:!0,value:!1},_trackIdsToAttributes:{value:new Map,writable:!0},_trackMatcher:{writable:!0,value:null},_mediaTrackSenderToPublisherHints:{value:new Map},id:{enumerable:!0,value:t}}),n.on("changed",o._onEncodingParametersChanged),v.addEventListener("connectionstatechange",o._handleConnectionStateChange.bind(o)),v.addEventListener("datachannel",o._handleDataChannelEvent.bind(o)),v.addEventListener("icecandidate",o._handleIceCandidateEvent.bind(o)),v.addEventListener("iceconnectionstatechange",o._handleIceConnectionStateChange.bind(o)),v.addEventListener("icegatheringstatechange",o._handleIceGatheringStateChange.bind(o)),v.addEventListener("signalingstatechange",o._handleSignalingStateChange.bind(o)),v.addEventListener("track",o._handleTrackEvent.bind(o));var y=o;return o.on("stateChanged",(function e(t){"closed"===t&&(y.removeListener("stateChanged",e),y._dataChannels.forEach((function(e,t){y.removeDataTrackSender(t)})))})),o}return r(t,e),t.prototype.toString=function(){return"[PeerConnectionV2 #"+this._instanceId+": "+this.id+"]"},t.prototype.setEffectiveAdaptiveSimulcast=function(e){this._log.debug("Setting setEffectiveAdaptiveSimulcast: ",e),this._preferredVideoCodecs.forEach((function(t){"adaptiveSimulcast"in t&&(t.adaptiveSimulcast=e)}))},Object.defineProperty(t.prototype,"_shouldApplySimulcast",{get:function(){return!(!Q&&!$)&&this._preferredVideoCodecs.some((function(e){return"vp8"===e.codec.toLowerCase()&&e.simulcast&&!1!==e.adaptiveSimulcast}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connectionState",{get:function(){return"failed"===this.iceConnectionState?"failed":this._peerConnection.connectionState||this.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iceConnectionState",{get:function(){return this._isIceConnectionInactive&&"disconnected"===this._peerConnection.iceConnectionState||this._iceGatheringFailed?"failed":this._peerConnection.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isApplicationSectionNegotiated",{get:function(){return"closed"===this._peerConnection.signalingState||!!this._peerConnection.localDescription&&C(this._peerConnection.localDescription.sdp,"application").length>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_isAdaptiveSimulcastEnabled",{get:function(){var e=this._preferredVideoCodecs.find((function(e){return"adaptiveSimulcast"in e}));return e&&!0===e.adaptiveSimulcast},enumerable:!1,configurable:!0}),t.prototype._maybeUpdateEncodings=function(e,t,n){if(void 0===n&&(n=!1),"video"!==e.kind||"ended"===e.readyState)return!1;var r=e.getSettings(),i=r.height,o=r.width;if("number"!==typeof i||"number"!==typeof o)return!1;var a=h.guessBrowser();return!!("safari"===a||"chrome"===a&&this._isAdaptiveSimulcastEnabled)&&(this._updateEncodings(e,t,n),!0)},t.prototype._updateEncodings=function(e,t,n){if(this._isChromeScreenShareTrack(e)){var r=[{scaleResolutionDownBy:1},{scaleResolutionDownBy:1}];t.forEach((function(e,t){var i=r[t];i?(e.scaleResolutionDownBy=i.scaleResolutionDownBy,n&&delete e.active):(e.active=!1,delete e.scaleResolutionDownBy)}))}else{var i=e.getSettings(),o=i.width*i.height,a=[{pixels:518400,maxActiveLayers:3},{pixels:129600,maxActiveLayers:2},{pixels:0,maxActiveLayers:1}].find((function(e){return o>=e.pixels})),s=Math.min(t.length,a.maxActiveLayers);t.forEach((function(e,t){t<s?(e.scaleResolutionDownBy=1<<s-t-1,n&&(e.active=!0)):(e.active=!1,delete e.scaleResolutionDownBy)}))}this._log.debug("_updateEncodings:",t.map((function(e,t){return"["+t+": "+e.active+", "+(e.scaleResolutionDownBy||0)+"]"})).join(", "))},t.prototype._addIceCandidate=function(e){var t=this;return Promise.resolve().then((function(){return e=new t._RTCIceCandidate(e),t._peerConnection.addIceCandidate(e)})).catch((function(n){t._log.warn("Failed to add RTCIceCandidate "+(e?'"'+e.candidate+'"':"null")+": "+n.message)}))},t.prototype._addIceCandidates=function(e){return Promise.all(e.map(this._addIceCandidate,this)).then((function(){}))},t.prototype._addOrUpdateTransceiver=function(e){var t=this,n=function(e,t){var n={audio:e._preferredAudioCodecs.map((function(e){return e.codec.toLowerCase()})),video:e._preferredVideoCodecs.map((function(e){return e.codec.toLowerCase()}))}[t],r=e._recycledTransceivers[t],i=n.find((function(t){return e._localCodecs.has(t)}));if(!i)return r.shift();var o=r.find((function(t){var n=e._remoteCodecMaps.get(t.mid);return n&&n.has(i)}));o&&r.splice(r.indexOf(o),1);return o}(this,e.kind);if(n&&n.sender){var r=n.sender.track?n.sender.track.id:null;return r&&this._log.warn("Reusing transceiver: "+n.mid+"] "+r+" => "+e.id),this._replaceTrackPromises.set(n,n.sender.replaceTrack(e).then((function(){n.direction="sendrecv"}),(function(){})).finally((function(){t._replaceTrackPromises.delete(n)}))),n}return this._peerConnection.addTransceiver(e,{})},t.prototype._checkIceBox=function(e){var t=oe(e);if(!t)return Promise.resolve();var n=this._remoteCandidates.setUfrag(t);return this._addIceCandidates(n)},t.prototype._answer=function(e){var t=this;return Promise.resolve().then((function(){return t._negotiationRole||(t._negotiationRole="answerer"),t._setRemoteDescription(e)})).catch((function(){throw new P})).then((function(){return t._peerConnection.createAnswer()})).then((function(n){n=Z?new t._RTCSessionDescription({sdp:S(n.sdp),type:n.type}):q(n);var r=R(n.sdp,["mslabel","label"]);if(t._shouldApplySimulcast){var i=r;r=t._setSimulcast(i,t._trackIdsToAttributes),r=t._revertSimulcast(r,i,e.sdp)}return r=r.replace(/42e015/g,"42e01f"),t._setLocalDescription({type:n.type,sdp:r})})).then((function(){return t._checkIceBox(e)})).then((function(){return t._queuedDescription&&t._updateDescription(t._queuedDescription)})).then((function(){return t._queuedDescription=null,t._maybeReoffer(t._peerConnection.localDescription)})).catch((function(e){var n=e instanceof P?e:new x;throw t._publishMediaWarning({message:"Failed to _answer",code:n.code,error:e}),n}))},t.prototype._close=function(){return this._iceConnectionMonitor.stop(),"closed"!==this._peerConnection.signalingState&&(this._peerConnection.close(),this.preempt("closed"),this._encodingParameters.removeListener("changed",this._onEncodingParametersChanged),!0)},t.prototype._handleConnectionStateChange=function(){this.emit("connectionStateChanged")},t.prototype._handleDataChannelEvent=function(e){var t=this,n=e.channel,r=new W(n);this._dataTrackReceivers.add(r),n.addEventListener("close",(function(){t._dataTrackReceivers.delete(r)})),this.emit("trackAdded",r)},t.prototype._handleGlare=function(e){var t=this;return this._log.debug("Glare detected; rolling back"),this._isRestartingIce&&(this._log.debug("An ICE restart was in progress; we'll need to restart ICE again after rolling back"),this._isRestartingIce=!1,this._shouldRestartIce=!0),Promise.resolve().then((function(){return t._trackIdsToAttributes=new Map(t._appliedTrackIdsToAttributes),t._setLocalDescription({type:"rollback"})})).then((function(){return t._needsAnswer=!1,t._answer(e)})).then((function(e){return e?Promise.resolve():t._offer()}))},t.prototype._publishMediaWarning=function(e){var t=e.message,n=e.code,r=e.error,i=e.sdp;this._eventObserver.emit("event",{level:"warning",name:"error",group:"media",payload:{message:t,code:n,context:JSON.stringify({error:r.message,sdp:i})}})},t.prototype._handleIceCandidateEvent=function(e){e.candidate&&(this._log.debug("Clearing ICE gathering timeout"),this._didGenerateLocalCandidates=!0,this._iceGatheringTimeout.clear(),this._localCandidates.push(e.candidate));var t={ice:{candidates:this._isIceLite?[]:this._localCandidates.slice(),ufrag:this._localUfrag},id:this.id};e.candidate||(t.ice.complete=!0),this._isIceLite&&e.candidate||(t.ice.revision=this._localCandidatesRevision++,this.emit("candidates",t))},t.prototype._handleIceConnectionStateChange=function(){var e=this,t=this._peerConnection.iceConnectionState,n=["connected","completed"].includes(t),r=this._log;r.debug('ICE connection state is "'+t+'"'),n&&(this._iceReconnectTimeout.clear(),this._iceRestartBackoff.reset()),"failed"===this._lastIceConnectionState||"failed"!==t||this._shouldRestartIce||this._isRestartingIce?["disconnected","failed"].includes(this._lastIceConnectionState)&&n&&r.debug("ICE reconnected"):(r.warn("ICE failed"),this._initiateIceRestartBackoff()),"connected"===t?(this._isIceConnectionInactive=!1,this._iceConnectionMonitor.start((function(){e._iceConnectionMonitor.stop(),e._shouldRestartIce||e._isRestartingIce||(r.warn("ICE Connection Monitor detected inactivity"),e._isIceConnectionInactive=!0,e._initiateIceRestartBackoff(),e.emit("iceConnectionStateChanged"),e.emit("connectionStateChanged"))}))):["disconnected","completed"].includes(t)||(this._iceConnectionMonitor.stop(),this._isIceConnectionInactive=!1),this._lastIceConnectionState=t,this.emit("iceConnectionStateChanged")},t.prototype._handleIceGatheringTimeout=function(){this._log.warn("ICE failed to gather any local candidates"),this._iceGatheringFailed=!0,this._initiateIceRestartBackoff(),this.emit("iceConnectionStateChanged"),this.emit("connectionStateChanged")},t.prototype._handleIceGatheringStateChange=function(){var e=this._peerConnection.iceGatheringState,t=this._log;t.debug('ICE gathering state is "'+e+'"');var n=this._iceGatheringTimeout,r=n.delay,i=n.isSet;"gathering"!==e||this._didGenerateLocalCandidates||i||(t.debug("Starting ICE gathering timeout: "+r),this._iceGatheringFailed=!1,this._iceGatheringTimeout.start())},t.prototype._handleSignalingStateChange=function(){"stable"===this._peerConnection.signalingState&&(this._appliedTrackIdsToAttributes=new Map(this._trackIdsToAttributes))},t.prototype._handleTrackEvent=function(e){var t=this,n=this._peerConnection.remoteDescription?this._peerConnection.remoteDescription.sdp:null;this._trackMatcher=this._trackMatcher||new K,this._trackMatcher.update(n);var r=e.track,i=this._trackMatcher.match(e)||r.id,o=new G(i,r);this._mediaTrackReceivers.forEach((function(e){e.track.id===o.track.id&&t._mediaTrackReceivers.delete(e)})),this._mediaTrackReceivers.add(o),r.addEventListener?r.addEventListener("ended",(function(){return t._mediaTrackReceivers.delete(o)})):r.onended=function(){return t._mediaTrackReceivers.delete(o)},this.emit("trackAdded",o)},t.prototype._initiateIceRestart=function(){if("closed"!==this._peerConnection.signalingState){var e=this._log;e.warn("Attempting to restart ICE"),this._didGenerateLocalCandidates=!1,this._isIceRestartBackoffInProgress=!1,this._shouldRestartIce=!0;var t=this._iceReconnectTimeout,n=t.delay;t.isSet||(e.debug("Starting ICE reconnect timeout: "+n),this._iceReconnectTimeout.start()),this.offer().catch((function(t){e.error("offer failed in _initiateIceRestart with: "+t.message)}))}},t.prototype._initiateIceRestartBackoff=function(){var e=this;"closed"===this._peerConnection.signalingState||this._isIceRestartBackoffInProgress||(this._log.warn("An ICE restart has been scheduled"),this._isIceRestartBackoffInProgress=!0,this._iceRestartBackoff.backoff((function(){return e._initiateIceRestart()})))},t.prototype._maybeReoffer=function(e){var t=this._shouldOffer;if(e&&e.sdp){var n=this._peerConnection.getSenders().filter((function(e){return e.track}));t=["audio","video"].reduce((function(t,r){var i=C(e.sdp,r,"(sendrecv|sendonly)"),o=n.filter(se.bind(null,r));return t||i.length<o.length}),t);var r=this._dataChannels.size>0,i=C(e.sdp,"application").length>0;t=t||r&&!i}return(t?this._offer():Promise.resolve()).then((function(){return t}))},t.prototype._offer=function(){var e=this,t=Object.assign({},this._offerOptions);return this._needsAnswer=!0,this._shouldRestartIce&&(this._shouldRestartIce=!1,this._isRestartingIce=!0,t.iceRestart=!0),Promise.all(this._replaceTrackPromises.values()).then((function(){return e._peerConnection.createOffer(t)})).catch((function(t){var n=new x;throw e._publishMediaWarning({message:"Failed to create offer",code:n.code,error:t}),n})).then((function(t){t=Z?new e._RTCSessionDescription({sdp:S(t.sdp),type:t.type}):q(t);var n=R(t.sdp,["mslabel","label"]);n=e._peerConnection.remoteDescription?w(n,e._peerConnection.remoteDescription.sdp):n;var r=e._setCodecPreferences(n,e._preferredAudioCodecs,e._preferredVideoCodecs);return e._shouldOffer=!1,e._negotiationRole||(e._negotiationRole="offerer"),e._shouldApplySimulcast&&(e._localDescriptionWithoutSimulcast={type:"offer",sdp:r},r=e._setSimulcast(r,e._trackIdsToAttributes)),e._setLocalDescription({type:"offer",sdp:r})}))},t.prototype._getMediaTrackSenderId=function(e){var t=Array.from(this._rtpSenders.keys()).find((function(t){return t.track.id===e}));return t?t.id:e},t.prototype._addOrRewriteLocalTrackIds=function(e){var t=this,n=this._peerConnection.getTransceivers().filter((function(e){var t=e.sender;return!e.stopped&&t&&t.track})),r=n.filter((function(e){return e.mid})),i=new Map(r.map((function(e){var n=e.mid,r=e.sender;return[n,t._getMediaTrackSenderId(r.track.id)]}))),o=b(e.sdp,i),a=n.filter((function(e){return!e.mid})),s=new Map(["audio","video"].map((function(e){return[e,a.filter((function(t){return t.sender.track.kind===e})).map((function(e){var n=e.sender;return t._getMediaTrackSenderId(n.track.id)}))]}))),c=y(o,i,s);return new this._RTCSessionDescription({sdp:c,type:e.type})},t.prototype._rollbackAndApplyOffer=function(e){var t=this;return this._setLocalDescription({type:"rollback"}).then((function(){return t._setLocalDescription(e)}))},t.prototype._setLocalDescription=function(e){var t=this;return"rollback"!==e.type&&this._shouldApplyDtx&&(e=new this._RTCSessionDescription({sdp:T(e.sdp),type:e.type})),this._peerConnection.setLocalDescription(e).catch((function(n){t._log.warn('Calling setLocalDescription with an RTCSessionDescription of type "'+e.type+'" failed with the error "'+n.message+'".',n);var r=new x,i={message:'Calling setLocalDescription with an RTCSessionDescription of type "'+e.type+'" failed',code:r.code,error:n};throw e.sdp&&(t._log.warn("The SDP was "+e.sdp),i.sdp=e.sdp),t._publishMediaWarning(i),r})).then((function(){"rollback"!==e.type&&(t._localDescription=t._addOrRewriteLocalTrackIds(e),t._shouldApplyDtx&&(t._localDescription=new t._RTCSessionDescription({sdp:T(t._localDescription.sdp,[]),type:t._localDescription.type})),t._localCandidates=[],"offer"===e.type?t._descriptionRevision++:"answer"===e.type&&(t._lastStableDescriptionRevision=t._descriptionRevision,ce(t)),t._localUfrag=oe(e),t.emit("description",t.getState()))}))},t.prototype._setRemoteDescription=function(e){var t=this;return e.sdp&&(e.sdp=this._setCodecPreferences(e.sdp,this._preferredAudioCodecs,this._preferredVideoCodecs),this._shouldApplyDtx?e.sdp=T(e.sdp):e.sdp=T(e.sdp,[]),Z&&(e.sdp=e.sdp.replace(/a=msid:[^ ]+ /g,"a=msid:- ")),this._peerConnection.remoteDescription||(this._isIceLite=/a=ice-lite/.test(e.sdp))),e=new this._RTCSessionDescription(e),Promise.resolve().then((function(){if("answer"===e.type&&t._localDescriptionWithoutSimulcast){var n=t._preferredVideoCodecs.find((function(e){return"adaptiveSimulcast"in e})),r=!!n&&!1===n.adaptiveSimulcast,i=t._revertSimulcast(t._localDescription.sdp,t._localDescriptionWithoutSimulcast.sdp,e.sdp,r);if(t._localDescriptionWithoutSimulcast=null,i!==t._localDescription.sdp)return t._rollbackAndApplyOffer({type:t._localDescription.type,sdp:i})}})).then((function(){return t._peerConnection.setRemoteDescription(e)})).then((function(){"answer"===e.type&&(t._isRestartingIce&&(t._log.debug("An ICE restart was in-progress and is now completed"),t._isRestartingIce=!1),ce(t))}),(function(n){throw t._log.warn('Calling setRemoteDescription with an RTCSessionDescription of type "'+e.type+'" failed with the error "'+n.message+'".',n),e.sdp&&t._log.warn("The SDP was "+e.sdp),n}))},t.prototype._updateDescription=function(e){var t=this;switch(e.type){case"answer":case"pranswer":if(e.revision!==this._descriptionRevision||"have-local-offer"!==this._peerConnection.signalingState)return Promise.resolve();this._descriptionRevision=e.revision;break;case"close":return this._close();case"create-offer":return e.revision<=this._lastStableDescriptionRevision?Promise.resolve():this._needsAnswer?(this._queuedDescription=e,Promise.resolve()):(this._descriptionRevision=e.revision,this._offer());case"offer":return e.revision<=this._lastStableDescriptionRevision||"closed"===this._peerConnection.signalingState?Promise.resolve():"have-local-offer"===this._peerConnection.signalingState?this._needsAnswer&&0===this._lastStableDescriptionRevision?(this._queuedDescription=e,Promise.resolve()):(this._descriptionRevision=e.revision,this._handleGlare(e)):(this._descriptionRevision=e.revision,this._answer(e).then((function(){})))}var n=e.revision;return Promise.resolve().then((function(){return t._setRemoteDescription(e)})).catch((function(n){var r=new P;throw t._publishMediaWarning({message:'Calling setRemoteDescription with an RTCSessionDescription of type "'+e.type+'" failed',code:r.code,error:n,sdp:e.sdp}),r})).then((function(){return t._lastStableDescriptionRevision=n,t._needsAnswer=!1,t._checkIceBox(e)})).then((function(){return t._queuedDescription&&t._updateDescription(t._queuedDescription)})).then((function(){return t._queuedDescription=null,t._maybeReoffer(t._peerConnection.localDescription).then((function(){}))}))},t.prototype._updateIce=function(e){var t=this._remoteCandidates.update(e);return this._addIceCandidates(t)},t.prototype.addDataTrackSender=function(e){if(!this._dataChannels.has(e))try{var t={ordered:e.ordered};null!==e.maxPacketLifeTime&&(t.maxPacketLifeTime=e.maxPacketLifeTime),null!==e.maxRetransmits&&(t.maxRetransmits=e.maxRetransmits);var n=this._peerConnection.createDataChannel(e.id,t);e.addDataChannel(n),this._dataChannels.set(e,n)}catch(r){this._log.warn('Error creating an RTCDataChannel for DataTrack "'+e.id+'": '+r.message)}},t.prototype._handleQueuedPublisherHints=function(){var e=this;"stable"===this._peerConnection.signalingState&&this._mediaTrackSenderToPublisherHints.forEach((function(t,n){var r=t.deferred,i=t.encodings;e._mediaTrackSenderToPublisherHints.delete(n),e._setPublisherHint(n,i).then((function(e){return r.resolve(e)})).catch((function(e){return r.reject(e)}))}))},t.prototype._setPublisherHint=function(e,t){var n=this;if(Z)return Promise.resolve("COULD_NOT_APPLY_HINT");this._mediaTrackSenderToPublisherHints.has(e)&&(this._mediaTrackSenderToPublisherHints.get(e).deferred.resolve("REQUEST_SKIPPED"),this._mediaTrackSenderToPublisherHints.delete(e));var r=this._rtpSenders.get(e);if(!r)return this._log.warn("Could not apply publisher hint because RTCRtpSender was not found"),Promise.resolve("UNKNOWN_TRACK");if("closed"===this._peerConnection.signalingState)return this._log.warn('Could not apply publisher hint because signalingState was "closed"'),Promise.resolve("COULD_NOT_APPLY_HINT");if("stable"!==this._peerConnection.signalingState){this._log.debug("Queuing up publisher hint because signalingState:",this._peerConnection.signalingState);var i=V();return this._mediaTrackSenderToPublisherHints.set(e,{deferred:i,encodings:t}),i.promise}var o=r.getParameters();return null!==t&&t.forEach((function(e){var t=e.enabled,r=e.layer_index;o.encodings.length>r?(n._log.debug("layer:"+r+", active:"+o.encodings[r].active+" => "+t),o.encodings[r].active=t):n._log.warn("invalid layer:"+r+", active:"+t)})),this._maybeUpdateEncodings(r.track,o.encodings,null===t),r.setParameters(o).then((function(){return"OK"})).catch((function(e){return n._log.error("Failed to apply publisher hints:",e),"COULD_NOT_APPLY_HINT"}))},t.prototype.addMediaTrackSender=function(e){var t=this;if("closed"!==this._peerConnection.signalingState&&!this._rtpSenders.has(e)){var n=this._addOrUpdateTransceiver(e.track).sender;e.addSender(n,(function(n){return t._setPublisherHint(e,n)})),this._rtpNewSenders.add(n),this._rtpSenders.set(e,n)}},t.prototype.close=function(){this._close()&&(this._descriptionRevision++,this._localDescription={type:"close"},this.emit("description",this.getState()))},t.prototype.getTrackReceivers=function(){return Array.from(this._dataTrackReceivers).concat(Array.from(this._mediaTrackReceivers))},t.prototype.getState=function(){if(!this._localDescription)return null;var e="answer"===this._localDescription.type?this._lastStableDescriptionRevision:this._descriptionRevision,t={type:this._localDescription.type,revision:e};return this._localDescription.sdp&&(t.sdp=this._localDescription.sdp),{description:t,id:this.id}},t.prototype.offer=function(){var e=this;return this._needsAnswer||this._isRestartingIce?(this._shouldOffer=!0,Promise.resolve()):this.bracket("offering",(function(t){return e.transition("updating",t),(e._needsAnswer||e._isRestartingIce?Promise.resolve():e._offer()).then((function(){e.tryTransition("open",t)}),(function(n){throw e.tryTransition("open",t),n}))}))},t.prototype.removeDataTrackSender=function(e){var t=this._dataChannels.get(e);t&&(e.removeDataChannel(t),this._dataChannels.delete(e),t.close())},t.prototype.removeMediaTrackSender=function(e){var t=this._rtpSenders.get(e);if(t){if("closed"!==this._peerConnection.signalingState&&this._peerConnection.removeTrack(t),e.removeSender(t),this._mediaTrackSenderToPublisherHints.has(e))this._mediaTrackSenderToPublisherHints.get(e).deferred.resolve("UNKNOWN_TRACK"),this._mediaTrackSenderToPublisherHints.delete(e);this._rtpNewSenders.delete(t),this._rtpSenders.delete(e)}},t.prototype.setConfiguration=function(e){"function"===typeof this._peerConnection.setConfiguration&&this._peerConnection.setConfiguration(ae(e))},t.prototype.setIceReconnectTimeout=function(e){return this._iceReconnectTimeout.setDelay(e),this._log.debug("Updated ICE reconnection timeout period:",this._iceReconnectTimeout.delay),this},t.prototype.update=function(e){var t=this;return this.bracket("updating",(function(n){if("closed"===t.state)return Promise.resolve();t.transition("updating",n);var r=[];return e.ice&&r.push(t._updateIce(e.ice)),e.description&&r.push(t._updateDescription(e.description)),Promise.all(r).then((function(){t.tryTransition("open",n)}),(function(e){throw t.tryTransition("open",n),e}))}))},t.prototype.getStats=function(){var e=this;return u(this._peerConnection,{log:this._log}).then((function(t){return function(e,t){return Object.assign(t,{remoteAudioTrackStats:t.remoteAudioTrackStats.map((function(t){return ie(e,t)})),remoteVideoTrackStats:t.remoteVideoTrackStats.map((function(t){return ie(e,t)})),localAudioTrackStats:t.localAudioTrackStats.map((function(t){return re(e,t)})),localVideoTrackStats:t.localVideoTrackStats.map((function(t){return re(e,t)}))})}(e,t)}))},t}(H);function re(e,t){var n=e._getMediaTrackSenderId(t.trackId);return Object.assign(t,{trackId:n})}function ie(e,t){var n=o([],i(e._mediaTrackReceivers)).find((function(e){return e.track.id===t.trackId})),r=n?n.id:null;return Object.assign(t,{trackId:r})}function oe(e){if(e.sdp){var t=e.sdp.match(/^a=ice-ufrag:([a-zA-Z0-9+/]+)/m);if(t)return t[1]}return null}function ae(e){return void 0===e&&(e={}),Object.assign({bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},e)}function se(e,t){var n=t.track;return n&&n.kind===e&&"ended"!==n.readyState}function ce(e){!function(e){e._recycledTransceivers.audio=[],e._recycledTransceivers.video=[],e._peerConnection.getTransceivers().forEach((function(t){if(function(e,t){return!e.stopped&&!t._replaceTrackPromises.has(e)&&["inactive","recvonly"].includes(e.direction)}(t,e)){var n=t.receiver.track;e._recycledTransceivers[n.kind].push(t)}}))}(e),function(e){var t=e._peerConnection.localDescription;t&&t.sdp&&C(t.sdp).forEach((function(t){E(t).forEach((function(t,n){return e._localCodecs.add(n)}))}))}(e),function(e){var t=e._peerConnection.remoteDescription;t&&t.sdp&&C(t.sdp).forEach((function(t){var n=t.match(/^a=mid:(.+)$/m);if(n&&n[1]){var r=n[1],i=E(t);e._remoteCodecMaps.set(r,i)}}))}(e),le(e).then((function(){e._handleQueuedPublisherHints()}))}function le(e){var t=e._encodingParameters,n=t.maxAudioBitrate,r=t.maxVideoBitrate,i=new Map([["audio",n],["video",r]]),o=[];return e._peerConnection.getSenders().filter((function(e){return e.track})).forEach((function(t){var n=i.get(t.track.kind),r=t.getParameters();null===n||0===n?function(e){Array.isArray(e.encodings)&&e.encodings.forEach((function(e){return delete e.maxBitrate}))}(r):e._isChromeScreenShareTrack(t.track)?e._log.warn("Not setting maxBitrate for "+t.track.kind+" Track "+t.track.id+" because it appears to be screen share track: "+t.track.label):function(e,t){Z?e.encodings=[{maxBitrate:t}]:e.encodings.forEach((function(e){e.maxBitrate=t}))}(r,n),!Z&&r.encodings.length>0&&("audio"===t.track.kind?r.encodings[0].priority="high":e._isChromeScreenShareTrack(t.track)&&(r.encodings[0].priority="medium"),e._enableDscp&&(r.encodings[0].networkPriority="high"));var a=e._rtpNewSenders.has(t);e._maybeUpdateEncodings(t.track,r.encodings,a),e._rtpNewSenders.delete(t);var s=t.setParameters(r).catch((function(n){e._log.warn("Error while setting encodings parameters for "+t.track.kind+" Track "+t.track.id+": "+(n.message||n.name))}));o.push(s)})),Promise.all(o)}e.exports=ne},7085:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=n(295).guessBrowser,s=n(5400),c=n(224),l=n(9223),d=n(6803),u=n(569).MediaConnectionError,h="firefox"===a(),p=function(e){function t(t,r,i){var o=e.call(this)||this,a=(i=Object.assign({audioContextFactory:h?n(902):null,PeerConnectionV2:s},i)).audioContextFactory?i.audioContextFactory.getOrCreate(o):null,l=a?{offerToReceiveVideo:!0}:{offerToReceiveAudio:!0,offerToReceiveVideo:!0};return Object.defineProperties(o,{_audioContextFactory:{value:i.audioContextFactory},_closedPeerConnectionIds:{value:new Set},_configuration:{writable:!0,value:null},_configurationDeferred:{writable:!0,value:d.defer()},_connectionState:{value:"new",writable:!0},_dummyAudioTrackSender:{value:a?new c(f(a)):null},_encodingParameters:{value:t},_iceConnectionState:{writable:!0,value:"new"},_dataTrackSenders:{writable:!0,value:new Set},_lastConnectionState:{value:"new",writable:!0},_lastIceConnectionState:{writable:!0,value:"new"},_mediaTrackSenders:{writable:!0,value:new Set},_offerOptions:{value:l},_peerConnections:{value:new Map},_preferredCodecs:{value:r},_sessionTimeout:{value:null,writable:!0},_PeerConnectionV2:{value:i.PeerConnectionV2}}),o}return r(t,e),t.prototype.setEffectiveAdaptiveSimulcast=function(e){this._peerConnections.forEach((function(t){return t.setEffectiveAdaptiveSimulcast(e)})),this._preferredCodecs.video.forEach((function(t){"adaptiveSimulcast"in t&&(t.adaptiveSimulcast=e)}))},Object.defineProperty(t.prototype,"connectionState",{get:function(){return this._connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iceConnectionState",{get:function(){return this._iceConnectionState},enumerable:!1,configurable:!0}),t.prototype._closeAbsentPeerConnections=function(e){var t=new Set(e.map((function(e){return e.id})));return this._peerConnections.forEach((function(e){t.has(e.id)||e._close()})),this},t.prototype._getConfiguration=function(){return this._configurationDeferred.promise},t.prototype._getOrCreate=function(e,t){var n=this,r=this,i=this._peerConnections.get(e);if(!i){var o=this._PeerConnectionV2,a=Object.assign({dummyAudioMediaStreamTrack:this._dummyAudioTrackSender?this._dummyAudioTrackSender.track:null,offerOptions:this._offerOptions},this._sessionTimeout?{sessionTimeout:this._sessionTimeout}:{},t);try{i=new o(e,this._encodingParameters,this._preferredCodecs,a)}catch(s){throw new u}this._peerConnections.set(i.id,i),i.on("candidates",this.queue.bind(this,"candidates")),i.on("description",this.queue.bind(this,"description")),i.on("trackAdded",this.queue.bind(this,"trackAdded")),i.on("stateChanged",(function e(t){"closed"===t&&(i.removeListener("stateChanged",e),r._dataTrackSenders.forEach((function(e){return i.removeDataTrackSender(e)})),r._mediaTrackSenders.forEach((function(e){return i.removeMediaTrackSender(e)})),r._peerConnections.delete(i.id),r._closedPeerConnectionIds.add(i.id),E(r),b(r))})),i.on("connectionStateChanged",(function(){return E(n)})),i.on("iceConnectionStateChanged",(function(){return b(n)})),this._dataTrackSenders.forEach(i.addDataTrackSender,i),this._mediaTrackSenders.forEach(i.addMediaTrackSender,i),b(this)}return i},t.prototype.close=function(){return this._peerConnections.forEach((function(e){e.close()})),this._dummyAudioTrackSender&&this._dummyAudioTrackSender.stop(),this._audioContextFactory&&this._audioContextFactory.release(this),b(this),this},t.prototype.createAndOffer=function(){var e=this;return this._getConfiguration().then((function(t){var n;do{n=d.makeUUID()}while(e._peerConnections.has(n));return e._getOrCreate(n,t)})).then((function(e){return e.offer()})).then((function(){return e}))},t.prototype.getTrackReceivers=function(){return d.flatMap(this._peerConnections,(function(e){return e.getTrackReceivers()}))},t.prototype.getStates=function(){var e=[];return this._peerConnections.forEach((function(t){var n=t.getState();n&&e.push(n)})),e},t.prototype.setConfiguration=function(e){return this._configuration&&(this._configurationDeferred=d.defer(),this._peerConnections.forEach((function(t){t.setConfiguration(e)}))),this._configuration=e,this._configurationDeferred.resolve(e),this},t.prototype.setIceReconnectTimeout=function(e){return null===this._sessionTimeout&&(this._peerConnections.forEach((function(t){t.setIceReconnectTimeout(e)})),this._sessionTimeout=e),this},t.prototype.setTrackSenders=function(e){var t=new Set(e.filter((function(e){return"data"===e.kind}))),n=new Set(e.filter((function(e){return e&&("audio"===e.kind||"video"===e.kind)}))),r=function(e,t,n){return{data:m(e,t),media:_(e,n)}}(this,t,n);return this._dataTrackSenders=t,this._mediaTrackSenders=n,function(e,t){(t.data.add.size||t.data.remove.size||t.media.add.size||t.media.remove.size)&&e._peerConnections.forEach((function(e){t.data.remove.forEach(e.removeDataTrackSender,e),t.media.remove.forEach(e.removeMediaTrackSender,e),t.data.add.forEach(e.addDataTrackSender,e),t.media.add.forEach(e.addMediaTrackSender,e),(t.media.add.size||t.media.remove.size||t.data.add.size&&!e.isApplicationSectionNegotiated)&&e.offer()}))}(this,r),this},t.prototype.update=function(e,t){var n=this;return void 0===t&&(t=!1),t&&this._closeAbsentPeerConnections(e),this._getConfiguration().then((function(t){return Promise.all(e.map((function(e){return n._closedPeerConnectionIds.has(e.id)?null:n._getOrCreate(e.id,t).update(e)})))})).then((function(){return n}))},t.prototype.getStats=function(){var e=Array.from(this._peerConnections.values());return Promise.all(e.map((function(e){return e.getStats().then((function(t){return[e.id,t]}))}))).then((function(e){return new Map(e)}))},t}(l);function f(e){return e.createMediaStreamDestination().stream.getAudioTracks()[0]}function m(e,t){return{add:d.difference(t,e._dataTrackSenders),remove:d.difference(e._dataTrackSenders,t)}}function _(e,t){return{add:d.difference(t,e._mediaTrackSenders),remove:d.difference(e._mediaTrackSenders,t)}}var g,v={new:0,checking:1,connecting:2,connected:3,completed:4,disconnected:-1,failed:-2,closed:-3};function y(e){return e.length?(g=g||Object.keys(v).reduce((function(e,t){var n;return Object.assign(e,((n={})[v[t]]=t,n))}),{}),e.reduce((function(e,t){return g[Math.max(v[e],v[t])]}))):"new"}function b(e){e._lastIceConnectionState=e.iceConnectionState,e._iceConnectionState=y(o([],i(e._peerConnections.values())).map((function(e){return e.iceConnectionState}))),e.iceConnectionState!==e._lastIceConnectionState&&e.emit("iceConnectionStateChanged")}function E(e){e._lastConnectionState=e.connectionState,e._connectionState=y(o([],i(e._peerConnections.values())).map((function(e){return e.connectionState}))),e.connectionState!==e._lastConnectionState&&e.emit("connectionStateChanged")}e.exports=p},5291:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(9996),o=1,a=function(e){function t(t,n){var r=e.call(this,t,"publisher_hints",n)||this;return r.on("ready",(function(e){r._log.debug("publisher_hints transport ready:",e),e.on("message",(function(e){if(r._log.debug("Incoming: ",e),"publisher_hints"===e.type)e.publisher&&e.publisher.hints&&e.publisher.id&&r._processPublisherHints(e.publisher.hints,e.publisher.id);else r._log.warn("Unknown message type: ",e.type)}))})),r}return r(t,e),t.prototype.sendTrackReplaced=function(e){var t=e.trackSid;if(this._transport){var n={type:"client_reset",track:t,id:o++};this._log.debug("Outgoing: ",n),this._transport.publish(n)}},t.prototype.sendHintResponse=function(e){var t=e.id,n=e.hints;if(this._transport){var r={type:"publisher_hints",id:t,hints:n};this._log.debug("Outgoing: ",r),this._transport.publish(r)}},t.prototype._processPublisherHints=function(e,t){try{this.emit("updated",e,t)}catch(n){this._log.error("error processing hints:",n)}},t}(i);e.exports=a},8849:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(){var t=e.call(this)||this;return Object.defineProperties(t,{_revision:{value:1,writable:!0}}),t}return r(t,e),t.prototype.update=function(e){return e.revision<this._revision?this:(this._revision=e.revision,this.enable(e.is_recording))},t}(n(3198));e.exports=i},7397:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(1274),o=n(6253),a=function(e){function t(t,n,r,i,a,s){var c=e.call(this,t.sid,t.identity)||this;return s=Object.assign({RemoteTrackPublicationV2:o},s),Object.defineProperties(c,{_revision:{writable:!0,value:null},_RemoteTrackPublicationV2:{value:s.RemoteTrackPublicationV2},_getInitialTrackSwitchOffState:{value:n},updateSubscriberTrackPriority:{value:function(e,t){return r(e,t)}},updateTrackRenderHint:{value:function(e,t){return i(e,t)}},clearTrackHint:{value:function(e){return a(e)}},revision:{enumerable:!0,get:function(){return this._revision}}}),c.update(t)}return r(t,e),t.prototype._getOrCreateTrack=function(e){var t=this._RemoteTrackPublicationV2,n=this.tracks.get(e.sid);n||(n=new t(e,this._getInitialTrackSwitchOffState(e.sid)),this.addTrack(n));return n},t.prototype.update=function(e){var t=this;if(null!==this.revision&&e.revision<=this.revision)return this;this._revision=e.revision;var n=new Set;switch(e.tracks.forEach((function(e){var r=t._getOrCreateTrack(e);r.update(e),n.add(r)})),this.tracks.forEach((function(e){n.has(e)||t.removeTrack(e)})),e.state){case"disconnected":this.disconnect();break;case"reconnecting":this.reconnecting();break;case"connected":this.connect(this.sid,this.identity)}return this},t}(i);e.exports=a},6253:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){return e.call(this,t.sid,t.name,t.kind,t.enabled,t.priority,n)||this}return r(t,e),t.prototype.update=function(e){return this.enable(e.enabled),this.setPriority(e.priority),this},t}(n(532));e.exports=i},5997:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(9996),o=n(2016),a=n(6803).isDeepEqual,s=1,c=function(e){function t(t,n){var r=e.call(this,t,"render_hints",n)||this;return Object.defineProperties(r,{_trackSidsToRenderHints:{value:new Map},_responseTimer:{value:new o((function(){r._sendAllHints(),r._responseTimer.setDelay(2*r._responseTimer.delay)}),2e3,!1)}}),r.on("ready",(function(e){e.on("message",(function(e){if(r._log.debug("Incoming: ",e),"render_hints"===e.type)r._processHintResults(e&&e.subscriber&&e.subscriber.hints||[]);else r._log.warn("Unknown message type: ",e.type)})),r._sendAllHints()})),r}return r(t,e),t.prototype._sendAllHints=function(){var e=this;Array.from(this._trackSidsToRenderHints.keys()).forEach((function(t){var n=e._trackSidsToRenderHints.get(t);n.renderDimensions&&(n.isDimensionDirty=!0),"enabled"in n&&(n.isEnabledDirty=!0)})),this._sendHints()},t.prototype._processHintResults=function(e){var t=this;this._responseTimer.clear(),this._responseTimer.setDelay(2e3),e.forEach((function(e){"OK"!==e.result&&t._log.debug("Server error processing hint:",e)})),this._sendHints()},t.prototype._sendHints=function(){var e=this;if(this._transport&&!this._responseTimer.isSet){var t=[];if(Array.from(this._trackSidsToRenderHints.keys()).forEach((function(n){var r=e._trackSidsToRenderHints.get(n);if(r.isEnabledDirty||r.isDimensionDirty){var i={track:n};r.isEnabledDirty&&(i.enabled=r.enabled,r.isEnabledDirty=!1),r.isDimensionDirty&&(i.render_dimensions=r.renderDimensions,r.isDimensionDirty=!1),t.push(i)}})),t.length>0){var n={type:"render_hints",subscriber:{id:s++,hints:t}};this._log.debug("Outgoing: ",n),this._transport.publish(n),this._responseTimer.start()}}},t.prototype.setTrackHint=function(e,t){var n=this._trackSidsToRenderHints.get(e)||{isEnabledDirty:!1,isDimensionDirty:!1};"enabled"in t&&n.enabled!==t.enabled&&(n.enabled=!!t.enabled,n.isEnabledDirty=!0),t.renderDimensions&&!a(t.renderDimensions,n.renderDimensions)&&(n.renderDimensions=t.renderDimensions,n.isDimensionDirty=!0),this._trackSidsToRenderHints.set(e,n),this._sendHints()},t.prototype.clearTrackHint=function(e){this._trackSidsToRenderHints.delete(e)},t}(i);e.exports=c},3963:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=n(2035),a=n(7817),s=n(1267),c=n(8849),l=n(8910),d=n(7397),u=n(5051),h=n(7037),p=n(2074),f=n(5997),m=n(5291),_=n(6803),g=_.constants.DEFAULT_SESSION_TIMEOUT_SEC,v=_.createBandwidthProfilePayload,y=_.defer,b=_.difference,E=_.filterObject,S=_.flatMap,T=_.oncePerTick,w=n(442),C=n(569).createTwilioError,R=function(e){function t(t,n,r,i,l){var _=this;n.options=Object.assign({session_timeout:g},n.options),l=Object.assign({DominantSpeakerSignaling:o,NetworkQualityMonitor:a,NetworkQualitySignaling:s,RecordingSignaling:c,RemoteParticipantV2:d,TrackPrioritySignaling:h,TrackSwitchOffSignaling:p,bandwidthProfile:null,sessionTimeout:1e3*n.options.session_timeout,statsPublishIntervalMs:1e4},l),t.setBandwidthProfile(l.bandwidthProfile);var v=n.options,y=v.signaling_region,w=v.audio_processors,C=void 0===w?[]:w;t.setSignalingRegion(y),C.includes("krisp")&&C.push("rnnoise"),t.setAudioProcessors(C),i.setIceReconnectTimeout(l.sessionTimeout);var R=function(e){return _._getTrackReceiver(e)},k=(_=e.call(this,t,n.sid,n.name,l)||this)._log;return Object.defineProperties(_,{_disconnectedParticipantRevisions:{value:new Map},_NetworkQualityMonitor:{value:l.NetworkQualityMonitor},_lastBandwidthProfileRevision:{value:t.bandwidthProfileRevision,writable:!0},_mediaStatesWarningsRevision:{value:0,writable:!0},_networkQualityMonitor:{value:null,writable:!0},_networkQualityConfiguration:{value:t.networkQualityConfiguration},_peerConnectionManager:{value:i},_published:{value:new Map},_publishedRevision:{value:0,writable:!0},_RemoteParticipantV2:{value:l.RemoteParticipantV2},_subscribed:{value:new Map},_subscribedRevision:{value:0,writable:!0},_subscriptionFailures:{value:new Map},_dominantSpeakerSignaling:{value:new l.DominantSpeakerSignaling(R,{log:k})},_networkQualitySignaling:{value:new l.NetworkQualitySignaling(R,t.networkQualityConfiguration,{log:k})},_renderHintsSignaling:{value:new f(R,{log:k})},_publisherHintsSignaling:{value:new m(R,{log:k})},_trackPrioritySignaling:{value:new l.TrackPrioritySignaling(R,{log:k})},_trackSwitchOffSignaling:{value:new l.TrackSwitchOffSignaling(R,{log:k})},_pendingSwitchOffStates:{value:new Map},_transport:{value:r},_trackReceiverDeferreds:{value:new Map},mediaRegion:{enumerable:!0,value:n.options.media_region||null}}),_._initTrackSwitchOffSignaling(),_._initDominantSpeakerSignaling(),_._initNetworkQualityMonitorSignaling(),_._initPublisherHintSignaling(),function(e,t){var n=T((function(){e._publishNewLocalParticipantState()})),r=T((function(){var n=S(t.tracks,(function(e){return e.trackTransceiver}));e._peerConnectionManager.setTrackSenders(n)}));t.on("trackAdded",r),t.on("trackRemoved",r),t.on("updated",n),e.on("stateChanged",(function i(o){"disconnected"===o&&(t.removeListener("trackAdded",r),t.removeListener("trackRemoved",r),t.removeListener("updated",n),e.removeListener("stateChanged",i),t.disconnect())})),e.on("signalingConnectionStateChanged",(function(){var t=e.localParticipant,n=e.signalingConnectionState,r=t.identity,i=t.sid;switch(n){case"connected":t.connect(i,r);break;case"reconnecting":t.reconnecting()}}))}(_,t),function(e,t){t.on("description",(function(t){e._publishPeerConnectionState(t)})),t.dequeue("description"),t.on("candidates",(function(t){e._publishPeerConnectionState(t)})),t.dequeue("candidates"),t.on("trackAdded",e._addTrackReceiver.bind(e)),t.dequeue("trackAdded"),t.getTrackReceivers().forEach(e._addTrackReceiver,e),t.on("connectionStateChanged",(function(){e.emit("connectionStateChanged")})),t.on("iceConnectionStateChanged",(function(){e.emit("iceConnectionStateChanged"),"failed"===e.iceConnectionState&&(null!==e.localParticipant.networkQualityLevel&&e.localParticipant.setNetworkQualityLevel(0),e.participants.forEach((function(e){null!==e.networkQualityLevel&&e.setNetworkQualityLevel(0)})))}))}(_,i),function(e,t){t.on("message",e._update.bind(e)),t.on("stateChanged",(function n(r,i){"disconnected"===r&&("disconnected"!==e.state&&e._disconnect(i),t.removeListener("stateChanged",n)),e.emit("signalingConnectionStateChanged")}))}(_,r),function(e,t,n){var r=new Map,i=!1,o=setInterval((function(){e.getStats().then((function(e){i=!i,e.forEach((function(e,n){var o=new u(n,e,!0);t.publishEvent("quality","stats-report","info",{audioTrackStats:o.remoteAudioTrackStats.map((function(t,n){return A(t,e.remoteAudioTrackStats[n],r)})),localAudioTrackStats:o.localAudioTrackStats.map((function(t,n){return N(t,e.localAudioTrackStats[n],r)})),localVideoTrackStats:o.localVideoTrackStats.map((function(t,n){return N(t,e.localVideoTrackStats[n],r)})),peerConnectionId:o.peerConnectionId,videoTrackStats:o.remoteVideoTrackStats.map((function(t,n){return A(t,e.remoteVideoTrackStats[n],r)}))});var a=S(["localAudioTrackStats","localVideoTrackStats","remoteAudioTrackStats","remoteVideoTrackStats"],(function(e){return o[e].map((function(e){var t=e.ssrc;return e.trackSid+"+"+t}))}));if(b(Array.from(r.keys()),a).forEach((function(e){return r.delete(e)})),i){var s=function(e,t){return e=Object.assign({availableIncomingBitrate:0,availableOutgoingBitrate:0,bytesReceived:0,bytesSent:0,consentRequestsSent:0,currentRoundTripTime:0,lastPacketReceivedTimestamp:0,lastPacketSentTimestamp:0,nominated:!1,peerConnectionId:t,priority:0,readable:!1,requestsReceived:0,requestsSent:0,responsesReceived:0,responsesSent:0,retransmissionsReceived:0,retransmissionsSent:0,state:"failed",totalRoundTripTime:0,transportId:"",writable:!1},E(e||{},null)),e.localCandidate=Object.assign({candidateType:"host",deleted:!1,ip:"",port:0,priority:0,protocol:"udp",url:""},E(e.localCandidate||{},null)),e.remoteCandidate=Object.assign({candidateType:"host",ip:"",port:0,priority:0,protocol:"udp",url:""},E(e.remoteCandidate||{},null)),e}(e.activeIceCandidatePair,o.peerConnectionId);t.publishEvent("quality","active-ice-candidate-pair","info",s)}}))}),(function(){}))}),n);e.on("stateChanged",(function t(n){"disconnected"===n&&(clearInterval(o),e.removeListener("stateChanged",t))}))}(_,r,l.statsPublishIntervalMs),_._update(n),_._peerConnectionManager.setEffectiveAdaptiveSimulcast(_._publisherHintsSignaling.isSetup),_}return r(t,e),Object.defineProperty(t.prototype,"connectionState",{get:function(){return this._peerConnectionManager.connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"signalingConnectionState",{get:function(){return"syncing"===this._transport.state?"reconnecting":this._transport.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iceConnectionState",{get:function(){return this._peerConnectionManager.iceConnectionState},enumerable:!1,configurable:!0}),t.prototype._deleteTrackReceiverDeferred=function(e){return this._trackReceiverDeferreds.delete(e)},t.prototype._getOrCreateTrackReceiverDeferred=function(e){var t=this._trackReceiverDeferreds.get(e)||y(),n=this._peerConnectionManager.getTrackReceivers().find((function(t){return t.id===e&&"ended"!==t.readyState}));return n?t.resolve(n):this._trackReceiverDeferreds.set(e,t),t},t.prototype._addTrackReceiver=function(e){return this._getOrCreateTrackReceiverDeferred(e.id).resolve(e),this},t.prototype._disconnect=function(t){var n=e.prototype._disconnect.call(this,t);return n&&(this._teardownNetworkQualityMonitor(),this._transport.disconnect(),this._peerConnectionManager.close()),this.localParticipant.tracks.forEach((function(e){e.publishFailed(t||new Error("LocalParticipant disconnected"))})),n},t.prototype._getTrackReceiver=function(e){var t=this;return this._getOrCreateTrackReceiverDeferred(e).promise.then((function(n){return t._deleteTrackReceiverDeferred(e),n}))},t.prototype._getInitialTrackSwitchOffState=function(e){var t=this._pendingSwitchOffStates.get(e)||!1;return this._pendingSwitchOffStates.delete(e),t&&this._log.warn("["+e+"] was initially switched off! "),t},t.prototype._getTrackSidsToTrackSignalings=function(){var e=S(this.participants,(function(e){return Array.from(e.tracks)}));return new Map(e)},t.prototype._getOrCreateRemoteParticipant=function(e){var t=this,n=this._RemoteParticipantV2,r=this.participants.get(e.sid),i=this;return r||((r=new n(e,(function(e){return t._getInitialTrackSwitchOffState(e)}),(function(e,n){return t._trackPrioritySignaling.sendTrackPriorityUpdate(e,"subscribe",n)}),(function(e,n){return t._renderHintsSignaling.setTrackHint(e,n)}),(function(e){return t._renderHintsSignaling.clearTrackHint(e)}))).on("stateChanged",(function e(t){"disconnected"===t&&(r.removeListener("stateChanged",e),i.participants.delete(r.sid),i._disconnectedParticipantRevisions.set(r.sid,r.revision))})),this.connectParticipant(r)),r},t.prototype._getState=function(){return{participant:this.localParticipant.getState()}},t.prototype._maybeAddBandwidthProfile=function(e){var t=this.localParticipant,n=t.bandwidthProfile,r=t.bandwidthProfileRevision;return n&&this._lastBandwidthProfileRevision<r?(this._lastBandwidthProfileRevision=r,Object.assign({bandwidth_profile:v(n)},e)):e},t.prototype._publishNewLocalParticipantState=function(){this._transport.publish(this._maybeAddBandwidthProfile(this._getState()))},t.prototype._publishPeerConnectionState=function(e){this._transport.publish(Object.assign({peer_connections:[e]},this._getState()))},t.prototype._update=function(e){var t=this;if(e.subscribed&&e.subscribed.revision>this._subscribedRevision){this._subscribedRevision=e.subscribed.revision,e.subscribed.tracks.forEach((function(e){e.id?(t._subscriptionFailures.delete(e.sid),t._subscribed.set(e.sid,e.id)):e.error&&!t._subscriptionFailures.has(e.sid)&&t._subscriptionFailures.set(e.sid,e.error)}));var n=new Set(e.subscribed.tracks.filter((function(e){return!!e.id})).map((function(e){return e.sid})));this._subscribed.forEach((function(e,r){n.has(r)||t._subscribed.delete(r)}))}var r=new Set;return(e.participants||[]).forEach((function(e){if(e.sid!==t.localParticipant.sid){var n=t._disconnectedParticipantRevisions.get(e.sid);if(!(n&&e.revision<=n)){n&&t._disconnectedParticipantRevisions.delete(e.sid);var i=t._getOrCreateRemoteParticipant(e);i.update(e),r.add(i)}}})),"synced"===e.type&&this.participants.forEach((function(e){r.has(e)||e.disconnect()})),function(e){var t=e._getTrackSidsToTrackSignalings();e._subscriptionFailures.forEach((function(n,r){var i=t.get(r);i&&(e._subscriptionFailures.delete(r),i.subscribeFailed(C(n.code,n.message)))})),t.forEach((function(t){var n=e._subscribed.get(t.sid);(!n||t.isSubscribed&&t.trackTransceiver.id!==n)&&t.setTrackTransceiver(null),n&&e._getTrackReceiver(n).then((function(e){return t.setTrackTransceiver(e)}))}))}(this),e.peer_connections&&this._peerConnectionManager.update(e.peer_connections,"synced"===e.type),e.recording&&this.recording.update(e.recording),e.published&&e.published.revision>this._publishedRevision&&(this._publishedRevision=e.published.revision,e.published.tracks.forEach((function(e){e.sid&&t._published.set(e.id,e.sid)})),this.localParticipant.update(e.published)),e.participant&&this.localParticipant.connect(e.participant.sid,e.participant.identity),[this._dominantSpeakerSignaling,this._networkQualitySignaling,this._trackPrioritySignaling,this._trackSwitchOffSignaling,this._renderHintsSignaling,this._publisherHintsSignaling].forEach((function(t){var n=t.channel;!t.isSetup&&e.media_signaling&&e.media_signaling[n]&&e.media_signaling[n].transport&&"data-channel"===e.media_signaling[n].transport.type&&t.setup(e.media_signaling[n].transport.label)})),"warning"===e.type&&e.states&&e.states.revision>this._mediaStatesWarningsRevision&&(this._mediaStatesWarningsRevision=e.states.revision,this.localParticipant.updateMediaStates(e.states)),this},t.prototype._initPublisherHintSignaling=function(){var e=this;this._publisherHintsSignaling.on("updated",(function(t,n){Promise.all(t.map((function(t){return e.localParticipant.setPublisherHint(t.track,t.encodings).then((function(e){return{track:t.track,result:e}}))}))).then((function(t){e._publisherHintsSignaling.sendHintResponse({id:n,hints:t})}))}));var t=function(t){"video"===t.kind&&t.trackTransceiver.on("replaced",(function(){e._publisherHintsSignaling.sendTrackReplaced({trackSid:t.sid})}))};Array.from(this.localParticipant.tracks.values()).forEach((function(e){return t(e)})),this.localParticipant.on("trackAdded",(function(e){return t(e)}))},t.prototype._initTrackSwitchOffSignaling=function(){var e=this;this._trackSwitchOffSignaling.on("updated",(function(t,n){try{e._log.debug("received trackSwitch: ",{tracksOn:n,tracksOff:t});var r=new Map;n.forEach((function(e){return r.set(e,!0)})),t.forEach((function(t){r.get(t)&&e._log.warn(t+" is DUPLICATED in both tracksOff and tracksOn list"),r.set(t,!1)})),e.participants.forEach((function(e){e.tracks.forEach((function(e){var t=r.get(e.sid);"undefined"!==typeof t&&(e.setSwitchedOff(!t),r.delete(e.sid))}))})),r.forEach((function(t,n){return e._pendingSwitchOffStates.set(n,!t)}))}catch(i){e._log.error("error processing track switch off:",i)}}))},t.prototype._initDominantSpeakerSignaling=function(){var e=this;this._dominantSpeakerSignaling.on("updated",(function(){return e.setDominantSpeaker(e._dominantSpeakerSignaling.loudestParticipantSid)}))},t.prototype._initNetworkQualityMonitorSignaling=function(){var e=this;this._networkQualitySignaling.on("ready",(function(){var t=new e._NetworkQualityMonitor(e._peerConnectionManager,e._networkQualitySignaling);e._networkQualityMonitor=t,t.on("updated",(function(){"failed"!==e.iceConnectionState&&(e.localParticipant.setNetworkQualityLevel(t.level,t.levels),e.participants.forEach((function(e){var n=t.remoteLevels.get(e.sid);n&&e.setNetworkQualityLevel(n.level,n)})))})),t.start()})),this._networkQualitySignaling.on("teardown",(function(){return e._teardownNetworkQualityMonitor()}))},t.prototype._teardownNetworkQualityMonitor=function(){this._networkQualityMonitor&&(this._networkQualityMonitor.stop(),this._networkQualityMonitor=null)},t.prototype.getStats=function(){var e=this;return this._peerConnectionManager.getStats().then((function(t){return new Map(Array.from(t).map((function(t){var n=i(t,2),r=n[0],o=n[1];return[r,Object.assign({},o,{localAudioTrackStats:O(e,o.localAudioTrackStats),localVideoTrackStats:O(e,o.localVideoTrackStats),remoteAudioTrackStats:I(e,o.remoteAudioTrackStats),remoteVideoTrackStats:I(e,o.remoteVideoTrackStats)})]})))}))},t}(l);function k(e,t){return t.reduce((function(t,n){var r=e.get(n.trackId);return r?[Object.assign({},n,{trackSid:r})].concat(t):t}),[])}function O(e,t){return k(e._published,t)}function I(e,t){var n=new Map(Array.from(e._subscribed.entries()).map((function(e){var t=i(e,2),n=t[0];return[t[1],n]})));return k(n,t)}function N(e,t,n){var r=t.framesEncoded,i=t.packetsSent,o=t.totalEncodeTime,a=t.totalPacketSendDelay,s=Object.assign({},e),c=e.trackSid+"+"+e.ssrc,l=n.get(c)||new Map;if("number"===typeof o&&"number"===typeof r){var d=l.get("avgEncodeDelay")||new w;d.putSample(1e3*o,r),s.avgEncodeDelay=Math.round(d.get()),l.set("avgEncodeDelay",d)}if("number"===typeof a&&"number"===typeof i){var u=l.get("avgPacketSendDelay")||new w;u.putSample(1e3*a,i),s.avgPacketSendDelay=Math.round(u.get()),l.set("avgPacketSendDelay",u)}return n.set(c,l),s}function A(e,t,n){var r=t.estimatedPlayoutTimestamp,i=t.framesDecoded,o=t.jitterBufferDelay,a=t.jitterBufferEmittedCount,s=t.totalDecodeTime,c=Object.assign({},e),l=e.trackSid+"+"+e.ssrc,d=n.get(l)||new Map;if("number"===typeof r&&(c.estimatedPlayoutTimestamp=r),"number"===typeof i&&"number"===typeof s){var u=d.get("avgDecodeDelay")||new w;u.putSample(1e3*s,i),c.avgDecodeDelay=Math.round(u.get()),d.set("avgDecodeDelay",u)}if("number"===typeof o&&"number"===typeof a){var h=d.get("avgJitterBufferDelay")||new w;h.putSample(1e3*o,a),c.avgJitterBufferDelay=Math.round(h.get()),d.set("avgJitterBufferDelay",h)}return n.set(l,d),c}e.exports=R},7037:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){var r=e.call(this,t,"track_priority",n)||this;return Object.defineProperties(r,{_enqueuedPriorityUpdates:{value:new Map}}),r.on("ready",(function(e){Array.from(r._enqueuedPriorityUpdates.keys()).forEach((function(t){e.publish({type:"track_priority",track:t,subscribe:r._enqueuedPriorityUpdates.get(t)})}))})),r}return r(t,e),t.prototype.sendTrackPriorityUpdate=function(e,t,n){if("subscribe"!==t)throw new Error("only subscribe priorities are supported, found: "+t);this._enqueuedPriorityUpdates.set(e,n),this._transport&&this._transport.publish({type:"track_priority",track:e,subscribe:n})},t}(n(9996));e.exports=i},2074:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){var r=e.call(this,t,"track_switch_off",n)||this;return r.on("ready",(function(e){e.on("message",(function(e){if("track_switch_off"===e.type)r._setTrackSwitchOffUpdates(e.off||[],e.on||[])}))})),r}return r(t,e),t.prototype._setTrackSwitchOffUpdates=function(e,t){this.emit("updated",e,t)},t}(n(9996));e.exports=i},9263:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(6546),o=n(896),a=n(2935),s=n(6262).reconnectBackoffConfig,c=n(2016),l=n(6262),d=l.SDK_NAME,u=l.SDK_VERSION,h=l.SDP_FORMAT,p=n(6803),f=p.createBandwidthProfilePayload,m=p.createMediaSignalingPayload,_=p.createMediaWarningsPayload,g=p.createSubscribePayload,v=p.getUserAgent,y=p.isNonArrayObject,b=n(569),E=b.createTwilioError,S=b.RoomCompletedError,T=b.SignalingConnectionError,w=b.SignalingServerBusyError,C={connecting:["connected","disconnected"],connected:["disconnected","syncing"],syncing:["connected","disconnected"],disconnected:[]},R=function(e){function t(t,n,r,i,c,l){var d;return l=Object.assign({Backoff:a,TwilioConnection:o,iceServers:null,trackPriority:!0,trackSwitchOff:!0,renderHints:!0,userAgent:v()},l),d=e.call(this,"connecting",C)||this,Object.defineProperties(d,{_accessToken:{value:n},_automaticSubscription:{value:l.automaticSubscription},_bandwidthProfile:{value:l.bandwidthProfile},_dominantSpeaker:{value:l.dominantSpeaker},_adaptiveSimulcast:{value:l.adaptiveSimulcast},_eventObserver:{value:l.eventObserver,writable:!1},_renderHints:{value:l.renderHints},_iceServersStatus:{value:Array.isArray(l.iceServers)?"overrode":"acquire"},_localParticipant:{value:r},_name:{value:t},_networkQuality:{value:y(l.networkQuality)||l.networkQuality},_notifyWarnings:{value:l.notifyWarnings},_options:{value:l},_peerConnectionManager:{value:i},_sessionTimer:{value:null,writable:!0},_sessionTimeoutMS:{value:0,writable:!0},_reconnectBackoff:{value:new l.Backoff(s)},_session:{value:null,writable:!0},_trackPriority:{value:l.trackPriority},_trackSwitchOff:{value:l.trackSwitchOff},_twilioConnection:{value:null,writable:!0},_updatesReceived:{value:[]},_updatesToSend:{value:[]},_userAgent:{value:l.userAgent},_wsServer:{value:c}}),function(e){function t(){if("disconnected"!==e.state){e._twilioConnection&&e._twilioConnection.removeListener("message",r);var t=e._iceServersStatus,i=e._options,o=e._wsServer,a=e.state,s=i.TwilioConnection,c=new s(o,Object.assign({helloBody:"connecting"===a&&"acquire"===t?e._createIceMessage():e._createConnectOrSyncOrDisconnectMessage()},i));c.once("close",(function(e){e===s.CloseReason.LOCAL?n():n(new Error(e))})),c.on("message",r),e._twilioConnection=c}}function n(n){if("disconnected"!==e.state)if(n){var r=e._getReconnectTimer();if(r)"connected"===e.state&&e.preempt("syncing"),r.then(t);else{var i=n.message===o.CloseReason.BUSY?new w:new T;e.disconnect(i)}}else e.disconnect()}function r(t){if("disconnected"!==e.state)if("error"!==t.type)switch(e.state){case"connected":switch(t.type){case"connected":case"synced":case"update":case"warning":return void e.emit("message",t);case"disconnected":return void e.disconnect("completed"===t.status?new S:null);default:return}case"connecting":switch(t.type){case"iced":return void e._options.onIced(t.ice_servers).then((function(){e._sendConnectOrSyncOrDisconnectMessage()}));case"connected":return e._setSession(t.session,t.options.session_timeout),e.emit("connected",t),void e.preempt("connected");case"synced":case"update":return void e._updatesReceived.push(t);case"disconnected":return void e.disconnect("completed"===t.status?new S:null);default:return}case"syncing":switch(t.type){case"connected":case"update":return void e._updatesReceived.push(t);case"synced":return e._clearReconnectTimer(),e.emit("message",t),void e.preempt("connected");case"disconnected":return void e.disconnect("completed"===t.status?new S:null);default:return}default:return}else e.disconnect(E(t.code,t.message))}e.on("stateChanged",(function t(n){switch(n){case"connected":var i=e._updatesToSend.splice(0);return i.length&&e.publish(function(e){return e.reduce((function(e,t){return(!e.participant&&t.participant||e.participant&&t.participant&&t.participant.revision>e.participant.revision)&&(e.participant=t.participant),!e.peer_connections&&t.peer_connections?e.peer_connections=k(t.peer_connections):e.peer_connections&&t.peer_connections&&(e.peer_connections=k(e.peer_connections.concat(t.peer_connections))),e}),{})}(i)),void e._updatesReceived.splice(0).forEach((function(t){return e.emit("message",t)}));case"disconnected":return e._twilioConnection.removeListener("message",r),void e.removeListener("stateChanged",t);default:return}}));var i=e._options,a=e._iceServersStatus,s=i.iceServers,c=i.onIced;"overrode"===a?c(s).then(t):t()}(d),d}return r(t,e),t.prototype._createConnectOrSyncOrDisconnectMessage=function(){if("connected"===this.state)return null;if("disconnected"===this.state)return{session:this._session,type:"disconnect",version:2};var e={connecting:"connect",syncing:"sync"}[this.state],t={name:this._name,participant:this._localParticipant.getState(),peer_connections:this._peerConnectionManager.getStates(),type:e,version:2};return"connect"===t.type?(t.ice_servers=this._iceServersStatus,t.publisher={name:d,sdk_version:u,user_agent:this._userAgent},this._bandwidthProfile&&(t.bandwidth_profile=f(this._bandwidthProfile)),this._notifyWarnings&&(t.participant.media_warnings=_(this._notifyWarnings)),t.media_signaling=m(this._dominantSpeaker,this._networkQuality,this._trackPriority,this._trackSwitchOff,this._adaptiveSimulcast,this._renderHints),t.subscribe=g(this._automaticSubscription),t.format=h,t.token=this._accessToken):"sync"===t.type?(t.session=this._session,t.token=this._accessToken):"update"===t.type&&(t.session=this._session),t},t.prototype._createIceMessage=function(){return{edge:"roaming",token:this._accessToken,type:"ice",version:1}},t.prototype._sendConnectOrSyncOrDisconnectMessage=function(){var e=this._createConnectOrSyncOrDisconnectMessage();e&&this._twilioConnection.sendMessage(e)},t.prototype.disconnect=function(e){return"disconnected"!==this.state&&(this.preempt("disconnected",null,[e]),this._sendConnectOrSyncOrDisconnectMessage(),this._twilioConnection.close(),!0)},t.prototype.publish=function(e){switch(this.state){case"connected":return this._twilioConnection.sendMessage(Object.assign({session:this._session,type:"update",version:2},e)),!0;case"connecting":case"syncing":return this._updatesToSend.push(e),!0;default:return!1}},t.prototype.publishEvent=function(e,t,n,r){this._eventObserver.emit("event",{group:e,name:t,level:n,payload:r})},t.prototype.sync=function(){return"connected"===this.state&&(this.preempt("syncing"),this._sendConnectOrSyncOrDisconnectMessage(),!0)},t.prototype._setSession=function(e,t){this._session=e,this._sessionTimeoutMS=1e3*t},t.prototype._getReconnectTimer=function(){var e=this;return 0===this._sessionTimeoutMS?null:(this._sessionTimer||(this._sessionTimer=new c((function(){e._sessionTimer&&(e._sessionTimeoutMS=0)}),this._sessionTimeoutMS)),new Promise((function(t){e._reconnectBackoff.backoff(t)})))},t.prototype._clearReconnectTimer=function(){this._reconnectBackoff.reset(),this._sessionTimer&&(this._sessionTimer.clear(),this._sessionTimer=null)},t}(i);function k(e){return Array.from(e.reduce((function(e,t){var n=e.get(t.id)||t;return(!n.description&&t.description||n.description&&t.description&&t.description.revision>n.description.revision)&&(n.description=t.description),(!n.ice&&t.ice||n.ice&&t.ice&&t.ice.revision>n.ice.revision)&&(n.ice=t.ice),e.set(n.id,n),e}),new Map).values())}e.exports=R},6546:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=n(7284).EventEmitter,s=n(6803),c=function(e){function t(t,n){var r,i=e.call(this)||this,o=null,a=t;return n=function(e){var t=new Map;for(var n in e)t.set(n,new Set(e[n]));return t}(n),Object.defineProperties(i,{_lock:{get:function(){return o},set:function(e){o=e}},_reachableStates:{value:(r=n,Array.from(r.keys()).reduce((function(e,t){return e.set(t,d(r,t))}),new Map))},_state:{get:function(){return a},set:function(e){a=e}},_states:{value:n},_whenDeferreds:{value:new Set},isLocked:{enumerable:!0,get:function(){return null!==o}},state:{enumerable:!0,get:function(){return a}}}),i.on("stateChanged",(function(e){i._whenDeferreds.forEach((function(t){t.when(e,t.resolve,t.reject)}))})),i}return r(t,e),t.prototype._whenPromise=function(e){var t=this;if("function"!==typeof e)return Promise.reject(new Error("when() executor must be a function"));var n=s.defer();return n.when=e,this._whenDeferreds.add(n),n.promise.then((function(e){return t._whenDeferreds.delete(n),e}),(function(e){throw t._whenDeferreds.delete(n),e}))},t.prototype.bracket=function(e,t){var n,r=this;function i(e){if(r.hasLock(n)&&r.releaseLockCompletely(n),e)throw e}return this.takeLock(e).then((function(e){return t(n=e)})).then((function(e){return i(),e}),i)},t.prototype.hasLock=function(e){return this._lock===e},t.prototype.preempt=function(e,t,n){if(!l(this._states,this.state,e))throw new Error('Cannot transition from "'+this.state+'" to "'+e+'"');var r;this.isLocked&&(r=this._lock,this._lock=null);var i=null;t&&(i=this.takeLockSync(t));var o=i?null:this.takeLockSync("preemption");return this.transition(e,i||o,n),r&&r.resolve(),o&&this.releaseLock(o),i},t.prototype.releaseLock=function(e){if(!this.isLocked)throw new Error("Could not release the lock for "+e.name+" because the StateMachine is not locked");if(!this.hasLock(e))throw new Error("Could not release the lock for "+e.name+" because "+this._lock.name+" has the lock");0===e.depth?(this._lock=null,e.resolve()):e.depth--},t.prototype.releaseLockCompletely=function(e){if(!this.isLocked)throw new Error("Could not release the lock for "+e.name+" because the StateMachine is not locked");if(!this.hasLock(e))throw new Error("Could not release the lock for "+e.name+" because "+this._lock.name+" has the lock");e.depth=0,this._lock=null,e.resolve()},t.prototype.takeLock=function(e){var t=this;if("object"===typeof e){var n=e;return new Promise((function(e){e(t.takeLockSync(n))}))}var r=e;if(this.isLocked){var i=this.takeLock.bind(this,r);return this._lock.promise.then(i)}return Promise.resolve(this.takeLockSync(r))},t.prototype.takeLockSync=function(e){var t="string"===typeof e?null:e,n=t?t.name:e;if(t&&!this.hasLock(t)||!t&&this.isLocked)throw new Error("Could not take the lock for "+n+" because the lock for "+this._lock.name+" was not released");if(t)return t.depth++,t;var r=function(e){var t=s.defer();return t.name=e,t.depth=0,t}(n);return this._lock=r,r},t.prototype.transition=function(e,t,n){if(n=n||[],this.isLocked){if(!t)throw new Error("You must provide the key in order to transition");if(!this.hasLock(t))throw new Error("Could not transition using the key for "+t.name+" because "+this._lock.name+" has the lock")}else if(t)throw new Error("Key provided for "+t.name+", but the StateMachine was not locked (possibly due to preemption)");if(!l(this._states,this.state,e))throw new Error('Cannot transition from "'+this.state+'" to "'+e+'"');this._state=e,this.emit.apply(this,o([],i(["stateChanged",e].concat(n))))},t.prototype.tryTransition=function(e,t,n){try{this.transition(e,t,n)}catch(r){return!1}return!0},t.prototype.when=function(e){var t=this;return this.state===e?Promise.resolve(this):l(this._reachableStates,this.state,e)?this._whenPromise((function(n,r,i){n===e?r(t):l(t._reachableStates,n,e)||i(u(n,e))})):Promise.reject(u(this.state,e))},t}(a);function l(e,t,n){return e.get(t).has(n)}function d(e,t,n){return n=n||new Set,e.get(t).forEach((function(t){n.has(t)||(n.add(t),d(e,t,n).forEach(n.add,n))})),n}function u(e,t){return new Error('"'+t+'" cannot be reached from "'+e+'"')}e.exports=c},8409:e=>{"use strict";e.exports=function(e){return(e=e.filter((function(e){return"number"===typeof e}))).length<1?void 0:e.reduce((function(e,t){return t+e}))/e.length}},9403:e=>{"use strict";var t=function(){function e(e,t,n,r){Object.defineProperties(this,{availableSend:{enumerable:!0,value:n},recv:{enumerable:!0,value:t},rtt:{enumerable:!0,value:r},send:{enumerable:!0,value:e}})}return e.of=function(t,n){var r=(n.timestamp-t.timestamp)/1e3,i=n.bytesSent-t.bytesSent,o=n.bytesReceived-t.bytesReceived;return new e(r>0?i/r*8:0,r>0?o/r*8:0,n.availableOutgoingBitrate,n.currentRoundTripTime)},e}();e.exports=t},2725:(e,t,n)=>{"use strict";var r=n(9403),i=function(){function e(){Object.defineProperties(this,{lastReport:{enumerable:!0,value:new r(0,0),writable:!0},lastStats:{enumerable:!0,value:null,writable:!0}})}return e.prototype.next=function(e){var t=this.lastStats;if(this.lastStats=e,t){var n=t.id===e.id?r.of(t,e):new r(0,0);this.lastReport=n}return this.lastReport},e}();e.exports=i},7737:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return Object.defineProperties(i,{audioLevel:{value:"number"===typeof n.audioInputLevel?n.audioInputLevel:null,enumerable:!0},jitter:{value:"number"===typeof n.jitter?n.jitter:null,enumerable:!0}}),i}return r(t,e),t}(n(4799));e.exports=i},4799:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return Object.defineProperties(i,{bytesSent:{value:"number"===typeof n.bytesSent?n.bytesSent:r?0:null,enumerable:!0},packetsSent:{value:"number"===typeof n.packetsSent?n.packetsSent:r?0:null,enumerable:!0},roundTripTime:{value:"number"===typeof n.roundTripTime?n.roundTripTime:r?0:null,enumerable:!0}}),i}return r(t,e),t}(n(3690));e.exports=i},2128:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this,o=null;"number"===typeof n.frameWidthInput&&"number"===typeof n.frameHeightInput&&(o={},Object.defineProperties(o,{width:{value:n.frameWidthInput,enumerable:!0},height:{value:n.frameHeightInput,enumerable:!0}}));var a=null;return"number"===typeof n.frameWidthSent&&"number"===typeof n.frameHeightSent&&(a={},Object.defineProperties(a,{width:{value:n.frameWidthSent,enumerable:!0},height:{value:n.frameHeightSent,enumerable:!0}})),Object.defineProperties(i,{captureDimensions:{value:o,enumerable:!0},dimensions:{value:a,enumerable:!0},captureFrameRate:{value:"number"===typeof n.frameRateInput?n.frameRateInput:null,enumerable:!0},frameRate:{value:"number"===typeof n.frameRateSent?n.frameRateSent:null,enumerable:!0}}),i}return r(t,e),t}(n(4799));e.exports=i},9410:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t}(n(4524));e.exports=i},4975:e=>{"use strict";var t=function(e){var t=e.actual,n=void 0===t?null:t,r=e.available,i=void 0===r?null:r,o=e.level,a=void 0===o?null:o;Object.defineProperties(this,{actual:{value:n,enumerable:!0},available:{value:i,enumerable:!0},level:{value:a,enumerable:!0}})};e.exports=t},6312:e=>{"use strict";var t=function(e){var t=e.fractionLost,n=void 0===t?null:t,r=e.level,i=void 0===r?null:r;Object.defineProperties(this,{fractionLost:{value:n,enumerable:!0},level:{value:i,enumerable:!0}})};e.exports=t},3698:e=>{"use strict";var t=function(e){var t=e.jitter,n=void 0===t?null:t,r=e.rtt,i=void 0===r?null:r,o=e.level,a=void 0===o?null:o;Object.defineProperties(this,{jitter:{value:n,enumerable:!0},rtt:{value:i,enumerable:!0},level:{value:a,enumerable:!0}})};e.exports=t},4524:(e,t,n)=>{"use strict";var r=n(5694),i=n(6320),o=function(e){var t=e.send,n=e.recv,o=e.sendStats,a=void 0===o?null:o,s=e.recvStats,c=void 0===s?null:s;Object.defineProperties(this,{send:{value:t,enumerable:!0},recv:{value:n,enumerable:!0},sendStats:{value:a?new r(a):null,enumerable:!0},recvStats:{value:c?new i(c):null,enumerable:!0}})};e.exports=o},6320:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t}(n(4533));e.exports=i},4533:(e,t,n)=>{"use strict";var r=n(4975),i=n(6312),o=n(3698),a=function(e){var t=e.bandwidth,n=void 0===t?null:t,a=e.fractionLost,s=void 0===a?null:a,c=e.latency,l=void 0===c?null:c;Object.defineProperties(this,{bandwidth:{value:n?new r(n):null,enumerable:!0},fractionLost:{value:s?new i(s):null,enumerable:!0},latency:{value:l?new o(l):null,enumerable:!0}})};e.exports=a},5694:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t}(n(4533));e.exports=i},4440:(e,t,n)=>{"use strict";var r=n(9410),i=n(6033),o=function(e){var t=e.level,n=e.audio,o=e.video;Object.defineProperties(this,{level:{value:t,enumerable:!0},audio:{value:n?new r(n):null,enumerable:!0},video:{value:o?new i(o):null,enumerable:!0}})};e.exports=o},6033:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t}(n(4524));e.exports=i},7238:(e,t,n)=>{"use strict";var r=n(7499),i=n(8299),o=function(){function e(e,t,n){Object.defineProperties(this,{ice:{enumerable:!0,value:e},audio:{enumerable:!0,value:t},video:{enumerable:!0,value:n}})}return e.prototype.summarize=function(){var e=this.audio.send.concat(this.video.send),t=i.summarize(e),n=this.audio.recv.concat(this.video.recv),o=r.summarize(n);return{ice:this.ice,send:t,recv:o,audio:{send:i.summarize(this.audio.send),recv:r.summarize(this.audio.recv)},video:{send:i.summarize(this.video.send),recv:r.summarize(this.video.recv)}}},e}();e.exports=o},5278:function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},o=this&&this.__values||function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=n(295).guessBrowser,s=n(2725),c=n(7238),l=n(1909),d=n(5941),u=function(){function e(e){Object.defineProperties(this,{pc:{enumerable:!0,value:e},ice:{enumerable:!0,value:new s},audio:{enumerable:!0,value:{send:new Map,recv:new Map}},video:{enumerable:!0,value:{send:new Map,recv:new Map}},lastReport:{enumerable:!0,value:null,writable:!0}})}return e.prototype.next=function(){var e,t=this,n="firefox"===a()?function(e){var t=e.pc.getTransceivers().filter((function(e){return e.currentDirection&&e.currentDirection.match(/send/)&&e.sender.track})).map((function(e){return e.sender})),n=e.pc.getTransceivers().filter((function(e){return e.currentDirection&&e.currentDirection.match(/recv/)})).map((function(e){return e.receiver}));return Promise.all([h(t),h(n),e.pc.getStats()]).then((function(t){var n=r(t,3),i=n[0],o=n[1],a=n[2],s=f(e),c=v(e);i.forEach((function(t,n){return b(e,t,c,n)})),S(s,c);var l=m(e),d=y(e);o.forEach((function(t,n){return E(e,t,d,n)})),S(l,d),T(e.ice,a)}))}(this):(e=this).pc.getStats().then((function(t){var n=f(e),r=v(e);b(e,t,r),S(n,r);var i=m(e),o=y(e);E(e,t,o),S(i,o),T(e.ice,t)}));return n.then((function(){var e=i([],r(t.audio.send.values())),n=i([],r(t.video.send.values())),o=i([],r(t.audio.recv.values())),a=i([],r(t.video.recv.values())),s=new c(t.ice.lastReport,{send:e.map((function(e){return e.lastReport})).filter((function(e){return e})),recv:o.map((function(e){return e.lastReport})).filter((function(e){return e}))},{send:n.map((function(e){return e.lastReport})).filter((function(e){return e})),recv:a.map((function(e){return e.lastReport})).filter((function(e){return e}))});return t.lastReport=s,s}))},e}();function h(e){return Promise.all(e.map((function(e){var t=e.track.id;return e.getStats().then((function(e){var n,r;try{for(var i=o(e.values()),a=i.next();!a.done;a=i.next()){var s=a.value;"inbound-rtp"===s.type&&(s.id=t+"-"+s.id)}}catch(c){n={error:c}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return[t,e]}))}))).then((function(e){return new Map(e)}))}function p(e,t,n,r,i){var o=t[r.mediaType];if(!i){var a=n.get(r.trackId);a&&(i=a.trackIdentifier)}if(o&&i){if(o.has(r.id))return o.get(r.id);var s=new e(i,r);o.set(r.id,s)}return null}function f(e){return{audio:e.audio.send,video:e.video.send}}function m(e){return{audio:e.audio.recv,video:e.video.recv}}function _(e,t,n,r){return p(d,f(e),t,n,r)}function g(e,t,n,r){return p(l,m(e),t,n,r)}function v(e){return{audio:new Set(e.audio.send.keys()),video:new Set(e.video.send.keys())}}function y(e){return{audio:new Set(e.audio.recv.keys()),video:new Set(e.video.recv.keys())}}function b(e,t,n,r){var i,s;try{for(var c=o(t.values()),l=c.next();!l.done;l=c.next()){var d=l.value;if("outbound-rtp"===d.type&&!d.isRemote){if("firefox"!==a()&&!d.trackId)continue;var u=n[d.mediaType];u&&u.delete(d.id);var h=_(e,t,d,r);if(h){var p=t.get(d.remoteId);h.next(r||h.trackId,d,p)}}}}catch(f){i={error:f}}finally{try{l&&!l.done&&(s=c.return)&&s.call(c)}finally{if(i)throw i.error}}}function E(e,t,n,r){var i,a;try{for(var s=o(t.values()),c=s.next();!c.done;c=s.next()){var l=c.value;if("inbound-rtp"===l.type&&!l.isRemote){var d=n[l.mediaType];d&&d.delete(l.id);var u=g(e,t,l,r);u&&u.next(r||u.trackId,l)}}}catch(h){i={error:h}}finally{try{c&&!c.done&&(a=s.return)&&a.call(s)}finally{if(i)throw i.error}}}function S(e,t){var n=function(n){var r=e[n];t[n].forEach((function(e){return r.delete(e)}))};for(var r in t)n(r)}function T(e,t){var n,r,i,a,s;try{for(var c=o(t.values()),l=c.next();!l.done;l=c.next()){"transport"===(h=l.value).type&&(s=t.get(h.selectedCandidatePairId))}}catch(p){n={error:p}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}if(s)e.next(s);else try{for(var d=o(t.values()),u=d.next();!u.done;u=d.next()){var h;"candidate-pair"!==(h=u.value).type||!h.nominated||"selected"in h&&!h.selected||e.next(h)}}catch(f){i={error:f}}finally{try{u&&!u.done&&(a=d.return)&&a.call(d)}finally{if(i)throw i.error}}}e.exports=u},7499:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(8409),o=n(1595),a=n(2913),s=function(e){function t(t,n,r,i,o,a,s){var c=e.call(this,t,n,r)||this,l=o>0?i/o:0;return Object.defineProperties(c,{deltaPacketsLost:{enumerable:!0,value:i},deltaPacketsReceived:{enumerable:!0,value:o},fractionLost:{enumerable:!0,value:a},jitter:{enumerable:!0,value:s},phonyFractionLost:{enumerable:!0,value:l}}),c}return r(t,e),t.of=function(e,n,r){if(n.id!==r.id)throw new Error("RTCStats IDs must match");var i=(r.timestamp-n.timestamp)/1e3,o=r.bytesReceived-n.bytesReceived,a=i>0?o/i*8:0,s=Math.max(r.packetsLost-n.packetsLost,0),c=r.packetsReceived-n.packetsReceived,l=r.fractionLost,d=r.jitter;return new t(n.id,e,a,s,c,l,d)},t.summarize=function(e){var t=e.map((function(e){return e.summarize()}));return{bitrate:a(t.map((function(e){return e.bitrate}))),fractionLost:i(t.map((function(e){return e.fractionLost}))),jitter:i(t.map((function(e){return e.jitter})))}},t.prototype.summarize=function(){return{bitrate:this.bitrate,fractionLost:"number"===typeof this.fractionLost?this.fractionLost:this.phonyFractionLost,jitter:this.jitter}},t}(o);e.exports=s},1909:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(7499),o=function(e){function t(t,n){var r=e.call(this,n.id,t,n)||this;return Object.defineProperties(r,{lastReport:{enumerable:!0,value:null,writable:!0}}),r}return r(t,e),t.prototype.next=function(e,t){var n=this.lastStats;this.lastStats=t,this.trackId=e;var r=i.of(e,n,t);return this.lastReport=r,r},t}(n(5621));e.exports=o},7412:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){var r=e.call(this,t,n)||this;return Object.defineProperties(r,{audioLevel:{value:"number"===typeof n.audioOutputLevel?n.audioOutputLevel:null,enumerable:!0},jitter:{value:"number"===typeof n.jitter?n.jitter:null,enumerable:!0}}),r}return r(t,e),t}(n(784));e.exports=i},784:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){var r=e.call(this,t,n)||this;return Object.defineProperties(r,{bytesReceived:{value:"number"===typeof n.bytesReceived?n.bytesReceived:null,enumerable:!0},packetsReceived:{value:"number"===typeof n.packetsReceived?n.packetsReceived:null,enumerable:!0}}),r}return r(t,e),t}(n(3690));e.exports=i},7349:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=null;return"number"===typeof n.frameWidthReceived&&"number"===typeof n.frameHeightReceived&&(i={},Object.defineProperties(i,{width:{value:n.frameWidthReceived,enumerable:!0},height:{value:n.frameHeightReceived,enumerable:!0}})),Object.defineProperties(r,{dimensions:{value:i,enumerable:!0},frameRate:{value:"number"===typeof n.frameRateReceived?n.frameRateReceived:null,enumerable:!0}}),r}return r(t,e),t}(n(784));e.exports=i},1595:e=>{"use strict";var t=function(e,t,n){Object.defineProperties(this,{id:{enumerable:!0,value:e},trackId:{enumerable:!0,value:t},bitrate:{enumerable:!0,value:n}})};e.exports=t},5621:e=>{"use strict";var t=function(e,t,n){Object.defineProperties(this,{id:{enumerable:!0,value:e,writable:!0},trackId:{enumerable:!0,value:t,writable:!0},lastStats:{enumerable:!0,value:n,writable:!0}})};e.exports=t},8299:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(8409),o=n(1595),a=n(2913),s=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r)||this;return Object.defineProperties(o,{rtt:{enumerable:!0,value:i}}),o}return r(t,e),t.of=function(e,n,r,i){if(n.id!==r.id)throw new Error("RTCStats IDs must match");var o=(r.timestamp-n.timestamp)/1e3,a=r.bytesSent-n.bytesSent,s=o>0?a/o*8:0,c=i&&"number"===typeof i.roundTripTime?i.roundTripTime/1e3:void 0;return new t(n.id,e,s,c)},t.summarize=function(e){return{bitrate:a(e.map((function(e){return e.bitrate}))),rtt:i(e.map((function(e){return e.rtt})))}},t}(o);e.exports=s},5941:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(5621),o=n(8299),a=function(e){function t(t,n){var r=e.call(this,n.id,t,n)||this;return Object.defineProperties(r,{lastReport:{enumerable:!0,value:null,writable:!0}}),r}return r(t,e),t.prototype.next=function(e,t,n){var r=this.lastStats;this.lastStats=t,this.trackId=e;var i=o.of(e,r,t,n);return this.lastReport=i,i},t}(i);e.exports=a},5051:(e,t,n)=>{"use strict";var r=n(7737),i=n(2128),o=n(7412),a=n(7349),s=function(e,t,n){if("string"!==typeof e)throw new Error("RTCPeerConnection id must be a string");Object.defineProperties(this,{peerConnectionId:{value:e,enumerable:!0},localAudioTrackStats:{value:t.localAudioTrackStats.map((function(e){return new r(e.trackId,e,n)})),enumerable:!0},localVideoTrackStats:{value:t.localVideoTrackStats.map((function(e){return new i(e.trackId,e,n)})),enumerable:!0},remoteAudioTrackStats:{value:t.remoteAudioTrackStats.map((function(e){return new o(e.trackId,e)})),enumerable:!0},remoteVideoTrackStats:{value:t.remoteVideoTrackStats.map((function(e){return new a(e.trackId,e)})),enumerable:!0}})};e.exports=s},2913:e=>{"use strict";e.exports=function(e){return e.reduce((function(e,t){return"number"===typeof t?t+e:e}),0)}},3690:e=>{"use strict";var t=function(e,t){if("string"!==typeof e)throw new Error("Track id must be a string");Object.defineProperties(this,{trackId:{value:e,enumerable:!0},trackSid:{value:t.trackSid,enumerable:!0},timestamp:{value:t.timestamp,enumerable:!0},ssrc:{value:t.ssrc,enumerable:!0},packetsLost:{value:"number"===typeof t.packetsLost?t.packetsLost:null,enumerable:!0},codec:{value:"string"===typeof t.codecName?t.codecName:null,enumerable:!0}})};e.exports=t},956:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(e){function t(t,n){var r=e.call(this)||this;return Object.defineProperties(r,{id:{enumerable:!0,value:t},kind:{enumerable:!0,value:n}}),r}return r(t,e),t.prototype.stop=function(){this.emit("stopped")},t}(n(9223));e.exports=i},896:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=n(6546),s=n(6803),c=s.buildLogLevels,l=s.makeUUID,d=n(5765),u=n(3207),h=n(2016),p=0,f={closed:[],connecting:["closed","open","waiting"],early:["closed","connecting"],open:["closed"],waiting:["closed","connecting","early","open"]},m={closed:"close",open:"open",waiting:"waiting"},_=3e3,g=3001,v=3002,y=3003,b=3005,E=3006,S=globalThis,T=S.WebSocket?S.WebSocket:n(6921),w={BUSY:"busy",FAILED:"failed",LOCAL:"local",REMOTE:"remote",TIMEOUT:"timeout"},C=new Map([[_,w.TIMEOUT],[g,w.TIMEOUT],[v,w.FAILED],[y,w.FAILED],[3004,w.TIMEOUT],[E,w.BUSY],[3007,w.TIMEOUT]]),R=function(e){function t(t,n){var r=e.call(this,"early",f)||this;n=Object.assign({helloBody:null,maxConsecutiveFailedHellos:3,maxConsecutiveMissedHeartbeats:3,requestedHeartbeatTimeout:5e3,openTimeout:15e3,welcomeTimeout:5e3,Log:d,WebSocket:T},n);var a=c(n.logLevel),s=new n.Log("default",r,a,n.loggerName),l=n.networkMonitor?new u((function(){var e=l.type,t="Network changed"+(e?" to "+e:"");s.debug(t),r._close({code:3004,reason:t})})):null;Object.defineProperties(r,{_busyWaitTimeout:{value:null,writable:!0},_consecutiveHeartbeatsMissed:{value:0,writable:!0},_cookie:{value:null,writable:!0},_eventObserver:{value:n.eventObserver},_heartbeatTimeout:{value:null,writable:!0},_hellosLeft:{value:n.maxConsecutiveFailedHellos,writable:!0},_instanceId:{value:++p},_log:{value:s},_messageQueue:{value:[]},_networkMonitor:{value:l},_options:{value:n},_openTimeout:{value:null,writable:!0},_sendHeartbeatTimeout:{value:null,writable:!0},_serverUrl:{value:t},_welcomeTimeout:{value:null,writable:!0},_ws:{value:null,writable:!0}});var h={connecting:"info",early:"info",open:"info",waiting:"warning",closed:"info"};return r.on("stateChanged",(function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e in m&&r.emit.apply(r,o([m[e]],i(t)));var a={name:e,group:"signaling",level:h[r.state]};if("closed"===e){var s=i(t,1)[0];a.payload={reason:s},a.level=s===w.LOCAL?"info":"error"}r._eventObserver.emit("event",a)})),r._eventObserver.emit("event",{name:r.state,group:"signaling",level:h[r.state]}),r._connect(),r}return r(t,e),t.prototype.toString=function(){return"[TwilioConnection #"+this._instanceId+": "+this._ws.url+"]"},t.prototype._close=function(e){var t=e.code,n=e.reason;if("closed"!==this.state){this._openTimeout&&this._openTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear(),this._heartbeatTimeout&&this._heartbeatTimeout.clear(),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.clear(),this._networkMonitor&&this._networkMonitor.stop(),this._busyWaitTimeout&&t!==b&&this._busyWaitTimeout.clear(),this._messageQueue.splice(0);var r=this._log;1e3===t?(r.debug("Closed"),this.transition("closed",null,[w.LOCAL])):(r.warn("Closed: "+t+" - "+n),t!==b&&this.transition("closed",null,[C.get(t)||w.REMOTE]));var i=this._ws.readyState,o=this._options.WebSocket;i!==o.CLOSING&&i!==o.CLOSED&&this._ws.close(t,n)}},t.prototype._connect=function(){var e=this,t=this._log;if("waiting"===this.state)this.transition("early");else if("early"!==this.state)return void t.warn('Unexpected state "'+this.state+'" for connecting to the TCMP server.');this._ws=new this._options.WebSocket(this._serverUrl);var n=this._ws;t.debug("Created a new WebSocket:",n),n.addEventListener("close",(function(t){return e._close(t)}));var r=this._options.openTimeout;this._openTimeout=new h((function(){var t="Failed to open in "+r+" ms";e._close({code:3007,reason:t})}),r),n.addEventListener("open",(function(){t.debug("WebSocket opened:",n),e._openTimeout.clear(),e._startHandshake(),e._networkMonitor&&e._networkMonitor.start()})),n.addEventListener("message",(function(n){t.debug("Incoming: "+n.data);try{n=JSON.parse(n.data)}catch(r){return void e.emit("error",r)}switch(n.type){case"bad":e._handleBad(n);break;case"busy":e._handleBusy(n);break;case"bye":break;case"msg":e._handleMessage(n);case"heartbeat":e._handleHeartbeat();break;case"welcome":e._handleWelcome(n);break;default:e._log.debug("Unknown message type: "+n.type),e.emit("error",new Error("Unknown message type: "+n.type))}}))},t.prototype._handleBad=function(e){var t=e.reason,n=this._log;if(["connecting","open"].includes(this.state)){if("connecting"===this.state)return n.warn("Closing: 3002 - "+t),void this._close({code:v,reason:t});n.debug("Error: "+t),this.emit("error",new Error(t))}else n.warn('Unexpected state "'+this.state+'" for handling a "bad" message from the TCMP server.')},t.prototype._handleBusy=function(e){var t=this,n=e.cookie,r=e.keepAlive,i=e.retryAfter,o=this._log;if(["connecting","waiting"].includes(this.state)){this._busyWaitTimeout&&this._busyWaitTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear();var a=i<0?'Received terminal "busy" message':'Received "busy" message, retrying after '+i+" ms";if(i<0)return o.warn("Closing: 3006 - "+a),void this._close({code:E,reason:a});var s=this._options.maxConsecutiveFailedHellos;this._hellosLeft=s,this._cookie=n||null,r?(o.warn(a),this._busyWaitTimeout=new h((function(){return t._startHandshake()}),i)):(o.warn("Closing: 3005 - "+a),this._close({code:b,reason:a}),this._busyWaitTimeout=new h((function(){return t._connect()}),i)),this.transition("waiting",null,[r,i])}else o.warn('Unexpected state "'+this.state+'" for handling a "busy" message from the TCMP server.')},t.prototype._handleHeartbeat=function(){"open"===this.state?this._heartbeatTimeout.reset():this._log.warn('Unexpected state "'+this.state+'" for handling a "heartbeat" message from the TCMP server.')},t.prototype._handleHeartbeatTimeout=function(){if("open"===this.state){var e=this._log,t=this._options.maxConsecutiveMissedHeartbeats;e.debug("Consecutive heartbeats missed: "+t);var n="Missed "+t+' "heartbeat" messages';e.warn("Closing: 3001 - "+n),this._close({code:g,reason:n})}},t.prototype._handleMessage=function(e){var t=e.body;"open"===this.state?this.emit("message",t):this._log.warn('Unexpected state "'+this.state+'" for handling a "msg" message from the TCMP server.')},t.prototype._handleWelcome=function(e){var t=this,n=e.negotiatedTimeout,r=this._log;if(["connecting","waiting"].includes(this.state)){"waiting"===this.state&&(r.debug('Received "welcome" message, no need to retry connection.'),this._busyWaitTimeout.clear());var i=n*this._options.maxConsecutiveMissedHeartbeats,o=n-200;this._welcomeTimeout.clear(),this._heartbeatTimeout=new h((function(){return t._handleHeartbeatTimeout()}),i),this._messageQueue.splice(0).forEach((function(e){return t._send(e)})),this._sendHeartbeatTimeout=new h((function(){return t._sendHeartbeat()}),o),this.transition("open")}else r.warn('Unexpected state "'+this.state+'" for handling a "welcome" message from the TCMP server.')},t.prototype._handleWelcomeTimeout=function(){if("connecting"===this.state){var e=this._log;if(this._hellosLeft<=0){var t="All handshake attempts failed";return e.warn("Closing: 3000 - "+t),void this._close({code:_,reason:t})}var n=this._options.maxConsecutiveFailedHellos;e.warn("Handshake attempt "+(n-this._hellosLeft)+" failed"),this._startHandshake()}},t.prototype._send=function(e){if(this._ws.readyState===this._options.WebSocket.OPEN){var t=JSON.stringify(e);this._log.debug("Outgoing: "+t);try{this._ws.send(t),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.reset()}catch(r){var n="Failed to send message";this._log.warn("Closing: 3003 - "+n),this._close({code:y,reason:n})}}},t.prototype._sendHeartbeat=function(){"closed"!==this.state&&this._send({type:"heartbeat"})},t.prototype._sendHello=function(){var e=this._options,t=e.helloBody,n=e.requestedHeartbeatTimeout,r={id:l(),timeout:n,type:"hello",version:2};this._cookie&&(r.cookie=this._cookie),t&&(r.body=t),this._send(r)},t.prototype._sendOrEnqueue=function(e){var t=this;if("closed"!==this.state){var n="open"===this.state?function(e){return t._send(e)}:function(e){return t._messageQueue.push(e)};n(e)}},t.prototype._startHandshake=function(){var e=this;if(["early","waiting"].includes(this.state)&&this.transition("connecting"),"connecting"===this.state){this._hellosLeft--,this._sendHello();var t=this._options.welcomeTimeout;this._welcomeTimeout=new h((function(){return e._handleWelcomeTimeout()}),t)}},t.prototype.close=function(){"closed"!==this.state&&(this._sendOrEnqueue({type:"bye"}),this._close({code:1e3,reason:"Normal"}))},t.prototype.sendMessage=function(e){this._sendOrEnqueue({body:e,type:"msg"})},t}(a);R.CloseReason=w,e.exports=R},5766:(e,t,n)=>{"use strict";var r=n(6803).defer,i=function(){function e(){Object.defineProperties(this,{_deferreds:{value:[]},_hasValue:{value:!1,writable:!0},_value:{value:null,writable:!0}})}return e.prototype.put=function(e){this._hasValue=!0,this._value=e;var t=this._deferreds.shift();return t&&t.resolve(e),this},e.prototype.take=function(){var e=this;if(this._hasValue&&!this._deferreds.length)return this._hasValue=!1,Promise.resolve(this._value);var t=r();return this._deferreds.push(t),t.promise.then((function(t){return e._hasValue=!1,t}))},e}();e.exports=i},2935:e=>{var t=function(){function e(e){Object.defineProperties(this,{_min:{value:e.min||100},_max:{value:e.max||1e4},_jitter:{value:e.jitter>0&&e.jitter<=1?e.jitter:0},_factor:{value:e.factor||2},_attempts:{value:0,writable:!0},_duration:{enumerable:!1,get:function(){var e=this._min*Math.pow(this._factor,this._attempts);if(this._jitter){var t=Math.random(),n=Math.floor(t*this._jitter*e);e=0===(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this._max)}},_timeoutID:{value:null,writable:!0}})}return e.prototype.backoff=function(e){var t=this,n=this._duration;this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null),this._timeoutID=setTimeout((function(){t._attempts++,e()}),n)},e.prototype.reset=function(){this._attempts=0,this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},e}();e.exports=t},4136:function(e){"use strict";var t=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};function n(){return!!(navigator&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2)}function r(){return n()&&window.screen.width>=744&&(/Macintosh/i.test(navigator.userAgent)||/iPad/.test(navigator.userAgent)||/iPad/.test(navigator.platform))}function i(){return n()&&window.screen.width<=476&&(/Macintosh/i.test(navigator.userAgent)||/iPhone/.test(navigator.userAgent)||/iPhone/.test(navigator.platform))}e.exports={isAndroid:function(){return/Android/.test(navigator.userAgent)},isIOS:function(){return r()||i()},isIpad:r,isIphone:i,isMobile:function(){return/Mobi/.test(navigator.userAgent)},isNonChromiumEdge:function(e){return"chrome"===e&&/Edge/.test(navigator.userAgent)&&("undefined"===typeof chrome||"undefined"===typeof chrome.runtime)},mobileWebKitBrowser:function(e){return"safari"!==e?null:"brave"in navigator?"brave":["edge","edg"].find((function(e){return navigator.userAgent.toLowerCase().includes(e)}))||null},rebrandedChromeBrowser:function(e){if("chrome"!==e)return null;if("brave"in navigator)return"brave";var n=function(e){for(var t=[],n=[],r=0;r<e.length;r++)if("("===e[r])t.push(r);else if(")"===e[r]&&t.length>0){var i=t.pop();0===t.length&&n.push(e.substring(i,r+1))}return n}(navigator.userAgent).reduce((function(e,t){return e.replace(t,"")}),navigator.userAgent).match(/[^\s]+/g)||[];return t(n.map((function(e){return e.split("/")[0].toLowerCase()}))).slice(2).find((function(e){return!["chrome","mobile","safari"].includes(e)}))||null}}},3172:function(e){"use strict";var t=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},n=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},r=function(){function e(e,t){var n=this;Object.defineProperties(this,{_isCancelable:{writable:!0,value:!0},_isCanceled:{writable:!0,value:!1},_onCancel:{value:t}}),Object.defineProperty(this,"_promise",{value:new Promise((function(t,r){e((function(e){n._isCancelable=!1,t(e)}),(function(e){n._isCancelable=!1,r(e)}),(function(){return n._isCanceled}))}))})}return e.reject=function(t){return new e((function(e,n){n(t)}),(function(){}))},e.resolve=function(t){return new e((function(e){e(t)}),(function(){}))},e.prototype.cancel=function(){return this._isCancelable&&(this._isCanceled=!0,this._onCancel()),this},e.prototype.catch=function(){var r=[].slice.call(arguments),i=this._promise;return new e((function(e,o){i.catch.apply(i,n([],t(r))).then(e,o)}),this._onCancel)},e.prototype.then=function(){var r=[].slice.call(arguments),i=this._promise;return new e((function(e,o){i.then.apply(i,n([],t(r))).then(e,o)}),this._onCancel)},e.prototype.finally=function(){var r=[].slice.call(arguments),i=this._promise;return new e((function(e,o){i.finally.apply(i,n([],t(r))).then(e,o)}),this._onCancel)},e}();e.exports=r},6262:(e,t,n)=>{"use strict";var r=n(4084);e.exports.SDK_NAME=r.name+".js",e.exports.SDK_VERSION=r.version,e.exports.SDP_FORMAT="unified",e.exports.hardwareDevicePublisheriPad={hwDeviceManufacturer:"Apple",hwDeviceModel:"iPad",hwDeviceType:"tablet",platformName:"iOS"},e.exports.hardwareDevicePublisheriPhone={hwDeviceManufacturer:"Apple",hwDeviceModel:"iPhone",hwDeviceType:"mobile",platformName:"iOS"},e.exports.DEFAULT_ENVIRONMENT="prod",e.exports.DEFAULT_REALM="us1",e.exports.DEFAULT_REGION="gll",e.exports.DEFAULT_LOG_LEVEL="warn",e.exports.DEFAULT_LOGGER_NAME="twilio-video",e.exports.WS_SERVER=function(e,t){return t="gll"===t?"global":encodeURIComponent(t),"prod"===e?"wss://"+t+".vss.twilio.com/signaling":"wss://"+t+".vss."+e+".twilio.com/signaling"},e.exports.PUBLISH_MAX_ATTEMPTS=5,e.exports.PUBLISH_BACKOFF_JITTER=10,e.exports.PUBLISH_BACKOFF_MS=20,e.exports.typeErrors={ILLEGAL_INVOKE:function(e,t){return new TypeError("Illegal call to "+e+": "+t)},INVALID_TYPE:function(e,t){return new TypeError(e+" must be "+((["a","e","i","o","u"].includes(t.toLowerCase()[0])?"an":"a")+" ")+t)},INVALID_VALUE:function(e,t){return new RangeError(e+" must be one of "+t.join(", "))},REQUIRED_ARGUMENT:function(e){return new TypeError(e+" must be specified")}},e.exports.DEFAULT_FRAME_RATE=24,e.exports.DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS=1e4,e.exports.DEFAULT_ICE_GATHERING_TIMEOUT_MS=15e3,e.exports.DEFAULT_SESSION_TIMEOUT_SEC=30,e.exports.DEFAULT_NQ_LEVEL_LOCAL=1,e.exports.DEFAULT_NQ_LEVEL_REMOTE=0,e.exports.MAX_NQ_LEVEL=3,e.exports.ICE_ACTIVITY_CHECK_PERIOD_MS=1e3,e.exports.ICE_INACTIVITY_THRESHOLD_MS=3e3,e.exports.iceRestartBackoffConfig={factor:1.1,min:1,max:1e3*e.exports.DEFAULT_SESSION_TIMEOUT_SEC,jitter:1},e.exports.reconnectBackoffConfig={factor:1.5,min:80,jitter:1},e.exports.subscriptionMode={MODE_COLLABORATION:"collaboration",MODE_GRID:"grid",MODE_PRESENTATION:"presentation"},e.exports.trackSwitchOffMode={MODE_DISABLED:"disabled",MODE_DETECTED:"detected",MODE_PREDICTED:"predicted"},e.exports.trackPriority={PRIORITY_HIGH:"high",PRIORITY_LOW:"low",PRIORITY_STANDARD:"standard"},e.exports.clientTrackSwitchOffControl={MODE_AUTO:"auto",MODE_MANUAL:"manual"},e.exports.videoContentPreferencesMode={MODE_AUTO:"auto",MODE_MANUAL:"manual"}},119:(e,t,n)=>{"use strict";var r=n(3337);e.exports=function(e){var t=n(902),i={},o=t.getOrCreate(i),a=3;return function t(){return a--,r(o,e.srcObject,250).then((function(e){return!!e&&(!(a>0)||t())})).catch((function(){return!0}))}().finally((function(){t.release(i)}))}},6918:e=>{"use strict";var t=null;e.exports=function(e){return t=t||document.createElement("canvas"),new Promise((function(n){var r=3;setTimeout((function i(){return r--,function(e){try{var n=t.getContext("2d");n.drawImage(e,0,0,50,50);var r=n.getImageData(0,0,50,50).data.filter((function(e,t){return(t+1)%4}));return 0===Math.max.apply(Math,r)}catch(i){return console.log("Error checking silence: ",i),!1}}(e)?r>0?setTimeout(i,250):n(!0):n(!1)}),250)}))}},3558:e=>{"use strict";var t=function(){function e(e){var t=this;void 0===e&&(e=1),Object.defineProperties(this,{_listeners:{value:[]},_onVisibilityChange:{value:function(){t._emitVisible("visible"===document.visibilityState)}}});for(var n=0;n<e;n++)this._listeners.push([])}return e.prototype.clear=function(){for(var e=this._listeners.length,t=0;t<e;t++)this._listeners[t]=[]},e.prototype._listenerCount=function(){return this._listeners.reduce((function(e,t){return e+t.length}),0)},e.prototype._emitVisible=function(e){for(var t=this,n=Promise.resolve(),r=function(r){n=n.then((function(){return t._emitVisiblePhase(r,e)}))},i=1;i<=this._listeners.length;i++)r(i);return n},e.prototype._emitVisiblePhase=function(e,t){var n=this._listeners[e-1];return Promise.all(n.map((function(e){var n=e(t);return n instanceof Promise?n:Promise.resolve(n)})))},e.prototype._start=function(){document.addEventListener("visibilitychange",this._onVisibilityChange)},e.prototype._stop=function(){document.removeEventListener("visibilitychange",this._onVisibilityChange)},e.prototype.onVisibilityChange=function(e,t){if("number"!==typeof e||e<=0||e>this._listeners.length)throw new Error("invalid phase: ",e);return this._listeners[e-1].push(t),1===this._listenerCount()&&this._start(),this},e.prototype.offVisibilityChange=function(e,t){if("number"!==typeof e||e<=0||e>this._listeners.length)throw new Error("invalid phase: ",e);var n=this._listeners[e-1],r=n.indexOf(t);return-1!==r&&(n.splice(r,1),0===this._listenerCount()&&this._stop()),this},e}();e.exports=new t(2)},6367:e=>{"use strict";e.exports=function(e){var t=e.location,n=e.URL;return[t,n].some((function(e){return!e}))?function(e){return Promise.reject(new Error("Failed to import: "+e+": dynamicImport is not supported"))}:(e.__twilioVideoImportedModules={},function(r){return r in e.__twilioVideoImportedModules?Promise.resolve(e.__twilioVideoImportedModules[r]):new Function("scope","return import('"+new n(r,t)+"').then(m => scope.__twilioVideoImportedModules['"+r+"'] = m);")(e)})}(globalThis)},7173:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(7284).EventEmitter,o=["signaling","room","media","quality","video-processor","preflight"],a=["debug","error","info","warning"],s=function(e){function t(t,n,r,i){void 0===i&&(i=null);var s=e.call(this)||this;return s.on("event",(function(e){var s=e.name,c=e.group,l=e.level,d=e.payload;if("string"!==typeof s)throw r.error("Unexpected name: ",s),new Error("Unexpected name: ",s);if(!o.includes(c))throw r.error("Unexpected group: ",c),new Error("Unexpected group: ",c);if(!a.includes(l))throw r.error("Unexpected level: ",l),new Error("Unexpected level: ",l);var u=Date.now(),h=u-n,p=Object.assign({elapsedTime:h,level:l},d||{});t.publish(c,s,p);var f=Object.assign({elapsedTime:h,group:c,level:l,name:s,timestamp:u},d?{payload:d}:{});r[{debug:"debug",error:"error",info:"info",warning:"warn"}[l]]("event",f),i&&"signaling"===c&&i.emit("event",f)})),s}return r(t,e),t}(i);e.exports=s},3253:e=>{"use strict";var t=function(){function e(e){e=Object.assign({getKey:function(e){return e},getValue:function(e){return e},isLessThanOrEqualTo:function(e,t){return e<=t}},e),Object.defineProperties(this,{_getKey:{value:e.getKey},_getValue:{value:e.getValue},_isLessThanOrEqualTo:{value:e.isLessThanOrEqualTo},_map:{value:new Map}})}return e.prototype.toMap=function(){return new Map(this._map)},e.prototype.updateAndFilter=function(e){return e.filter(this.update,this)},e.prototype.update=function(e){var t=this._getKey(e),n=this._getValue(e);return(!this._map.has(t)||!this._isLessThanOrEqualTo(n,this._map.get(t)))&&(this._map.set(t,n),!0)},e}();e.exports=t},6803:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=n(6262),s=a.typeErrors,c=a.trackPriority,l=n(295),d=n(483).sessionSID,u=n(3691);function h(){return"undefined"!==typeof navigator&&navigator.userAgent?navigator.userAgent:"Unknown"}function p(e,t,n,r){if(!(r in t)&&!r.match(/^on[a-z]+$/)){var a;try{a=typeof e[r]}catch(s){}"function"===a&&(t[r]=function(){for(var e,t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return(e=this[n])[r].apply(e,o([],i(t)))})}}function f(e){return"object"===typeof e&&!Array.isArray(e)}function m(e){Object.getOwnPropertyNames(e).forEach((function(t){t.startsWith("_")&&_(e,t)}))}function _(e,t){var n=Object.getOwnPropertyDescriptor(e,t);n.enumerable=!1,Object.defineProperty(e,t,n)}function g(e){return e.map(v)}function v(e){return Array.isArray(e)?g(e):e instanceof Set?g(o([],i(e))):e instanceof Map?o([],i(e.entries())).reduce((function(e,t){var n,r=i(t,2),o=r[0],a=r[1];return Object.assign(((n={})[o]=v(a),n),e)}),{}):e&&"object"===typeof e?(t=e,Object.entries(t).reduce((function(e,t){var n,r=i(t,2),o=r[0],a=r[1];return Object.assign(((n={})[o]=v(a),n),e)}),{})):e;var t}function y(e){return S(e,[{prop:"dominantSpeakerPriority",type:"string",payloadProp:"active_speaker_priority"},{prop:"maxSubscriptionBitrate",type:"number",payloadProp:"max_subscription_bandwidth"},{prop:"maxTracks",type:"number",payloadProp:"max_tracks"},{prop:"mode",type:"string"},{prop:"renderDimensions",type:"object",payloadProp:"render_dimensions",transform:E},{prop:"trackSwitchOffMode",type:"string",payloadProp:"track_switch_off"}])}function b(e){return S(e,[{prop:"height",type:"number"},{prop:"width",type:"number"}])}function E(e){return S(e,[{prop:c.PRIORITY_HIGH,type:"object",transform:b},{prop:c.PRIORITY_LOW,type:"object",transform:b},{prop:c.PRIORITY_STANDARD,type:"object",transform:b}])}function S(e,t){return t.reduce((function(t,n){var r,i=n.prop,o=n.type,a=n.payloadProp,s=void 0===a?i:a,c=n.transform,l=void 0===c?function(e){return e}:c;return typeof e[i]===o?Object.assign(((r={})[s]=l(e[i]),r),t):t}),{})}t.constants=a,t.createBandwidthProfilePayload=function(e){return S(e,[{prop:"video",type:"object",transform:y}])},t.createMediaSignalingPayload=function(e,t,n,r,i,o){var a={transports:[{type:"data-channel"}]};return Object.assign(e?{active_speaker:a}:{},t?{network_quality:a}:{},o?{render_hints:a}:{},i?{publisher_hints:a}:{},n?{track_priority:a}:{},r?{track_switch_off:a}:{})},t.createMediaWarningsPayload=function(e){var t,n=((t={})[u.recordingMediaLost]="recordings",t);return e.map((function(e){return n[e]})).filter((function(e){return!!e}))},t.createRoomConnectEventPayload=function(e){function t(e){return e?"true":"false"}var n={sessionSID:d,iceServers:(e.iceServers||[]).length,audioTracks:(e.tracks||[]).filter((function(e){return"audio"===e.kind})).length,videoTracks:(e.tracks||[]).filter((function(e){return"video"===e.kind})).length,dataTracks:(e.tracks||[]).filter((function(e){return"data"===e.kind})).length};if([["audio"],["automaticSubscription"],["enableDscp"],["eventListener"],["preflight"],["video"],["dominantSpeaker","enableDominantSpeaker"]].forEach((function(r){var o=i(r,2),a=o[0],s=o[1];n[s=s||a]=t(!!e[a])})),[["maxVideoBitrate"],["maxAudioBitrate"]].forEach((function(t){var r=i(t,2),o=r[0],a=r[1];a=a||o,"number"===typeof e[o]?n[a]=e[o]:isNaN(Number(e[o]))||(n[a]=Number(e[o]))})),[["iceTransportPolicy"],["region"],["name","roomName"]].forEach((function(t){var r=i(t,2),o=r[0],a=r[1];a=a||o,"string"===typeof e[o]?n[a]=e[o]:"number"===typeof e[o]&&"name"===o&&(n[a]=e[o].toString())})),["preferredAudioCodecs","preferredVideoCodecs"].forEach((function(t){t in e&&(n[t]=JSON.stringify(e[t]))})),"networkQuality"in e&&(n.networkQualityConfiguration={},f(e.networkQuality)?["local","remote"].forEach((function(t){"number"===typeof e.networkQuality[t]&&(n.networkQualityConfiguration[t]=e.networkQuality[t])})):(n.networkQualityConfiguration.remote=0,n.networkQualityConfiguration.local=e.networkQuality?1:0)),e.bandwidthProfile&&e.bandwidthProfile.video){var r=e.bandwidthProfile.video||{};n.bandwidthProfileOptions={},["mode","maxTracks","trackSwitchOffMode","dominantSpeakerPriority","maxSubscriptionBitrate","renderDimensions","contentPreferencesMode","clientTrackSwitchOffControl"].forEach((function(e){"number"===typeof r[e]||"string"===typeof r[e]?n.bandwidthProfileOptions[e]=r[e]:"boolean"===typeof r[e]?n.bandwidthProfileOptions[e]=t(r[e]):"object"===typeof r[e]&&(n.bandwidthProfileOptions[e]=JSON.stringify(r[e]))}))}return Object.entries({RTCPeerConnection:"customRTCPeerConnectionImpl",MediaStream:"customMediaStreamImpl",getUserMedia:"customGetUserMediaImpl",enumerateDevices:"customEnumerateDevicesImpl"}).forEach((function(r){var o=i(r,2),a=o[0],s=o[1];n[s]=t("undefined"!==typeof e[a])})),{group:"room",name:"connect",level:"info",payload:n}},t.createSubscribePayload=function(e){return{rules:[{type:e?"include":"exclude",all:!0}],revision:1}},t.asLocalTrack=function(e,t){if(e instanceof t.LocalAudioTrack||e instanceof t.LocalVideoTrack||e instanceof t.LocalDataTrack)return e;if(e instanceof t.MediaStreamTrack)return"audio"===e.kind?new t.LocalAudioTrack(e,t):new t.LocalVideoTrack(e,t);throw s.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")},t.asLocalTrackPublication=function(e,t,n,r){return new(0,{audio:r.LocalAudioTrackPublication,video:r.LocalVideoTrackPublication,data:r.LocalDataTrackPublication}[e.kind])(t,e,n,r)},t.capitalize=function(e){return e[0].toUpperCase()+e.slice(1)},t.deprecateEvents=function(e,t,n,r){var i=new Set;t.on("newListener",(function o(a){n.has(a)&&!i.has(a)&&(r.deprecated(e+"#"+a+" has been deprecated and scheduled for removal in twilio-video.js@2.0.0."+(n.get(a)?" Use "+e+"#"+n.get(a)+" instead.":"")),i.add(a)),i.size>=n.size&&t.removeListener("newListener",o)}))},t.difference=function(e,t){e=Array.isArray(e)?new Set(e):new Set(e.values()),t=Array.isArray(t)?new Set(t):new Set(t.values());var n=new Set;return e.forEach((function(e){t.has(e)||n.add(e)})),n},t.filterObject=function(e,t){return Object.keys(e).reduce((function(n,r){return e[r]!==t&&(n[r]=e[r]),n}),{})},t.flatMap=function(e,t){var n=e instanceof Map||e instanceof Set?Array.from(e.values()):e;return t=t||function(e){return e},n.reduce((function(e,n){var r=t(n);return e.concat(r)}),[])},t.getPlatform=function(){var e=h(),t=i(e.match(/\(([^)]+)\)/)||[],2)[1];return i((void 0===t?"unknown":t).split(";").map((function(e){return e.trim()})),1)[0].toLowerCase()},t.getUserAgent=h,t.hidePrivateProperties=m,t.hidePrivateAndCertainPublicPropertiesInClass=function(e,t){return function(e){function n(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var a=e.apply(this,o([],i(n)))||this;return m(a),function(e,t){void 0===t&&(t=[]);t.forEach((function(t){e.hasOwnProperty(t)&&_(e,t)}))}(a,t),a}return r(n,e),n}(e)},t.isDeepEqual=function e(t,n){if(t===n)return!0;if(typeof t!==typeof n)return!1;if(null===t)return null===n;if(null===n)return!1;if(Array.isArray(t))return Array.isArray(n)&&t.length===n.length&&t.every((function(t,r){return e(t,n[r])}));if("object"===typeof t){var r=Object.keys(t).sort(),i=Object.keys(n).sort();return!Array.isArray(n)&&e(r,i)&&r.every((function(r){return e(t[r],n[r])}))}return!1},t.isNonArrayObject=f,t.inRange=function(e,t,n){return t<=e&&e<=n},t.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},t.oncePerTick=function(e){var t=null;function n(){t=null,e()}return function(){t&&clearTimeout(t),t=setTimeout(n)}},t.promiseFromEvents=function(e,t,n,r){return new Promise((function(a,s){function c(){var e=[].slice.call(arguments);r&&t.removeListener(r,l),a.apply(void 0,o([],i(e)))}function l(){var e=[].slice.call(arguments);t.removeListener(n,c),s.apply(void 0,o([],i(e)))}t.once(n,c),r&&t.once(r,l),e()}))},t.getOrNull=function(e,t){return t.split(".").reduce((function(e,t){return e?e[t]:null}),e)},t.defer=function(){var e={};return e.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),e},t.delegateMethods=function(e,t,n){for(var r in e)p(e,t,n,r)},t.proxyProperties=function(e,t,n){Object.getOwnPropertyNames(e).forEach((function(e){!function(e,t,n,r){if(r in t)return;if(r.match(/^on[a-z]+$/))return Object.defineProperty(t,r,{value:null,writable:!0}),void n.addEventListener(r.slice(2),(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.dispatchEvent.apply(t,o([],i(e)))}));Object.defineProperty(t,r,{enumerable:!0,get:function(){return n[r]}})}(0,t,n,e)}))},t.legacyPromise=function(e,t,n){return t?e.then((function(e){t(e)}),(function(e){n(e)})):e},t.buildLogLevels=function(e){return"string"===typeof e?{default:e,media:e,signaling:e,webrtc:e}:e},t.trackClass=function(e,t){return(t=t?"Local":"")+(e.kind||"").replace(/\w{1}/,(function(e){return e.toUpperCase()}))+"Track"},t.trackPublicationClass=function(e,t){return(t=t?"Local":"")+(e.kind||"").replace(/\w{1}/,(function(e){return e.toUpperCase()}))+"TrackPublication"},t.valueToJSON=v,t.withJitter=function(e,t){var n=Math.random();return e-t+Math.floor(2*t*n+.5)},t.isChromeScreenShareTrack=function(e){return"chrome"===l.guessBrowser()&&"video"===e.kind&&"displaySurface"in e.getSettings()},t.waitForSometime=function(e){return void 0===e&&(e=10),new Promise((function(t){return setTimeout(t,e)}))},t.waitForEvent=function(e,t){return new Promise((function(n){e.addEventListener(t,(function r(i){e.removeEventListener(t,r),n(i)}))}))}},1339:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},o=n(7284).EventEmitter,a=n(6803).getUserAgent,s=globalThis,c=s.WebSocket?s.WebSocket:n(6921),l=n(6262),d=l.hardwareDevicePublisheriPad,u=l.hardwareDevicePublisheriPhone,h=n(6803),p=n(4136),f=function(e){function t(t,n,r,i,o,s){var l=e.call(this)||this;return s=Object.assign({gateway:_(i,o)+"/v1/VideoEvents",maxReconnectAttempts:5,reconnectIntervalMs:50,userAgent:a(),WebSocket:c},s),Object.defineProperties(l,{_connectTimestamp:{value:0,writable:!0},_eventQueue:{value:[]},_readyToConnect:{value:h.defer()},_reconnectAttemptsLeft:{value:s.maxReconnectAttempts,writable:!0},_ws:{value:null,writable:!0},_WebSocket:{value:s.WebSocket}}),l._readyToConnect.promise.then((function(e){var i=e.roomSid,o=e.participantSid,a=l;l.on("disconnected",(function e(c){if(a._session=null,c&&a._reconnectAttemptsLeft>0)return a.emit("reconnecting"),void function(e,t,n,r,i,o,a){var s=Date.now()-e._connectTimestamp,c=a.reconnectIntervalMs-s;if(c>0)return void setTimeout((function(){m(e,t,n,r,i,o,a)}),c);m(e,t,n,r,i,o,a)}(a,t,n,r,i,o,s);a.removeListener("disconnected",e)})),m(l,t,n,r,i,o,s)})).catch((function(){})),l}return r(t,e),t.prototype.connect=function(e,t){this._readyToConnect.resolve({roomSid:e,participantSid:t})},t.prototype._publish=function(e){e.session=this._session,this._ws.send(JSON.stringify(e))},t.prototype.disconnect=function(){if(null===this._ws||this._ws.readyState===this._WebSocket.CLOSING||this._ws.readyState===this._WebSocket.CLOSED)return!1;try{this._ws.close()}catch(e){}return this.emit("disconnected"),!0},t.prototype.publish=function(e,t,n){return(null===this._ws||this._ws.readyState!==this._WebSocket.CLOSING&&this._ws.readyState!==this._WebSocket.CLOSED)&&(("string"===typeof this._session?this._publish.bind(this):this._eventQueue.push.bind(this._eventQueue))({group:e,name:t,payload:n,timestamp:Date.now(),type:"event",version:1}),!0)},t}(o);function m(e,t,n,r,o,a,s){e._connectTimestamp=Date.now(),e._reconnectAttemptsLeft--,e._ws=new s.WebSocket(s.gateway);var c=e._ws;c.addEventListener("close",(function(t){1e3!==t.code?e.emit("disconnected",new Error("WebSocket Error "+t.code+": "+t.reason)):e.emit("disconnected")})),c.addEventListener("message",(function(t){!function(e,t,n){switch(t.type){case"connected":e._session=t.session,e._reconnectAttemptsLeft=n.maxReconnectAttempts,e._eventQueue.splice(0).forEach(e._publish,e),e.emit("connected");break;case"error":e._ws.close(),e.emit("disconnected",new Error(t.message))}}(e,JSON.parse(t.data),s)})),c.addEventListener("open",(function(){var e={type:"connect",token:t,version:1};e.publisher={name:n,sdkVersion:r,userAgent:s.userAgent,participantSid:a,roomSid:o},p.isIpad()?e.publisher=i(i({},e.publisher),d):p.isIphone()&&(e.publisher=i(i({},e.publisher),u)),c.send(JSON.stringify(e))}))}function _(e,t){return"prod"===e?"wss://sdkgw."+t+".twilio.com":"wss://sdkgw."+e+"-"+t+".twilio.com"}e.exports=f},3702:e=>{"use strict";var t=function(){function e(){Object.defineProperties(this,{_connected:{writable:!0,value:!0}})}return e.prototype.connect=function(){},e.prototype.disconnect=function(){return!!this._connected&&(this._connected=!1,!0)},e.prototype.publish=function(){return this._connected},e}();e.exports=t},5843:(e,t,n)=>{"use strict";var r=n(6803).defer,i=function(){function e(){Object.defineProperties(this,{_audio:{value:r(),writable:!0},_video:{value:r(),writable:!0}}),this._audio.resolve(),this._video.resolve()}return e.prototype.resolveDeferred=function(e){"audio"===e?this._audio.resolve():this._video.resolve()},e.prototype.startDeferred=function(e){"audio"===e?this._audio=r():this._video=r()},e.prototype.whenResolved=function(e){return"audio"===e?this._audio.promise:this._video.promise},e}();e.exports=new i},5765:function(e,t,n){"use strict";var r,i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=n(6553).getLogger,s=n(6262),c=s.DEFAULT_LOG_LEVEL,l=s.DEFAULT_LOGGER_NAME,d=n(6262).typeErrors;var u=function(){function e(t,n,r,i,o){if("string"!==typeof t)throw d.INVALID_TYPE("moduleName","string");if(!n)throw d.REQUIRED_ARGUMENT("component");"object"!==typeof r&&(r={}),o=o||a,_(r),Object.defineProperties(this,{_component:{value:n},_logLevels:{value:r},_warnings:{value:new Set},_loggerName:{get:function(){var e=i&&"string"===typeof i?i:l;return this._logLevelsEqual||(e=e+"-"+t),e}},_logger:{get:function(){var e=o(this._loggerName),n=this._logLevels[t]||c;return n="off"===n?"silent":n,e.setDefaultLevel(n),e}},_logLevelsEqual:{get:function(){return 1===new Set(Object.values(this._logLevels)).size}},logLevel:{get:function(){return e.getLevelByName(r[t]||c)}},name:{get:n.toString.bind(n)}})}return e.getLevelByName=function(t){return isNaN(t)?(m(t=t.toUpperCase()),e[t]):parseInt(t,10)},e.prototype.createLog=function(t,n){var r=this._loggerName;return this._logLevelsEqual||(r=r.substring(0,r.lastIndexOf("-"))),new e(t,n,this._logLevels,r)},e.prototype.setLevels=function(e){return _(e),Object.assign(this._logLevels,e),this},e.prototype.log=function(t,n){var r=e._levels[t];if(!r)throw d.INVALID_VALUE("logLevel",p);r=r.toLowerCase();var a=[(new Date).toISOString(),r,this.name];return(this._logger[r]||function(){}).apply(void 0,o([],i(a.concat(n)))),this},e.prototype.debug=function(){return this.log(e.DEBUG,[].slice.call(arguments))},e.prototype.deprecated=function(e){var t=function(e){if((r=r||new Map).has(e))return r.get(e);var t=new Set;return r.set(e,t),t}(this._component.constructor);return t.has(e)?this:(t.add(e),this.warn(e))},e.prototype.info=function(){return this.log(e.INFO,[].slice.call(arguments))},e.prototype.warn=function(){return this.log(e.WARN,[].slice.call(arguments))},e.prototype.warnOnce=function(e){return this._warnings.has(e)?this:(this._warnings.add(e),this.warn(e))},e.prototype.error=function(){return this.log(e.ERROR,[].slice.call(arguments))},e.prototype.throw=function(t,n){throw t.clone&&(t=t.clone(n)),this.log(e.ERROR,t),t},e}();Object.defineProperties(u,{DEBUG:{value:0},INFO:{value:1},WARN:{value:2},ERROR:{value:3},OFF:{value:4},_levels:{value:["DEBUG","INFO","WARN","ERROR","OFF"]}});var h={},p=[],f=u._levels.map((function(e,t){return h[e]=!0,p.push(t),e}));function m(e){if(!(e in h))throw d.INVALID_VALUE("level",f)}function _(e){Object.keys(e).forEach((function(t){m(e[t].toUpperCase())}))}e.exports=u},442:e=>{"use strict";var t=function(){function e(){Object.defineProperties(this,{_samples:{value:[{denominator:0,numerator:0},{denominator:0,numerator:0}]}})}return e.prototype.get=function(){var e=this._samples,t=e[1].denominator-e[0].denominator||1/0;return(e[1].numerator-e[0].numerator)/t},e.prototype.putSample=function(e,t){var n=this._samples;n.shift(),n.push({denominator:t,numerator:e})},e}();e.exports=t},3207:e=>{"use strict";var t=function(){function e(e,t){var n=this,r=(t=Object.assign({navigator:navigator,window:window},t)).navigator,i=r.connection||{type:null},o=i.type,a=i.type?{_events:{value:["change","typechange"]},_listener:{value:function(){var t=o!==n.type&&n.isOnline;o=n.type,t&&e()}},_target:{value:i}}:{_events:{value:["online"]},_listener:{value:e},_target:{value:t.window}},s=a._events,c=a._listener,l=a._target;Object.defineProperties(this,{isOnline:{enumerable:!0,get:function(){return"boolean"!==typeof r.onLine||r.onLine}},type:{enumerable:!0,get:function(){return i.type||null}},_listener:c,_events:s,_target:l})}return e.prototype.start=function(){var e=this;this._events.forEach((function(t){e._target.addEventListener(t,e._listener)}))},e.prototype.stop=function(){var e=this;this._events.forEach((function(t){e._target.removeEventListener(t,e._listener)}))},e}();e.exports=t},428:function(e){"use strict";var t=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),n=function(){function e(e){Object.defineProperties(this,{_callback:{value:e}})}return e.prototype.observe=function(){},e.prototype.unobserve=function(){},e.prototype.makeVisible=function(e){var t=this._makeFakeEntry(e,!0);this._callback([t])},e.prototype.makeInvisible=function(e){var t=this._makeFakeEntry(e,!1);this._callback([t])},e.prototype._makeFakeEntry=function(e,t){return{target:e,isIntersecting:t}},e}(),r=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(n),i=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.resize=function(e){var t=this._makeFakeEntry(e,!0);this._callback([t])},n}(n);e.exports={NullIntersectionObserver:r,NullResizeObserver:i,NullObserver:n}},981:function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=n(6803),o=i.difference,a=i.flatMap,s=n(9016),c={0:"PCMU",8:"PCMA"};function l(e){return Array.from(u(e)).reduce((function(e,t){var n=t[0],r=t[1],i=e.get(r)||[];return e.set(r,i.concat(n))}),new Map)}function d(e){return f(e).reduce((function(e,t){var n=p(t);return n?e.set(n,t):e}),new Map)}function u(e){return m(e).reduce((function(t,n){var r=new RegExp("a=rtpmap:"+n+" ([^/]+)"),i=e.match(r),o=i?i[1].toLowerCase():c[n]?c[n].toLowerCase():"";return t.set(n,o)}),new Map)}function h(e,t){var n=new RegExp("^a=fmtp:"+e+" (.+)$","m"),i=t.match(n);return i&&i[1].split(";").reduce((function(e,t){var n=r(t.split("="),2),i=n[0],o=n[1];return e[i]=isNaN(o)?o:parseInt(o,10),e}),{})}function p(e){var t=e.match(/^a=mid:(.+)$/m);return t&&t[1]}function f(e,t,n){return e.replace(/\r\n\r\n$/,"\r\n").split("\r\nm=").slice(1).map((function(e){return"m="+e})).filter((function(e){var r=new RegExp("m="+(t||".*"),"gm"),i=new RegExp("a="+(n||".*"),"gm");return r.test(e)&&i.test(e)}))}function m(e){var t=e.split("\r\n")[0].match(/([0-9]+)/g);return t?t.slice(1).map((function(e){return parseInt(e,10)})):[]}function _(e,t){var n=t.split("\r\n"),r=n[0],i=n.slice(1);return[r=r.replace(/([0-9]+\s?)+$/,e.join(" "))].concat(i).join("\r\n")}function g(e,t,n){if(!/^m=(audio|video)/.test(e))return e;var i=p(e),o=i&&t.get(i);if(!o)return e;var s=u(o),c=l(e),d=a(Array.from(s),(function(t){var i=r(t,2),a=i[0],s=i[1];return"rtx"===s||n.includes(s)?[]:function(e,t,n,r,i){var o=n.get(e)||[];if(o.length<=1)return o;var a=h(t,i);if(!a)return o;var s=o.find((function(e){var t=h(e,r);return t&&Object.keys(a).every((function(e){return a[e]===t[e]}))}));return"number"===typeof s?[s]:o}(s,a,c,e,o)})),f=c.get("rtx")||[];d=d.concat(f.filter((function(t){var n=h(t,e);return n&&d.includes(n.apt)})));var g=e.split("\r\n").filter((function(e){var t=e.match(/^a=(rtpmap|fmtp|rtcp-fb):(.+) .+$/),n=t&&t[2];return!t||n&&d.includes(parseInt(n,10))}));return _(m(e).filter((function(e){return d.includes(e)})),g.join("\r\n"))}function v(e,t){var n=f(e);return[e.split("\r\nm=")[0]].concat(n.map((function(e){if(!/^m=(audio|video)/.test(e))return e;var n=p(e);if(!n)return e;var i=t.get(n);if(!i)return e;var o=(e.match(/^a=msid:(.+)$/m)||[])[1];if(!o)return e;var a=r(o.split(" "),2),s=a[0],c=a[1],l=new RegExp("msid:"+s+(c?" "+c:"")+"$","gm");return e.replace(l,"msid:"+s+" "+i)}))).join("\r\n")}function y(e,t){var n=Object.entries(t).map((function(e){var t=r(e,2);return t[0]+"="+t[1]})).join(";");return"a=fmtp:"+e+" "+n}t.addOrRewriteNewTrackIds=function(e,t,n){var i=Array.from(n).reduce((function(n,i){var o=r(i,2),a=o[0],s=o[1];return f(e,a,"send(only|recv)").map(p).filter((function(e){return!t.has(e)})).forEach((function(e,t){return n.set(e,s[t])})),n}),new Map);return v(e,i)},t.addOrRewriteTrackIds=v,t.createCodecMapForMediaSection=l,t.createPtToCodecName=u,t.disableRtx=function(e){var t=f(e);return[e.split("\r\nm=")[0]].concat(t.map((function(e){if(!/^m=video/.test(e))return e;var t=l(e).get("rtx");if(!t)return e;var n=new Set(m(e));t.forEach((function(e){return n.delete(e)}));var r=e.match(/a=ssrc-group:FID [0-9]+ ([0-9]+)/),i=r&&r[1],o=[/^a=fmtp:.+ apt=.+$/,/^a=rtpmap:.+ rtx\/.+$/,/^a=ssrc-group:.+$/].concat(i?[new RegExp("^a=ssrc:"+i+" .+$")]:[]);return e=e.split("\r\n").filter((function(e){return o.every((function(t){return!t.test(e)}))})).join("\r\n"),_(Array.from(n),e)}))).join("\r\n")},t.enableDtxForOpus=function(e,t){var n=f(e),r=e.split("\r\nm=")[0];return t=t||n.filter((function(e){return/^m=audio/.test(e)})).map(p),[r].concat(n.map((function(e){if(!/^m=audio/.test(e))return e;var n=l(e).get("opus");if(!n)return e;var r=h(n,e);if(!r)return e;var i=y(n,r),o=new RegExp(i),a=p(e);t.includes(a)?r.usedtx=1:delete r.usedtx;var s=y(n,r);return e.replace(o,s)}))).join("\r\n")},t.filterLocalCodecs=function(e,t){var n=f(e),r=e.split("\r\nm=")[0],i=d(t);return[r].concat(n.map((function(e){return g(e,i,[])}))).join("\r\n")},t.getMediaSections=f,t.removeSSRCAttributes=function(e,t){return e.split("\r\n").filter((function(e){return!t.find((function(t){return new RegExp("a=ssrc:.*"+t+":","g").test(e)}))})).join("\r\n")},t.revertSimulcast=function(e,t,n,r){void 0===r&&(r=!1);var i=d(n),o=d(t),a=f(e);return[e.split("\r\nm=")[0]].concat(a.map((function(e){if(e=e.replace(/\r\n$/,""),!/^m=video/.test(e))return e;var t=e.match(/^a=mid:(.+)$/m),n=t&&t[1];if(!n)return e;var a=i.get(n),s=u(a),c=m(a),l=c.length&&"vp8"===s.get(c[0]);return r||!l?o.get(n).replace(/\r\n$/,""):e}))).concat("").join("\r\n")},t.setCodecPreferences=function(e,t,n){var r=f(e);return[e.split("\r\nm=")[0]].concat(r.map((function(e){if(!/^m=(audio|video)/.test(e))return e;var r=e.match(/^m=(audio|video)/)[1],i=l(e),s=function(e,t){t=t.map((function(e){return e.codec.toLowerCase()}));var n=a(t,(function(t){return e.get(t)||[]})),r=o(Array.from(e.keys()),t),i=a(r,(function(t){return e.get(t)}));return n.concat(i)}(i,"audio"===r?t:n),c=_(s,e),d=i.get("pcma")||[],u=i.get("pcmu")||[];return("audio"===r?new Set(d.concat(u)):new Set).has(s[0])?c.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):c}))).join("\r\n")},t.setSimulcast=function(e,t){var n=f(e);return[e.split("\r\nm=")[0]].concat(n.map((function(e){if(e=e.replace(/\r\n$/,""),!/^m=video/.test(e))return e;var n=l(e),r=m(e),i=new Set(n.get("vp8")||[]);return r.some((function(e){return i.has(e)}))?s(e,t):e}))).concat("").join("\r\n")}},7898:(e,t,n)=>{"use strict";var r=n(7422).RTCSessionDescription,i=n(981),o=i.createPtToCodecName,a=i.getMediaSections;function s(e){var t=o(e);e=function(e,t){return Array.from(t.keys()).reduce((function(e,n){var r=new RegExp("^a=rtpmap:"+n+" rtx.+$","gm");return(e.match(r)||[]).slice("rtx"===t.get(n)?1:0).reduce((function(e,t){var r=new RegExp("\r\n"+t),i=new RegExp("\r\na=fmtp:"+n+" apt=[0-9]+");return e.replace(r,"").replace(i,"")}),e)}),e)}(e,t);var n=function(e){var t=new Map;return e.forEach((function(e,n){var r=t.get(e)||new Set;return t.set(e,r.add(n))})),t}(t),r=n.get("rtx")||new Set,i=new Set,a=function(e,t,n,r){return Array.from(n).reduce((function(n,i){var o=new RegExp("a=fmtp:"+i+" apt=(\\d+)"),a=e.match(o);if(!a)return r.add(i),n;var s=Number.parseInt(a[1]);return t.has(s)?"rtx"===t.get(s)?(r.add(i),n):n.set(i,s):(r.add(i),n)}),new Map)}(e,t,r,i),s=function(e,t){var n=Array.from(e).reduce((function(e,t){var n=t[0],r=t[1],i=e.get(r)||new Set;return e.set(r,i.add(n))}),new Map);return Array.from(n).reduce((function(e,n){var r=n[0],i=Array.from(n[1]);return i.length>1?(i.forEach((function(e){t.add(e)})),e):e.set(r,i[0])}),new Map)}(a,i),l=Array.from(i);return["h264","vp8","vp9"].reduce((function(e,t){var r=n.get(t)||new Set;return Array.from(r).reduce((function(e,t){return s.has(t)?e:e.add(t)}),e)}),new Set).forEach((function(t){if(l.length){var n=l.shift();e=function(e,t,n){return e.endsWith("\r\n")?e+"a=fmtp:"+t+" apt="+n+"\r\n":e+"\r\na=fmtp:"+t+" apt="+n}(e=c(e,n),n,t)}})),l.forEach((function(t){e=function(e,t){var n=new RegExp("a=rtpmap:"+t+".*\r\n","gm");return e.replace(n,"")}(e=c(e,t),t)})),e}function c(e,t){var n=new RegExp("a=fmtp:"+t+".*\r\n","gm");return e.replace(n,"")}e.exports=function(e){var t={type:e.type};return"rollback"!==e.type&&(t.sdp=function(e){var t=a(e);return[e.split("\r\nm=")[0]].concat(t.map(s)).join("\r\n")}(e.sdp)),new r(t)}},9016:function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},i=n(6803),o=i.difference,a=i.flatMap;function s(){return String(Math.floor(4294967295*Math.random()))}var c=function(){function e(e,t,n){Object.defineProperties(this,{cName:{enumerable:!0,value:n},isSimulcastEnabled:{enumerable:!0,value:!1,writable:!0},primarySSRCs:{enumerable:!0,value:new Set},rtxPairs:{enumerable:!0,value:new Map},streamId:{enumerable:!0,value:t},trackId:{enumerable:!0,value:e}})}return e.prototype.addSimulcastSSRCs=function(){if(!this.isSimulcastEnabled){var e=[s(),s()];e.forEach((function(e){this.primarySSRCs.add(e)}),this),this.rtxPairs.size&&e.forEach((function(e){this.rtxPairs.set(s(),e)}),this)}},e.prototype.addSSRC=function(e,t,n){t?this.rtxPairs.set(e,t):this.primarySSRCs.add(e),this.isSimulcastEnabled=this.isSimulcastEnabled||n},e.prototype.toSdpLines=function(e){var t=this,n=e?[]:Array.from(this.rtxPairs.entries()).map((function(e){return e.reverse()})),r=Array.from(this.primarySSRCs.values()),i=n.length?a(n):r,o=a(i,(function(e){return["a=ssrc:"+e+" cname:"+t.cName,"a=ssrc:"+e+" msid:"+t.streamId+" "+t.trackId]})),s=n.map((function(e){return"a=ssrc-group:FID "+e.join(" ")})),c=["a=ssrc-group:SIM "+r.join(" ")];return s.concat(o).concat(c)},e}();function l(e,t){return(e.match(new RegExp(t,"gm"))||[]).map((function(e){return(e.match(new RegExp(t))||[]).slice(1)}))}function d(e){var t=function(e){return new Set(a(l(e,"^a=ssrc-group:SIM ([0-9]+) ([0-9]+) ([0-9]+)$")))}(e),n=function(e){return new Map(l(e,"^a=ssrc-group:FID ([0-9]+) ([0-9]+)$").map((function(e){return e.reverse()})))}(e),i=function(e){var t=r(a(l(e,"^a=msid:(.+) (.+)$")),2),n=t[0],i=t[1];return a(l(e,"^a=ssrc:(.+) cname:.+$")).map((function(e){return[e,n,i]}))}(e);return i.reduce((function(r,i){var o=i[0],a=i[1],s=i[2],l=r.get(s)||new c(s,a,function(e,t,n){var r="a=ssrc:"+t+" "+n+":(.+)";return e.match(new RegExp(r))[1]}(e,o,"cname")),d=n.get(o)||null;return l.addSSRC(o,d,t.has(o)),r.set(s,l)}),new Map)}e.exports=function(e,t){var n=d(e),r=Array.from(n.keys()),i=Array.from(t.keys()),s=o(r,i),c=o(i,r);a(s,(function(e){return n.get(e)})).forEach((function(e){e.addSimulcastSSRCs(),t.set(e.trackId,e)})),i=Array.from(t.keys());var l=o(i,c),u=a(l,(function(e){return t.get(e)})),h=!e.match(/a=rtpmap:[0-9]+ rtx/),p=a(u,(function(e){return e.toSdpLines(h)})),f=a(new Set(e.split("\r\n").concat(p))),m="a=x-google-flag:conference";return e.match(m)||f.push(m),f.join("\r\n")}},4690:(e,t,n)=>{"use strict";var r=n(981).getMediaSections,i=function(){function e(){Object.defineProperties(this,{_midsToTrackIds:{value:new Map,writable:!0}})}return e.prototype.match=function(e){return this._midsToTrackIds.get(e.transceiver.mid)||null},e.prototype.update=function(e){var t=r(e,"(audio|video)");this._midsToTrackIds=t.reduce((function(e,t){var n=t.match(/^a=mid:(.+)$/m)||[],r=t.match(/^a=msid:.+ (.+)$/m)||[],i=n[1],o=r[1];return i&&o?e.set(i,o):e}),this._midsToTrackIds)},e}();e.exports=i},483:(e,t)=>{var n="1234567890abcdef";function r(e){for(var t="",r=0;r<32;r++)t+=n.charAt(Math.floor(16*Math.random()));return""+e+t}t.sessionSID=r("SS"),t.createSID=r},244:(e,t,n)=>{"use strict";var r=n(295),i=r.guessBrowser,o=r.support,a=n(2138).getSdpFormat,s=n(4136),c=s.isAndroid,l=s.isMobile,d=s.isNonChromiumEdge,u=s.rebrandedChromeBrowser,h=s.mobileWebKitBrowser,p=["crios","edg","edge","electron","headlesschrome"],f=["chrome","firefox"],m=["chrome","safari"],_=[];e.exports=function(){var e=i();if(!e)return!1;var t=u(e),n=h(e),r=c()?f:m;return!!e&&o()&&"unified"===a()&&(!t||p.includes(t))&&!d(e)&&(!n||_.includes(n))&&(!l()||r.includes(e))}},2016:e=>{"use strict";var t=function(){function e(e,t,n){void 0===n&&(n=!0),Object.defineProperties(this,{_delay:{value:t,writable:!0},_fn:{value:e},_timeout:{value:null,writable:!0}}),n&&this.start()}return Object.defineProperty(e.prototype,"delay",{get:function(){return this._delay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSet",{get:function(){return!!this._timeout},enumerable:!1,configurable:!0}),e.prototype.setDelay=function(e){this._delay=e},e.prototype.start=function(){var e=this;this.isSet||(this._timeout=setTimeout((function(){var t=e._fn;e.clear(),t()}),this._delay))},e.prototype.clear=function(){clearTimeout(this._timeout),this._timeout=null},e.prototype.reset=function(){this.clear(),this.start()},e}();e.exports=t},569:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=n(2361),o={};t.createTwilioError=function(e,t){return t="string"===typeof t&&t?t:"Unknown error",o[e="number"===typeof e?e:0]?new o[e]:new i(e,t)};var a=function(e){function t(){var n=e.call(this,20101,"Invalid Access Token")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.AccessTokenInvalidError=a,Object.defineProperty(o,20101,{value:a});var s=function(e){function t(){var n=e.call(this,20102,"Invalid Access Token header")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.AccessTokenHeaderInvalidError=s,Object.defineProperty(o,20102,{value:s});var c=function(e){function t(){var n=e.call(this,20103,"Invalid Access Token issuer/subject")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.AccessTokenIssuerInvalidError=c,Object.defineProperty(o,20103,{value:c});var l=function(e){function t(){var n=e.call(this,20104,"Access Token expired or expiration date invalid")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.AccessTokenExpiredError=l,Object.defineProperty(o,20104,{value:l});var d=function(e){function t(){var n=e.call(this,20105,"Access Token not yet valid")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.AccessTokenNotYetValidError=d,Object.defineProperty(o,20105,{value:d});var u=function(e){function t(){var n=e.call(this,20106,"Invalid Access Token grants")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.AccessTokenGrantsInvalidError=u,Object.defineProperty(o,20106,{value:u});var h=function(e){function t(){var n=e.call(this,20107,"Invalid Access Token signature")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.AccessTokenSignatureInvalidError=h,Object.defineProperty(o,20107,{value:h});var p=function(e){function t(){var n=e.call(this,53e3,"Signaling connection error")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.SignalingConnectionError=p,Object.defineProperty(o,53e3,{value:p});var f=function(e){function t(){var n=e.call(this,53001,"Signaling connection disconnected")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.SignalingConnectionDisconnectedError=f,Object.defineProperty(o,53001,{value:f});var m=function(e){function t(){var n=e.call(this,53002,"Signaling connection timed out")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.SignalingConnectionTimeoutError=m,Object.defineProperty(o,53002,{value:m});var _=function(e){function t(){var n=e.call(this,53003,"Client received an invalid signaling message")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.SignalingIncomingMessageInvalidError=_,Object.defineProperty(o,53003,{value:_});var g=function(e){function t(){var n=e.call(this,53004,"Client sent an invalid signaling message")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.SignalingOutgoingMessageInvalidError=g,Object.defineProperty(o,53004,{value:g});var v=function(e){function t(){var n=e.call(this,53006,"Video server is busy")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.SignalingServerBusyError=v,Object.defineProperty(o,53006,{value:v});var y=function(e){function t(){var n=e.call(this,53100,"Room name is invalid")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomNameInvalidError=y,Object.defineProperty(o,53100,{value:y});var b=function(e){function t(){var n=e.call(this,53101,"Room name is too long")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomNameTooLongError=b,Object.defineProperty(o,53101,{value:b});var E=function(e){function t(){var n=e.call(this,53102,"Room name contains invalid characters")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomNameCharsInvalidError=E,Object.defineProperty(o,53102,{value:E});var S=function(e){function t(){var n=e.call(this,53103,"Unable to create Room")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomCreateFailedError=S,Object.defineProperty(o,53103,{value:S});var T=function(e){function t(){var n=e.call(this,53104,"Unable to connect to Room")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomConnectFailedError=T,Object.defineProperty(o,53104,{value:T});var w=function(e){function t(){var n=e.call(this,53105,"Room contains too many Participants")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomMaxParticipantsExceededError=w,Object.defineProperty(o,53105,{value:w});var C=function(e){function t(){var n=e.call(this,53106,"Room not found")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomNotFoundError=C,Object.defineProperty(o,53106,{value:C});var R=function(e){function t(){var n=e.call(this,53107,"MaxParticipants is out of range")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomMaxParticipantsOutOfRangeError=R,Object.defineProperty(o,53107,{value:R});var k=function(e){function t(){var n=e.call(this,53108,"RoomType is not valid")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomTypeInvalidError=k,Object.defineProperty(o,53108,{value:k});var O=function(e){function t(){var n=e.call(this,53109,"Timeout is out of range")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomTimeoutOutOfRangeError=O,Object.defineProperty(o,53109,{value:O});var I=function(e){function t(){var n=e.call(this,53110,"StatusCallbackMethod is invalid")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomStatusCallbackMethodInvalidError=I,Object.defineProperty(o,53110,{value:I});var N=function(e){function t(){var n=e.call(this,53111,"StatusCallback is invalid")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomStatusCallbackInvalidError=N,Object.defineProperty(o,53111,{value:N});var A=function(e){function t(){var n=e.call(this,53112,"Status is invalid")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomStatusInvalidError=A,Object.defineProperty(o,53112,{value:A});var x=function(e){function t(){var n=e.call(this,53113,"Room exists")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomRoomExistsError=x,Object.defineProperty(o,53113,{value:x});var P=function(e){function t(){var n=e.call(this,53114,"Room creation parameter(s) incompatible with the Room type")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomInvalidParametersError=P,Object.defineProperty(o,53114,{value:P});var D=function(e){function t(){var n=e.call(this,53115,"MediaRegion is invalid")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomMediaRegionInvalidError=D,Object.defineProperty(o,53115,{value:D});var L=function(e){function t(){var n=e.call(this,53116,"There are no media servers available in the MediaRegion")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomMediaRegionUnavailableError=L,Object.defineProperty(o,53116,{value:L});var M=function(e){function t(){var n=e.call(this,53117,"The subscription operation requested is not supported for the Room type")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomSubscriptionOperationNotSupportedError=M,Object.defineProperty(o,53117,{value:M});var j=function(e){function t(){var n=e.call(this,53118,"Room completed")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomCompletedError=j,Object.defineProperty(o,53118,{value:j});var U=function(e){function t(){var n=e.call(this,53124,"The AudioOnly flag is not supported for the Room type")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomAudioOnlyFlagNotSupportedError=U,Object.defineProperty(o,53124,{value:U});var V=function(e){function t(){var n=e.call(this,53125,"The track kind is not supported by the Room")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.RoomTrackKindNotSupportedError=V,Object.defineProperty(o,53125,{value:V});var F=function(e){function t(){var n=e.call(this,53200,"Participant identity is invalid")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.ParticipantIdentityInvalidError=F,Object.defineProperty(o,53200,{value:F});var B=function(e){function t(){var n=e.call(this,53201,"Participant identity is too long")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.ParticipantIdentityTooLongError=B,Object.defineProperty(o,53201,{value:B});var W=function(e){function t(){var n=e.call(this,53202,"Participant identity contains invalid characters")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.ParticipantIdentityCharsInvalidError=W,Object.defineProperty(o,53202,{value:W});var G=function(e){function t(){var n=e.call(this,53203,"The maximum number of published tracks allowed in the Room at the same time has been reached")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.ParticipantMaxTracksExceededError=G,Object.defineProperty(o,53203,{value:G});var H=function(e){function t(){var n=e.call(this,53204,"Participant not found")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.ParticipantNotFoundError=H,Object.defineProperty(o,53204,{value:H});var z=function(e){function t(){var n=e.call(this,53205,"Participant disconnected because of duplicate identity")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.ParticipantDuplicateIdentityError=z,Object.defineProperty(o,53205,{value:z});var K=function(e){function t(){var n=e.call(this,53300,"Track is invalid")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.TrackInvalidError=K,Object.defineProperty(o,53300,{value:K});var q=function(e){function t(){var n=e.call(this,53301,"Track name is invalid")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.TrackNameInvalidError=q,Object.defineProperty(o,53301,{value:q});var Y=function(e){function t(){var n=e.call(this,53302,"Track name is too long")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.TrackNameTooLongError=Y,Object.defineProperty(o,53302,{value:Y});var J=function(e){function t(){var n=e.call(this,53303,"Track name contains invalid characters")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.TrackNameCharsInvalidError=J,Object.defineProperty(o,53303,{value:J});var X=function(e){function t(){var n=e.call(this,53304,"Track name is duplicated")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.TrackNameIsDuplicatedError=X,Object.defineProperty(o,53304,{value:X});var Q=function(e){function t(){var n=e.call(this,53305,"The server has reached capacity and cannot fulfill this request")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.TrackServerTrackCapacityReachedError=Q,Object.defineProperty(o,53305,{value:Q});var Z=function(e){function t(){var n=e.call(this,53400,"Client is unable to create or apply a local media description")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.MediaClientLocalDescFailedError=Z,Object.defineProperty(o,53400,{value:Z});var $=function(e){function t(){var n=e.call(this,53401,"Server is unable to create or apply a local media description")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.MediaServerLocalDescFailedError=$,Object.defineProperty(o,53401,{value:$});var ee=function(e){function t(){var n=e.call(this,53402,"Client is unable to apply a remote media description")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.MediaClientRemoteDescFailedError=ee,Object.defineProperty(o,53402,{value:ee});var te=function(e){function t(){var n=e.call(this,53403,"Server is unable to apply a remote media description")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.MediaServerRemoteDescFailedError=te,Object.defineProperty(o,53403,{value:te});var ne=function(e){function t(){var n=e.call(this,53404,"No supported codec")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.MediaNoSupportedCodecError=ne,Object.defineProperty(o,53404,{value:ne});var re=function(e){function t(){var n=e.call(this,53405,"Media connection failed or Media activity ceased")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.MediaConnectionError=re,Object.defineProperty(o,53405,{value:re});var ie=function(e){function t(){var n=e.call(this,53407,"Media connection failed due to DTLS handshake failure")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.MediaDTLSTransportFailedError=ie,Object.defineProperty(o,53407,{value:ie});var oe=function(e){function t(){var n=e.call(this,53500,"Unable to acquire configuration")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.ConfigurationAcquireFailedError=oe,Object.defineProperty(o,53500,{value:oe});var ae=function(e){function t(){var n=e.call(this,53501,"Unable to acquire TURN credentials")||this;return Object.setPrototypeOf(n,t.prototype),n}return r(t,e),t}(i);t.ConfigurationAcquireTurnFailedError=ae,Object.defineProperty(o,53501,{value:ae})},2361:function(e){"use strict";var t=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),n=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},i=function(e){function i(t){var o,a=[].slice.call(arguments,1);o=e.apply(this,r([],n(a)))||this,Object.setPrototypeOf(o,i.prototype);var s=Error.apply(o,a);return s.name="TwilioError",Object.defineProperty(o,"code",{value:t,enumerable:!0}),Object.getOwnPropertyNames(s).forEach((function(e){Object.defineProperty(this,e,{value:s[e],enumerable:!0})}),o),o}return t(i,e),i.prototype.toString=function(){var e=this.message?": "+this.message:"";return this.name+" "+this.code+e},i}(Error);e.exports=i},3691:e=>{"use strict";e.exports={recordingMediaLost:"recording-media-lost"}},9961:(e,t,n)=>{"use strict";var r=n(6803).isNonArrayObject,i=n(6262),o=i.typeErrors,a=i.clientTrackSwitchOffControl,s=i.videoContentPreferencesMode,c=i.subscriptionMode,l=i.trackPriority,d=i.trackSwitchOffMode;function u(e,t,n){return void 0===n&&(n=[]),"undefined"===typeof e?null:null!==e&&r(e)?n.reduce((function(n,r){var i=r.prop,a=r.type,s=r.values;if(n||!(i in e))return n;var c=e[i];return a&&typeof c!==a||"number"===a&&isNaN(c)?o.INVALID_TYPE(t+"."+i,a):Array.isArray(s)&&!s.includes(c)?o.INVALID_VALUE(t+"."+i,s):n}),null):o.INVALID_TYPE(t,"object")}t.Pn=function(e){var t=u(e,"options.bandwidthProfile");return!e||t?t:(t=u(e.video,"options.bandwidthProfile.video",[{prop:"contentPreferencesMode",values:Object.values(s)},{prop:"dominantSpeakerPriority",values:Object.values(l)},{prop:"maxSubscriptionBitrate",type:"number"},{prop:"maxTracks",type:"number"},{prop:"mode",values:Object.values(c)},{prop:"clientTrackSwitchOffControl",values:Object.values(a)},{prop:"trackSwitchOffMode",values:Object.values(d)}]))||(e.video?"maxTracks"in e.video&&"clientTrackSwitchOffControl"in e.video?new TypeError("options.bandwidthProfile.video.maxTracks is deprecated. Use options.bandwidthProfile.video.clientTrackSwitchOffControl instead."):"renderDimensions"in e.video&&"contentPreferencesMode"in e.video?new TypeError("options.bandwidthProfile.video.renderDimensions is deprecated. Use options.bandwidthProfile.video.contentPreferencesMode instead."):function(e){var t="options.bandwidthProfile.video.renderDimensions",n=u(e,t);return e?n||Object.values(l).reduce((function(n,r){return n||u(e[r],t+"."+r,[{prop:"height",type:"number"},{prop:"width",type:"number"}])}),null):n}(e.video.renderDimensions):null)},t.ZS=function(e,t){if(!(e instanceof t.LocalAudioTrack||e instanceof t.LocalDataTrack||e instanceof t.LocalVideoTrack||e instanceof t.MediaStreamTrack))throw o.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")}},6209:e=>{e.exports=function(e,t){if(e&&t)if(e.super_=t,"function"===typeof Object.create)e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});else{var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},6553:e=>{var t=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function o(e,t){var n=e[t];if("function"===typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(e,n){for(var r=0;r<i.length;r++){var o=i[r];this[o]=r<e?t:this.methodFactory(o,e,n)}this.log=this.debug}function c(e,t,r){return function(){typeof console!==n&&(s.call(this,t,r),this[e].apply(this,arguments))}}function l(e,i,s){return function(e){return"debug"===e&&(e="log"),typeof console!==n&&("trace"===e&&r?a:void 0!==console[e]?o(console,e):void 0!==console.log?o(console,"log"):t)}(e)||c.apply(this,arguments)}function d(e,t,r){var o,a=this,c="loglevel";function d(){var e;if(typeof window!==n&&c){try{e=window.localStorage[c]}catch(i){}if(typeof e===n)try{var t=window.document.cookie,r=t.indexOf(encodeURIComponent(c)+"=");-1!==r&&(e=/^([^;]+)/.exec(t.slice(r))[1])}catch(i){}return void 0===a.levels[e]&&(e=void 0),e}}"string"===typeof e?c+=":"+e:"symbol"===typeof e&&(c=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=r||l,a.getLevel=function(){return o},a.setLevel=function(t,r){if("string"===typeof t&&void 0!==a.levels[t.toUpperCase()]&&(t=a.levels[t.toUpperCase()]),!("number"===typeof t&&t>=0&&t<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(o=t,!1!==r&&function(e){var t=(i[e]||"silent").toUpperCase();if(typeof window!==n&&c){try{return void(window.localStorage[c]=t)}catch(r){}try{window.document.cookie=encodeURIComponent(c)+"="+t+";"}catch(r){}}}(t),s.call(a,t,e),typeof console===n&&t<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){d()||a.setLevel(e,!1)},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var u=d();null==u&&(u=null==t?"WARN":t),a.setLevel(u,!1)}var u=new d,h={};u.getLogger=function(e){if("symbol"!==typeof e&&"string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=h[e];return t||(t=h[e]=new d(e,u.getLevel(),u.methodFactory)),t};var p=typeof window!==n?window.log:void 0;u.noConflict=function(){return typeof window!==n&&window.log===u&&(window.log=p),u},u.getLoggers=function(){return h},u.default=u,e.exports=u},902:e=>{"use strict";var t="undefined"!==typeof AudioContext?AudioContext:"undefined"!==typeof webkitAudioContext?webkitAudioContext:null,n=function(){function e(n){n=Object.assign({AudioContext:t},n),Object.defineProperties(this,{_AudioContext:{value:n.AudioContext},_audioContext:{value:null,writable:!0},_holders:{value:new Set},AudioContextFactory:{enumerable:!0,value:e}})}return e.prototype.getOrCreate=function(e){if(!this._holders.has(e)&&(this._holders.add(e),this._AudioContext&&!this._audioContext))try{this._audioContext=new this._AudioContext}catch(t){}return this._audioContext},e.prototype.release=function(e){this._holders.has(e)&&(this._holders.delete(e),!this._holders.size&&this._audioContext&&(this._audioContext.close(),this._audioContext=null))},e}();e.exports=new n},3337:e=>{"use strict";e.exports=function(e,t,n){n="number"===typeof n?n:250;var r=e.createMediaStreamSource(t),i=e.createAnalyser();i.fftSize=2048,r.connect(i);var o=new Uint8Array(i.fftSize),a=!1;return setTimeout((function(){a=!0}),n),function e(){return a?Promise.resolve(!0):(i.getByteTimeDomainData(o),o.some((function(e){return 128!==e&&0!==e}))?Promise.resolve(!1):function(e){return e="number"===typeof e?e:0,new Promise((function(t){return setTimeout(t,e)}))}().then(e))}().then((function(e){return r.disconnect(),e}),(function(e){throw r.disconnect(),e}))}},5355:(e,t,n)=>{"use strict";var r=n(3337);e.exports=function(e,t,i,o,a){o="number"===typeof o?o:3;var s=0,c=n(902),l={},d=c.getOrCreate(l);return function n(){return t(i).then((function(t){return(i.audio?r(d,t,a).catch((function(t){return e.warn("Encountered an error while detecting silence",t),!0})):Promise.resolve(!1)).then((function(r){return r?o<=0?(e.warn("Got a silent audio MediaStreamTrack. Normally we would try to get a new one, but we've run out of retries; returning it anyway."),t):(e.warn("Got a silent audio MediaStreamTrack. Stopping all MediaStreamTracks and calling getUserMedia again. This is retry #"+ ++s+"."),t.getTracks().forEach((function(e){return e.stop()})),o--,n()):(e.info("Got a non-silent audio MediaStreamTrack; returning it."),t)}))}))}().then((function(e){return c.release(l),e}),(function(e){throw c.release(l),e}))}},2807:function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=n(295),a=o.flatMap,s=o.guessBrowser,c=o.guessBrowserVersion,l=n(2138).getSdpFormat,d=s(),u=c(),h="chrome"===d,p="firefox"===d,f="safari"===d,m=h?u.major:null;function _(e,t){return"function"===typeof e.get?e.get(t):e.find((function(e){return e.id===t}))}function g(e){var t=Array.from(e.values()).find((function(e){var t=e.nominated;return"candidate-pair"===e.type&&t}));if(!t)return null;var n=_(e,t.localCandidateId),r=_(e,t.remoteCandidateId),i=[{key:"candidateType",type:"string"},{key:"ip",type:"string"},{key:"port",type:"number"},{key:"priority",type:"number"},{key:"protocol",type:"string"},{key:"url",type:"string"}],o=i.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),a=n?o.reduce((function(e,t){var r=t.key,i=t.type;return e[r]=typeof n[r]===i?n[r]:"deleted"!==r&&null,e}),{}):null,s=r?i.reduce((function(e,t){var n=t.key,i=t.type;return e[n]=typeof r[n]===i?r[n]:null,e}),{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string",fixup:function(e){return"inprogress"===e?"in-progress":e}},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce((function(e,n){var r=n.key,i=n.type,o=n.fixup;return e[r]=typeof t[r]===i?o?o(t[r]):t[r]:null,e}),{localCandidate:a,remoteCandidate:s})}function v(e){var t=Array.from(e.values()).find((function(e){var t=e.nominated;return"candidate-pair"===e.type&&t}));if(!t)return null;var n=_(e,t.localCandidateId),r=_(e,t.remoteCandidateId),i=[{key:"candidateType",type:"string"},{key:"ip",ffKeys:["address","ipAddress"],type:"string"},{key:"port",ffKeys:["portNumber"],type:"number"},{key:"priority",type:"number"},{key:"protocol",ffKeys:["transport"],type:"string"},{key:"url",type:"string"}],o=i.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),a={host:"host",peerreflexive:"prflx",relayed:"relay",serverreflexive:"srflx"},s=n?o.reduce((function(e,t){var r=t.ffKeys,i=t.key,o=t.type,s=r&&r.find((function(e){return e in n}))||i;return e[i]=typeof n[s]===o?"candidateType"===s&&a[n[s]]||n[s]:"deleted"!==s&&null,e}),{}):null,c=r?i.reduce((function(e,t){var n=t.ffKeys,i=t.key,o=t.type,s=n&&n.find((function(e){return e in r}))||i;return e[i]=typeof r[s]===o?"candidateType"===s&&a[r[s]]||r[s]:null,e}),{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string"},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce((function(e,n){var r=n.key,i=n.type;return e[r]=typeof t[r]===i?t[r]:null,e}),{localCandidate:s,remoteCandidate:c})}function y(e,t,n){var r="local"===n?"getSenders":"getReceivers";if(e[r])return e[r]().map((function(e){return e.track})).filter((function(e){return e&&e.kind===t}));var i="audio"===t?"getAudioTracks":"getVideoTracks";return a(e["local"===n?"getLocalStreams":"getRemoteStreams"](),(function(e){return e[i]()}))}function b(e,t,n){var o=n.log;return m&&m<67?new Promise((function(n,r){e.getStats((function(e){n([E(e,t)])}),null,r)})):e.getStats(t).then((function(e){return o.info("getStats by track successful"),S(e,n)})).catch((function(){return o.warn("getStats by track failed. Getting default stats"),e.getStats().then((function(a){o.info("getStats by default successful");var s=function(e,t){var n,i,o,a,s,c;if(!e||!t)return!1;if(e.getReceivers){var l=e.getReceivers();try{for(var d=r(l),u=d.next();!u.done;u=d.next()){var h=u.value;if(h.track&&h.track.id===t.id)return!0}}catch(y){n={error:y}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}}if(e.getRemoteStreams){var p=e.getRemoteStreams();try{for(var f=r(p),m=f.next();!m.done;m=f.next()){var _=m.value.getTracks();try{for(var g=(s=void 0,r(_)),v=g.next();!v.done;v=g.next())if(v.value.id===t.id)return!0}catch(b){s={error:b}}finally{try{v&&!v.done&&(c=g.return)&&c.call(g)}finally{if(s)throw s.error}}}}catch(E){o={error:E}}finally{try{m&&!m.done&&(a=f.return)&&a.call(f)}finally{if(o)throw o.error}}}return!1}(e,t);o.info("Starting filtering stats for "+(s?"remote":"local")+" track");var c=function(e,t,n){var o,a,s,c,l,d,u,h,p,f,m,_,g,v,y,b,E,S,T,w,C,R,k;if(void 0===n&&(n=!1),Array.isArray(e))k=new Map(e.map((function(e){return[e.id||String(Math.random()),e]})));else if(e instanceof Map)k=e;else{if("object"!==typeof e||null===e)return new Map;var O=new Map;Object.keys(e).forEach((function(t){O.set(t,e[t])})),k=O}if(!k||!t)return new Map;var I=new Map,N=t.id,A=t.kind,x=null,P=null,D=null;try{for(var L=r(k),M=L.next();!M.done;M=L.next()){var j=i(M.value,2),U=j[0],V=j[1];if(n&&"inbound-rtp"===V.type&&V.trackIdentifier===N){x=V,P=U,D=V.ssrc;break}if(!n&&"media-source"===V.type&&V.trackIdentifier===N){x=V,P=U;break}"track"===V.type&&V.trackIdentifier===N&&(x||(x=V,P=U))}}catch(Te){o={error:Te}}finally{try{M&&!M.done&&(a=L.return)&&a.call(L)}finally{if(o)throw o.error}}if(!x)if(n){var F=[];try{for(var B=r(k),W=B.next();!W.done;W=B.next()){var G=i(W.value,2);U=G[0],"inbound-rtp"!==(V=G[1]).type||V.kind!==A&&V.mediaType!==A||F.push({id:U,stat:V})}}catch(we){s={error:we}}finally{try{W&&!W.done&&(c=B.return)&&c.call(B)}finally{if(s)throw s.error}}(1===F.length||F.length>1)&&(x=F[0].stat,P=F[0].id,D=x.ssrc)}else try{for(var H=r(k),z=H.next();!z.done;z=H.next()){var K=i(z.value,2);if(U=K[0],"media-source"===(V=K[1]).type&&V.kind===A){x=V,P=U;break}}}catch(Ce){l={error:Ce}}finally{try{z&&!z.done&&(d=H.return)&&d.call(H)}finally{if(l)throw l.error}}if(!x)return I;I.set(P,x);var q=new Set;if(n){if(x.codecId&&q.add(x.codecId),x.transportId&&q.add(x.transportId),x.remoteId&&q.add(x.remoteId),D)try{for(var Y=r(k),J=Y.next();!J.done;J=Y.next()){var X=i(J.value,2);U=X[0],"remote-outbound-rtp"===(V=X[1]).type&&V.ssrc===D&&q.add(U)}}catch(Re){u={error:Re}}finally{try{J&&!J.done&&(h=Y.return)&&h.call(Y)}finally{if(u)throw u.error}}try{for(var Q=r(q),Z=Q.next();!Z.done;Z=Q.next()){var $=Z.value;k.has($)&&I.set($,k.get($))}}catch(ke){p={error:ke}}finally{try{Z&&!Z.done&&(f=Q.return)&&f.call(Q)}finally{if(p)throw p.error}}try{for(var ee=r(k),te=ee.next();!te.done;te=ee.next()){var ne=i(te.value,2);U=ne[0],"track"===(V=ne[1]).type&&V.trackIdentifier===N&&I.set(U,V)}}catch(Oe){m={error:Oe}}finally{try{te&&!te.done&&(_=ee.return)&&_.call(ee)}finally{if(m)throw m.error}}}else{try{for(var re=r(k),ie=re.next();!ie.done;ie=re.next()){var oe=i(ie.value,2);if(U=oe[0],"outbound-rtp"===(V=oe[1]).type&&V.mediaSourceId===P){I.set(U,V),V.codecId&&q.add(V.codecId),V.transportId&&q.add(V.transportId);var ae=U;try{for(var se=(y=void 0,r(k)),ce=se.next();!ce.done;ce=se.next()){var le=i(ce.value,2),de=le[0],ue=le[1];"remote-inbound-rtp"===ue.type&&ue.localId===ae&&I.set(de,ue)}}catch(Ie){y={error:Ie}}finally{try{ce&&!ce.done&&(b=se.return)&&b.call(se)}finally{if(y)throw y.error}}}}}catch(Ne){g={error:Ne}}finally{try{ie&&!ie.done&&(v=re.return)&&v.call(re)}finally{if(g)throw g.error}}try{for(var he=r(q),pe=he.next();!pe.done;pe=he.next())$=pe.value,k.has($)&&I.set($,k.get($))}catch(Ae){E={error:Ae}}finally{try{pe&&!pe.done&&(S=he.return)&&S.call(he)}finally{if(E)throw E.error}}}var fe=null,me=new Set;try{for(var _e=r(I.values()),ge=_e.next();!ge.done;ge=_e.next())(V=ge.value).transportId&&me.add(V.transportId)}catch(xe){T={error:xe}}finally{try{ge&&!ge.done&&(w=_e.return)&&w.call(_e)}finally{if(T)throw T.error}}try{for(var ve=r(me),ye=ve.next();!ye.done;ye=ve.next()){var be=ye.value;if(k.has(be)){var Ee=k.get(be);I.set(be,Ee),Ee.selectedCandidatePairId&&(fe=Ee.selectedCandidatePairId),Ee.localCertificateId&&k.has(Ee.localCertificateId)&&I.set(Ee.localCertificateId,k.get(Ee.localCertificateId)),Ee.remoteCertificateId&&k.has(Ee.remoteCertificateId)&&I.set(Ee.remoteCertificateId,k.get(Ee.remoteCertificateId))}}}catch(Pe){C={error:Pe}}finally{try{ye&&!ye.done&&(R=ve.return)&&R.call(ve)}finally{if(C)throw C.error}}if(fe&&k.has(fe)){var Se=k.get(fe);I.set(fe,Se),Se.localCandidateId&&k.has(Se.localCandidateId)&&I.set(Se.localCandidateId,k.get(Se.localCandidateId)),Se.remoteCandidateId&&k.has(Se.remoteCandidateId)&&I.set(Se.remoteCandidateId,k.get(Se.remoteCandidateId))}return I}(a,t,s);return o.info("Completed filtering stats for "+(s?"remote":"local")+" track"),S(c,n)}))}))}function E(e,t){var n=e.result().find((function(e){return"ssrc"===e.type&&e.stat("googTrackId")===t.id})),r={};return n&&(r.timestamp=Math.round(Number(n.timestamp)),r=n.names().reduce((function(e,t){switch(t){case"googCodecName":e.codecName=n.stat(t);break;case"googRtt":e.roundTripTime=Number(n.stat(t));break;case"googJitterReceived":e.jitter=Number(n.stat(t));break;case"googFrameWidthInput":e.frameWidthInput=Number(n.stat(t));break;case"googFrameHeightInput":e.frameHeightInput=Number(n.stat(t));break;case"googFrameWidthSent":e.frameWidthSent=Number(n.stat(t));break;case"googFrameHeightSent":e.frameHeightSent=Number(n.stat(t));break;case"googFrameWidthReceived":e.frameWidthReceived=Number(n.stat(t));break;case"googFrameHeightReceived":e.frameHeightReceived=Number(n.stat(t));break;case"googFrameRateInput":e.frameRateInput=Number(n.stat(t));break;case"googFrameRateSent":e.frameRateSent=Number(n.stat(t));break;case"googFrameRateReceived":e.frameRateReceived=Number(n.stat(t));break;case"ssrc":e[t]=n.stat(t);break;case"bytesReceived":case"bytesSent":case"packetsLost":case"packetsReceived":case"packetsSent":case"audioInputLevel":case"audioOutputLevel":e[t]=Number(n.stat(t))}return e}),r)),r}function S(e,t){var n=t.simulateExceptionWhileStandardizingStats;if(void 0!==n&&n)throw new Error("Error while gathering stats");var r=null,i=[],o=null,a=null,s=null,c=null,l=null;e.forEach((function(e){switch(e.type){case"inbound-rtp":r=e;break;case"outbound-rtp":i.push(e);break;case"media-source":l=e;break;case"track":s=e;break;case"codec":c=e;break;case"remote-inbound-rtp":o=e;break;case"remote-outbound-rtp":a=e}}));var d=s?s.remoteSource:!l,u=[],h=d?a:o;return(d?[r]:i).forEach((function(e){var t={},n=[e,l,s,c,h&&h.ssrc===e.ssrc?h:null];function r(e){var t=n.find((function(t){return t&&"undefined"!==typeof t[e]}))||null;return t?t[e]:null}var i=r("ssrc");"number"===typeof i&&(t.ssrc=String(i));var o=r("timestamp");t.timestamp=Math.round(o);var a=r("mimeType");"string"===typeof a&&(a=a.split("/"),t.codecName=a[a.length-1]);var p=r("roundTripTime");"number"===typeof p&&(t.roundTripTime=Math.round(1e3*p));var f=r("jitter");"number"===typeof f&&(t.jitter=Math.round(1e3*f));var m=r("frameWidth");"number"===typeof m&&(d?t.frameWidthReceived=m:(t.frameWidthSent=m,t.frameWidthInput=s?s.frameWidth:l.width));var _=r("frameHeight");"number"===typeof _&&(d?t.frameHeightReceived=_:(t.frameHeightSent=_,t.frameHeightInput=s?s.frameHeight:l.height));var g=r("framesPerSecond");"number"===typeof g&&(t[d?"frameRateReceived":"frameRateSent"]=g);var v=r("bytesReceived");"number"===typeof v&&(t.bytesReceived=v);var y=r("bytesSent");"number"===typeof y&&(t.bytesSent=y);var b=r("packetsLost");"number"===typeof b&&(t.packetsLost=b);var E=r("packetsReceived");"number"===typeof E&&(t.packetsReceived=E);var S=r("packetsSent");"number"===typeof S&&(t.packetsSent=S);var T=r("audioLevel");"number"===typeof T&&(T=Math.round(32767*T),d?t.audioOutputLevel=T:t.audioInputLevel=T);var w=r("totalPacketSendDelay");"number"===typeof w&&(t.totalPacketSendDelay=w);var C=r("totalEncodeTime");"number"===typeof C&&(t.totalEncodeTime=C);var R=r("framesEncoded");"number"===typeof R&&(t.framesEncoded=R);var k=r("estimatedPlayoutTimestamp");"number"===typeof k&&(t.estimatedPlayoutTimestamp=k);var O=r("totalDecodeTime");"number"===typeof O&&(t.totalDecodeTime=O);var I=r("framesDecoded");"number"===typeof I&&(t.framesDecoded=I);var N=r("jitterBufferDelay");"number"===typeof N&&(t.jitterBufferDelay=N);var A=r("jitterBufferEmittedCount");"number"===typeof A&&(t.jitterBufferEmittedCount=A),u.push(t)})),u}function T(e,t){void 0===e&&(e=new Map);var n=t.isRemote,r=t.simulateExceptionWhileStandardizingStats;if(void 0!==r&&r)throw new Error("Error while gathering stats");var i=null,o=null;e.forEach((function(t){var n=t.isRemote,r=t.remoteId,a=t.type;if(!n)switch(a){case"inbound-rtp":i=t,o=_(e,r);break;case"outbound-rtp":o=t,i=_(e,r)}}));var a=n?i:o,s=n?o:i;function c(e){return a&&"undefined"!==typeof a[e]?a[e]:s&&"undefined"!==typeof s[e]?s[e]:null}var l={},d=c("timestamp");l.timestamp=Math.round(d);var u=c("ssrc");"number"===typeof u&&(l.ssrc=String(u));var h=c("bytesSent");"number"===typeof h&&(l.bytesSent=h);var p=c("packetsLost");"number"===typeof p&&(l.packetsLost=p);var f=c("packetsSent");"number"===typeof f&&(l.packetsSent=f);var m=c("roundTripTime");"number"===typeof m&&(l.roundTripTime=Math.round(1e3*m));var g=c("jitter");"number"===typeof g&&(l.jitter=Math.round(1e3*g));var v=c("framerateMean");"number"===typeof v&&(l.frameRateSent=Math.round(v));var y=c("bytesReceived");"number"===typeof y&&(l.bytesReceived=y);var b=c("packetsReceived");"number"===typeof b&&(l.packetsReceived=b);var E=c("framerateMean");"number"===typeof E&&(l.frameRateReceived=Math.round(E));var S=c("totalPacketSendDelay");"number"===typeof S&&(l.totalPacketSendDelay=S);var T=c("totalEncodeTime");"number"===typeof T&&(l.totalEncodeTime=T);var w=c("framesEncoded");"number"===typeof w&&(l.framesEncoded=w);var C=c("estimatedPlayoutTimestamp");"number"===typeof C&&(l.estimatedPlayoutTimestamp=C);var R=c("totalDecodeTime");"number"===typeof R&&(l.totalDecodeTime=R);var k=c("framesDecoded");"number"===typeof k&&(l.framesDecoded=k);var O=c("jitterBufferDelay");"number"===typeof O&&(l.jitterBufferDelay=O);var I=c("jitterBufferEmittedCount");return"number"===typeof I&&(l.jitterBufferEmittedCount=I),l}e.exports=function(e,t){return e&&"function"===typeof e.getStats?function(e,t){var n=y(e,"audio","local"),r=y(e,"video","local"),o=y(e,"audio"),s=y(e,"video"),c={activeIceCandidatePair:null,localAudioTrackStats:[],localVideoTrackStats:[],remoteAudioTrackStats:[],remoteVideoTrackStats:[]},d=a([[n,"localAudioTrackStats",!1],[r,"localVideoTrackStats",!1],[o,"remoteAudioTrackStats",!0],[s,"remoteVideoTrackStats",!0]],(function(n){var r=i(n,3),o=r[0],a=r[1],s=r[2];return o.map((function(n){return function(e,t,n){void 0===n&&(n={});if("undefined"!==typeof n.testForChrome||h)return b(e,t,n);if("undefined"!==typeof n.testForFirefox||p)return function(e,t,n){return e.getStats(t).then((function(e){return[T(e,n)]}))}(e,t,n);if("undefined"!==typeof n.testForSafari||f)return"undefined"!==typeof n.testForSafari||"unified"===l()?b(e,t,n):Promise.reject(new Error(["getStats() is not supported on this version of Safari","due to this bug: https://bugs.webkit.org/show_bug.cgi?id=192601"].join(" ")));return Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}(e,n,Object.assign({isRemote:s},t)).then((function(e){e.forEach((function(e){e.trackId=n.id,c[a].push(e)}))}))}))}));return Promise.all(d).then((function(){return function(e,t){void 0===t&&(t={});if("undefined"!==typeof t.testForChrome||h||"undefined"!==typeof t.testForSafari||f)return e.getStats().then(g);if("undefined"!==typeof t.testForFirefox||p)return e.getStats().then(v);return Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}(e,t)})).then((function(e){return c.activeIceCandidatePair=e,c}))}(e,t):Promise.reject(new Error("Given PeerConnection does not support getStats"))}},745:e=>{"use strict";e.exports=function(e){return void 0===e&&(e={audio:!0,video:!0}),"object"===typeof navigator&&"object"===typeof navigator.mediaDevices&&"function"===typeof navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(e):Promise.reject(new Error("getUserMedia is not supported"))}},7422:(e,t,n)=>{"use strict";var r={};Object.defineProperties(r,{getStats:{enumerable:!0,value:n(2807)},getUserMedia:{enumerable:!0,value:n(745)},MediaStream:{enumerable:!0,value:n(8194)},MediaStreamTrack:{enumerable:!0,value:n(5919)},RTCIceCandidate:{enumerable:!0,value:n(9125)},RTCPeerConnection:{enumerable:!0,value:n(5654)},RTCSessionDescription:{enumerable:!0,value:n(6156)}}),e.exports=r},8194:e=>{"use strict";"function"===typeof MediaStream?e.exports=MediaStream:e.exports=function(){throw new Error("MediaStream is not supported")}},5919:e=>{"use strict";"function"===typeof MediaStreamTrack?e.exports=MediaStreamTrack:e.exports=function(){throw new Error("MediaStreamTrack is not supported")}},9125:e=>{"use strict";"function"===typeof RTCIceCandidate?e.exports=RTCIceCandidate:e.exports=function(){throw new Error("RTCIceCandidate is not supported")}},8114:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=n(9940),s=n(523),c=n(6289),l=n(8194),d=n(4666),u=n(2138),h=u.getSdpFormat,p=u.updatePlanBTrackIdsToSSRCs,f=u.updateUnifiedPlanTrackIdsToSSRCs,m=n(295),_=m.delegateMethods,g=m.interceptEvent,v=m.isIOSChrome,y=m.legacyPromise,b=m.proxyProperties,E="unified"===h(),S=function(e){function t(t,n){void 0===t&&(t={});var r=e.call(this)||this,a=Object.assign(t.iceTransportPolicy?{iceTransports:t.iceTransportPolicy}:{},t);g(r,"datachannel"),g(r,"signalingstatechange");var s=h(a.sdpSemantics),d=new RTCPeerConnection(a,n);return Object.defineProperties(r,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_localStream:{value:new l},_peerConnection:{value:d},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_sdpFormat:{value:s},_senders:{value:new Map},_signalingStateLatch:{value:new c},_tracksToSSRCs:{value:new Map,writable:!0}}),d.addEventListener("datachannel",(function(e){k(e.channel),r.dispatchEvent(e)})),d.addEventListener("signalingstatechange",(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];"stable"===d.signalingState&&(r._appliedTracksToSSRCs=new Map(r._tracksToSSRCs)),r._pendingLocalOffer||r._pendingRemoteOffer||r.dispatchEvent.apply(r,o([],i(e)))})),d.ontrack=function(){},"function"!==typeof d.addTrack&&d.addStream(r._localStream),b(RTCPeerConnection.prototype,r,d),r}return r(t,e),Object.defineProperty(t.prototype,"localDescription",{get:function(){return this._pendingLocalOffer?this._pendingLocalOffer:this._peerConnection.localDescription},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteDescription",{get:function(){return this._pendingRemoteOffer?this._pendingRemoteOffer:this._peerConnection.remoteDescription},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"signalingState",{get:function(){return this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),t.prototype.addTrack=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if("function"===typeof this._peerConnection.addTrack)return(t=this._peerConnection).addTrack.apply(t,o([e],i(n)));if("closed"===this._peerConnection.signalingState)throw new Error("Cannot add MediaStreamTrack ["+e.id+", \n        "+e.kind+"]: RTCPeerConnection is closed");var a=this._senders.get(e);if(a&&a.track)throw new Error("Cannot add MediaStreamTrack ['"+e.id+", \n        "+e.kind+"]: RTCPeerConnection already has it");return this._peerConnection.removeStream(this._localStream),this._localStream.addTrack(e),this._peerConnection.addStream(this._localStream),a=new d(e),this._senders.set(e,a),a},t.prototype.removeTrack=function(e){if("closed"===this._peerConnection.signalingState)throw new Error("Cannot remove MediaStreamTrack: RTCPeerConnection is closed");if("function"===typeof this._peerConnection.addTrack)try{return this._peerConnection.removeTrack(e)}catch(n){}else{var t=e.track;if(!t)return;(e=this._senders.get(t))&&e.track&&(e.track=null,this._peerConnection.removeStream(this._localStream),this._localStream.removeTrack(t),this._peerConnection.addStream(this._localStream))}},t.prototype.getSenders=function(){return"function"===typeof this._peerConnection.addTrack?this._peerConnection.getSenders():Array.from(this._senders.values())},t.prototype.addIceCandidate=function(e){for(var t,n=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return t="have-remote-offer"===this.signalingState?this._signalingStateLatch.when("low").then((function(){return n._peerConnection.addIceCandidate(e)})):this._peerConnection.addIceCandidate(e),r.length>0?y.apply(void 0,o([t],i(r))):t},t.prototype.close=function(){"closed"!==this.signalingState&&(this._pendingLocalOffer=null,this._pendingRemoteOffer=null,this._peerConnection.close())},t.prototype.createAnswer=function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return e=this._pendingRemoteOffer?this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then((function(){return t._signalingStateLatch.lower(),t._peerConnection.createAnswer()})).then((function(e){return t._pendingRemoteOffer=null,t._rolledBackTracksToSSRCs.clear(),new a({type:"answer",sdp:O(t._sdpFormat,t._tracksToSSRCs,e.sdp)})}),(function(e){throw t._pendingRemoteOffer=null,e})):this._peerConnection.createAnswer().then((function(e){return t._rolledBackTracksToSSRCs.clear(),new a({type:"answer",sdp:O(t._sdpFormat,t._tracksToSSRCs,e.sdp)})})),n.length>1?y.apply(void 0,o([e],i(n))):e},t.prototype.createOffer=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=i(t,3),o=r[0],s=r[1],c=r[2]||o||{};if(v()){if(c.offerToReceiveVideo&&!this._audioTransceiver&&(!E||!w(this,"audio"))){delete c.offerToReceiveAudio;try{this._audioTransceiver=E?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio")}catch(d){return Promise.reject(d)}}if(c.offerToReceiveVideo&&!this._videoTransceiver&&(!E||!w(this,"video"))){delete c.offerToReceiveVideo;try{this._videoTransceiver=E?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video")}catch(d){return Promise.reject(d)}}}var l=this._peerConnection.createOffer(c).then((function(t){return e._rolledBackTracksToSSRCs.clear(),new a({type:t.type,sdp:O(e._sdpFormat,e._tracksToSSRCs,t.sdp)})}));return t.length>1?y(l,o,s):l},t.prototype.createDataChannel=function(e,t){t=function(e){e=Object.assign({},e),R()&&"maxPacketLifeTime"in e&&(e.maxRetransmitTime=e.maxPacketLifeTime);return e}(t);var n=this._peerConnection.createDataChannel(e,t);return k(n),n},t.prototype.setLocalDescription=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=i(e,3),r=n[0],o=n[1],a=n[2];this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear());var s=T(this,!0,r);return e.length>1?y(s,o,a):s},t.prototype.setRemoteDescription=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=i(e,3),r=n[0],o=n[1],a=n[2];this._rolledBackTracksToSSRCs.clear();var s=T(this,!1,r);return e.length>1?y(s,o,a):s},t}(s);function T(e,t,n){var r,i,o=t?e._pendingLocalOffer:e._pendingRemoteOffer,a=t?e._pendingRemoteOffer:e._pendingLocalOffer,s=t?"have-local-offer":"have-remote-offer",c=t?"setLocalDescription":"setRemoteDescription";if(!t&&a&&"answer"===n.type)r=function(e,t){var n=e._pendingLocalOffer;return e._peerConnection.setLocalDescription(n).then((function(){return e._pendingLocalOffer=null,e.setRemoteDescription(t)})).then((function(){e._signalingStateLatch.lower()}))}(e,n);else if("offer"===n.type){if(e.signalingState!==s&&"stable"!==e.signalingState)return Promise.reject(new Error("Cannot set "+(t?"local":"remote")+" offer in state "+e.signalingState));o||"low"!==e._signalingStateLatch.state||e._signalingStateLatch.raise();var l=e.signalingState;i=C(n),t?e._pendingLocalOffer=i:e._pendingRemoteOffer=i,r=Promise.resolve(),e.signalingState!==l&&r.then((function(){return e.dispatchEvent(new Event("signalingstatechange"))}))}else"rollback"===n.type&&(e.signalingState!==s?r=Promise.reject(new Error("Cannot rollback "+(t?"local":"remote")+" description in "+e.signalingState)):(t?e._pendingLocalOffer=null:e._pendingRemoteOffer=null,e._rolledBackTracksToSSRCs=new Map(e._tracksToSSRCs),e._tracksToSSRCs=new Map(e._appliedTracksToSSRCs),(r=Promise.resolve()).then((function(){return e.dispatchEvent(new Event("signalingstatechange"))}))));return r||e._peerConnection[c](C(n))}function w(e,t){return!!e.getTransceivers().find((function(e){var n=e.receiver,r=(void 0===n?{}:n).track;return(void 0===r?{}:r).kind===t}))}function C(e){return e instanceof a&&e._description?e._description:new RTCSessionDescription(e)}function R(){return"maxRetransmitTime"in RTCDataChannel.prototype&&!("maxPacketLifeTime"in RTCDataChannel.prototype)}function k(e){return Object.defineProperty(e,"maxRetransmits",{value:65535===e.maxRetransmits?null:e.maxRetransmits}),R()&&Object.defineProperty(e,"maxPacketLifeTime",{value:65535===e.maxRetransmitTime?null:e.maxRetransmitTime}),e}function O(e,t,n){return"unified"===e?f(t,n):p(t,n)}_(RTCPeerConnection.prototype,S.prototype,"_peerConnection"),e.exports=S},9479:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=n(523),s=n(4569),c=n(2138).updateUnifiedPlanTrackIdsToSSRCs,l=n(295),d=l.delegateMethods,u=l.interceptEvent,h=l.legacyPromise,p=l.proxyProperties,f=function(e){function t(t){var n=e.call(this)||this;u(n,"signalingstatechange");var r,a=new RTCPeerConnection(t);return Object.defineProperties(n,{_initiallyNegotiatedDtlsRole:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:a},_rollingBack:{value:!1,writable:!0},_tracksToSSRCs:{value:new Map},peerIdentity:{enumerable:!0,value:Promise.resolve({idp:"",name:""})}}),a.addEventListener("signalingstatechange",(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n._rollingBack||n.signalingState===r||(r=n.signalingState,n._isClosed?setTimeout((function(){return n.dispatchEvent.apply(n,o([],i(e)))})):n.dispatchEvent.apply(n,o([],i(e))))})),p(RTCPeerConnection.prototype,n,a),n}return r(t,e),Object.defineProperty(t.prototype,"iceGatheringState",{get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localDescription",{get:function(){return g(this._peerConnection.localDescription,this._initiallyNegotiatedDtlsRole)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"signalingState",{get:function(){return this._isClosed?"closed":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),t.prototype.createAnswer=function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return e=this._peerConnection.createAnswer().then((function(e){return _(t,e),g(e,t._initiallyNegotiatedDtlsRole)})),"function"===typeof n[0]?h.apply(void 0,o([e],i(n))):e},t.prototype.createOffer=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r,o=i(t,3),a=o[0],l=o[1],d=o[2]||a||{};"have-local-offer"===this.signalingState||"have-remote-offer"===this.signalingState?r=m(this,"have-local-offer"===this.signalingState,(function(){return e.createOffer(d)})):r=this._peerConnection.createOffer(d);return r=r.then((function(t){return new s({type:t.type,sdp:c(e._tracksToSSRCs,t.sdp)})})),t.length>1?h(r,a,l):r},t.prototype.setLocalDescription=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r,a=i(t),s=a[0],c=a.slice(1);return s&&"answer"===s.type&&"have-local-offer"===this.signalingState&&(r=Promise.reject(new Error("Cannot set local answer in state have-local-offer"))),r?t.length>1?h.apply(void 0,o([r],i(c))):r:(e=this._peerConnection).setLocalDescription.apply(e,o([],i(t)))},t.prototype.setRemoteDescription=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r,a=i(t),s=a[0],c=a.slice(1);return s&&"have-remote-offer"===this.signalingState&&("answer"===s.type?r=Promise.reject(new Error("Cannot set remote answer in state have-remote-offer")):"offer"===s.type&&(r=m(this,!1,(function(){return e._peerConnection.setRemoteDescription(s)})))),r||(r=this._peerConnection.setRemoteDescription(s)),r=r.then((function(){return _(e,s,!0)})),t.length>1?h.apply(void 0,o([r],i(c))):r},t.prototype.close=function(){"closed"!==this.signalingState&&(this._isClosed=!0,this._peerConnection.close())},t}(a);function m(e,t,n){var r=t?"setLocalDescription":"setRemoteDescription";return e._rollingBack=!0,e._peerConnection[r](new s({type:"rollback"})).then(n).then((function(t){return e._rollingBack=!1,t}),(function(t){throw e._rollingBack=!1,t}))}function _(e,t,n){if(!e._initiallyNegotiatedDtlsRole&&"offer"!==t.type){var r=t.sdp.match(/a=setup:([a-z]+)/);if(r){var i=r[1];e._initiallyNegotiatedDtlsRole=n?{active:"passive",passive:"active"}[i]:i}}}function g(e,t){return e&&"answer"===e.type&&t?new s({type:e.type,sdp:e.sdp.replace(/a=setup:[a-z]+/g,"a=setup:"+t)}):e}d(RTCPeerConnection.prototype,f.prototype,"_peerConnection"),e.exports=f},5654:(e,t,n)=>{"use strict";if("function"===typeof RTCPeerConnection)switch((0,n(295).guessBrowser)()){case"chrome":e.exports=n(8114);break;case"firefox":e.exports=n(9479);break;case"safari":e.exports=n(1292);break;default:e.exports=RTCPeerConnection}else e.exports=function(){throw new Error("RTCPeerConnection is not supported")}},1292:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},a=n(523),s=n(6289),c=n(2138),l=c.getSdpFormat,d=c.updatePlanBTrackIdsToSSRCs,u=c.updateUnifiedPlanTrackIdsToSSRCs,h=n(295),p=h.delegateMethods,f=h.interceptEvent,m=h.proxyProperties,_="unified"===l(),g=_?u:d,v=function(e){function t(t){var n=e.call(this)||this;f(n,"datachannel"),f(n,"iceconnectionstatechange"),f(n,"signalingstatechange"),f(n,"track");var r=new RTCPeerConnection(t);return Object.defineProperties(n,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_audioTransceiver:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:r},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_signalingStateLatch:{value:new s},_tracksToSSRCs:{value:new Map,writable:!0},_videoTransceiver:{value:null,writable:!0}}),r.addEventListener("datachannel",(function(e){E(e.channel),n.dispatchEvent(e)})),r.addEventListener("iceconnectionstatechange",(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n._isClosed||n.dispatchEvent.apply(n,o([],i(e)))})),r.addEventListener("signalingstatechange",(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n._isClosed||("stable"===r.signalingState&&(n._appliedTracksToSSRCs=new Map(n._tracksToSSRCs)),n._pendingLocalOffer||n._pendingRemoteOffer||n.dispatchEvent.apply(n,o([],i(e))))})),r.addEventListener("track",(function(e){n._pendingRemoteOffer=null,n.dispatchEvent(e)})),m(RTCPeerConnection.prototype,n,r),n}return r(t,e),Object.defineProperty(t.prototype,"localDescription",{get:function(){return this._pendingLocalOffer||this._peerConnection.localDescription},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iceConnectionState",{get:function(){return this._isClosed?"closed":this._peerConnection.iceConnectionState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iceGatheringState",{get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteDescription",{get:function(){return this._pendingRemoteOffer||this._peerConnection.remoteDescription},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"signalingState",{get:function(){return this._isClosed?"closed":this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":this._peerConnection.signalingState},enumerable:!1,configurable:!0}),t.prototype.addIceCandidate=function(e){var t=this;return"have-remote-offer"===this.signalingState?this._signalingStateLatch.when("low").then((function(){return t._peerConnection.addIceCandidate(e)})):this._peerConnection.addIceCandidate(e)},t.prototype.createOffer=function(e){var t=this;if((e=Object.assign({},e)).offerToReceiveVideo&&!this._audioTransceiver&&(!_||!b(this,"audio"))){delete e.offerToReceiveAudio;try{this._audioTransceiver=_?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio")}catch(n){return Promise.reject(n)}}if(e.offerToReceiveVideo&&!this._videoTransceiver&&(!_||!b(this,"video"))){delete e.offerToReceiveVideo;try{this._videoTransceiver=_?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video")}catch(n){return Promise.reject(n)}}return this._peerConnection.createOffer(e).then((function(e){return t._rolledBackTracksToSSRCs.clear(),new RTCSessionDescription({type:e.type,sdp:g(t._tracksToSSRCs,e.sdp)})}))},t.prototype.createAnswer=function(e){var t=this;return this._pendingRemoteOffer?this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then((function(){return t._signalingStateLatch.lower(),t._peerConnection.createAnswer()})).then((function(e){return t._pendingRemoteOffer=null,t._rolledBackTracksToSSRCs.clear(),_?new RTCSessionDescription({type:e.type,sdp:g(t._tracksToSSRCs,e.sdp)}):e}),(function(e){throw t._pendingRemoteOffer=null,e})):this._peerConnection.createAnswer(e).then((function(e){return t._rolledBackTracksToSSRCs.clear(),_?new RTCSessionDescription({type:e.type,sdp:g(t._tracksToSSRCs,e.sdp)}):e}))},t.prototype.createDataChannel=function(e,t){var n=this._peerConnection.createDataChannel(e,t);return E(n),n},t.prototype.removeTrack=function(e){e.replaceTrack(null),this._peerConnection.removeTrack(e)},t.prototype.setLocalDescription=function(e){return this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear()),y(this,!0,e)},t.prototype.setRemoteDescription=function(e){return this._rolledBackTracksToSSRCs.clear(),y(this,!1,e)},t.prototype.close=function(){var e=this;this._isClosed||(this._isClosed=!0,this._peerConnection.close(),setTimeout((function(){e.dispatchEvent(new Event("iceconnectionstatechange")),e.dispatchEvent(new Event("signalingstatechange"))})))},t}(a);function y(e,t,n){var r,i=t?e._pendingLocalOffer:e._pendingRemoteOffer,o=t?e._pendingRemoteOffer:e._pendingLocalOffer,a=t?"have-local-offer":"have-remote-offer",s=t?"setLocalDescription":"setRemoteDescription";if(!t&&o&&"answer"===n.type)return function(e,t){var n=e._pendingLocalOffer;return e._peerConnection.setLocalDescription(n).then((function(){return e._pendingLocalOffer=null,e.setRemoteDescription(t)})).then((function(){return e._signalingStateLatch.lower()}))}(e,n);if("offer"===n.type){if(e.signalingState!==a&&"stable"!==e.signalingState)return Promise.reject(new Error("Cannot set "+(t?"local":"remote")+"\n        offer in state "+e.signalingState));i||"low"!==e._signalingStateLatch.state||e._signalingStateLatch.raise();var c=e.signalingState;return r=n,t?e._pendingLocalOffer=r:e._pendingRemoteOffer=r,e.signalingState!==c?Promise.resolve().then((function(){return e.dispatchEvent(new Event("signalingstatechange"))})):Promise.resolve()}return"rollback"===n.type?e.signalingState!==a?Promise.reject(new Error("Cannot rollback \n        "+(t?"local":"remote")+" description in "+e.signalingState)):(t?e._pendingLocalOffer=null:e._pendingRemoteOffer=null,e._rolledBackTracksToSSRCs=new Map(e._tracksToSSRCs),e._tracksToSSRCs=new Map(e._appliedTracksToSSRCs),Promise.resolve().then((function(){return e.dispatchEvent(new Event("signalingstatechange"))}))):e._peerConnection[s](n)}function b(e,t){return!!e.getTransceivers().find((function(e){var n=e.receiver,r=(void 0===n?{}:n).track;return(void 0===r?{}:r).kind===t}))}function E(e){return Object.defineProperties(e,{maxPacketLifeTime:{value:65535===e.maxPacketLifeTime?null:e.maxPacketLifeTime},maxRetransmits:{value:65535===e.maxRetransmits?null:e.maxRetransmits}})}p(RTCPeerConnection.prototype,v.prototype,"_peerConnection"),e.exports=v},4666:e=>{"use strict";var t=function(e){Object.defineProperties(this,{track:{enumerable:!0,value:e,writable:!0}})};e.exports=t},9940:e=>{"use strict";var t=function(){function e(e){this.descriptionInitDict=e;var t=e&&"rollback"===e.type?null:new RTCSessionDescription(e);Object.defineProperties(this,{_description:{get:function(){return t}}})}return Object.defineProperty(e.prototype,"sdp",{get:function(){return this._description?this._description.sdp:this.descriptionInitDict.sdp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._description?this._description.type:this.descriptionInitDict.type},enumerable:!1,configurable:!0}),e}();e.exports=t},4569:e=>{"use strict";e.exports=RTCSessionDescription},6156:(e,t,n)=>{"use strict";if("function"===typeof RTCSessionDescription)switch((0,n(295).guessBrowser)()){case"chrome":e.exports=n(9940);break;case"firefox":e.exports=n(4569);break;default:e.exports=RTCSessionDescription}else e.exports=function(){throw new Error("RTCSessionDescription is not supported")}},295:function(e,t){"use strict";var n=this&&this.__read||function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};function i(e,t,n,r){if(!(r in t)&&!r.match(/^on[a-z]+$/)){var i=!1;try{var o=Object.getOwnPropertyDescriptor(e,r);i=o&&!!o.get}catch(s){}if(!i){var a;try{a=typeof e[r]}catch(s){}"function"===a&&(t[r]=function(){return this[n][r].apply(this[n],arguments)})}}}function o(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:null}function a(e){return"undefined"===typeof e&&(e=o()),/Chrome|CriOS/.test(e)?"chrome":/Firefox|FxiOS/.test(e)?"firefox":/Safari|iPhone|iPad|iPod/.test(e)?"safari":null}var s=new Map;t.clearCachedSupportedCodecs=function(){s.clear()},t.defer=function(){var e={};return e.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),e},t.delegateMethods=function(e,t,n){for(var r in e)i(e,t,n,r)},t.difference=function(e,t){e=Array.isArray(e)?new Set(e):new Set(e.values()),t=Array.isArray(t)?new Set(t):new Set(t.values());var n=new Set;return e.forEach((function(e){t.has(e)||n.add(e)})),n},t.flatMap=function(e,t){return(e instanceof Map||e instanceof Set?Array.from(e.values()):e).reduce((function(e,n){return e.concat(t(n))}),[])},t.guessBrowser=a,t.guessBrowserVersion=function(e){"undefined"===typeof e&&(e=o());var t={chrome:"Chrome|CriOS",firefox:"Firefox|FxiOS",safari:"Version"}[a(e)];if(!t)return null;var r=new RegExp("("+t+")/([^\\s]+)"),i=n(e.match(r)||[],3)[2];if(!i)return null;var s=i.split(".").map(Number);return{major:isNaN(s[0])?null:s[0],minor:isNaN(s[1])?null:s[1]}},t.isCodecSupported=function(e,t){var n=s.get(t);return n?Promise.resolve(n.has(e.toLowerCase())):function(e){if("undefined"!==typeof RTCRtpSender&&"function"===typeof RTCRtpSender.getCapabilities)return Promise.resolve(new Set(RTCRtpSender.getCapabilities(e).codecs.map((function(e){return e.mimeType.split("/")[1].toLowerCase()}))));if("undefined"===typeof RTCPeerConnection||"undefined"===typeof RTCPeerConnection.prototype||"function"!==typeof RTCPeerConnection.prototype.addTransceiver||"function"!==typeof RTCPeerConnection.prototype.close||"function"!==typeof RTCPeerConnection.prototype.createOffer)return Promise.resolve(new Set);var t=new RTCPeerConnection;return t.addTransceiver(e),t.createOffer().then((function(e){var n=e.sdp;return t.close(),new Set((n.match(/^a=rtpmap:.+$/gm)||[]).map((function(e){return e.match(/^a=rtpmap:.+ ([^/]+)/)[1].toLowerCase()})))}),(function(){return t.close(),new Set}))}(t).then((function(n){return s.set(t,n),n.has(e.toLowerCase())}))},t.isIOSChrome=function(e){return"undefined"===typeof e&&(e=o()),/Mobi/.test(e)&&"chrome"===a()&&/iPad|iPhone|iPod/.test(e)},t.interceptEvent=function(e,t){var n=null;Object.defineProperty(e,"on"+t,{get:function(){return n},set:function(e){n&&this.removeEventListener(t,n),"function"===typeof e?(n=e,this.addEventListener(t,n)):n=null}})},t.legacyPromise=function(e,t,n){return t?e.then(t,n):e},t.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},t.proxyProperties=function(e,t,i){Object.getOwnPropertyNames(e).forEach((function(e){!function(e,t,i,o){if(o in t)return;if(o.match(/^on[a-z]+$/))return Object.defineProperty(t,o,{value:null,writable:!0}),void i.addEventListener(o.slice(2),(function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.dispatchEvent.apply(t,r([],n(e)))}));Object.defineProperty(t,o,{enumerable:!0,get:function(){return i[o]}})}(0,t,i,e)}))},t.support=function(){return"object"===typeof navigator&&"object"===typeof navigator.mediaDevices&&"function"===typeof navigator.mediaDevices.getUserMedia&&"function"===typeof RTCPeerConnection}},6289:(e,t,n)=>{"use strict";var r=n(295).defer,i={high:new Set(["low"]),low:new Set(["high"])},o=function(){function e(e){void 0===e&&(e="low");var t=e;Object.defineProperties(this,{_state:{set:function(e){var n=this;if(t!==e){t=e;var r=this._whenDeferreds.get(t);r.forEach((function(e){return e.resolve(n)})),r.clear()}},get:function(){return t}},_whenDeferreds:{value:new Map([["high",new Set],["low",new Set]])}})}return Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),e.prototype.lower=function(){return this.transition("low")},e.prototype.raise=function(){return this.transition("high")},e.prototype.transition=function(e){if(!i[this.state].has(e))throw a(this.state,e);return this._state=e,this},e.prototype.when=function(e){if(this.state===e)return Promise.resolve(this);if(!i[this.state].has(e))return Promise.reject(a(this.state,e));var t=r();return this._whenDeferreds.get(e).add(t),t.promise},e}();function a(e,t){return new Error('Cannot transition from "'+e+'" to "'+t+'"')}e.exports=o},2138:(e,t,n)=>{"use strict";var r=n(295),i=r.flatMap,o=r.guessBrowser,a=null;var s=null;function c(e){return e&&function(){if("boolean"===typeof a)return a;if("undefined"===typeof RTCPeerConnection)return a=!1;try{new RTCPeerConnection({sdpSemantics:"foo"}),a=!1}catch(e){a=!0}return a}()?{"plan-b":"planb","unified-plan":"unified"}[e]:function(){if(!s)if("undefined"!==typeof RTCPeerConnection&&"addTransceiver"in RTCPeerConnection.prototype){var e=new RTCPeerConnection;try{e.addTransceiver("audio"),s="unified"}catch(t){s="planb"}e.close()}else s="planb";return s}()}function l(e,t){return(t.match(new RegExp(e,"gm"))||[]).reduce((function(t,n){var r=n.match(new RegExp(e));return r?t.add(r[1]):t}),new Set)}function d(e,t){return l(e,t)}function u(e){return d("^a=ssrc:[0-9]+ +msid:.+ +(.+) *$",e)}function h(e){return d("^a=msid:.+ +(.+) *$",e)}function p(e,t){return l("^a=ssrc:([0-9]+) +msid:[^ ]+ +"+t+" *$",e)}function f(e,t,n){return void 0===t&&(t=".*"),void 0===n&&(n=".*"),e.split("\r\nm=").slice(1).map((function(e){return"m="+e})).filter((function(e){var r=new RegExp("m="+t,"gm"),i=new RegExp("a="+n,"gm");return r.test(e)&&i.test(e)}))}function m(e){return Array.from(l("^a=ssrc:([0-9]+) +.*$",e))}function _(e,t){var n=f(e),r=new RegExp("^a=msid:[^ ]+ +"+t+" *$","gm"),o=n.filter((function(e){return e.match(r)}));return new Set(i(o,m))}function g(e,t,n){return new Map(Array.from(e(n)).map((function(e){return[e,t(n,e)]})))}function v(e){return g(u,p,e)}function y(e){return g(h,_,e)}function b(e,t,n){var r=e(n),i=new Map;r.forEach((function(e,r){if(t.has(r)){var o=Array.from(t.get(r)),a=Array.from(e);o.forEach((function(e,t){var r=a[t];i.set(r,e);var o="^a=ssrc:"+r+" (.*)$",s="a=ssrc:"+e+" $1";n=n.replace(new RegExp(o,"gm"),s)}))}else t.set(r,e)}));var o="^(a=ssrc-group:[^ ]+ +)(.*)$";return(n.match(new RegExp(o,"gm"))||[]).forEach((function(e){var t=e.match(new RegExp(o));if(t){var r=t[1],a=t[2].split(" ").map((function(e){var t=i.get(e);return t||e})).join(" ");n=n.replace(t[0],r+a)}})),n}t.clearChromeCachedSdpFormat=function(){s=null},t.getSdpFormat=function(e){return{chrome:c(e),firefox:"unified",safari:"undefined"!==typeof RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype?"unified":"planb"}[o()]||null},t.getMediaSections=f,t.getPlanBTrackIds=u,t.getUnifiedPlanTrackIds=h,t.getPlanBSSRCs=p,t.getUnifiedPlanSSRCs=_,t.updatePlanBTrackIdsToSSRCs=function(e,t){return b(v,e,t)},t.updateUnifiedPlanTrackIdsToSSRCs=function(e,t){return b(y,e,t)}},6921:e=>{e.exports=WebSocket},4084:e=>{"use strict";e.exports=JSON.parse('{"name":"twilio-video","title":"Twilio Video","description":"Twilio Video JavaScript Library","version":"2.31.0","homepage":"https://twilio.com","author":"Mark Andrus Roberts <mroberts@twilio.com>","contributors":["Ryan Rowland <rrowland@twilio.com>","Manjesh Malavalli <mmalavalli@twilio.com>","Makarand Patwardhan <mpatwardhan@twilio.com>","Luis Rivas <lrivas@twilio.com>"],"keywords":["twilio","webrtc","library","javascript","video","rooms"],"repository":{"type":"git","url":"https://github.com/twilio/twilio-video.js.git"},"devDependencies":{"@babel/core":"^7.14.2","@babel/plugin-proposal-class-properties":"^7.18.6","@babel/plugin-proposal-object-rest-spread":"^7.20.7","@babel/preset-env":"^7.14.2","@babel/preset-typescript":"^7.13.0","@types/express":"^4.11.0","@types/node":"^8.5.1","@types/selenium-webdriver":"^3.0.8","@types/ws":"^3.2.1","@typescript-eslint/eslint-plugin":"^4.13.0","@typescript-eslint/parser":"^4.0.0","babel-cli":"^6.26.0","babel-preset-es2015":"^6.24.1","browserify":"^17.0.0","cheerio":"^0.22.0","cors":"^2.8.5","electron":"^17.2.0","envify":"^4.0.0","eslint":"^6.2.1","eslint-config-standard":"^14.0.0","eslint-plugin-import":"^2.18.2","eslint-plugin-node":"^9.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^4.0.1","express":"^4.16.2","glob":"^7.1.7","ink-docstrap":"^1.3.2","inquirer":"^7.0.0","is-docker":"^2.0.0","jsdoc":"^3.5.5","jsdoc-babel":"^0.5.0","json-loader":"^0.5.7","karma":"6.4.1","karma-browserify":"^8.0.0","karma-chrome-launcher":"^2.0.0","karma-edgium-launcher":"^4.0.0-0","karma-electron":"^6.1.0","karma-firefox-launcher":"^1.3.0","karma-htmlfile-reporter":"^0.3.8","karma-junit-reporter":"^1.2.0","karma-mocha":"^1.3.0","karma-safari-launcher":"^1.0.0","karma-spec-reporter":"0.0.32","karma-typescript":"^5.5.1","karma-typescript-es6-transform":"^5.5.1","mocha":"^3.2.0","mock-require":"^3.0.3","ncp":"^2.0.0","node-http-server":"^8.1.2","npm-run-all":"^4.0.2","nyc":"^15.1.0","regex-replace":"^2.3.1","requirejs":"^2.3.3","rimraf":"^2.6.1","simple-git":"^1.126.0","sinon":"^4.0.1","ts-node":"4.0.1","tslint":"5.8.0","twilio":"^3.49.0","twilio-release-tool":"^1.0.2","typescript":"4.2.2","uglify-js":"^2.8.22","vinyl-fs":"^2.4.4","vinyl-source-stream":"^1.1.0","watchify":"^3.11.1","webrtc-adapter":"^7.7.1"},"engines":{"node":">=0.12"},"license":"BSD-3-Clause","main":"./es5/index.js","types":"./tsdef/index.d.ts","scripts":{"lint:js":"eslint ./lib ./test/*.js ./docker/**/*.js ./test/framework/*.js ./test/lib/*.js ./test/integration/** ./test/unit/** ","lint:ts":"eslint ./tsdef/*.ts ./lib/**/*.ts","lint":"npm-run-all lint:js lint:ts","patch-linkifyit-111":"regex-replace \\"readonly linkify: LinkifyIt.LinkifyIt;\\" \\"readonly linkify: typeof LinkifyIt;\\" \\"node_modules/@types/markdown-it/lib/index.d.ts\\" --filecontents","printVersion":"node --version && npm --version","test:unit":"npm-run-all printVersion build:es5 && nyc --report-dir=./coverage --include=lib/**/* --reporter=html --reporter=lcov --reporter=text mocha -r ts-node/register ./test/unit/*","test:unit:quick":"nyc --report-dir=./coverage --include=lib/**/* --reporter=html --reporter=lcov mocha -r ts-node/register","test:serversiderender":"mocha ./test/serversiderender/index.js","test:integration:adapter":"node ./scripts/karma.js karma/integration.adapter.conf.js","test:integration":"npm run build:es5 && node ./scripts/karma.js karma/integration.conf.js","test:umd:install":"npm install puppeteer@19.2.2","test:umd":"mocha ./test/umd/index.js","test:crossbrowser:build:clean":"rimraf ./test/crossbrowser/lib ./test/crossbrowser/src/browser/index.js","test:crossbrowser:build:lint":"cd ./test/crossbrowser && tslint --project tsconfig.json","test:crossbrowser:build:tsc":"cd ./test/crossbrowser && tsc","test:crossbrowser:build:browser":"cd ./test/crossbrowser && browserify lib/crossbrowser/src/browser/index.js > src/browser/index.js","test:crossbrowser:build":"npm-run-all test:crossbrowser:build:*","test:crossbrowser:test":"cd ./test/crossbrowser && mocha --compilers ts:ts-node/register test/integration/spec/**/*.ts","test:crossbrowser":"npm-run-all test:crossbrowser:*","test:sdkdriver:build:clean":"rimraf ./test/lib/sdkdriver/lib ./test/lib/sdkdriver/test/integration/browser/index.js","test:sdkdriver:build:lint":"cd ./test/lib/sdkdriver && tslint --project tsconfig.json","test:sdkdriver:build:tsc":"cd ./test/lib/sdkdriver && tsc --rootDir src","test:sdkdriver:build":"npm-run-all test:sdkdriver:build:*","test:sdkdriver:test:unit":"cd ./test/lib/sdkdriver && mocha --compilers ts:ts-node/register test/unit/spec/**/*.ts","test:sdkdriver:test:integration:browser":"cd ./test/lib/sdkdriver/test/integration && browserify browser/browser.js > browser/index.js","test:sdkdriver:test:integration:run":"cd ./test/lib/sdkdriver && mocha --compilers ts:ts-node/register test/integration/spec/**/*.ts","test:sdkdriver:test:integration":"npm-run-all test:sdkdriver:test:integration:*","test:sdkdriver:test":"npm-run-all test:sdkdriver:test:*","test:sdkdriver":"npm-run-all test:sdkdriver:*","test:framework:angular:install":"cd ./test/framework/twilio-video-angular && rimraf ./node_modules package-lock.json && npm install","test:framework:angular:run":"mocha ./test/framework/twilio-video-angular.js","test:framework:angular":"npm-run-all test:framework:angular:*","test:framework:no-framework:run":"mocha ./test/framework/twilio-video-no-framework.js","test:framework:no-framework":"npm-run-all test:framework:no-framework:*","test:framework:react:install":"cd ./test/framework/twilio-video-react && rimraf ./node_modules package-lock.json && npm install","test:framework:react:test":"node ./scripts/framework.js twilio-video-react","test:framework:react:build":"cd ./test/framework/twilio-video-react && npm run build","test:framework:react:run":"mocha ./test/framework/twilio-video-react.js","test:framework:react":"npm-run-all test:framework:react:*","test:framework:install":"npm install chromedriver && npm install selenium-webdriver && npm install geckodriver && npm install puppeteer","test:framework":"npm-run-all test:framework:install test:framework:no-framework test:framework:react","test":"npm-run-all test:unit test:integration","build:es5":"rimraf ./es5 && mkdir -p es5 && npm run patch-linkifyit-111 && tsc tsdef/twilio-video-tests.ts --noEmit --lib es2018,dom && tsc","build:js":"node ./scripts/build.js ./src/twilio-video.js ./LICENSE.md ./dist/twilio-video.js","build:min.js":"uglifyjs ./dist/twilio-video.js -o ./dist/twilio-video.min.js --comments \\"/^! twilio-video.js/\\" -b beautify=false,ascii_only=true","build":"npm-run-all clean lint docs test:unit test:integration build:es5 build:js build:min.js test:umd","build:quick":"npm-run-all clean lint docs build:es5 build:js build:min.js","docs":"node ./scripts/docs.js ./dist/docs","watch":"tsc -w","clean":"rimraf ./coverage ./es5 ./dist"},"dependencies":{"events":"^3.3.0","util":"^0.12.4","ws":"^7.4.6","xmlhttprequest":"^1.8.0"},"browser":{"ws":"./src/ws.js","xmlhttprequest":"./src/xmlhttprequest.js"}}')}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};n.r(e),n.d(e,{hasBrowserEnv:()=>wn,hasStandardBrowserEnv:()=>Rn,hasStandardBrowserWebWorkerEnv:()=>kn,navigator:()=>Cn,origin:()=>On});var t=n(5043),r=n(4391);function i(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}function s(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}n(3175);const d=["sri"],u=["page"],h=["page","matches"],p=["onClick","discover","prefetch","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],f=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],m=["discover","fetcherKey","navigate","reloadDocument","replace","state","method","action","onSubmit","relative","preventScrollReset","viewTransition"];var _="popstate";function g(){return w((function(e,t){let{pathname:n,search:r,hash:i}=e.location;return E("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:S(t)}),null,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function v(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function y(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function b(e,t){return{usr:e.state,key:e.key,idx:t}}function E(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;return l(l({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?T(t):t),{},{state:n,key:t&&t.key||r||Math.random().toString(36).substring(2,10)})}function S(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function T(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substring(r),e=e.substring(0,r)),e&&(t.pathname=e)}return t}function w(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{window:i=document.defaultView,v5Compat:o=!1}=r,a=i.history,s="POP",c=null,d=u();function u(){return(a.state||{idx:null}).idx}function h(){s="POP";let e=u(),t=null==e?null:e-d;d=e,c&&c({action:s,location:f.location,delta:t})}function p(e){let t="null"!==i.location.origin?i.location.origin:i.location.href,n="string"===typeof e?e:S(e);return n=n.replace(/ $/,"%20"),v(t,"No window.location.(origin|href) available to create URL for href: ".concat(n)),new URL(n,t)}null==d&&(d=0,a.replaceState(l(l({},a.state),{},{idx:d}),""));let f={get action(){return s},get location(){return e(i,a)},listen(e){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(_,h),c=e,()=>{i.removeEventListener(_,h),c=null}},createHref:e=>t(i,e),createURL:p,encodeLocation(e){let t=p(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){s="PUSH";let r=E(f.location,e,t);n&&n(r,e),d=u()+1;let l=b(r,d),h=f.createHref(r);try{a.pushState(l,"",h)}catch(p){if(p instanceof DOMException&&"DataCloneError"===p.name)throw p;i.location.assign(h)}o&&c&&c({action:s,location:f.location,delta:1})},replace:function(e,t){s="REPLACE";let r=E(f.location,e,t);n&&n(r,e),d=u();let i=b(r,d),l=f.createHref(r);a.replaceState(i,"",l),o&&c&&c({action:s,location:f.location,delta:0})},go:e=>a.go(e)};return f}new WeakMap;function C(e,t){return R(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",!1)}function R(e,t,n,r){let i=B(("string"===typeof t?T(t):t).pathname||"/",n);if(null==i)return null;let o=k(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(o);let a=null;for(let s=0;null==a&&s<o.length;++s){let e=F(i);a=j(o[s],e,r)}return a}function k(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=(e,i,o)=>{let a={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};a.relativePath.startsWith("/")&&(v(a.relativePath.startsWith(r),'Absolute route path "'.concat(a.relativePath,'" nested under path "').concat(r,'" is not valid. An absolute child route path must start with the combined path of all its parent routes.')),a.relativePath=a.relativePath.slice(r.length));let s=K([r,a.relativePath]),c=n.concat(a);e.children&&e.children.length>0&&(v(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'.concat(s,'".')),k(e.children,t,c,s)),(null!=e.path||e.index)&&t.push({path:s,score:M(s,e.index),routesMeta:c})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!==(n=e.path)&&void 0!==n&&n.includes("?"))for(let r of O(e.path))i(e,t,r);else i(e,t)})),t}function O(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(0===r.length)return i?[o,""]:[o];let a=O(r.join("/")),s=[];return s.push(...a.map((e=>""===e?o:[o,e].join("/")))),i&&s.push(...a),s.map((t=>e.startsWith("/")&&""===t?"/":t))}var I=/^:[\w-]+$/,N=3,A=2,x=1,P=10,D=-2,L=e=>"*"===e;function M(e,t){let n=e.split("/"),r=n.length;return n.some(L)&&(r+=D),t&&(r+=A),n.filter((e=>!L(e))).reduce(((e,t)=>e+(I.test(t)?N:""===t?x:P)),r)}function j(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{routesMeta:r}=e,i={},o="/",a=[];for(let s=0;s<r.length;++s){let e=r[s],c=s===r.length-1,l="/"===o?t:t.slice(o.length)||"/",d=U({path:e.relativePath,caseSensitive:e.caseSensitive,end:c},l),u=e.route;if(!d&&c&&n&&!r[r.length-1].route.index&&(d=U({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},l)),!d)return null;Object.assign(i,d.params),a.push({params:i,pathname:K([o,d.pathname]),pathnameBase:q(K([o,d.pathnameBase])),route:u}),"/"!==d.pathnameBase&&(o=K([o,d.pathnameBase]))}return a}function U(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=V(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let o=i[0],a=o.replace(/(.)\/+$/,"$1"),s=i.slice(1);return{params:r.reduce(((e,t,n)=>{let{paramName:r,isOptional:i}=t;if("*"===r){let e=s[n]||"";a=o.slice(0,o.length-e.length).replace(/(.)\/+$/,"$1")}const c=s[n];return e[r]=i&&!c?void 0:(c||"").replace(/%2F/g,"/"),e}),{}),pathname:o,pathnameBase:a,pattern:e}}function V(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];y("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'.concat(e,'" will be treated as if it were "').concat(e.replace(/\*$/,"/*"),'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "').concat(e.replace(/\*$/,"/*"),'".'));let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));return e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),r]}function F(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return y(!1,'The URL path "'.concat(e,'" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (').concat(t,").")),e}}function B(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function W(e,t,n,r){return"Cannot include a '".concat(e,"' character in a manually specified `to.").concat(t,"` field [").concat(JSON.stringify(r),"].  Please separate it out to the `to.").concat(n,'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.')}function G(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function H(e){let t=G(e);return t.map(((e,n)=>n===t.length-1?e.pathname:e.pathnameBase))}function z(e,t,n){let r,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];"string"===typeof e?r=T(e):(r=l({},e),v(!r.pathname||!r.pathname.includes("?"),W("?","pathname","search",r)),v(!r.pathname||!r.pathname.includes("#"),W("#","pathname","hash",r)),v(!r.search||!r.search.includes("#"),W("#","search","hash",r)));let o,a=""===e||""===r.pathname,s=a?"/":r.pathname;if(null==s)o=n;else{let e=t.length-1;if(!i&&s.startsWith("..")){let t=s.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}o=e>=0?t[e]:"/"}let c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",{pathname:n,search:r="",hash:i=""}="string"===typeof e?T(e):e,o=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:o,search:Y(r),hash:J(i)}}(r,o),d=s&&"/"!==s&&s.endsWith("/"),u=(a||"."===s)&&n.endsWith("/");return c.pathname.endsWith("/")||!d&&!u||(c.pathname+="/"),c}var K=e=>e.join("/").replace(/\/\/+/g,"/"),q=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Y=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",J=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";function X(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}var Q=["POST","PUT","PATCH","DELETE"],Z=(new Set(Q),["GET",...Q]);new Set(Z),Symbol("ResetLoaderData");var $=t.createContext(null);$.displayName="DataRouter";var ee=t.createContext(null);ee.displayName="DataRouterState";var te=t.createContext({isTransitioning:!1});te.displayName="ViewTransition";var ne=t.createContext(new Map);ne.displayName="Fetchers";var re=t.createContext(null);re.displayName="Await";var ie=t.createContext(null);ie.displayName="Navigation";var oe=t.createContext(null);oe.displayName="Location";var ae=t.createContext({outlet:null,matches:[],isDataRoute:!1});ae.displayName="Route";var se=t.createContext(null);se.displayName="RouteError";function ce(){return null!=t.useContext(oe)}function le(){return v(ce(),"useLocation() may be used only in the context of a <Router> component."),t.useContext(oe).location}var de="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function ue(e){t.useContext(ie).static||t.useLayoutEffect(e)}function he(){let{isDataRoute:e}=t.useContext(ae);return e?function(){let{router:e}=Se("useNavigate"),n=we("useNavigate"),r=t.useRef(!1);ue((()=>{r.current=!0}));let i=t.useCallback((async function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};y(r.current,de),r.current&&("number"===typeof t?e.navigate(t):await e.navigate(t,l({fromRouteId:n},i)))}),[e,n]);return i}():function(){v(ce(),"useNavigate() may be used only in the context of a <Router> component.");let e=t.useContext($),{basename:n,navigator:r}=t.useContext(ie),{matches:i}=t.useContext(ae),{pathname:o}=le(),a=JSON.stringify(H(i)),s=t.useRef(!1);ue((()=>{s.current=!0}));let c=t.useCallback((function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(y(s.current,de),!s.current)return;if("number"===typeof t)return void r.go(t);let c=z(t,JSON.parse(a),o,"path"===i.relative);null==e&&"/"!==n&&(c.pathname="/"===c.pathname?n:K([n,c.pathname])),(i.replace?r.replace:r.push)(c,i.state,i)}),[n,r,a,o,e]);return c}()}t.createContext(null);function pe(){let{matches:e}=t.useContext(ae),n=e[e.length-1];return n?n.params:{}}function fe(e){let{relative:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{matches:r}=t.useContext(ae),{pathname:i}=le(),o=JSON.stringify(H(r));return t.useMemo((()=>z(e,JSON.parse(o),i,"path"===n)),[e,o,i,n])}function me(e,n,r,i){v(ce(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o,static:a}=t.useContext(ie),{matches:s}=t.useContext(ae),c=s[s.length-1],d=c?c.params:{},u=c?c.pathname:"/",h=c?c.pathnameBase:"/",p=c&&c.route;{let e=p&&p.path||"";ke(u,!p||e.endsWith("*")||e.endsWith("*?"),'You rendered descendant <Routes> (or called `useRoutes()`) at "'.concat(u,'" (under <Route path="').concat(e,'">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won\'t match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="').concat(e,'"> to <Route path="').concat("/"===e?"*":"".concat(e,"/*"),'">.'))}let f,m=le();if(n){var _;let e="string"===typeof n?T(n):n;v("/"===h||(null===(_=e.pathname)||void 0===_?void 0:_.startsWith(h)),'When overriding the location using `<Routes location>` or `useRoutes(routes, location)`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "'.concat(h,'" but pathname "').concat(e.pathname,'" was given in the `location` prop.')),f=e}else f=m;let g=f.pathname||"/",b=g;if("/"!==h){let e=h.replace(/^\//,"").split("/");b="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let E=!a&&r&&r.matches&&r.matches.length>0?r.matches:C(e,{pathname:b});y(p||null!=E,'No routes matched location "'.concat(f.pathname).concat(f.search).concat(f.hash,'" ')),y(null==E||void 0!==E[E.length-1].route.element||void 0!==E[E.length-1].route.Component||void 0!==E[E.length-1].route.lazy,'Matched leaf route at location "'.concat(f.pathname).concat(f.search).concat(f.hash,'" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.'));let S=be(E&&E.map((e=>Object.assign({},e,{params:Object.assign({},d,e.params),pathname:K([h,o.encodeLocation?o.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?h:K([h,o.encodeLocation?o.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),s,r,i);return n&&S?t.createElement(oe.Provider,{value:{location:l({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:"POP"}},S):S}function _e(){let e=Ce(),n=X(e)?"".concat(e.status," ").concat(e.statusText):e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:i},a={padding:"2px 4px",backgroundColor:i},s=null;return console.error("Error handled by React Router default ErrorBoundary:",e),s=t.createElement(t.Fragment,null,t.createElement("p",null,"\ud83d\udcbf Hey developer \ud83d\udc4b"),t.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",t.createElement("code",{style:a},"ErrorBoundary")," or"," ",t.createElement("code",{style:a},"errorElement")," prop on your route.")),t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),r?t.createElement("pre",{style:o},r):null,s)}var ge=t.createElement(_e,null),ve=class extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(ae.Provider,{value:this.props.routeContext},t.createElement(se.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function ye(e){let{routeContext:n,match:r,children:i}=e,o=t.useContext($);return o&&o.static&&o.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=r.route.id),t.createElement(ae.Provider,{value:n},i)}function be(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==e){if(!r)return null;if(r.errors)e=r.matches;else{if(0!==n.length||r.initialized||!(r.matches.length>0))return null;e=r.matches}}let i=e,o=null===r||void 0===r?void 0:r.errors;if(null!=o){let e=i.findIndex((e=>e.route.id&&void 0!==(null===o||void 0===o?void 0:o[e.route.id])));v(e>=0,"Could not find a matching route for errors on route IDs: ".concat(Object.keys(o).join(","))),i=i.slice(0,Math.min(i.length,e+1))}let a=!1,s=-1;if(r)for(let t=0;t<i.length;t++){let e=i[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(s=t),e.route.id){let{loaderData:t,errors:n}=r,o=e.route.loader&&!t.hasOwnProperty(e.route.id)&&(!n||void 0===n[e.route.id]);if(e.route.lazy||o){a=!0,i=s>=0?i.slice(0,s+1):[i[0]];break}}}return i.reduceRight(((e,c,l)=>{let d,u=!1,h=null,p=null;r&&(d=o&&c.route.id?o[c.route.id]:void 0,h=c.route.errorElement||ge,a&&(s<0&&0===l?(ke("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),u=!0,p=null):s===l&&(u=!0,p=c.route.hydrateFallbackElement||null)));let f=n.concat(i.slice(0,l+1)),m=()=>{let n;return n=d?h:u?p:c.route.Component?t.createElement(c.route.Component,null):c.route.element?c.route.element:e,t.createElement(ye,{match:c,routeContext:{outlet:e,matches:f,isDataRoute:null!=r},children:n})};return r&&(c.route.ErrorBoundary||c.route.errorElement||0===l)?t.createElement(ve,{location:r.location,revalidation:r.revalidation,component:h,error:d,children:m(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):m()}),null)}function Ee(e){return"".concat(e," must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.")}function Se(e){let n=t.useContext($);return v(n,Ee(e)),n}function Te(e){let n=t.useContext(ee);return v(n,Ee(e)),n}function we(e){let n=function(e){let n=t.useContext(ae);return v(n,Ee(e)),n}(e),r=n.matches[n.matches.length-1];return v(r.route.id,"".concat(e,' can only be used on routes that contain a unique "id"')),r.route.id}function Ce(){var e;let n=t.useContext(se),r=Te("useRouteError"),i=we("useRouteError");return void 0!==n?n:null===(e=r.errors)||void 0===e?void 0:e[i]}var Re={};function ke(e,t,n){t||Re[e]||(Re[e]=!0,y(!1,n))}t.memo((function(e){let{routes:t,future:n,state:r}=e;return me(t,void 0,r,n)}));function Oe(e){let{to:n,replace:r,state:i,relative:o}=e;v(ce(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=t.useContext(ie);y(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:s}=t.useContext(ae),{pathname:c}=le(),l=he(),d=z(n,H(s),c,"path"===o),u=JSON.stringify(d);return t.useEffect((()=>{l(JSON.parse(u),{replace:r,state:i,relative:o})}),[l,u,o,r,i]),null}function Ie(e){v(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Ne(e){let{basename:n="/",children:r=null,location:i,navigationType:o="POP",navigator:a,static:s=!1}=e;v(!ce(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=n.replace(/^\/*/,"/"),l=t.useMemo((()=>({basename:c,navigator:a,static:s,future:{}})),[c,a,s]);"string"===typeof i&&(i=T(i));let{pathname:d="/",search:u="",hash:h="",state:p=null,key:f="default"}=i,m=t.useMemo((()=>{let e=B(d,c);return null==e?null:{location:{pathname:e,search:u,hash:h,state:p,key:f},navigationType:o}}),[c,d,u,h,p,f,o]);return y(null!=m,'<Router basename="'.concat(c,'"> is not able to match the URL "').concat(d).concat(u).concat(h,"\" because it does not start with the basename, so the <Router> won't render anything.")),null==m?null:t.createElement(ie.Provider,{value:l},t.createElement(oe.Provider,{children:r,value:m}))}function Ae(e){let{children:t,location:n}=e;return me(xe(t),n)}t.Component;function xe(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=[];return t.Children.forEach(e,((e,i)=>{if(!t.isValidElement(e))return;let o=[...n,i];if(e.type===t.Fragment)return void r.push.apply(r,xe(e.props.children,o));v(e.type===Ie,"[".concat("string"===typeof e.type?e.type:e.type.name,"] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>")),v(!e.props.index||!e.props.children,"An index route cannot have child routes.");let a={id:e.props.id||o.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=xe(e.props.children,o)),r.push(a)})),r}var Pe="get",De="application/x-www-form-urlencoded";function Le(e){return null!=e&&"string"===typeof e.tagName}var Me=null;var je=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ue(e){return null==e||je.has(e)?e:(y(!1,'"'.concat(e,'" is not a valid `encType` for `<Form>`/`<fetcher.Form>` and will default to "').concat(De,'"')),null)}function Ve(e,t){let n,r,i,o,a;if(Le(s=e)&&"form"===s.tagName.toLowerCase()){let a=e.getAttribute("action");r=a?B(a,t):null,n=e.getAttribute("method")||Pe,i=Ue(e.getAttribute("enctype"))||De,o=new FormData(e)}else if(function(e){return Le(e)&&"button"===e.tagName.toLowerCase()}(e)||function(e){return Le(e)&&"input"===e.tagName.toLowerCase()}(e)&&("submit"===e.type||"image"===e.type)){let a=e.form;if(null==a)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let s=e.getAttribute("formaction")||a.getAttribute("action");if(r=s?B(s,t):null,n=e.getAttribute("formmethod")||a.getAttribute("method")||Pe,i=Ue(e.getAttribute("formenctype"))||Ue(a.getAttribute("enctype"))||De,o=new FormData(a,e),!function(){if(null===Me)try{new FormData(document.createElement("form"),0),Me=!1}catch(e){Me=!0}return Me}()){let{name:t,type:n,value:r}=e;if("image"===n){let e=t?"".concat(t,"."):"";o.append("".concat(e,"x"),"0"),o.append("".concat(e,"y"),"0")}else t&&o.append(t,r)}}else{if(Le(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Pe,r=null,i=De,a=e}var s;return o&&"text/plain"===i&&(a=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:a}}function Fe(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}async function Be(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(n){return console.error("Error loading route module `".concat(e.module,"`, reloading page...")),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise((()=>{}))}}function We(e){return null!=e&&"string"===typeof e.page}function Ge(e){return null!=e&&(null==e.href?"preload"===e.rel&&"string"===typeof e.imageSrcSet&&"string"===typeof e.imageSizes:"string"===typeof e.rel&&"string"===typeof e.href)}function He(e,t,n,r,i,o){let a=(e,t)=>!n[t]||e.route.id!==n[t].route.id,s=(e,t)=>{var r;return n[t].pathname!==e.pathname||(null===(r=n[t].route.path)||void 0===r?void 0:r.endsWith("*"))&&n[t].params["*"]!==e.params["*"]};return"assets"===o?t.filter(((e,t)=>a(e,t)||s(e,t))):"data"===o?t.filter(((t,o)=>{let c=r.routes[t.route.id];if(!c||!c.hasLoader)return!1;if(a(t,o)||s(t,o))return!0;if(t.route.shouldRevalidate){var l;let r=t.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:(null===(l=n[0])||void 0===l?void 0:l.params)||{},nextUrl:new URL(e,window.origin),nextParams:t.params,defaultShouldRevalidate:!0});if("boolean"===typeof r)return r}return!0})):[]}function ze(e,t){let{includeHydrateFallback:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r=e.map((e=>{let r=t.routes[e.route.id];if(!r)return[];let i=[r.module];return r.clientActionModule&&(i=i.concat(r.clientActionModule)),r.clientLoaderModule&&(i=i.concat(r.clientLoaderModule)),n&&r.hydrateFallbackModule&&(i=i.concat(r.hydrateFallbackModule)),r.imports&&(i=i.concat(r.imports)),i})).flat(1),[...new Set(r)];var r}function Ke(e,t){let n=new Set,r=new Set(t);return e.reduce(((e,i)=>{if(t&&!We(i)&&"script"===i.as&&i.href&&r.has(i.href))return e;let o=JSON.stringify(function(e){let t={},n=Object.keys(e).sort();for(let r of n)t[r]=e[r];return t}(i));return n.has(o)||(n.add(o),e.push({key:o,link:i})),e}),[])}function qe(e){return{__html:e}}Symbol("SingleFetchRedirect");var Ye=new Set([100,101,204,205]);function Je(e,t){let n="string"===typeof e?new URL(e,"undefined"===typeof window?"server://singlefetch/":window.location.origin):e;return"/"===n.pathname?n.pathname="_root.data":t&&"/"===B(n.pathname,t)?n.pathname="".concat(t.replace(/\/$/,""),"/_root.data"):n.pathname="".concat(n.pathname.replace(/\/$/,""),".data"),n}t.Component;function Xe(e){let{error:n,isOutsideRemixApp:r}=e;console.error(n);let i,o=t.createElement("script",{dangerouslySetInnerHTML:{__html:'\n        console.log(\n          "\ud83d\udcbf Hey developer \ud83d\udc4b. You can provide a way better UX than this when your app throws errors. Check out https://remix.run/guides/errors for more information."\n        );\n      '}});if(X(n))return t.createElement(Qe,{title:"Unhandled Thrown Response!"},t.createElement("h1",{style:{fontSize:"24px"}},n.status," ",n.statusText),o);if(n instanceof Error)0;else{let e=null==n?"Unknown Error":"object"===typeof n&&"toString"in n?n.toString():JSON.stringify(n);new Error(e)}return t.createElement(Qe,{title:"Application Error!",isOutsideRemixApp:r},t.createElement("h1",{style:{fontSize:"24px"}},"Application Error"),t.createElement("pre",{style:{padding:"2rem",background:"hsla(10, 50%, 50%, 0.1)",color:"red",overflow:"auto"}},i.stack),o)}function Qe(e){var n;let{title:r,renderScripts:i,isOutsideRemixApp:o,children:a}=e,{routeModules:s}=nt();return null!==s.root&&void 0!==n&&n.Layout&&!o?a:t.createElement("html",{lang:"en"},t.createElement("head",null,t.createElement("meta",{charSet:"utf-8"}),t.createElement("meta",{name:"viewport",content:"width=device-width,initial-scale=1,viewport-fit=cover"}),t.createElement("title",null,r)),t.createElement("body",null,t.createElement("main",{style:{fontFamily:"system-ui, sans-serif",padding:"2rem"}},a,i?t.createElement(lt,null):null)))}function Ze(e){return!0===e}function $e(){let e=t.useContext($);return Fe(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function et(){let e=t.useContext(ee);return Fe(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var tt=t.createContext(void 0);function nt(){let e=t.useContext(tt);return Fe(e,"You must render this element inside a <HydratedRouter> element"),e}function rt(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function it(e,t,n){if(n&&!ct)return[e[0]];if(t){let n=e.findIndex((e=>void 0!==t[e.route.id]));return e.slice(0,n+1)}return e}function ot(e){let{page:n}=e,r=i(e,u),{router:o}=$e(),a=t.useMemo((()=>C(o.routes,n,o.basename)),[o.routes,n,o.basename]);return a?t.createElement(st,l({page:n,matches:a},r)):null}function at(e){let{manifest:n,routeModules:r}=nt(),[i,o]=t.useState([]);return t.useEffect((()=>{let t=!1;return async function(e,t,n){return Ke((await Promise.all(e.map((async e=>{let r=t.routes[e.route.id];if(r){let e=await Be(r,n);return e.links?e.links():[]}return[]})))).flat(1).filter(Ge).filter((e=>"stylesheet"===e.rel||"preload"===e.rel)).map((e=>"stylesheet"===e.rel?l(l({},e),{},{rel:"prefetch",as:"style"}):l(l({},e),{},{rel:"prefetch"}))))}(e,n,r).then((e=>{t||o(e)})),()=>{t=!0}}),[e,n,r]),i}function st(e){let{page:n,matches:r}=e,o=i(e,h),a=le(),{manifest:s,routeModules:c}=nt(),{basename:d}=$e(),{loaderData:u,matches:p}=et(),f=t.useMemo((()=>He(n,r,p,s,a,"data")),[n,r,p,s,a]),m=t.useMemo((()=>He(n,r,p,s,a,"assets")),[n,r,p,s,a]),_=t.useMemo((()=>{if(n===a.pathname+a.search+a.hash)return[];let e=new Set,t=!1;if(r.forEach((n=>{var r;let i=s.routes[n.route.id];i&&i.hasLoader&&(!f.some((e=>e.route.id===n.route.id))&&n.route.id in u&&null!==(r=c[n.route.id])&&void 0!==r&&r.shouldRevalidate||i.hasClientLoader?t=!0:e.add(n.route.id))})),0===e.size)return[];let i=Je(n,d);return t&&e.size>0&&i.searchParams.set("_routes",r.filter((t=>e.has(t.route.id))).map((e=>e.route.id)).join(",")),[i.pathname+i.search]}),[d,u,a,s,f,r,n,c]),g=t.useMemo((()=>ze(m,s)),[m,s]),v=at(m);return t.createElement(t.Fragment,null,_.map((e=>t.createElement("link",l({key:e,rel:"prefetch",as:"fetch",href:e},o)))),g.map((e=>t.createElement("link",l({key:e,rel:"modulepreload",href:e},o)))),v.map((e=>{let{key:n,link:r}=e;return t.createElement("link",l({key:n},r))})))}tt.displayName="FrameworkContext";var ct=!1;function lt(e){let{manifest:n,serverHandoffString:r,isSpaMode:o,ssr:a,renderMeta:s}=nt(),{router:c,static:u,staticContext:h}=$e(),{matches:p}=et(),f=Ze(a);s&&(s.didRenderScripts=!0);let m=it(p,null,o);t.useEffect((()=>{0}),[]);let _=t.useMemo((()=>{var o;let a=h?"window.__reactRouterContext = ".concat(r,";").concat("window.__reactRouterContext.stream = new ReadableStream({start(controller){window.__reactRouterContext.streamController = controller;}}).pipeThrough(new TextEncoderStream());"):" ",s=u?"".concat(null!==n.hmr&&void 0!==o&&o.runtime?"import ".concat(JSON.stringify(n.hmr.runtime),";"):"").concat(f?"":"import ".concat(JSON.stringify(n.url)),";\n").concat(m.map(((e,t)=>{let r="route".concat(t),i=n.routes[e.route.id];Fe(i,"Route ".concat(e.route.id," not found in manifest"));let{clientActionModule:o,clientLoaderModule:a,clientMiddlewareModule:s,hydrateFallbackModule:c,module:l}=i,d=[...o?[{module:o,varName:"".concat(r,"_clientAction")}]:[],...a?[{module:a,varName:"".concat(r,"_clientLoader")}]:[],...s?[{module:s,varName:"".concat(r,"_clientMiddleware")}]:[],...c?[{module:c,varName:"".concat(r,"_HydrateFallback")}]:[],{module:l,varName:"".concat(r,"_main")}];return 1===d.length?"import * as ".concat(r," from ").concat(JSON.stringify(l),";"):[d.map((e=>"import * as ".concat(e.varName,' from "').concat(e.module,'";'))).join("\n"),"const ".concat(r," = {").concat(d.map((e=>"...".concat(e.varName))).join(","),"};")].join("\n")})).join("\n"),"\n  ").concat(f?"window.__reactRouterManifest = ".concat(JSON.stringify(function(e,t){let{sri:n}=e,r=i(e,d),o=new Set(t.state.matches.map((e=>e.route.id))),a=t.state.location.pathname.split("/").filter(Boolean),s=["/"];for(a.pop();a.length>0;)s.push("/".concat(a.join("/"))),a.pop();s.forEach((e=>{let n=C(t.routes,e,t.basename);n&&n.forEach((e=>o.add(e.route.id)))}));let c=[...o].reduce(((e,t)=>Object.assign(e,{[t]:r.routes[t]})),{});return l(l({},r),{},{routes:c,sri:!!n||void 0})}(n,c),null,2),";"):"","\n  window.__reactRouterRouteModules = {").concat(m.map(((e,t)=>"".concat(JSON.stringify(e.route.id),":route").concat(t))).join(","),"};\n\nimport(").concat(JSON.stringify(n.entry.module),");"):" ";return t.createElement(t.Fragment,null,t.createElement("script",l(l({},e),{},{suppressHydrationWarning:!0,dangerouslySetInnerHTML:qe(a),type:void 0})),t.createElement("script",l(l({},e),{},{suppressHydrationWarning:!0,dangerouslySetInnerHTML:qe(s),type:"module",async:!0})))}),[]),g=ct?[]:(n.entry.imports.concat(ze(m,n,{includeHydrateFallback:!0})),[...new Set(v)]);var v;let y="object"===typeof n.sri?n.sri:{};return ct?null:t.createElement(t.Fragment,null,"object"===typeof n.sri?t.createElement("script",{"rr-importmap":"",type:"importmap",suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:JSON.stringify({integrity:y})}}):null,f?null:t.createElement("link",{rel:"modulepreload",href:n.url,crossOrigin:e.crossOrigin,integrity:y[n.url],suppressHydrationWarning:!0}),t.createElement("link",{rel:"modulepreload",href:n.entry.module,crossOrigin:e.crossOrigin,integrity:y[n.entry.module],suppressHydrationWarning:!0}),g.map((n=>t.createElement("link",{key:n,rel:"modulepreload",href:n,crossOrigin:e.crossOrigin,integrity:y[n],suppressHydrationWarning:!0}))),_)}function dt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{t.forEach((t=>{"function"===typeof t?t(e):null!=t&&(t.current=e)}))}}var ut="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;try{ut&&(window.__reactRouterVersion="7.5.1")}catch(eo){}function ht(e){let{basename:n,children:r,window:i}=e,o=t.useRef();null==o.current&&(o.current=g({window:i,v5Compat:!0}));let a=o.current,[s,c]=t.useState({action:a.action,location:a.location}),l=t.useCallback((e=>{t.startTransition((()=>c(e)))}),[c]);return t.useLayoutEffect((()=>a.listen(l)),[a,l]),t.createElement(Ne,{basename:n,children:r,location:s.location,navigationType:s.action,navigator:a})}var pt=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ft=t.forwardRef((function(e,n){let r,{onClick:o,discover:a="render",prefetch:s="none",relative:c,reloadDocument:d,replace:u,state:h,target:f,to:m,preventScrollReset:_,viewTransition:g}=e,b=i(e,p),{basename:E}=t.useContext(ie),T="string"===typeof m&&pt.test(m),w=!1;if("string"===typeof m&&T&&(r=m,ut))try{let e=new URL(window.location.href),t=m.startsWith("//")?new URL(e.protocol+m):new URL(m),n=B(t.pathname,E);t.origin===e.origin&&null!=n?m=n+t.search+t.hash:w=!0}catch(eo){y(!1,'<Link to="'.concat(m,'"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.'))}let C=function(e){let{relative:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v(ce(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:i}=t.useContext(ie),{hash:o,pathname:a,search:s}=fe(e,{relative:n}),c=a;return"/"!==r&&(c="/"===a?r:K([r,a])),i.createHref({pathname:c,search:s,hash:o})}(m,{relative:c}),[R,k,O]=function(e,n){let r=t.useContext(tt),[i,o]=t.useState(!1),[a,s]=t.useState(!1),{onFocus:c,onBlur:l,onMouseEnter:d,onMouseLeave:u,onTouchStart:h}=n,p=t.useRef(null);t.useEffect((()=>{if("render"===e&&s(!0),"viewport"===e){let e=new IntersectionObserver((e=>{e.forEach((e=>{s(e.isIntersecting)}))}),{threshold:.5});return p.current&&e.observe(p.current),()=>{e.disconnect()}}}),[e]),t.useEffect((()=>{if(i){let e=setTimeout((()=>{s(!0)}),100);return()=>{clearTimeout(e)}}}),[i]);let f=()=>{o(!0)},m=()=>{o(!1),s(!1)};return r?"intent"!==e?[a,p,{}]:[a,p,{onFocus:rt(c,f),onBlur:rt(l,m),onMouseEnter:rt(d,f),onMouseLeave:rt(u,m),onTouchStart:rt(h,f)}]:[!1,p,{}]}(s,b),I=function(e){let{target:n,replace:r,state:i,preventScrollReset:o,relative:a,viewTransition:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=he(),l=le(),d=fe(e,{relative:a});return t.useCallback((t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let n=void 0!==r?r:S(l)===S(d);c(e,{replace:n,state:i,preventScrollReset:o,relative:a,viewTransition:s})}}),[l,c,d,r,i,n,e,o,a,s])}(m,{replace:u,state:h,target:f,preventScrollReset:_,relative:c,viewTransition:g});let N=t.createElement("a",l(l(l({},b),O),{},{href:r||C,onClick:w||d?o:function(e){o&&o(e),e.defaultPrevented||I(e)},ref:dt(n,k),target:f,"data-discover":T||"render"!==a?void 0:"true"}));return R&&!T?t.createElement(t.Fragment,null,N,t.createElement(ot,{page:C})):N}));ft.displayName="Link",t.forwardRef((function(e,n){let{"aria-current":r="page",caseSensitive:o=!1,className:a="",end:s=!1,style:c,to:d,viewTransition:u,children:h}=e,p=i(e,f),m=fe(d,{relative:p.relative}),_=le(),g=t.useContext(ee),{navigator:y,basename:b}=t.useContext(ie),E=null!=g&&function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.useContext(te);v(null!=r,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=gt("useViewTransitionState"),o=fe(e,{relative:n.relative});if(!r.isTransitioning)return!1;let a=B(r.currentLocation.pathname,i)||r.currentLocation.pathname,s=B(r.nextLocation.pathname,i)||r.nextLocation.pathname;return null!=U(o.pathname,s)||null!=U(o.pathname,a)}(m)&&!0===u,S=y.encodeLocation?y.encodeLocation(m).pathname:m.pathname,T=_.pathname,w=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;o||(T=T.toLowerCase(),w=w?w.toLowerCase():null,S=S.toLowerCase()),w&&b&&(w=B(w,b)||w);const C="/"!==S&&S.endsWith("/")?S.length-1:S.length;let R,k=T===S||!s&&T.startsWith(S)&&"/"===T.charAt(C),O=null!=w&&(w===S||!s&&w.startsWith(S)&&"/"===w.charAt(S.length)),I={isActive:k,isPending:O,isTransitioning:E},N=k?r:void 0;R="function"===typeof a?a(I):[a,k?"active":null,O?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let A="function"===typeof c?c(I):c;return t.createElement(ft,l(l({},p),{},{"aria-current":N,className:R,ref:n,style:A,to:d,viewTransition:u}),"function"===typeof h?h(I):h)})).displayName="NavLink";var mt=t.forwardRef(((e,n)=>{let{discover:r="render",fetcherKey:o,navigate:a,reloadDocument:s,replace:c,state:d,method:u=Pe,action:h,onSubmit:p,relative:f,preventScrollReset:_,viewTransition:g}=e,y=i(e,m),b=bt(),E=function(e){let{relative:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{basename:r}=t.useContext(ie),i=t.useContext(ae);v(i,"useFormAction must be used inside a RouteContext");let[o]=i.matches.slice(-1),a=l({},fe(e||".",{relative:n})),s=le();if(null==e){a.search=s.search;let e=new URLSearchParams(a.search),t=e.getAll("index");if(t.some((e=>""===e))){e.delete("index"),t.filter((e=>e)).forEach((t=>e.append("index",t)));let n=e.toString();a.search=n?"?".concat(n):""}}e&&"."!==e||!o.route.index||(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index");"/"!==r&&(a.pathname="/"===a.pathname?r:K([r,a.pathname]));return S(a)}(h,{relative:f}),T="get"===u.toLowerCase()?"get":"post",w="string"===typeof h&&pt.test(h);return t.createElement("form",l(l({ref:n,method:T,action:E,onSubmit:s?p:e=>{if(p&&p(e),e.defaultPrevented)return;e.preventDefault();let t=e.nativeEvent.submitter,n=(null===t||void 0===t?void 0:t.getAttribute("formmethod"))||u;b(t||e.currentTarget,{fetcherKey:o,method:n,navigate:a,replace:c,state:d,relative:f,preventScrollReset:_,viewTransition:g})}},y),{},{"data-discover":w||"render"!==r?void 0:"true"}))}));function _t(e){return"".concat(e," must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.")}function gt(e){let n=t.useContext($);return v(n,_t(e)),n}mt.displayName="Form";var vt=0,yt=()=>"__".concat(String(++vt),"__");function bt(){let{router:e}=gt("useSubmit"),{basename:n}=t.useContext(ie),r=we("useRouteId");return t.useCallback((async function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{action:o,method:a,encType:s,formData:c,body:l}=Ve(t,n);if(!1===i.navigate){let t=i.fetcherKey||yt();await e.fetch(t,r,i.action||o,{preventScrollReset:i.preventScrollReset,formData:c,body:l,formMethod:i.method||a,formEncType:i.encType||s,flushSync:i.flushSync})}else await e.navigate(i.action||o,{preventScrollReset:i.preventScrollReset,formData:c,body:l,formMethod:i.method||a,formEncType:i.encType||s,replace:i.replace,state:i.state,fromRouteId:r,flushSync:i.flushSync,viewTransition:i.viewTransition})}),[e,n,r])}new TextEncoder;function Et(e,t){return function(){return e.apply(t,arguments)}}const{toString:St}=Object.prototype,{getPrototypeOf:Tt}=Object,wt=(Ct=Object.create(null),e=>{const t=St.call(e);return Ct[t]||(Ct[t]=t.slice(8,-1).toLowerCase())});var Ct;const Rt=e=>(e=e.toLowerCase(),t=>wt(t)===e),kt=e=>t=>typeof t===e,{isArray:Ot}=Array,It=kt("undefined");const Nt=Rt("ArrayBuffer");const At=kt("string"),xt=kt("function"),Pt=kt("number"),Dt=e=>null!==e&&"object"===typeof e,Lt=e=>{if("object"!==wt(e))return!1;const t=Tt(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Mt=Rt("Date"),jt=Rt("File"),Ut=Rt("Blob"),Vt=Rt("FileList"),Ft=Rt("URLSearchParams"),[Bt,Wt,Gt,Ht]=["ReadableStream","Request","Response","Headers"].map(Rt);function zt(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),Ot(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const r=i?Object.getOwnPropertyNames(e):Object.keys(e),o=r.length;let a;for(n=0;n<o;n++)a=r[n],t.call(null,e[a],a,e)}}function Kt(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const qt="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,Yt=e=>!It(e)&&e!==qt;const Jt=(Xt="undefined"!==typeof Uint8Array&&Tt(Uint8Array),e=>Xt&&e instanceof Xt);var Xt;const Qt=Rt("HTMLFormElement"),Zt=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),$t=Rt("RegExp"),en=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};zt(n,((n,i)=>{let o;!1!==(o=t(n,i,e))&&(r[i]=o||n)})),Object.defineProperties(e,r)};const tn=Rt("AsyncFunction"),nn=((e,t)=>{return e?setImmediate:t?(n="axios@".concat(Math.random()),r=[],qt.addEventListener("message",(e=>{let{source:t,data:i}=e;t===qt&&i===n&&r.length&&r.shift()()}),!1),e=>{r.push(e),qt.postMessage(n,"*")}):e=>setTimeout(e);var n,r})("function"===typeof setImmediate,xt(qt.postMessage)),rn="undefined"!==typeof queueMicrotask?queueMicrotask.bind(qt):"undefined"!==typeof process&&process.nextTick||nn,on={isArray:Ot,isArrayBuffer:Nt,isBuffer:function(e){return null!==e&&!It(e)&&null!==e.constructor&&!It(e.constructor)&&xt(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||xt(e.append)&&("formdata"===(t=wt(e))||"object"===t&&xt(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Nt(e.buffer),t},isString:At,isNumber:Pt,isBoolean:e=>!0===e||!1===e,isObject:Dt,isPlainObject:Lt,isReadableStream:Bt,isRequest:Wt,isResponse:Gt,isHeaders:Ht,isUndefined:It,isDate:Mt,isFile:jt,isBlob:Ut,isRegExp:$t,isFunction:xt,isStream:e=>Dt(e)&&xt(e.pipe),isURLSearchParams:Ft,isTypedArray:Jt,isFileList:Vt,forEach:zt,merge:function e(){const{caseless:t}=Yt(this)&&this||{},n={},r=(r,i)=>{const o=t&&Kt(n,i)||i;Lt(n[o])&&Lt(r)?n[o]=e(n[o],r):Lt(r)?n[o]=e({},r):Ot(r)?n[o]=r.slice():n[o]=r};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&zt(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return zt(t,((t,r)=>{n&&xt(t)?e[r]=Et(t,n):e[r]=t}),{allOwnKeys:r}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,o,a;const s={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)a=i[o],r&&!r(a,e,t)||s[a]||(t[a]=e[a],s[a]=!0);e=!1!==n&&Tt(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:wt,kindOfTest:Rt,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(Ot(e))return e;let t=e.length;if(!Pt(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:Qt,hasOwnProperty:Zt,hasOwnProp:Zt,reduceDescriptors:en,freezeMethods:e=>{en(e,((t,n)=>{if(xt(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];xt(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return Ot(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Kt,global:qt,isContextDefined:Yt,isSpecCompliantForm:function(e){return!!(e&&xt(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(Dt(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const i=Ot(e)?[]:{};return zt(e,((e,t)=>{const o=n(e,r+1);!It(o)&&(i[t]=o)})),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:tn,isThenable:e=>e&&(Dt(e)||xt(e))&&xt(e.then)&&xt(e.catch),setImmediate:nn,asap:rn};function an(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}on.inherits(an,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:on.toJSONObject(this.config),code:this.code,status:this.status}}});const sn=an.prototype,cn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{cn[e]={value:e}})),Object.defineProperties(an,cn),Object.defineProperty(sn,"isAxiosError",{value:!0}),an.from=(e,t,n,r,i,o)=>{const a=Object.create(sn);return on.toFlatObject(e,a,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),an.call(a,e.message,t,n,r,i),a.cause=e,a.name=e.name,o&&Object.assign(a,o),a};const ln=an;function dn(e){return on.isPlainObject(e)||on.isArray(e)}function un(e){return on.endsWith(e,"[]")?e.slice(0,-2):e}function hn(e,t,n){return e?e.concat(t).map((function(e,t){return e=un(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const pn=on.toFlatObject(on,{},null,(function(e){return/^is[A-Z]/.test(e)}));const fn=function(e,t,n){if(!on.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=on.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!on.isUndefined(t[e])}))).metaTokens,i=n.visitor||l,o=n.dots,a=n.indexes,s=(n.Blob||"undefined"!==typeof Blob&&Blob)&&on.isSpecCompliantForm(t);if(!on.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(on.isDate(e))return e.toISOString();if(!s&&on.isBlob(e))throw new ln("Blob is not supported. Use a Buffer instead.");return on.isArrayBuffer(e)||on.isTypedArray(e)?s&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,i){let s=e;if(e&&!i&&"object"===typeof e)if(on.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(on.isArray(e)&&function(e){return on.isArray(e)&&!e.some(dn)}(e)||(on.isFileList(e)||on.endsWith(n,"[]"))&&(s=on.toArray(e)))return n=un(n),s.forEach((function(e,r){!on.isUndefined(e)&&null!==e&&t.append(!0===a?hn([n],r,o):null===a?n:n+"[]",c(e))})),!1;return!!dn(e)||(t.append(hn(i,n,o),c(e)),!1)}const d=[],u=Object.assign(pn,{defaultVisitor:l,convertValue:c,isVisitable:dn});if(!on.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!on.isUndefined(n)){if(-1!==d.indexOf(n))throw Error("Circular reference detected in "+r.join("."));d.push(n),on.forEach(n,(function(n,o){!0===(!(on.isUndefined(n)||null===n)&&i.call(t,n,on.isString(o)?o.trim():o,r,u))&&e(n,r?r.concat(o):[o])})),d.pop()}}(e),t};function mn(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function _n(e,t){this._pairs=[],e&&fn(e,this,t)}const gn=_n.prototype;gn.append=function(e,t){this._pairs.push([e,t])},gn.toString=function(e){const t=e?function(t){return e.call(this,t,mn)}:mn;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const vn=_n;function yn(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function bn(e,t,n){if(!t)return e;const r=n&&n.encode||yn;on.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let o;if(o=i?i(t,n):on.isURLSearchParams(t)?t.toString():new vn(t,n).toString(r),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}const En=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){on.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},Sn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Tn={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:vn,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},wn="undefined"!==typeof window&&"undefined"!==typeof document,Cn="object"===typeof navigator&&navigator||void 0,Rn=wn&&(!Cn||["ReactNative","NativeScript","NS"].indexOf(Cn.product)<0),kn="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,On=wn&&window.location.href||"http://localhost",In=l(l({},e),Tn);const Nn=function(e){function t(e,n,r,i){let o=e[i++];if("__proto__"===o)return!0;const a=Number.isFinite(+o),s=i>=e.length;if(o=!o&&on.isArray(r)?r.length:o,s)return on.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!a;r[o]&&on.isObject(r[o])||(r[o]=[]);return t(e,n,r[o],i)&&on.isArray(r[o])&&(r[o]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let o;for(r=0;r<i;r++)o=n[r],t[o]=e[o];return t}(r[o])),!a}if(on.isFormData(e)&&on.isFunction(e.entries)){const n={};return on.forEachEntry(e,((e,r)=>{t(function(e){return on.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null};const An={transitional:Sn,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=on.isObject(e);i&&on.isHTMLForm(e)&&(e=new FormData(e));if(on.isFormData(e))return r?JSON.stringify(Nn(e)):e;if(on.isArrayBuffer(e)||on.isBuffer(e)||on.isStream(e)||on.isFile(e)||on.isBlob(e)||on.isReadableStream(e))return e;if(on.isArrayBufferView(e))return e.buffer;if(on.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return fn(e,new In.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return In.isNode&&on.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((o=on.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return fn(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e,t,n){if(on.isString(e))try{return(t||JSON.parse)(e),on.trim(e)}catch(eo){if("SyntaxError"!==eo.name)throw eo}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||An.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(on.isResponse(e)||on.isReadableStream(e))return e;if(e&&on.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(eo){if(n){if("SyntaxError"===eo.name)throw ln.from(eo,ln.ERR_BAD_RESPONSE,this,null,this.response);throw eo}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:In.classes.FormData,Blob:In.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};on.forEach(["delete","get","head","post","put","patch"],(e=>{An.headers[e]={}}));const xn=An,Pn=on.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Dn=Symbol("internals");function Ln(e){return e&&String(e).trim().toLowerCase()}function Mn(e){return!1===e||null==e?e:on.isArray(e)?e.map(Mn):String(e)}function jn(e,t,n,r,i){return on.isFunction(r)?r.call(this,t,n):(i&&(t=n),on.isString(t)?on.isString(r)?-1!==t.indexOf(r):on.isRegExp(r)?r.test(t):void 0:void 0)}class Un{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=Ln(t);if(!i)throw new Error("header name must be a non-empty string");const o=on.findKey(r,i);(!o||void 0===r[o]||!0===n||void 0===n&&!1!==r[o])&&(r[o||t]=Mn(e))}const o=(e,t)=>on.forEach(e,((e,n)=>i(e,n,t)));if(on.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(on.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))o((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach((function(e){i=e.indexOf(":"),n=e.substring(0,i).trim().toLowerCase(),r=e.substring(i+1).trim(),!n||t[n]&&Pn[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t);else if(on.isHeaders(e))for(const[a,s]of e.entries())i(s,a,n);else null!=e&&i(t,e,n);return this}get(e,t){if(e=Ln(e)){const n=on.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(on.isFunction(t))return t.call(this,e,n);if(on.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ln(e)){const n=on.findKey(this,e);return!(!n||void 0===this[n]||t&&!jn(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=Ln(e)){const i=on.findKey(n,e);!i||t&&!jn(0,n[i],i,t)||(delete n[i],r=!0)}}return on.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!jn(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return on.forEach(this,((r,i)=>{const o=on.findKey(n,i);if(o)return t[o]=Mn(r),void delete t[i];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(i):String(i).trim();a!==i&&delete t[i],t[a]=Mn(r),n[a]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return on.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&on.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((e=>{let[t,n]=e;return t+": "+n})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach((e=>t.set(e))),t}static accessor(e){const t=(this[Dn]=this[Dn]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=Ln(e);t[r]||(!function(e,t){const n=on.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[r]=!0)}return on.isArray(e)?e.forEach(r):r(e),this}}Un.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),on.reduceDescriptors(Un.prototype,((e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}})),on.freezeMethods(Un);const Vn=Un;function Fn(e,t){const n=this||xn,r=t||n,i=Vn.from(r.headers);let o=r.data;return on.forEach(e,(function(e){o=e.call(n,o,i.normalize(),t?t.status:void 0)})),i.normalize(),o}function Bn(e){return!(!e||!e.__CANCEL__)}function Wn(e,t,n){ln.call(this,null==e?"canceled":e,ln.ERR_CANCELED,t,n),this.name="CanceledError"}on.inherits(Wn,ln,{__CANCEL__:!0});const Gn=Wn;function Hn(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new ln("Request failed with status code "+n.status,[ln.ERR_BAD_REQUEST,ln.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const zn=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,o=0,a=0;return t=void 0!==t?t:1e3,function(s){const c=Date.now(),l=r[a];i||(i=c),n[o]=s,r[o]=c;let d=a,u=0;for(;d!==o;)u+=n[d++],d%=e;if(o=(o+1)%e,o===a&&(a=(a+1)%e),c-i<t)return;const h=l&&c-l;return h?Math.round(1e3*u/h):void 0}};const Kn=function(e,t){let n,r,i=0,o=1e3/t;const a=function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();i=o,n=null,r&&(clearTimeout(r),r=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-i;for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];t>=o?a(c,e):(n=c,r||(r=setTimeout((()=>{r=null,a(n)}),o-t)))},()=>n&&a(n)]},qn=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0;const i=zn(50,250);return Kn((n=>{const o=n.loaded,a=n.lengthComputable?n.total:void 0,s=o-r,c=i(s);r=o;e({loaded:o,total:a,progress:a?o/a:void 0,bytes:s,rate:c||void 0,estimated:c&&a&&o<=a?(a-o)/c:void 0,event:n,lengthComputable:null!=a,[t?"download":"upload"]:!0})}),n)},Yn=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},Jn=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return on.asap((()=>e(...n)))},Xn=In.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,In.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(In.origin),In.navigator&&/(msie|trident)/i.test(In.navigator.userAgent)):()=>!0,Qn=In.hasStandardBrowserEnv?{write(e,t,n,r,i,o){const a=[e+"="+encodeURIComponent(t)];on.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),on.isString(r)&&a.push("path="+r),on.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Zn(e,t,n){let r=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const $n=e=>e instanceof Vn?l({},e):e;function er(e,t){t=t||{};const n={};function r(e,t,n,r){return on.isPlainObject(e)&&on.isPlainObject(t)?on.merge.call({caseless:r},e,t):on.isPlainObject(t)?on.merge({},t):on.isArray(t)?t.slice():t}function i(e,t,n,i){return on.isUndefined(t)?on.isUndefined(e)?void 0:r(void 0,e,0,i):r(e,t,0,i)}function o(e,t){if(!on.isUndefined(t))return r(void 0,t)}function a(e,t){return on.isUndefined(t)?on.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,i,o){return o in t?r(n,i):o in e?r(void 0,n):void 0}const c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(e,t,n)=>i($n(e),$n(t),0,!0)};return on.forEach(Object.keys(Object.assign({},e,t)),(function(r){const o=c[r]||i,a=o(e[r],t[r],r);on.isUndefined(a)&&o!==s||(n[r]=a)})),n}const tr=e=>{const t=er({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:o,xsrfCookieName:a,headers:s,auth:c}=t;if(t.headers=s=Vn.from(s),t.url=bn(Zn(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&s.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),on.isFormData(r))if(In.hasStandardBrowserEnv||In.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(!1!==(n=s.getContentType())){const[e,...t]=n?n.split(";").map((e=>e.trim())).filter(Boolean):[];s.setContentType([e||"multipart/form-data",...t].join("; "))}if(In.hasStandardBrowserEnv&&(i&&on.isFunction(i)&&(i=i(t)),i||!1!==i&&Xn(t.url))){const e=o&&a&&Qn.read(a);e&&s.set(o,e)}return t},nr="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){const r=tr(e);let i=r.data;const o=Vn.from(r.headers).normalize();let a,s,c,l,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=r;function f(){l&&l(),d&&d(),r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}let m=new XMLHttpRequest;function _(){if(!m)return;const r=Vn.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());Hn((function(e){t(e),f()}),(function(e){n(e),f()}),{data:u&&"text"!==u&&"json"!==u?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:r,config:e,request:m}),m=null}m.open(r.method.toUpperCase(),r.url,!0),m.timeout=r.timeout,"onloadend"in m?m.onloadend=_:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(_)},m.onabort=function(){m&&(n(new ln("Request aborted",ln.ECONNABORTED,e,m)),m=null)},m.onerror=function(){n(new ln("Network Error",ln.ERR_NETWORK,e,m)),m=null},m.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const i=r.transitional||Sn;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new ln(t,i.clarifyTimeoutError?ln.ETIMEDOUT:ln.ECONNABORTED,e,m)),m=null},void 0===i&&o.setContentType(null),"setRequestHeader"in m&&on.forEach(o.toJSON(),(function(e,t){m.setRequestHeader(t,e)})),on.isUndefined(r.withCredentials)||(m.withCredentials=!!r.withCredentials),u&&"json"!==u&&(m.responseType=r.responseType),p&&([c,d]=qn(p,!0),m.addEventListener("progress",c)),h&&m.upload&&([s,l]=qn(h),m.upload.addEventListener("progress",s),m.upload.addEventListener("loadend",l)),(r.cancelToken||r.signal)&&(a=t=>{m&&(n(!t||t.type?new Gn(null,e,m):t),m.abort(),m=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));const g=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);g&&-1===In.protocols.indexOf(g)?n(new ln("Unsupported protocol "+g+":",ln.ERR_BAD_REQUEST,e)):m.send(i||null)}))},rr=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const i=function(e){if(!n){n=!0,a();const t=e instanceof Error?e:this.reason;r.abort(t instanceof ln?t:new Gn(t instanceof Error?t.message:t))}};let o=t&&setTimeout((()=>{o=null,i(new ln("timeout ".concat(t," of ms exceeded"),ln.ETIMEDOUT))}),t);const a=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach((e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)})),e=null)};e.forEach((e=>e.addEventListener("abort",i)));const{signal:s}=r;return s.unsubscribe=()=>on.asap(a),s}};function ir(e,t){this.v=e,this.k=t}function or(e){return function(){return new ar(e.apply(this,arguments))}}function ar(e){var t,n;function r(t,n){try{var o=e[t](n),a=o.value,s=a instanceof ir;Promise.resolve(s?a.v:a).then((function(n){if(s){var c="return"===t?"return":"next";if(!a.k||n.done)return r(c,n);n=e[c](n).value}i(o.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new Promise((function(o,a){var s={key:e,arg:i,resolve:o,reject:a,next:null};n?n=n.next=s:(t=n=s,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function sr(e){return new ir(e,0)}function cr(e){var t={},n=!1;function r(t,r){return n=!0,r=new Promise((function(n){n(e[t](r))})),{done:!1,value:new ir(r,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}function lr(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new dr(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function dr(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return dr=function(e){this.s=e,this.n=e.next},dr.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new dr(e)}ar.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},ar.prototype.next=function(e){return this._invoke("next",e)},ar.prototype.throw=function(e){return this._invoke("throw",e)},ar.prototype.return=function(e){return this._invoke("return",e)};const ur=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},hr=function(){var e=or((function*(e,t){var n,r=!1,i=!1;try{for(var o,a=lr(pr(e));r=!(o=yield sr(a.next())).done;r=!1){const e=o.value;yield*cr(lr(ur(e,t)))}}catch(s){i=!0,n=s}finally{try{r&&null!=a.return&&(yield sr(a.return()))}finally{if(i)throw n}}}));return function(t,n){return e.apply(this,arguments)}}(),pr=function(){var e=or((function*(e){if(e[Symbol.asyncIterator])return void(yield*cr(lr(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield sr(t.read());if(e)break;yield n}}finally{yield sr(t.cancel())}}));return function(t){return e.apply(this,arguments)}}(),fr=(e,t,n,r)=>{const i=hr(e,t);let o,a=0,s=e=>{o||(o=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await i.next();if(t)return s(),void e.close();let o=r.byteLength;if(n){let e=a+=o;n(e)}e.enqueue(new Uint8Array(r))}catch(t){throw s(t),t}},cancel:e=>(s(e),i.return())},{highWaterMark:2})},mr="function"===typeof fetch&&"function"===typeof Request&&"function"===typeof Response,_r=mr&&"function"===typeof ReadableStream,gr=mr&&("function"===typeof TextEncoder?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),vr=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch(eo){return!1}},yr=_r&&vr((()=>{let e=!1;const t=new Request(In.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),br=_r&&vr((()=>on.isReadableStream(new Response("").body))),Er={stream:br&&(e=>e.body)};var Sr;mr&&(Sr=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!Er[e]&&(Er[e]=on.isFunction(Sr[e])?t=>t[e]():(t,n)=>{throw new ln("Response type '".concat(e,"' is not supported"),ln.ERR_NOT_SUPPORT,n)})})));const Tr=async(e,t)=>{const n=on.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(on.isBlob(e))return e.size;if(on.isSpecCompliantForm(e)){const t=new Request(In.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return on.isArrayBufferView(e)||on.isArrayBuffer(e)?e.byteLength:(on.isURLSearchParams(e)&&(e+=""),on.isString(e)?(await gr(e)).byteLength:void 0)})(t):n},wr=mr&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:o,timeout:a,onDownloadProgress:s,onUploadProgress:c,responseType:d,headers:u,withCredentials:h="same-origin",fetchOptions:p}=tr(e);d=d?(d+"").toLowerCase():"text";let f,m=rr([i,o&&o.toAbortSignal()],a);const _=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(c&&yr&&"get"!==n&&"head"!==n&&0!==(g=await Tr(u,r))){let e,n=new Request(t,{method:"POST",body:r,duplex:"half"});if(on.isFormData(r)&&(e=n.headers.get("content-type"))&&u.setContentType(e),n.body){const[e,t]=Yn(g,qn(Jn(c)));r=fr(n.body,65536,e,t)}}on.isString(h)||(h=h?"include":"omit");const i="credentials"in Request.prototype;f=new Request(t,l(l({},p),{},{signal:m,method:n.toUpperCase(),headers:u.normalize().toJSON(),body:r,duplex:"half",credentials:i?h:void 0}));let o=await fetch(f);const a=br&&("stream"===d||"response"===d);if(br&&(s||a&&_)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=o[t]}));const t=on.toFiniteNumber(o.headers.get("content-length")),[n,r]=s&&Yn(t,qn(Jn(s),!0))||[];o=new Response(fr(o.body,65536,n,(()=>{r&&r(),_&&_()})),e)}d=d||"text";let v=await Er[on.findKey(Er,d)||"text"](o,e);return!a&&_&&_(),await new Promise(((t,n)=>{Hn(t,n,{data:v,headers:Vn.from(o.headers),status:o.status,statusText:o.statusText,config:e,request:f})}))}catch(v){if(_&&_(),v&&"TypeError"===v.name&&/fetch/i.test(v.message))throw Object.assign(new ln("Network Error",ln.ERR_NETWORK,e,f),{cause:v.cause||v});throw ln.from(v,v&&v.code,e,f)}}),Cr={http:null,xhr:nr,fetch:wr};on.forEach(Cr,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(eo){}Object.defineProperty(e,"adapterName",{value:t})}}));const Rr=e=>"- ".concat(e),kr=e=>on.isFunction(e)||null===e||!1===e,Or=e=>{e=on.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let o=0;o<t;o++){let t;if(n=e[o],r=n,!kr(n)&&(r=Cr[(t=String(n)).toLowerCase()],void 0===r))throw new ln("Unknown adapter '".concat(t,"'"));if(r)break;i[t||"#"+o]=r}if(!r){const e=Object.entries(i).map((e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")}));let n=t?e.length>1?"since :\n"+e.map(Rr).join("\n"):" "+Rr(e[0]):"as no adapter specified";throw new ln("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return r};function Ir(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Gn(null,e)}function Nr(e){Ir(e),e.headers=Vn.from(e.headers),e.data=Fn.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Or(e.adapter||xn.adapter)(e).then((function(t){return Ir(e),t.data=Fn.call(e,e.transformResponse,t),t.headers=Vn.from(t.headers),t}),(function(t){return Bn(t)||(Ir(e),t&&t.response&&(t.response.data=Fn.call(e,e.transformResponse,t.response),t.response.headers=Vn.from(t.response.headers))),Promise.reject(t)}))}const Ar="1.8.4",xr={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{xr[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const Pr={};xr.transitional=function(e,t,n){function r(e,t){return"[Axios v1.8.4] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,o)=>{if(!1===e)throw new ln(r(i," has been removed"+(t?" in "+t:"")),ln.ERR_DEPRECATED);return t&&!Pr[i]&&(Pr[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}},xr.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};const Dr={assertOptions:function(e,t,n){if("object"!==typeof e)throw new ln("options must be an object",ln.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const o=r[i],a=t[o];if(a){const t=e[o],n=void 0===t||a(t,o,e);if(!0!==n)throw new ln("option "+o+" must be "+n,ln.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new ln("Unknown option "+o,ln.ERR_BAD_OPTION)}},validators:xr},Lr=Dr.validators;class Mr{constructor(e){this.defaults=e,this.interceptors={request:new En,response:new En}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{n.stack?t&&!String(n.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+t):n.stack=t}catch(eo){}}throw n}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=er(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&Dr.assertOptions(n,{silentJSONParsing:Lr.transitional(Lr.boolean),forcedJSONParsing:Lr.transitional(Lr.boolean),clarifyTimeoutError:Lr.transitional(Lr.boolean)},!1),null!=r&&(on.isFunction(r)?t.paramsSerializer={serialize:r}:Dr.assertOptions(r,{encode:Lr.function,serialize:Lr.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Dr.assertOptions(t,{baseUrl:Lr.spelling("baseURL"),withXsrfToken:Lr.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&on.merge(i.common,i[t.method]);i&&on.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=Vn.concat(o,i);const a=[];let s=!0;this.interceptors.request.forEach((function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,a.unshift(e.fulfilled,e.rejected))}));const c=[];let l;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let d,u=0;if(!s){const e=[Nr.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,c),d=e.length,l=Promise.resolve(t);u<d;)l=l.then(e[u++],e[u++]);return l}d=a.length;let h=t;for(u=0;u<d;){const e=a[u++],t=a[u++];try{h=e(h)}catch(p){t.call(this,p);break}}try{l=Nr.call(this,h)}catch(p){return Promise.reject(p)}for(u=0,d=c.length;u<d;)l=l.then(c[u++],c[u++]);return l}getUri(e){return bn(Zn((e=er(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}on.forEach(["delete","get","head","options"],(function(e){Mr.prototype[e]=function(t,n){return this.request(er(n||{},{method:e,url:t,data:(n||{}).data}))}})),on.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(er(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Mr.prototype[e]=t(),Mr.prototype[e+"Form"]=t(!0)}));const jr=Mr;class Ur{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new Gn(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Ur((function(t){e=t})),cancel:e}}}const Vr=Ur;const Fr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Fr).forEach((e=>{let[t,n]=e;Fr[n]=t}));const Br=Fr;const Wr=function e(t){const n=new jr(t),r=Et(jr.prototype.request,n);return on.extend(r,jr.prototype,n,{allOwnKeys:!0}),on.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(er(t,n))},r}(xn);Wr.Axios=jr,Wr.CanceledError=Gn,Wr.CancelToken=Vr,Wr.isCancel=Bn,Wr.VERSION=Ar,Wr.toFormData=fn,Wr.AxiosError=ln,Wr.Cancel=Wr.CanceledError,Wr.all=function(e){return Promise.all(e)},Wr.spread=function(e){return function(t){return e.apply(null,t)}},Wr.isAxiosError=function(e){return on.isObject(e)&&!0===e.isAxiosError},Wr.mergeConfig=er,Wr.AxiosHeaders=Vn,Wr.formToJSON=e=>Nn(on.isHTMLForm(e)?new FormData(e):e),Wr.getAdapter=Or,Wr.HttpStatusCode=Br,Wr.default=Wr;const Gr=Wr;var Hr=n(579);const zr=()=>{const[e,n]=(0,t.useState)("overview"),[r,i]=(0,t.useState)([]),[o,a]=(0,t.useState)(!1),[s,c]=(0,t.useState)({key_type:"",service_name:"",api_key:"",api_secret:"",app_id:"",account_sid:"",auth_token:"",client_id:"",client_secret:"",environment:"production",description:""}),[d,u]=(0,t.useState)({performer_trial_days:7,member_trial_days:7,trial_enabled:!0,auto_remind_days:[3,1],trial_benefits_performer:[],trial_benefits_member:[]}),[h,p]=(0,t.useState)(null),f="https://0505b05a-3ca5-43b7-aafd-03668f4bbfc0.preview.emergentagent.com",m=[{value:"agora",label:"Agora Video"},{value:"twilio_video",label:"Twilio Video"},{value:"jitsi",label:"Jitsi Meet"},{value:"google_calendar",label:"Google Calendar"},{value:"microsoft_outlook",label:"Microsoft Outlook"},{value:"firebase_fcm",label:"Firebase FCM"},{value:"twilio_sms",label:"Twilio SMS"},{value:"aws_s3",label:"AWS S3"},{value:"google_cloud_storage",label:"Google Cloud Storage"},{value:"cloudinary",label:"Cloudinary"},{value:"usps",label:"USPS"},{value:"ups",label:"UPS"},{value:"fedex",label:"FedEx"},{value:"stripe_connect",label:"Stripe Connect"},{value:"openai",label:"OpenAI"},{value:"anthropic",label:"Anthropic"}];(0,t.useEffect)((()=>{"api-keys"===e?v():"trial-management"===e&&(_(),g())}),[e]);const _=async()=>{try{const e=await Gr.get("".concat(f,"/api/admin/trial-settings"));e.data.success&&u(e.data.settings)}catch(e){console.error("Failed to fetch trial settings:",e)}},g=async()=>{try{const e=await Gr.get("".concat(f,"/api/admin/trials/stats"));e.data.success&&p(e.data.statistics)}catch(e){console.error("Failed to fetch trial stats:",e)}},v=async()=>{try{a(!0);const e=await Gr.get("".concat(f,"/api/admin/api-keys"));i(e.data)}catch(e){console.error("Failed to fetch API keys:",e)}finally{a(!1)}},y=async e=>{e.preventDefault();try{a(!0),await Gr.post("".concat(f,"/api/admin/api-keys"),s),c({key_type:"",service_name:"",api_key:"",api_secret:"",app_id:"",account_sid:"",auth_token:"",client_id:"",client_secret:"",environment:"production",description:""}),await v(),alert("API key created successfully!")}catch(t){console.error("Failed to create API key:",t),alert("Failed to create API key. Please try again.")}finally{a(!1)}},b=e=>(0,Hr.jsxs)("div",{className:"bg-gray-800 p-8 rounded-lg border border-gray-700 text-center",children:[(0,Hr.jsx)("div",{className:"text-4xl mb-4",children:"\ud83d\udea7"}),(0,Hr.jsxs)("h3",{className:"text-xl font-semibold text-white mb-2",children:[e," Management"]}),(0,Hr.jsxs)("p",{className:"text-gray-400",children:["This section will be implemented with advanced ",e.toLowerCase()," management features."]})]});return(0,Hr.jsxs)("div",{className:"min-h-screen bg-black",children:[(0,Hr.jsx)("div",{className:"bg-gradient-to-r from-pink-900/20 to-purple-900/20 border-b border-gray-800",children:(0,Hr.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,Hr.jsxs)("div",{className:"py-6",children:[(0,Hr.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent",children:"Admin Dashboard"}),(0,Hr.jsx)("p",{className:"text-gray-400 mt-2",children:"Manage your Eye Candy platform"})]})})}),(0,Hr.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,Hr.jsx)("div",{className:"mb-8",children:(0,Hr.jsx)("div",{className:"flex space-x-1 bg-gray-800 p-1 rounded-lg overflow-x-auto",children:[{id:"overview",label:"Overview",icon:"\ud83d\udcca"},{id:"api-keys",label:"API Keys",icon:"\ud83d\udd11"},{id:"trial-management",label:"Trial Management",icon:"\u23f1\ufe0f"},{id:"users",label:"Users",icon:"\ud83d\udc65"},{id:"content",label:"Content",icon:"\ud83d\udcf1"},{id:"payments",label:"Payments",icon:"\ud83d\udcb3"},{id:"analytics",label:"Analytics",icon:"\ud83d\udcc8"},{id:"settings",label:"Settings",icon:"\u2699\ufe0f"}].map((t=>(0,Hr.jsxs)("button",{onClick:()=>n(t.id),className:"flex items-center space-x-2 px-4 py-2 rounded-md text-sm font-medium whitespace-nowrap transition-colors ".concat(e===t.id?"bg-gradient-to-r from-pink-500 to-purple-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-700"),children:[(0,Hr.jsx)("span",{children:t.icon}),(0,Hr.jsx)("span",{children:t.label})]},t.id)))})}),(0,Hr.jsxs)("div",{children:["overview"===e&&(0,Hr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,Hr.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700",children:[(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:"Total Users"}),(0,Hr.jsx)("p",{className:"text-2xl font-bold text-white",children:"1,234"})]}),(0,Hr.jsx)("div",{className:"text-3xl",children:"\ud83d\udc65"})]}),(0,Hr.jsx)("p",{className:"text-green-400 text-sm mt-2",children:"+12% from last month"})]}),(0,Hr.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700",children:[(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:"Active Performers"}),(0,Hr.jsx)("p",{className:"text-2xl font-bold text-white",children:"567"})]}),(0,Hr.jsx)("div",{className:"text-3xl",children:"\ud83c\udfad"})]}),(0,Hr.jsx)("p",{className:"text-green-400 text-sm mt-2",children:"+8% from last month"})]}),(0,Hr.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700",children:[(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:"Monthly Revenue"}),(0,Hr.jsx)("p",{className:"text-2xl font-bold text-white",children:"$45,678"})]}),(0,Hr.jsx)("div",{className:"text-3xl",children:"\ud83d\udcb0"})]}),(0,Hr.jsx)("p",{className:"text-green-400 text-sm mt-2",children:"+15% from last month"})]}),(0,Hr.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700",children:[(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:"Live Sessions"}),(0,Hr.jsx)("p",{className:"text-2xl font-bold text-white",children:"23"})]}),(0,Hr.jsx)("div",{className:"text-3xl",children:"\ud83d\udcf9"})]}),(0,Hr.jsx)("p",{className:"text-blue-400 text-sm mt-2",children:"Currently active"})]})]}),"api-keys"===e&&(0,Hr.jsxs)("div",{className:"space-y-6",children:[(0,Hr.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"Add New API Key"}),(0,Hr.jsxs)("form",{onSubmit:y,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Service Type"}),(0,Hr.jsxs)("select",{value:s.key_type,onChange:e=>c(l(l({},s),{},{key_type:e.target.value})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent",required:!0,children:[(0,Hr.jsx)("option",{value:"",children:"Select Service Type"}),m.map((e=>(0,Hr.jsx)("option",{value:e.value,children:e.label},e.value)))]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Service Name"}),(0,Hr.jsx)("input",{type:"text",value:s.service_name,onChange:e=>c(l(l({},s),{},{service_name:e.target.value})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"e.g., Agora Production",required:!0})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"API Key"}),(0,Hr.jsx)("input",{type:"password",value:s.api_key,onChange:e=>c(l(l({},s),{},{api_key:e.target.value})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Enter API Key"})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"API Secret"}),(0,Hr.jsx)("input",{type:"password",value:s.api_secret,onChange:e=>c(l(l({},s),{},{api_secret:e.target.value})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Enter API Secret"})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"App ID"}),(0,Hr.jsx)("input",{type:"text",value:s.app_id,onChange:e=>c(l(l({},s),{},{app_id:e.target.value})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Enter App ID (if applicable)"})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Environment"}),(0,Hr.jsxs)("select",{value:s.environment,onChange:e=>c(l(l({},s),{},{environment:e.target.value})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent",children:[(0,Hr.jsx)("option",{value:"production",children:"Production"}),(0,Hr.jsx)("option",{value:"sandbox",children:"Sandbox"})]})]}),(0,Hr.jsxs)("div",{className:"md:col-span-2",children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description"}),(0,Hr.jsx)("textarea",{value:s.description,onChange:e=>c(l(l({},s),{},{description:e.target.value})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Optional description or notes",rows:"3"})]}),(0,Hr.jsx)("div",{className:"md:col-span-2",children:(0,Hr.jsx)("button",{type:"submit",disabled:o,className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg font-medium hover:from-pink-600 hover:to-purple-700 disabled:opacity-50",children:o?"Creating...":"Create API Key"})})]})]}),(0,Hr.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"Existing API Keys"}),o?(0,Hr.jsx)("div",{className:"text-center py-8",children:(0,Hr.jsx)("div",{className:"text-gray-400",children:"Loading API keys..."})}):0===r.length?(0,Hr.jsx)("div",{className:"text-center py-8",children:(0,Hr.jsx)("div",{className:"text-gray-400",children:"No API keys configured yet."})}):(0,Hr.jsx)("div",{className:"overflow-x-auto",children:(0,Hr.jsxs)("table",{className:"w-full text-left",children:[(0,Hr.jsx)("thead",{children:(0,Hr.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,Hr.jsx)("th",{className:"pb-3 text-gray-300",children:"Service"}),(0,Hr.jsx)("th",{className:"pb-3 text-gray-300",children:"Type"}),(0,Hr.jsx)("th",{className:"pb-3 text-gray-300",children:"Environment"}),(0,Hr.jsx)("th",{className:"pb-3 text-gray-300",children:"Status"}),(0,Hr.jsx)("th",{className:"pb-3 text-gray-300",children:"Created"}),(0,Hr.jsx)("th",{className:"pb-3 text-gray-300",children:"Actions"})]})}),(0,Hr.jsx)("tbody",{children:r.map((e=>(0,Hr.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,Hr.jsx)("td",{className:"py-3 text-white",children:e.service_name}),(0,Hr.jsx)("td",{className:"py-3 text-gray-300",children:e.key_type}),(0,Hr.jsx)("td",{className:"py-3",children:(0,Hr.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat("production"===e.environment?"bg-green-900 text-green-300":"bg-yellow-900 text-yellow-300"),children:e.environment})}),(0,Hr.jsx)("td",{className:"py-3",children:(0,Hr.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat("active"===e.status?"bg-green-900 text-green-300":"bg-red-900 text-red-300"),children:e.status})}),(0,Hr.jsx)("td",{className:"py-3 text-gray-300",children:new Date(e.created_at).toLocaleDateString()}),(0,Hr.jsx)("td",{className:"py-3",children:(0,Hr.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this API key?"))try{await Gr.delete("".concat(f,"/api/admin/api-keys/").concat(e)),await v(),alert("API key deleted successfully!")}catch(t){console.error("Failed to delete API key:",t),alert("Failed to delete API key. Please try again.")}})(e.id),className:"text-red-400 hover:text-red-300 text-sm",children:"Delete"})})]},e.id)))})]})})]})]}),"trial-management"===e&&(()=>{var e,t;return(0,Hr.jsxs)("div",{className:"space-y-6",children:[(0,Hr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[(0,Hr.jsx)("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700",children:(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:"Total Trials"}),(0,Hr.jsx)("p",{className:"text-2xl font-bold text-white",children:(null===h||void 0===h?void 0:h.total_trials)||0})]}),(0,Hr.jsx)("div",{className:"text-3xl",children:"\ud83c\udd93"})]})}),(0,Hr.jsx)("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700",children:(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:"Active Trials"}),(0,Hr.jsx)("p",{className:"text-2xl font-bold text-white",children:(null===h||void 0===h||null===(e=h.status_breakdown)||void 0===e||null===(t=e.find((e=>"active"===e._id)))||void 0===t?void 0:t.count)||0})]}),(0,Hr.jsx)("div",{className:"text-3xl",children:"\u2728"})]})}),(0,Hr.jsx)("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700",children:(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:"Conversions"}),(0,Hr.jsx)("p",{className:"text-2xl font-bold text-white",children:(null===h||void 0===h?void 0:h.converted_trials)||0})]}),(0,Hr.jsx)("div",{className:"text-3xl",children:"\ud83d\udcb0"})]})}),(0,Hr.jsx)("div",{className:"bg-gray-800 p-6 rounded-lg border border-gray-700",children:(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:"Conversion Rate"}),(0,Hr.jsxs)("p",{className:"text-2xl font-bold text-white",children:[(null===h||void 0===h?void 0:h.conversion_rate)||0,"%"]})]}),(0,Hr.jsx)("div",{className:"text-3xl",children:"\ud83d\udcc8"})]})})]}),(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white mb-6",children:"Trial Period Settings"}),(0,Hr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Hr.jsxs)("div",{className:"space-y-4",children:[(0,Hr.jsx)("h4",{className:"text-lg font-medium text-pink-400",children:"Performer Trial"}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Trial Duration (Days)"}),(0,Hr.jsx)("input",{type:"number",min:"1",max:"30",value:d.performer_trial_days,onChange:e=>u(l(l({},d),{},{performer_trial_days:parseInt(e.target.value)})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent"})]}),(0,Hr.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg",children:[(0,Hr.jsx)("h5",{className:"text-sm font-medium text-gray-300 mb-2",children:"Performer Benefits"}),(0,Hr.jsxs)("div",{className:"text-xs text-gray-400 space-y-1",children:[(0,Hr.jsx)("div",{children:"\u2713 Premium Analytics & Insights"}),(0,Hr.jsx)("div",{children:"\u2713 Advanced Messaging Tools"}),(0,Hr.jsx)("div",{children:"\u2713 Live Streaming Capabilities"}),(0,Hr.jsx)("div",{children:"\u2713 Video Call Features"}),(0,Hr.jsx)("div",{children:"\u2713 Content Monetization Tools"}),(0,Hr.jsx)("div",{children:"\u2713 Priority Customer Support"})]})]})]}),(0,Hr.jsxs)("div",{className:"space-y-4",children:[(0,Hr.jsx)("h4",{className:"text-lg font-medium text-purple-400",children:"Member Trial"}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Trial Duration (Days)"}),(0,Hr.jsx)("input",{type:"number",min:"1",max:"30",value:d.member_trial_days,onChange:e=>u(l(l({},d),{},{member_trial_days:parseInt(e.target.value)})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),(0,Hr.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg",children:[(0,Hr.jsx)("h5",{className:"text-sm font-medium text-gray-300 mb-2",children:"Member Benefits"}),(0,Hr.jsxs)("div",{className:"text-xs text-gray-400 space-y-1",children:[(0,Hr.jsx)("div",{children:"\u2713 Premium Content Access"}),(0,Hr.jsx)("div",{children:"\u2713 HD Streaming Quality"}),(0,Hr.jsx)("div",{children:"\u2713 Download Content"}),(0,Hr.jsx)("div",{children:"\u2713 Advanced Search & Filters"}),(0,Hr.jsx)("div",{children:"\u2713 Priority Messaging"}),(0,Hr.jsx)("div",{children:"\u2713 Ad-Free Experience"})]})]})]})]}),(0,Hr.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-700",children:[(0,Hr.jsx)("h4",{className:"text-lg font-medium text-white mb-4",children:"Global Settings"}),(0,Hr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Hr.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-700 rounded-lg",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("div",{className:"font-medium text-white",children:"Enable Free Trials"}),(0,Hr.jsx)("div",{className:"text-sm text-gray-400",children:"Allow new users to start free trials"})]}),(0,Hr.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,Hr.jsx)("input",{type:"checkbox",checked:d.trial_enabled,onChange:e=>u(l(l({},d),{},{trial_enabled:e.target.checked})),className:"sr-only peer"}),(0,Hr.jsx)("div",{className:"w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-pink-600"})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Reminder Days"}),(0,Hr.jsx)("input",{type:"text",value:d.auto_remind_days.join(", "),onChange:e=>u(l(l({},d),{},{auto_remind_days:e.target.value.split(",").map((e=>parseInt(e.trim()))).filter((e=>!isNaN(e)))})),placeholder:"3, 1",className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent"}),(0,Hr.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Days before expiry to send reminders (comma-separated)"})]})]})]}),(0,Hr.jsx)("div",{className:"mt-6",children:(0,Hr.jsx)("button",{onClick:()=>(async e=>{try{a(!0),(await Gr.put("".concat(f,"/api/admin/trial-settings"),e)).data.success&&(u(e),alert("Trial settings updated successfully!"))}catch(t){console.error("Failed to update trial settings:",t),alert("Failed to update trial settings. Please try again.")}finally{a(!1)}})(d),disabled:o,className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg font-medium hover:from-pink-600 hover:to-purple-700 disabled:opacity-50",children:o?"Saving...":"Save Trial Settings"})})]})]})})(),"users"===e&&b("Users"),"content"===e&&b("Content"),"payments"===e&&b("Payments"),"analytics"===e&&b("Analytics"),"settings"===e&&b("Settings")]})]})]})},Kr=e=>{var n,r;let{isOpen:i,onClose:o,trialData:a}=e;const{user:s,API:c}=Qi(),[l,d]=(0,t.useState)(!1),[u,h]=(0,t.useState)("monthly");if(!i||!a)return null;const p="expired"===a.status,f=(a.days_remaining<=1&&a.status,[{id:"monthly",name:"Monthly Plan",price:"performer"===(null===s||void 0===s?void 0:s.userType)?29.99:19.99,interval:"month",description:"Perfect for getting started",features:["All premium features","Priority support","Advanced analytics","Unlimited content"]},{id:"yearly",name:"Yearly Plan",price:"performer"===(null===s||void 0===s?void 0:s.userType)?299.99:199.99,interval:"year",description:"Best value - Save 17%",popular:!0,savings:"performer"===(null===s||void 0===s?void 0:s.userType)?59.89:39.89,features:["All monthly features","Priority support","Advanced analytics","Unlimited content","Exclusive features","Early access to new tools"]}]);return(0,Hr.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 px-4",children:(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-xl max-w-2xl w-full max-h-screen overflow-y-auto",children:[(0,Hr.jsxs)("div",{className:"p-6 text-center border-b border-gray-700 ".concat(p?"bg-red-900/20":"bg-yellow-900/20"),children:[(0,Hr.jsx)("div",{className:"text-4xl mb-3",children:p?"\u23f0":"\u26a0\ufe0f"}),(0,Hr.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:p?"Your Free Trial Has Ended":"Trial Expiring Soon!"}),(0,Hr.jsx)("p",{className:"text-gray-300",children:p?"Upgrade now to restore access to all premium features":"Your trial ends ".concat(0===a.days_remaining?"today":"in ".concat(a.days_remaining," day").concat(1===a.days_remaining?"":"s"),". Don't lose access!")})]}),(0,Hr.jsxs)("div",{className:"p-6",children:[p&&(0,Hr.jsxs)("div",{className:"bg-red-900/20 border border-red-500/30 rounded-lg p-4 mb-6",children:[(0,Hr.jsx)("h3",{className:"text-lg font-semibold text-red-400 mb-3",children:"Features You've Lost Access To:"}),(0,Hr.jsx)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:a.benefits_unlocked.map(((e,t)=>(0,Hr.jsxs)("div",{className:"flex items-center space-x-2 text-red-300",children:[(0,Hr.jsx)("span",{children:"\u274c"}),(0,Hr.jsx)("span",{children:e.replace(/_/g," ")})]},t)))})]}),(0,Hr.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white text-center mb-4",children:"Choose Your Plan to Continue"}),f.map((e=>(0,Hr.jsxs)("div",{onClick:()=>h(e.id),className:"relative border-2 rounded-lg p-4 cursor-pointer transition-all ".concat(u===e.id?"border-pink-500 bg-pink-900/20":"border-gray-600 bg-gray-700 hover:border-gray-500"," ").concat(e.popular?"ring-2 ring-purple-500":""),children:[e.popular&&(0,Hr.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:(0,Hr.jsx)("span",{className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white px-3 py-1 rounded-full text-xs font-bold",children:"MOST POPULAR"})}),(0,Hr.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h4",{className:"text-lg font-semibold text-white",children:e.name}),(0,Hr.jsx)("p",{className:"text-sm text-gray-400",children:e.description})]}),(0,Hr.jsxs)("div",{className:"text-right",children:[(0,Hr.jsxs)("div",{className:"text-2xl font-bold text-white",children:["$",e.price]}),(0,Hr.jsxs)("div",{className:"text-sm text-gray-400",children:["per ",e.interval]}),e.savings&&(0,Hr.jsxs)("div",{className:"text-xs text-green-400 font-medium",children:["Save $",e.savings]})]})]}),(0,Hr.jsx)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:e.features.map(((e,t)=>(0,Hr.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Hr.jsx)("span",{className:"text-green-400",children:"\u2713"}),(0,Hr.jsx)("span",{className:"text-gray-300",children:e})]},t)))}),u===e.id&&(0,Hr.jsx)("div",{className:"absolute top-4 right-4 w-5 h-5 bg-pink-500 rounded-full flex items-center justify-center",children:(0,Hr.jsx)("span",{className:"text-white text-xs",children:"\u2713"})})]},e.id)))]}),(0,Hr.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4 mb-6",children:[(0,Hr.jsx)("h4",{className:"text-lg font-semibold text-white mb-3",children:"Your Trial Summary"}),(0,Hr.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"Trial Duration:"}),(0,Hr.jsxs)("span",{className:"text-white ml-2",children:[a.trial_duration_days," days"]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"Days Used:"}),(0,Hr.jsx)("span",{className:"text-white ml-2",children:a.days_used})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"Features Accessed:"}),(0,Hr.jsx)("span",{className:"text-white ml-2",children:a.benefits_unlocked.length})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"Started:"}),(0,Hr.jsx)("span",{className:"text-white ml-2",children:new Date(a.trial_start_date).toLocaleDateString()})]})]})]}),(0,Hr.jsxs)("div",{className:"space-y-3",children:[(0,Hr.jsx)("button",{onClick:async()=>{try{d(!0);(await Gr.post("".concat(c,"/trials/").concat(s.id,"/convert"),{subscription_type:u})).data.success&&(window.location.href="/payment?plan=".concat(u,"&trial_conversion=true"))}catch(e){console.error("Failed to upgrade:",e),alert("Failed to process upgrade. Please try again.")}finally{d(!1)}},disabled:l,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white py-4 px-6 rounded-lg font-bold transition-all disabled:opacity-50",children:l?(0,Hr.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,Hr.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,Hr.jsx)("span",{children:"Processing..."})]}):(0,Hr.jsxs)(Hr.Fragment,{children:[p?"Restore Access":"Upgrade Now"," - $",null===(n=f.find((e=>e.id===u)))||void 0===n?void 0:n.price,"/",null===(r=f.find((e=>e.id===u)))||void 0===r?void 0:r.interval]})}),!p&&(0,Hr.jsx)("button",{onClick:async()=>{try{d(!0);(await Gr.post("".concat(c,"/trials/").concat(s.id,"/extend"),{additional_days:3})).data.success&&(alert("Trial extended by 3 days!"),window.location.reload())}catch(e){console.error("Failed to extend trial:",e),alert("Unable to extend trial at this time.")}finally{d(!1)}},disabled:l,className:"w-full bg-gray-600 hover:bg-gray-700 text-white py-3 px-6 rounded-lg font-medium transition-all",children:"Give Me 3 More Days (One-time Extension)"}),(0,Hr.jsx)("button",{onClick:o,className:"w-full border border-gray-600 hover:bg-gray-700 text-gray-300 py-3 px-6 rounded-lg font-medium transition-all",children:p?"Continue with Basic Features":"Remind Me Later"})]}),(0,Hr.jsx)("div",{className:"mt-6 text-center",children:(0,Hr.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-gray-400 text-xs",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,Hr.jsx)("span",{children:"\ud83d\udd12"}),(0,Hr.jsx)("span",{children:"Secure Payment"})]}),(0,Hr.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,Hr.jsx)("span",{children:"\u21a9\ufe0f"}),(0,Hr.jsx)("span",{children:"30-Day Money Back"})]}),(0,Hr.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,Hr.jsx)("span",{children:"\ud83d\udeab"}),(0,Hr.jsx)("span",{children:"Cancel Anytime"})]})]})})]})]})})},qr=()=>{const{user:e,API:n}=Qi(),[r,i]=(0,t.useState)(null),[o,a]=(0,t.useState)(!0),[s,c]=(0,t.useState)(!1),[l,d]=(0,t.useState)(!1);(0,t.useEffect)((()=>{e&&u()}),[e]),(0,t.useEffect)((()=>{r&&("expired"===r.status||r.days_remaining<=1&&"active"===r.status)&&d(!0)}),[r]);const u=async()=>{try{a(!0);const t=await Gr.get("".concat(n,"/trials/").concat(e.id));t.data.success&&t.data.trial&&i(t.data.trial)}catch(t){console.error("Failed to fetch trial status:",t)}finally{a(!1)}},h=async t=>{try{const r=await Gr.post("".concat(n,"/trials/").concat(e.id,"/convert"),{subscription_type:t});r.data.success&&(alert(r.data.message),c(!1),u())}catch(r){console.error("Failed to convert trial:",r),alert("Failed to upgrade. Please try again.")}};if(o)return(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 animate-pulse",children:[(0,Hr.jsx)("div",{className:"h-4 bg-gray-700 rounded w-1/3 mb-2"}),(0,Hr.jsx)("div",{className:"h-3 bg-gray-700 rounded w-1/2"})]});if(!r)return null;const{status:p,days_remaining:f,days_used:m,trial_end_date:_,benefits_unlocked:g}=r,v="active"===p,y=f<=3&&v;return(0,Hr.jsxs)("div",{className:"border-2 rounded-lg p-4 mb-6 ".concat((b=f,b<=1?"border-red-500 bg-red-900/20":b<=3?"border-yellow-500 bg-yellow-900/20":"border-green-500 bg-green-900/20")),children:[(0,Hr.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Hr.jsx)("div",{className:"text-2xl",children:"\u2728"}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h3",{className:"font-semibold text-white",children:"Free Trial"}),(0,Hr.jsx)("span",{className:"text-sm ".concat((e=>{switch(e){case"active":return"text-green-400";case"expired":return"text-red-400";case"used":return"text-gray-400";default:return"text-yellow-400"}})(p)),children:p.charAt(0).toUpperCase()+p.slice(1)})]})]}),v&&(0,Hr.jsxs)("div",{className:"text-right",children:[(0,Hr.jsx)("div",{className:"text-2xl font-bold text-white",children:f}),(0,Hr.jsx)("div",{className:"text-xs text-gray-400",children:"days left"})]})]}),v&&(0,Hr.jsxs)(Hr.Fragment,{children:[(0,Hr.jsxs)("div",{className:"mb-3",children:[(0,Hr.jsxs)("div",{className:"flex justify-between text-xs text-gray-400 mb-1",children:[(0,Hr.jsx)("span",{children:"Trial Progress"}),(0,Hr.jsxs)("span",{children:[m,"/",m+f," days"]})]}),(0,Hr.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2",children:(0,Hr.jsx)("div",{className:"bg-gradient-to-r from-pink-500 to-purple-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(m/(m+f)*100,"%")}})})]}),(0,Hr.jsxs)("div",{className:"mb-4",children:[(0,Hr.jsx)("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Trial Benefits:"}),(0,Hr.jsxs)("div",{className:"grid grid-cols-2 gap-1 text-xs",children:[g.slice(0,4).map(((e,t)=>(0,Hr.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,Hr.jsx)("span",{className:"text-green-400",children:"\u2713"}),(0,Hr.jsx)("span",{className:"text-gray-300",children:e.replace(/_/g," ")})]},t))),g.length>4&&(0,Hr.jsxs)("div",{className:"text-gray-400",children:["+",g.length-4," more"]})]})]}),y?(0,Hr.jsxs)("div",{className:"bg-gradient-to-r from-red-900/50 to-orange-900/50 rounded-lg p-3 mb-3",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,Hr.jsx)("span",{className:"text-red-400",children:"\u26a0\ufe0f"}),(0,Hr.jsxs)("span",{className:"text-sm font-medium text-red-400",children:["Trial expires ",0===f?"today":"in ".concat(f," day").concat(1===f?"":"s"),"!"]})]}),(0,Hr.jsx)("p",{className:"text-xs text-gray-300",children:"Upgrade now to continue enjoying premium features without interruption."})]}):(0,Hr.jsx)("div",{className:"bg-gradient-to-r from-pink-900/30 to-purple-900/30 rounded-lg p-3 mb-3",children:(0,Hr.jsx)("p",{className:"text-xs text-gray-300",children:"Loving your trial? Upgrade anytime to unlock unlimited access to all premium features."})}),(0,Hr.jsx)("button",{onClick:()=>d(!0),className:"w-full py-2 px-4 rounded-lg font-medium text-sm transition-all ".concat(y?"bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600 text-white":"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white"),children:y?"Upgrade Now - Don't Lose Access!":"Upgrade to Premium"})]}),"expired"===p&&(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsx)("div",{className:"text-red-400 mb-2",children:"Your trial has expired"}),(0,Hr.jsx)("button",{onClick:()=>d(!0),className:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white py-2 px-4 rounded-lg font-medium text-sm",children:"Restore Access - Upgrade Now"})]}),(0,Hr.jsx)(Kr,{isOpen:l,onClose:()=>d(!1),trialData:r}),s&&(0,Hr.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Hr.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg w-96 max-w-full mx-4",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"Upgrade Your Account"}),(0,Hr.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,Hr.jsx)("div",{className:"border border-gray-600 rounded-lg p-4 hover:border-pink-500 transition-colors cursor-pointer",onClick:()=>h("monthly"),children:(0,Hr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h4",{className:"font-medium text-white",children:"Monthly Plan"}),(0,Hr.jsx)("p",{className:"text-sm text-gray-400",children:"Billed monthly"})]}),(0,Hr.jsxs)("div",{className:"text-right",children:[(0,Hr.jsx)("div",{className:"text-lg font-bold text-white",children:"$19.99"}),(0,Hr.jsx)("div",{className:"text-xs text-gray-400",children:"per month"})]})]})}),(0,Hr.jsxs)("div",{className:"border border-gray-600 rounded-lg p-4 hover:border-purple-500 transition-colors cursor-pointer",onClick:()=>h("yearly"),children:[(0,Hr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h4",{className:"font-medium text-white",children:"Yearly Plan"}),(0,Hr.jsx)("p",{className:"text-sm text-gray-400",children:"Save 20% annually"})]}),(0,Hr.jsxs)("div",{className:"text-right",children:[(0,Hr.jsx)("div",{className:"text-lg font-bold text-white",children:"$199.99"}),(0,Hr.jsx)("div",{className:"text-xs text-gray-400",children:"per year"})]})]}),(0,Hr.jsx)("div",{className:"mt-2",children:(0,Hr.jsx)("span",{className:"bg-green-600 text-xs px-2 py-1 rounded",children:"Save $40"})})]})]}),(0,Hr.jsx)("div",{className:"flex space-x-3",children:(0,Hr.jsx)("button",{onClick:()=>c(!1),className:"flex-1 py-2 px-4 border border-gray-600 rounded-lg text-gray-300 hover:bg-gray-700 transition-colors",children:"Maybe Later"})})]})})]});var b},Yr=()=>{const{user:e,API:n}=Qi(),[r,i]=(0,t.useState)({performers:[],pagination:{current_page:1,total_pages:1,total_count:0},filters_applied:{}}),[o,a]=(0,t.useState)({query:"",country:"",state:"",city:"",radius_km:50,min_age:18,max_age:65,gender:[],sexual_preference:[],ethnicity:[],online_only:!1,verified_only:!1,sort_by:"popularity",sort_order:"desc",page:1,limit:20}),[s,c]=(0,t.useState)({genders:[],sexual_preferences:[],ethnicities:[],body_types:[],hair_colors:[],eye_colors:[],sort_options:[]}),[d,u]=(0,t.useState)(!1),[h,p]=(0,t.useState)([]),[f,m]=(0,t.useState)(!1),[_,g]=(0,t.useState)(""),[v,y]=(0,t.useState)({status:"all",subscriptionType:"all",sortBy:"popularity",gender:"all",ageRange:"all"}),[b,E]=(0,t.useState)([]),[S,T]=(0,t.useState)([]),[w,C]=(0,t.useState)(1),[R,k]=(0,t.useState)(1),[O,I]=(0,t.useState)(!0),N=[{id:1,firstName:"Isabella",lastName:"Rose",displayName:"Isabella Rose",username:"@isabella_rose",email:"isabella@example.com",bio:"Welcome to my exclusive world \u2728 Premium content creator sharing intimate moments and lifestyle content.",profileImage:"https://images.unsplash.com/photo-1701286618296-b40443dc63a9",coverImage:"https://images.pexels.com/photos/7533330/pexels-photo-7533330.jpeg",gender:"female",age:25,isOnline:!0,lastSeen:(new Date).toISOString(),followers:125e3,posts:247,subscribers:12500,rating:4.9,subscriptionType:"paid",monthlyFee:19.99,bundles:[{months:3,price:54.99,discount:8},{months:6,price:99.99,discount:17},{months:12,price:179.99,discount:25}],isVerified:!0,joinedDate:"2023-01-15",totalLikes:45e4,totalMedia:890},{id:2,firstName:"Sophia",lastName:"Dreams",displayName:"Sophia Dreams",username:"@sophia_dreams",bio:"Your favorite girl next door \ud83d\udc95 Custom content available. Let's chat!",profileImage:"https://images.unsplash.com/photo-1701286842710-5f37edc4b8b4",coverImage:"https://images.pexels.com/photos/2330137/pexels-photo-2330137.jpeg",gender:"female",age:23,isOnline:!1,lastSeen:"2024-01-20T14:45:00Z",followers:89e3,posts:189,subscribers:8900,rating:4.7,subscriptionType:"paid",monthlyFee:24.99,bundles:[{months:3,price:69.99,discount:7},{months:6,price:129.99,discount:13},{months:12,price:239.99,discount:20}],isVerified:!0,joinedDate:"2023-03-22",totalLikes:287e3,totalMedia:567},{id:3,firstName:"Luna",lastName:"Nights",displayName:"Luna Nights",username:"@luna_nights",bio:"Late night adventures and exclusive content \ud83c\udf19 VIP experience guaranteed.",profileImage:"https://images.pexels.com/photos/1983035/pexels-photo-1983035.jpeg",coverImage:"https://images.unsplash.com/photo-1717295248358-4b8f2c8989d6",gender:"female",age:28,isOnline:!0,lastSeen:(new Date).toISOString(),followers:156e3,posts:312,subscribers:15600,rating:4.8,subscriptionType:"paid",monthlyFee:29.99,bundles:[{months:3,price:79.99,discount:11},{months:6,price:149.99,discount:17},{months:12,price:269.99,discount:25}],isVerified:!0,joinedDate:"2022-11-08",totalLikes:678e3,totalMedia:1240},{id:4,firstName:"Alex",lastName:"Storm",displayName:"Alex Storm",username:"@alex_storm",bio:"Fitness enthusiast and lifestyle content creator. Join my journey to wellness! \ud83d\udcaa",profileImage:"https://images.pexels.com/photos/7533330/pexels-photo-7533330.jpeg",coverImage:"https://images.pexels.com/photos/2330137/pexels-photo-2330137.jpeg",gender:"male",age:30,isOnline:!1,lastSeen:"2024-01-19T18:30:00Z",followers:67e3,posts:145,subscribers:5400,rating:4.6,subscriptionType:"free",monthlyFee:0,bundles:[],isVerified:!0,joinedDate:"2023-06-12",totalLikes:123e3,totalMedia:345},{id:5,firstName:"Maya",lastName:"Divine",displayName:"Maya Divine",username:"@maya_divine",bio:"Spiritual content and meditation sessions. Find your inner peace with me \u2728",profileImage:"https://images.unsplash.com/photo-1701286618296-b40443dc63a9",coverImage:"https://images.pexels.com/photos/7533330/pexels-photo-7533330.jpeg",gender:"female",age:26,isOnline:!0,lastSeen:(new Date).toISOString(),followers:45e3,posts:98,subscribers:3200,rating:4.9,subscriptionType:"paid",monthlyFee:15.99,bundles:[{months:3,price:42.99,discount:10},{months:6,price:79.99,discount:17},{months:12,price:149.99,discount:22}],isVerified:!1,joinedDate:"2023-09-03",totalLikes:89e3,totalMedia:234}],A=(0,t.useCallback)(function(e,t){let n;return function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];const a=this;clearTimeout(n),n=setTimeout((()=>e.apply(a,i)),t)}}(((e,t)=>{let n=[...N];switch(e.length>0&&(n=n.filter((t=>t.displayName.toLowerCase().includes(e.toLowerCase())||t.username.toLowerCase().includes(e.toLowerCase())||t.bio.toLowerCase().includes(e.toLowerCase())))),"all"!==t.status&&(n=n.filter((e=>"online"===t.status?e.isOnline:!e.isOnline))),"all"!==t.subscriptionType&&(n=n.filter((e=>"free"===t.subscriptionType?"free"===e.subscriptionType:"paid"===e.subscriptionType))),"all"!==t.gender&&(n=n.filter((e=>e.gender===t.gender))),"all"!==t.ageRange&&(n=n.filter((e=>{const n=e.age;switch(t.ageRange){case"18-25":return n>=18&&n<=25;case"26-35":return n>=26&&n<=35;case"36+":return n>=36;default:return!0}}))),t.sortBy){case"newest":n.sort(((e,t)=>new Date(t.joinedDate)-new Date(e.joinedDate)));break;case"price_low":n.sort(((e,t)=>e.monthlyFee-t.monthlyFee));break;case"price_high":n.sort(((e,t)=>t.monthlyFee-e.monthlyFee));break;default:n.sort(((e,t)=>t.followers-e.followers))}T(n),k(Math.ceil(n.length/12)),C(1)}),300),[]);(0,t.useEffect)((()=>{I(!0),setTimeout((()=>{E(N),A(_,v),I(!1)}),1e3)}),[]),(0,t.useEffect)((()=>{A(_,v)}),[_,v,A]);const x=(e,t)=>{y((n=>l(l({},n),{},{[e]:t})))};return(0,Hr.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,Hr.jsx)(ui,{}),(0,Hr.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,Hr.jsxs)("div",{className:"mb-8",children:[(0,Hr.jsx)("h1",{className:"text-4xl font-bold mb-4 bg-gradient-to-r from-pink-400 to-purple-600 bg-clip-text text-transparent",children:"Discover Amazing Creators"}),(0,Hr.jsx)("p",{className:"text-gray-400 text-lg",children:"Find your favorite content creators and explore exclusive content"})]}),(0,Hr.jsxs)("div",{className:"bg-gray-900 rounded-lg p-6 mb-8",children:[(0,Hr.jsx)("div",{className:"mb-6",children:(0,Hr.jsxs)("div",{className:"relative",children:[(0,Hr.jsx)("input",{type:"text",placeholder:"Search by name, username, or bio...",value:_,onChange:e=>g(e.target.value),className:"w-full px-4 py-3 pl-12 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-pink-500"}),(0,Hr.jsx)("div",{className:"absolute left-4 top-3.5",children:(0,Hr.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})}),(0,Hr.jsxs)("div",{className:"grid md:grid-cols-5 gap-4",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Status"}),(0,Hr.jsxs)("select",{value:v.status,onChange:e=>x("status",e.target.value),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-pink-500",children:[(0,Hr.jsx)("option",{value:"all",children:"All"}),(0,Hr.jsx)("option",{value:"online",children:"Online"}),(0,Hr.jsx)("option",{value:"offline",children:"Offline"})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Type"}),(0,Hr.jsxs)("select",{value:v.subscriptionType,onChange:e=>x("subscriptionType",e.target.value),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-pink-500",children:[(0,Hr.jsx)("option",{value:"all",children:"All"}),(0,Hr.jsx)("option",{value:"free",children:"Free"}),(0,Hr.jsx)("option",{value:"paid",children:"Premium"})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Gender"}),(0,Hr.jsxs)("select",{value:v.gender,onChange:e=>x("gender",e.target.value),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-pink-500",children:[(0,Hr.jsx)("option",{value:"all",children:"All"}),(0,Hr.jsx)("option",{value:"female",children:"Female"}),(0,Hr.jsx)("option",{value:"male",children:"Male"}),(0,Hr.jsx)("option",{value:"other",children:"Other"})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Age"}),(0,Hr.jsxs)("select",{value:v.ageRange,onChange:e=>x("ageRange",e.target.value),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-pink-500",children:[(0,Hr.jsx)("option",{value:"all",children:"All Ages"}),(0,Hr.jsx)("option",{value:"18-25",children:"18-25"}),(0,Hr.jsx)("option",{value:"26-35",children:"26-35"}),(0,Hr.jsx)("option",{value:"36+",children:"36+"})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Sort By"}),(0,Hr.jsxs)("select",{value:v.sortBy,onChange:e=>x("sortBy",e.target.value),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-pink-500",children:[(0,Hr.jsx)("option",{value:"popularity",children:"Most Popular"}),(0,Hr.jsx)("option",{value:"newest",children:"Newest"}),(0,Hr.jsx)("option",{value:"price_low",children:"Price: Low to High"}),(0,Hr.jsx)("option",{value:"price_high",children:"Price: High to Low"})]})]})]}),(0,Hr.jsxs)("div",{className:"flex items-center justify-between mt-6",children:[(0,Hr.jsxs)("div",{className:"text-sm text-gray-400",children:[S.length," creators found"]}),(0,Hr.jsxs)("button",{onClick:()=>{I(!0),setTimeout((()=>{const e=[...N].sort((()=>.5-Math.random()));E(e),A(_,v),I(!1)}),1e3)},className:"px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all flex items-center space-x-2",children:[(0,Hr.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,Hr.jsx)("span",{children:"Refresh"})]})]})]}),O?(0,Hr.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[...Array(8)].map(((e,t)=>(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg overflow-hidden animate-pulse",children:[(0,Hr.jsx)("div",{className:"w-full h-48 bg-gray-700"}),(0,Hr.jsxs)("div",{className:"p-4",children:[(0,Hr.jsx)("div",{className:"h-4 bg-gray-700 rounded mb-2"}),(0,Hr.jsx)("div",{className:"h-3 bg-gray-700 rounded w-3/4 mb-4"}),(0,Hr.jsx)("div",{className:"h-8 bg-gray-700 rounded"})]})]},t)))}):0===S.length?(0,Hr.jsxs)("div",{className:"text-center py-12",children:[(0,Hr.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udd0d"}),(0,Hr.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"No creators found"}),(0,Hr.jsx)("p",{className:"text-gray-400 mb-4",children:"Try adjusting your search criteria or filters"}),(0,Hr.jsx)("button",{onClick:()=>{g(""),y({status:"all",subscriptionType:"all",sortBy:"popularity",gender:"all",ageRange:"all"})},className:"px-6 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors",children:"Clear All Filters"})]}):(0,Hr.jsxs)(Hr.Fragment,{children:[(0,Hr.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:(()=>{const e=12*(w-1),t=e+12;return S.slice(e,t)})().map((e=>(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg overflow-hidden hover:transform hover:scale-105 transition-all duration-300 group",children:[(0,Hr.jsxs)("div",{className:"relative",children:[(0,Hr.jsx)("img",{src:e.coverImage,alt:e.displayName,className:"w-full h-48 object-cover group-hover:scale-110 transition-transform duration-300"}),(0,Hr.jsx)("div",{className:"absolute top-3 left-3",children:(0,Hr.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat(e.isOnline?"bg-green-500 text-white":"bg-gray-600 text-gray-300"),children:e.isOnline?"Online":"Offline"})}),e.isVerified&&(0,Hr.jsx)("div",{className:"absolute top-3 right-3",children:(0,Hr.jsx)("div",{className:"bg-blue-500 rounded-full p-1",children:(0,Hr.jsx)("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Hr.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})}),(0,Hr.jsx)("div",{className:"absolute bottom-3 left-3",children:(0,Hr.jsx)("img",{src:e.profileImage,alt:e.displayName,className:"w-12 h-12 rounded-full border-3 border-white object-cover"})}),(0,Hr.jsx)("div",{className:"absolute bottom-3 right-3",children:(0,Hr.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat("free"===e.subscriptionType?"bg-green-500 text-white":"bg-purple-500 text-white"),children:"free"===e.subscriptionType?"Free":"Premium"})})]}),(0,Hr.jsxs)("div",{className:"p-4",children:[(0,Hr.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Hr.jsx)("h3",{className:"text-lg font-semibold text-white truncate",children:e.displayName}),(0,Hr.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,Hr.jsx)("span",{className:"text-yellow-400",children:"\u2605"}),(0,Hr.jsx)("span",{className:"text-sm text-gray-400",children:e.rating})]})]}),(0,Hr.jsx)("p",{className:"text-gray-400 text-sm mb-1",children:e.username}),(0,Hr.jsx)("p",{className:"text-gray-300 text-sm mb-3 line-clamp-2 h-10",children:e.bio}),(0,Hr.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-400 mb-3",children:[(0,Hr.jsxs)("span",{children:[(e.followers/1e3).toFixed(0),"K followers"]}),(0,Hr.jsxs)("span",{children:[e.posts," posts"]}),(0,Hr.jsxs)("span",{children:[(e.totalLikes/1e3).toFixed(0),"K likes"]})]}),(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsx)("div",{children:"paid"===e.subscriptionType?(0,Hr.jsxs)("span",{className:"text-lg font-semibold text-pink-400",children:["$",e.monthlyFee,"/month"]}):(0,Hr.jsx)("span",{className:"text-lg font-semibold text-green-400",children:"Free"})}),(0,Hr.jsx)("a",{href:"/profile/".concat(e.id),className:"px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all text-sm font-medium",children:"View Profile"})]})]})]},e.id)))}),R>1&&(0,Hr.jsxs)("div",{className:"flex items-center justify-center space-x-2 mt-8",children:[(0,Hr.jsx)("button",{onClick:()=>C((e=>Math.max(e-1,1))),disabled:1===w,className:"px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),[...Array(R)].map(((e,t)=>(0,Hr.jsx)("button",{onClick:()=>C(t+1),className:"px-4 py-2 rounded-lg ".concat(w===t+1?"bg-pink-500 text-white":"bg-gray-800 text-white hover:bg-gray-700"),children:t+1},t+1))),(0,Hr.jsx)("button",{onClick:()=>C((e=>Math.min(e+1,R))),disabled:w===R,className:"px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})]})},Jr=()=>{const{user:e,logout:n}=Qi(),[r,i]=(0,t.useState)("feed"),[o,a]=(0,t.useState)([]),[s,c]=(0,t.useState)([]),[d,u]=(0,t.useState)([]),[h,p]=(0,t.useState)({}),[f,m]=(0,t.useState)(!0),_=[{id:1,performerId:1,performerName:"Isabella Rose",performerUsername:"@isabella_rose",performerImage:"https://images.unsplash.com/photo-1701286618296-b40443dc63a9",title:"Morning Workout Routine",description:"Starting my day with some intense cardio and strength training. Who wants to join me? \ud83d\udcaa",type:"video",mediaUrl:"https://images.pexels.com/photos/7533330/pexels-photo-7533330.jpeg",thumbnail:"https://images.pexels.com/photos/7533330/pexels-photo-7533330.jpeg",duration:"12:34",isLocked:!0,price:9.99,likes:1240,comments:156,isLiked:!1,isBookmarked:!1,createdAt:"2024-01-20T08:30:00Z",tags:["fitness","workout","morning"]},{id:2,performerId:2,performerName:"Sophia Dreams",performerUsername:"@sophia_dreams",performerImage:"https://images.unsplash.com/photo-1701286842710-5f37edc4b8b4",title:"Behind the Scenes Photoshoot",description:"Exclusive behind-the-scenes content from my latest photoshoot. You get to see everything! \ud83d\udcf8",type:"photo",mediaUrl:"https://images.unsplash.com/photo-1701286842710-5f37edc4b8b4",thumbnail:"https://images.unsplash.com/photo-1701286842710-5f37edc4b8b4",isLocked:!1,price:0,likes:856,comments:89,isLiked:!0,isBookmarked:!0,createdAt:"2024-01-19T15:20:00Z",tags:["photoshoot","bts","modeling"]}],g=[{id:1,performerId:1,performerName:"Isabella Rose",performerUsername:"@isabella_rose",performerImage:"https://images.unsplash.com/photo-1701286618296-b40443dc63a9",subscriptionType:"monthly",price:19.99,startDate:"2024-01-01T00:00:00Z",endDate:"2024-02-01T00:00:00Z",status:"active",autoRenew:!0},{id:2,performerId:2,performerName:"Sophia Dreams",performerUsername:"@sophia_dreams",performerImage:"https://images.unsplash.com/photo-1701286842710-5f37edc4b8b4",subscriptionType:"3-month",price:69.99,startDate:"2023-12-15T00:00:00Z",endDate:"2024-03-15T00:00:00Z",status:"active",autoRenew:!1}];(0,t.useEffect)((()=>{setTimeout((()=>{a(_),c(g),u(_.filter((e=>e.isBookmarked))),p({totalReferrals:12,totalEarnings:127.5,thisMonth:45.2,referralLink:"https://eyecandy.com/ref/johndoe123"}),m(!1)}),1e3)}),[]);const v=async e=>{a((t=>t.map((t=>t.id===e?l(l({},t),{},{isLiked:!t.isLiked,likes:t.isLiked?t.likes-1:t.likes+1}):t))))},y=async e=>{a((t=>t.map((t=>t.id===e?l(l({},t),{},{isBookmarked:!t.isBookmarked}):t))));const t=o.find((t=>t.id===e));t&&(t.isBookmarked?u((t=>t.filter((t=>t.id!==e)))):u((e=>[...e,l(l({},t),{},{isBookmarked:!0})])))},b=async(e,t,n)=>{console.log("Sending tip:",{performerId:e,amount:t,message:n})};return(0,Hr.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,Hr.jsx)(ui,{}),(0,Hr.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,Hr.jsx)(qr,{}),(0,Hr.jsxs)("div",{className:"mb-8",children:[(0,Hr.jsxs)("h1",{className:"text-3xl font-bold mb-2",children:["Welcome back, ",(null===e||void 0===e?void 0:e.firstName)||(null===e||void 0===e?void 0:e.displayName),"!"]}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Your premium membership is active"})]}),(0,Hr.jsx)("div",{className:"flex space-x-1 mb-8 bg-gray-800 rounded-lg p-1 overflow-x-auto",children:[{id:"feed",label:"Your Feed",icon:"\ud83d\udcf0"},{id:"subscriptions",label:"Subscriptions",icon:"\ud83d\udc8e"},{id:"bookmarks",label:"Bookmarks",icon:"\ud83d\udd16"},{id:"messages",label:"Messages",icon:"\ud83d\udcac"},{id:"referrals",label:"Referrals",icon:"\ud83d\udcb0"}].map((e=>(0,Hr.jsxs)("button",{onClick:()=>i(e.id),className:"px-4 py-3 rounded-lg whitespace-nowrap transition-all flex items-center space-x-2 ".concat(r===e.id?"bg-pink-500 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"),children:[(0,Hr.jsx)("span",{children:e.icon}),(0,Hr.jsx)("span",{children:e.label})]},e.id)))}),f?(0,Hr.jsxs)("div",{className:"text-center py-12",children:[(0,Hr.jsx)("div",{className:"w-16 h-16 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Loading your content..."})]}):(0,Hr.jsxs)(Hr.Fragment,{children:["feed"===r&&(0,Hr.jsxs)("div",{className:"space-y-6",children:[(0,Hr.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Your Feed"}),o.map((e=>(0,Hr.jsx)(Xr,{post:e,onLike:v,onBookmark:y,onTip:b},e.id)))]}),"subscriptions"===r&&(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Your Subscriptions"}),(0,Hr.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map((e=>(0,Hr.jsx)(Qr,{subscription:e},e.id)))})]}),"bookmarks"===r&&(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Bookmarked Content"}),0===d.length?(0,Hr.jsxs)("div",{className:"text-center py-12",children:[(0,Hr.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udd16"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"No bookmarked content yet"})]}):(0,Hr.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.map((e=>(0,Hr.jsx)(Zr,{bookmark:e},e.id)))})]}),"messages"===r&&(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Messages"}),(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-8 text-center",children:[(0,Hr.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udcac"}),(0,Hr.jsx)("p",{className:"text-gray-400 mb-4",children:"No messages yet"}),(0,Hr.jsx)("p",{className:"text-gray-500",children:"Start chatting with your favorite creators!"})]})]}),"referrals"===r&&(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Referral Program"}),(0,Hr.jsx)($r,{referralStats:h,onCopyLink:()=>{navigator.clipboard.writeText(h.referralLink)}})]})]})]})]})},Xr=e=>{let{post:n,onLike:r,onBookmark:i,onTip:o}=e;const[a,s]=(0,t.useState)(!1),[c,l]=(0,t.useState)(""),[d,u]=(0,t.useState)("");return(0,Hr.jsxs)("div",{className:"bg-gray-900 rounded-lg overflow-hidden",children:[(0,Hr.jsx)("div",{className:"p-6 pb-4",children:(0,Hr.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Hr.jsx)("img",{src:n.performerImage,alt:n.performerName,className:"w-12 h-12 rounded-full object-cover"}),(0,Hr.jsxs)("div",{className:"flex-1",children:[(0,Hr.jsx)("h3",{className:"font-semibold text-white",children:n.performerName}),(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:n.performerUsername})]}),(0,Hr.jsx)("div",{className:"text-gray-400 text-sm",children:new Date(n.createdAt).toLocaleDateString()})]})}),(0,Hr.jsxs)("div",{className:"px-6 pb-4",children:[(0,Hr.jsx)("h4",{className:"text-lg font-semibold mb-2",children:n.title}),(0,Hr.jsx)("p",{className:"text-gray-300 mb-4",children:n.description}),(0,Hr.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:n.tags.map((e=>(0,Hr.jsxs)("span",{className:"px-2 py-1 bg-gray-700 text-gray-300 rounded-full text-sm",children:["#",e]},e)))})]}),(0,Hr.jsxs)("div",{className:"relative",children:[(0,Hr.jsx)("img",{src:n.thumbnail,alt:n.title,className:"w-full h-64 object-cover"}),n.isLocked&&(0,Hr.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-75 flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsx)("div",{className:"text-4xl mb-2",children:"\ud83d\udd12"}),(0,Hr.jsxs)("p",{className:"text-lg font-semibold mb-2",children:["Unlock for $",n.price]}),(0,Hr.jsx)("button",{className:"px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600",children:"Unlock Now"})]})}),"video"===n.type&&!n.isLocked&&(0,Hr.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,Hr.jsx)("button",{className:"w-16 h-16 bg-black bg-opacity-50 rounded-full flex items-center justify-center text-white hover:bg-opacity-70 transition-all",children:(0,Hr.jsx)("svg",{className:"w-8 h-8 ml-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Hr.jsx)("path",{d:"M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"})})})})]}),(0,Hr.jsx)("div",{className:"p-6",children:(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,Hr.jsxs)("button",{onClick:()=>r(n.id),className:"flex items-center space-x-2 transition-colors ".concat(n.isLiked?"text-red-500":"text-gray-400 hover:text-red-400"),children:[(0,Hr.jsx)("svg",{className:"w-6 h-6",fill:n.isLiked?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),(0,Hr.jsx)("span",{children:n.likes})]}),(0,Hr.jsxs)("button",{className:"flex items-center space-x-2 text-gray-400 hover:text-white transition-colors",children:[(0,Hr.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,Hr.jsx)("span",{children:n.comments})]}),(0,Hr.jsx)("button",{onClick:()=>i(n.id),className:"transition-colors ".concat(n.isBookmarked?"text-yellow-500":"text-gray-400 hover:text-yellow-400"),children:(0,Hr.jsx)("svg",{className:"w-6 h-6",fill:n.isBookmarked?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})})})]}),(0,Hr.jsx)("button",{onClick:()=>s(!0),className:"px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all",children:"\ud83d\udcb0 Tip"})]})}),a&&(0,Hr.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4",children:[(0,Hr.jsxs)("h3",{className:"text-xl font-semibold mb-4",children:["Send a Tip to ",n.performerName]}),(0,Hr.jsxs)("div",{className:"mb-4",children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Tip Amount ($)"}),(0,Hr.jsx)("input",{type:"number",min:"1",step:"0.01",value:c,onChange:e=>l(e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500",placeholder:"Enter amount"})]}),(0,Hr.jsxs)("div",{className:"mb-6",children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Message (optional)"}),(0,Hr.jsx)("textarea",{value:d,onChange:e=>u(e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500",rows:"3",placeholder:"Add a message..."})]}),(0,Hr.jsxs)("div",{className:"flex space-x-4",children:[(0,Hr.jsx)("button",{onClick:()=>s(!1),className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"}),(0,Hr.jsx)("button",{onClick:()=>{c&&parseFloat(c)>0&&(o(n.performerId,parseFloat(c),d),s(!1),l(""),u(""))},disabled:!c||parseFloat(c)<=0,className:"flex-1 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Send Tip"})]})]})})]})},Qr=e=>{let{subscription:t}=e;const n=Math.ceil((new Date(t.endDate)-new Date)/864e5);return(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,Hr.jsx)("img",{src:t.performerImage,alt:t.performerName,className:"w-16 h-16 rounded-full object-cover"}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h3",{className:"font-semibold text-white",children:t.performerName}),(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:t.performerUsername}),(0,Hr.jsx)("p",{className:"text-sm ".concat("active"===t.status?"text-green-400":"text-red-400"),children:"active"===t.status?"Active \u2022 ".concat(n," days left"):"Expired"})]})]}),(0,Hr.jsxs)("div",{className:"mb-4",children:[(0,Hr.jsxs)("div",{className:"flex justify-between text-sm text-gray-400 mb-1",children:[(0,Hr.jsx)("span",{children:"Subscription Type"}),(0,Hr.jsxs)("span",{children:["$",t.price]})]}),(0,Hr.jsxs)("div",{className:"flex justify-between text-sm text-gray-400",children:[(0,Hr.jsx)("span",{children:"Auto Renew"}),(0,Hr.jsx)("span",{children:t.autoRenew?"On":"Off"})]})]}),(0,Hr.jsxs)("div",{className:"flex space-x-2",children:[(0,Hr.jsx)("button",{className:"flex-1 px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors",children:"Message"}),(0,Hr.jsx)("button",{className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-colors",children:"Manage"})]})]})},Zr=e=>{let{bookmark:t}=e;return(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:[(0,Hr.jsxs)("div",{className:"relative",children:[(0,Hr.jsx)("img",{src:t.thumbnail,alt:t.title,className:"w-full h-48 object-cover"}),"video"===t.type&&(0,Hr.jsx)("div",{className:"absolute top-2 right-2 bg-black bg-opacity-75 px-2 py-1 rounded text-white text-sm",children:t.duration})]}),(0,Hr.jsxs)("div",{className:"p-4",children:[(0,Hr.jsx)("h3",{className:"font-semibold text-white mb-2",children:t.title}),(0,Hr.jsx)("p",{className:"text-gray-400 text-sm mb-2",children:t.performerName}),(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsx)("span",{className:"text-pink-400",children:t.isLocked?"$".concat(t.price):"Free"}),(0,Hr.jsxs)("div",{className:"flex items-center space-x-1 text-gray-400",children:[(0,Hr.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Hr.jsx)("path",{d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"})}),(0,Hr.jsx)("span",{children:t.likes})]})]})]})]})},$r=e=>{let{referralStats:t,onCopyLink:n}=e;return(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Your Referral Stats"}),(0,Hr.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 mb-6",children:[(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsx)("div",{className:"text-3xl font-bold text-pink-400",children:t.totalReferrals}),(0,Hr.jsx)("div",{className:"text-gray-400",children:"Total Referrals"})]}),(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsxs)("div",{className:"text-3xl font-bold text-green-400",children:["$",t.totalEarnings]}),(0,Hr.jsx)("div",{className:"text-gray-400",children:"Total Earned"})]}),(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsxs)("div",{className:"text-3xl font-bold text-purple-400",children:["$",t.thisMonth]}),(0,Hr.jsx)("div",{className:"text-gray-400",children:"This Month"})]})]}),(0,Hr.jsxs)("div",{className:"border-t border-gray-700 pt-6",children:[(0,Hr.jsx)("h4",{className:"font-semibold mb-2",children:"Your Referral Link"}),(0,Hr.jsxs)("div",{className:"flex space-x-2",children:[(0,Hr.jsx)("input",{type:"text",value:t.referralLink,readOnly:!0,className:"flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"}),(0,Hr.jsx)("button",{onClick:n,className:"px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors",children:"Copy"})]})]}),(0,Hr.jsxs)("div",{className:"mt-6",children:[(0,Hr.jsx)("h4",{className:"font-semibold mb-2",children:"Commission Structure"}),(0,Hr.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,Hr.jsxs)("div",{className:"flex justify-between",children:[(0,Hr.jsx)("span",{children:"Tier 1 (Direct Referrals):"}),(0,Hr.jsx)("span",{className:"text-green-400",children:"10%"})]}),(0,Hr.jsxs)("div",{className:"flex justify-between",children:[(0,Hr.jsx)("span",{children:"Tier 2 (Sub-referrals):"}),(0,Hr.jsx)("span",{className:"text-green-400",children:"5%"})]}),(0,Hr.jsxs)("div",{className:"flex justify-between",children:[(0,Hr.jsx)("span",{children:"Tier 3 (Sub-sub-referrals):"}),(0,Hr.jsx)("span",{className:"text-green-400",children:"5%"})]})]})]})]})},ei=e=>{let{onMethodSelect:t,selectedMethod:n}=e;return(0,Hr.jsxs)("div",{className:"space-y-4",children:[(0,Hr.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Choose Payment Method"}),[{id:"ccbill",name:"Credit/Debit Card (CCBill)",description:"Secure payment with Visa, Mastercard, Amex",icon:"\ud83d\udcb3",recommended:!0,fees:"3.9%"},{id:"stripe",name:"Credit/Debit Card (Stripe)",description:"Alternative card processing",icon:"\ud83d\udcb3",recommended:!1,fees:"2.9%"},{id:"crypto",name:"Cryptocurrency",description:"Bitcoin, Ethereum, and 200+ coins",icon:"\u20bf",recommended:!1,fees:"0.5%"}].map((e=>(0,Hr.jsxs)("div",{onClick:()=>t(e.id),className:"relative p-4 border-2 rounded-lg cursor-pointer transition-all ".concat(n===e.id?"border-pink-500 bg-pink-500 bg-opacity-10":"border-gray-700 bg-gray-800 hover:border-gray-600"),children:[e.recommended&&(0,Hr.jsx)("div",{className:"absolute -top-2 left-4 bg-pink-500 text-white text-xs px-2 py-1 rounded",children:"Recommended"}),(0,Hr.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Hr.jsx)("div",{className:"text-2xl",children:e.icon}),(0,Hr.jsxs)("div",{className:"flex-1",children:[(0,Hr.jsx)("h4",{className:"font-semibold text-white",children:e.name}),(0,Hr.jsx)("p",{className:"text-sm text-gray-400",children:e.description})]}),(0,Hr.jsxs)("div",{className:"text-right",children:[(0,Hr.jsxs)("div",{className:"text-sm text-gray-400",children:["Fee: ",e.fees]}),n===e.id&&(0,Hr.jsx)("div",{className:"text-pink-400",children:(0,Hr.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Hr.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})]})]},e.id)))]})},ti=e=>{let{onPackageSelect:t,selectedPackage:n,userType:r}=e;const i="member"===r?[{id:"member_monthly",name:"Monthly Membership",price:19.95,period:"1 month",description:"Access to all premium content",features:["Unlimited content access","HD video streaming","Direct messaging","Mobile app access"],popular:!1},{id:"member_quarterly",name:"Quarterly Membership",price:54.99,period:"3 months",originalPrice:59.85,savings:8,description:"Best value for regular users",features:["Everything in Monthly","3 months at reduced rate","Priority support","Early access to new features"],popular:!0},{id:"member_annual",name:"Annual Membership",price:179.99,period:"12 months",originalPrice:239.4,savings:25,description:"Maximum savings for power users",features:["Everything in Quarterly","Maximum discount","VIP badge","Exclusive events access"],popular:!1}]:[{id:"performer_monthly",name:"Creator Monthly",price:50,period:"1 month",description:"Start your content creation journey",features:["Upload unlimited content","Keep 60% of revenue","Analytics dashboard","Payment processing"],popular:!1},{id:"performer_quarterly",name:"Creator Quarterly",price:140,period:"3 months",originalPrice:150,savings:7,description:"Popular choice for serious creators",features:["Everything in Monthly","Advanced analytics","Priority listing","Custom branding"],popular:!0},{id:"performer_annual",name:"Creator Annual",price:500,period:"12 months",originalPrice:600,savings:17,description:"Best value for professional creators",features:["Everything in Quarterly","Maximum savings","Dedicated support","Marketing tools"],popular:!1}];return(0,Hr.jsxs)("div",{className:"space-y-6",children:[(0,Hr.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4",children:["Choose Your ","member"===r?"Membership":"Creator"," Plan"]}),(0,Hr.jsx)("div",{className:"grid md:grid-cols-3 gap-4",children:i.map((e=>(0,Hr.jsxs)("div",{onClick:()=>t(e),className:"relative p-6 border-2 rounded-lg cursor-pointer transition-all ".concat((null===n||void 0===n?void 0:n.id)===e.id?"border-pink-500 bg-pink-500 bg-opacity-10":"border-gray-700 bg-gray-800 hover:border-gray-600"),children:[e.popular&&(0,Hr.jsx)("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-pink-500 to-purple-600 text-white text-sm px-4 py-1 rounded-full",children:"Most Popular"}),e.savings&&(0,Hr.jsxs)("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:["Save ",e.savings,"%"]}),(0,Hr.jsxs)("div",{className:"text-center mb-4",children:[(0,Hr.jsx)("h4",{className:"font-semibold text-white text-lg",children:e.name}),(0,Hr.jsxs)("div",{className:"mt-2",children:[(0,Hr.jsxs)("span",{className:"text-3xl font-bold text-pink-400",children:["$",e.price]}),(0,Hr.jsxs)("span",{className:"text-gray-400",children:["/",e.period]})]}),e.originalPrice&&(0,Hr.jsxs)("div",{className:"text-sm text-gray-500 line-through",children:["$",e.originalPrice]})]}),(0,Hr.jsx)("p",{className:"text-gray-400 text-sm text-center mb-4",children:e.description}),(0,Hr.jsx)("ul",{className:"space-y-2",children:e.features.map(((e,t)=>(0,Hr.jsxs)("li",{className:"flex items-center text-sm text-gray-300",children:[(0,Hr.jsx)("svg",{className:"w-4 h-4 text-green-400 mr-2 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Hr.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),e]},t)))}),(null===n||void 0===n?void 0:n.id)===e.id&&(0,Hr.jsx)("div",{className:"mt-4 flex justify-center",children:(0,Hr.jsx)("div",{className:"w-6 h-6 bg-pink-500 rounded-full flex items-center justify-center",children:(0,Hr.jsx)("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Hr.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})})]},e.id)))})]})},ni=e=>{let{package:n,onSuccess:r,onError:i}=e;const o=(0,t.useRef)(null),a=(0,t.useRef)(null),[s,c]=(0,t.useState)(!0),[l,d]=(0,t.useState)("");(0,t.useEffect)((()=>{if(n){if(window.ccbill)u();else{const e=document.createElement("script");e.src="https://js.ccbill.com/v1.9.0/ccbill-advanced-widget.js",e.onload=u,e.onerror=()=>d("Failed to load CCBill payment system"),document.head.appendChild(e)}return()=>{if(a.current)try{a.current.unmount()}catch(eo){console.warn("Error unmounting CCBill widget:",eo)}}}}),[n]);const u=()=>{try{const e=new window.ccbill.PaymentWidget;a.current=e;const t="one-time"!==n.period,r={apiKey:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:"443",FAST_REFRESH:!0,REACT_APP_BACKEND_URL:"https://0505b05a-3ca5-43b7-aafd-03668f4bbfc0.preview.emergentagent.com"}.REACT_APP_CCBILL_API_KEY,initialPrice:n.price.toFixed(2),initialPeriod:t?h(n.period):1,currency:"USD",recurringPrice:t?n.price.toFixed(2):void 0,recurringPeriod:t?h(n.period):void 0,rebills:t?99:void 0,formName:"eyecandy_".concat(n.id),style:{theme:"dark",primaryColor:"#EC4899"}};o.current&&(o.current.innerHTML="",e.mount(o.current,r));const s=e=>{const t=e.detail.token;p(t)},l=e=>{d(e.detail.message||"Payment failed. Please try again."),i(e.detail)};return document.addEventListener("tokenCreated",s),document.addEventListener("paymentError",l),c(!1),()=>{document.removeEventListener("tokenCreated",s),document.removeEventListener("paymentError",l)}}catch(e){d("Failed to initialize payment system"),c(!1)}},h=e=>{switch(e){case"1 month":default:return 30;case"3 months":return 90;case"12 months":return 365}},p=async e=>{try{c(!0);const t=await fetch("/api/payments/ccbill/process",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken"))},body:JSON.stringify({paymentToken:e,packageId:n.id,amount:n.price,isSubscription:"one-time"!==n.period})}),o=await t.json();o.success?r(o):(d(o.message||"Payment processing failed"),i(o))}catch(t){d("Network error. Please check your connection and try again."),i(t)}finally{c(!1)}};return l?(0,Hr.jsx)("div",{className:"bg-red-600 bg-opacity-20 border border-red-600 rounded-lg p-4",children:(0,Hr.jsxs)("div",{className:"flex items-center",children:[(0,Hr.jsx)("svg",{className:"w-5 h-5 text-red-400 mr-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Hr.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,Hr.jsx)("p",{className:"text-red-400",children:l})]})}):(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Secure Card Payment"}),s&&(0,Hr.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,Hr.jsx)("div",{className:"w-8 h-8 border-4 border-pink-500 border-t-transparent rounded-full animate-spin"}),(0,Hr.jsx)("span",{className:"ml-3 text-gray-400",children:"Loading secure payment form..."})]}),(0,Hr.jsx)("div",{ref:o,className:s?"hidden":""}),(0,Hr.jsxs)("div",{className:"mt-4 text-xs text-gray-400",children:[(0,Hr.jsx)("p",{children:"\ud83d\udd12 Your payment information is encrypted and secure"}),(0,Hr.jsx)("p",{children:"\ud83d\udcb3 Visa, Mastercard, American Express, and Discover accepted"}),(0,Hr.jsx)("p",{children:"\ud83c\udfe6 Processed by CCBill - trusted by millions worldwide"})]})]})},ri=e=>{let{package:n,onSuccess:r,onError:i}=e;const[o,a]=(0,t.useState)(!1),[s,c]=(0,t.useState)("");return(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Stripe Checkout"}),s&&(0,Hr.jsx)("div",{className:"mb-4 bg-red-600 bg-opacity-20 border border-red-600 rounded-lg p-3",children:(0,Hr.jsx)("p",{className:"text-red-400 text-sm",children:s})}),(0,Hr.jsxs)("div",{className:"space-y-4",children:[(0,Hr.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,Hr.jsx)("h4",{className:"font-semibold text-white",children:n.name}),(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:n.description}),(0,Hr.jsxs)("div",{className:"mt-2",children:[(0,Hr.jsxs)("span",{className:"text-2xl font-bold text-pink-400",children:["$",n.price]}),(0,Hr.jsxs)("span",{className:"text-gray-400",children:["/",n.period]})]})]}),(0,Hr.jsx)("button",{onClick:async()=>{try{a(!0),c("");const e=window.location.origin,t="".concat(e,"/payment-success?session_id={CHECKOUT_SESSION_ID}"),r="".concat(e,"/payment-cancelled"),o=await fetch("/api/payments/stripe/create-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken"))},body:JSON.stringify({packageId:n.id,successUrl:t,cancelUrl:r,metadata:{packageId:n.id,packageName:n.name,userId:localStorage.getItem("userId")}})}),s=await o.json();s.success&&s.url?window.location.href=s.url:(c(s.message||"Failed to create payment session"),i(s))}catch(e){c("Network error. Please check your connection and try again."),i(e)}finally{a(!1)}},disabled:o,className:"w-full py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:o?(0,Hr.jsxs)("span",{className:"flex items-center justify-center",children:[(0,Hr.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Processing..."]}):"Continue with Stripe"}),(0,Hr.jsxs)("div",{className:"text-xs text-gray-400 text-center",children:[(0,Hr.jsx)("p",{children:"\ud83d\udd12 Secure payment powered by Stripe"}),(0,Hr.jsx)("p",{children:"\ud83d\udcb3 All major credit and debit cards accepted"})]})]})]})},ii=e=>{let{package:n,onSuccess:r,onError:i}=e;const[o,a]=(0,t.useState)(!1),[s,c]=(0,t.useState)(""),[l,d]=(0,t.useState)(null),[u,h]=(0,t.useState)("btc"),[p,f]=(0,t.useState)("idle"),m=[{id:"btc",name:"Bitcoin",symbol:"BTC",icon:"\u20bf"},{id:"eth",name:"Ethereum",symbol:"ETH",icon:"\u039e"},{id:"usdt",name:"Tether",symbol:"USDT",icon:"\u20ae"},{id:"usdc",name:"USD Coin",symbol:"USDC",icon:"$"},{id:"ltc",name:"Litecoin",symbol:"LTC",icon:"\u0141"},{id:"bch",name:"Bitcoin Cash",symbol:"BCH",icon:"\u20bf"}],_=e=>{const t=async()=>{try{const n=await fetch("/api/payments/crypto/status/".concat(e),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken"))}}),o=await n.json();"completed"===o.status?(f("completed"),r(o)):"failed"===o.status||"expired"===o.status?(f("failed"),c("Payment failed or expired. Please try again."),i(o)):setTimeout(t,1e4)}catch(n){console.error("Error checking payment status:",n),setTimeout(t,1e4)}};setTimeout(t,3e4)},g=e=>{navigator.clipboard.writeText(e)},v=()=>{const e=m.find((e=>e.id===u)),t="".concat(e.symbol.toLowerCase(),":").concat(l.address,"?amount=").concat(l.cryptoAmount);window.open(t,"_blank")};return"completed"===p?(0,Hr.jsxs)("div",{className:"bg-green-600 bg-opacity-20 border border-green-600 rounded-lg p-6 text-center",children:[(0,Hr.jsx)("div",{className:"text-4xl mb-4",children:"\u2705"}),(0,Hr.jsx)("h3",{className:"text-lg font-semibold text-green-400 mb-2",children:"Payment Completed!"}),(0,Hr.jsx)("p",{className:"text-gray-300",children:"Your crypto payment has been confirmed on the blockchain."})]}):l&&"pending"===p?(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Complete Crypto Payment"}),(0,Hr.jsx)("div",{className:"bg-yellow-600 bg-opacity-20 border border-yellow-600 rounded-lg p-4 mb-6",children:(0,Hr.jsxs)("div",{className:"flex items-center",children:[(0,Hr.jsx)("svg",{className:"w-5 h-5 text-yellow-400 mr-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Hr.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,Hr.jsx)("p",{className:"text-yellow-400 text-sm",children:"Send exactly the amount shown below to complete your payment"})]})}),(0,Hr.jsxs)("div",{className:"space-y-4",children:[(0,Hr.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,Hr.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"Amount to Send:"}),(0,Hr.jsxs)("span",{className:"text-xl font-bold text-white",children:[l.cryptoAmount," ",l.currency]})]}),(0,Hr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"USD Value:"}),(0,Hr.jsxs)("span",{className:"text-gray-300",children:["$",n.price]})]})]}),(0,Hr.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,Hr.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"Send to Address:"}),(0,Hr.jsx)("button",{onClick:()=>g(l.address),className:"text-pink-400 hover:text-pink-300 text-sm",children:"Copy"})]}),(0,Hr.jsx)("div",{className:"bg-gray-800 rounded p-2 break-all text-sm text-white font-mono",children:l.address})]}),(0,Hr.jsxs)("div",{className:"flex space-x-3",children:[(0,Hr.jsx)("button",{onClick:v,className:"flex-1 py-2 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all",children:"Open in Wallet"}),(0,Hr.jsx)("button",{onClick:()=>g(l.address),className:"flex-1 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all",children:"Copy Address"})]}),(0,Hr.jsx)("div",{className:"text-center",children:(0,Hr.jsxs)("div",{className:"inline-flex items-center text-sm text-gray-400",children:[(0,Hr.jsx)("div",{className:"w-4 h-4 border-2 border-pink-500 border-t-transparent rounded-full animate-spin mr-2"}),"Waiting for payment confirmation..."]})}),(0,Hr.jsxs)("div",{className:"text-xs text-gray-500 text-center",children:[(0,Hr.jsx)("p",{children:"\u23f1\ufe0f Payment expires in 30 minutes"}),(0,Hr.jsx)("p",{children:"\ud83d\udd17 Confirmation typically takes 1-3 network confirmations"})]})]})]}):(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Pay with Cryptocurrency"}),s&&(0,Hr.jsx)("div",{className:"mb-4 bg-red-600 bg-opacity-20 border border-red-600 rounded-lg p-3",children:(0,Hr.jsx)("p",{className:"text-red-400 text-sm",children:s})}),(0,Hr.jsxs)("div",{className:"space-y-4",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select Cryptocurrency"}),(0,Hr.jsx)("div",{className:"grid grid-cols-2 gap-2",children:m.map((e=>(0,Hr.jsx)("button",{onClick:()=>h(e.id),className:"p-3 rounded-lg border-2 transition-all ".concat(u===e.id?"border-pink-500 bg-pink-500 bg-opacity-10":"border-gray-700 bg-gray-700 hover:border-gray-600"),children:(0,Hr.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Hr.jsx)("span",{className:"text-lg",children:e.icon}),(0,Hr.jsxs)("div",{className:"text-left",children:[(0,Hr.jsx)("div",{className:"text-white text-sm font-medium",children:e.symbol}),(0,Hr.jsx)("div",{className:"text-gray-400 text-xs",children:e.name})]})]})},e.id)))})]}),(0,Hr.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,Hr.jsx)("h4",{className:"font-semibold text-white",children:n.name}),(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:n.description}),(0,Hr.jsxs)("div",{className:"mt-2",children:[(0,Hr.jsxs)("span",{className:"text-2xl font-bold text-pink-400",children:["$",n.price]}),(0,Hr.jsxs)("span",{className:"text-gray-400",children:["/",n.period]})]})]}),(0,Hr.jsx)("button",{onClick:async()=>{try{a(!0),c("");const e=await fetch("/api/payments/crypto/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken"))},body:JSON.stringify({packageId:n.id,amount:n.price,currency:u.toUpperCase(),isSubscription:"one-time"!==n.period})}),t=await e.json();t.success?(d(t.payment),f("pending"),_(t.payment.id)):(c(t.message||"Failed to create crypto payment"),i(t))}catch(e){c("Network error. Please check your connection and try again."),i(e)}finally{a(!1)}},disabled:o,className:"w-full py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg font-semibold hover:from-purple-600 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:o?(0,Hr.jsxs)("span",{className:"flex items-center justify-center",children:[(0,Hr.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Creating Payment..."]}):"Generate Payment Address"}),(0,Hr.jsxs)("div",{className:"text-xs text-gray-400 text-center",children:[(0,Hr.jsx)("p",{children:"\ud83d\udd12 Secure crypto payments via NOWPayments"}),(0,Hr.jsx)("p",{children:"\u26a1 Instant confirmation with supported cryptocurrencies"}),(0,Hr.jsx)("p",{children:"\ud83c\udf10 Decentralized and anonymous transactions"})]})]})]})},oi=()=>{const{user:e,userType:n}=Qi(),[r,i]=(0,t.useState)(1),[o,a]=(0,t.useState)("ccbill"),[s,c]=(0,t.useState)(null),[l,d]=(0,t.useState)(!1),u=[{id:1,name:"Choose Package",icon:"\ud83d\udce6"},{id:2,name:"Payment Method",icon:"\ud83d\udcb3"},{id:3,name:"Complete Payment",icon:"\u2705"}],h=e=>{d(!1),window.location.href="/payment-success"},p=e=>{d(!1),console.error("Payment error:",e)};return(0,Hr.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,Hr.jsx)(Header,{}),(0,Hr.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,Hr.jsxs)("div",{className:"text-center mb-8",children:[(0,Hr.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Complete Your Purchase"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Secure payment processing for Eye Candy"})]}),(0,Hr.jsx)("div",{className:"flex items-center justify-center mb-8",children:u.map(((e,t)=>(0,Hr.jsxs)("div",{className:"flex items-center",children:[(0,Hr.jsx)("div",{className:"flex items-center justify-center w-10 h-10 rounded-full border-2 ".concat(r>=e.id?"bg-pink-500 border-pink-500 text-white":"border-gray-600 text-gray-400"),children:(0,Hr.jsx)("span",{className:"text-lg",children:e.icon})}),(0,Hr.jsx)("div",{className:"ml-2 mr-4",children:(0,Hr.jsx)("div",{className:"text-sm ".concat(r>=e.id?"text-white":"text-gray-400"),children:e.name})}),t<u.length-1&&(0,Hr.jsx)("div",{className:"w-8 h-0.5 mr-4 ".concat(r>e.id?"bg-pink-500":"bg-gray-600")})]},e.id)))}),(0,Hr.jsxs)("div",{className:"max-w-2xl mx-auto",children:[1===r&&(0,Hr.jsx)("div",{children:(0,Hr.jsx)(ti,{onPackageSelect:e=>{c(e),i(2)},selectedPackage:s,userType:n})}),2===r&&(0,Hr.jsxs)("div",{className:"space-y-6",children:[(0,Hr.jsx)(ei,{onMethodSelect:a,selectedMethod:o}),(0,Hr.jsxs)("div",{className:"flex space-x-4",children:[(0,Hr.jsx)("button",{onClick:()=>i(1),className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Back"}),(0,Hr.jsx)("button",{onClick:()=>i(3),className:"flex-1 px-6 py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all",children:"Continue to Payment"})]})]}),3===r&&(0,Hr.jsxs)("div",{className:"space-y-6",children:[(()=>{if(!s)return null;switch(o){case"ccbill":return(0,Hr.jsx)(ni,{package:s,onSuccess:h,onError:p});case"stripe":return(0,Hr.jsx)(ri,{package:s,onSuccess:h,onError:p});case"crypto":return(0,Hr.jsx)(ii,{package:s,onSuccess:h,onError:p});default:return null}})(),(0,Hr.jsx)("div",{className:"flex space-x-4",children:(0,Hr.jsx)("button",{onClick:()=>i(2),className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",disabled:l,children:"Back"})})]})]})]})]})},ai=()=>{const{user:e,API:n}=Qi(),[r,i]=(0,t.useState)({balance:0,pendingBalance:0,totalEarnings:0,totalSpent:0}),[o,a]=(0,t.useState)("overview"),[s,c]=(0,t.useState)([]),[l,d]=(0,t.useState)(!0),[u,h]=(0,t.useState)(!1),[p,f]=(0,t.useState)(!1),m={balance:247.85,pendingBalance:45.2,totalEarnings:1247.5,totalSpent:189.65,currency:"USD"},_=[{id:1,type:"earned",amount:19.99,description:"Subscription payment from @john_doe",date:"2024-01-20T14:30:00Z",status:"completed",method:"ccbill"},{id:2,type:"spent",amount:-24.99,description:"Subscription to @sophia_dreams",date:"2024-01-19T09:15:00Z",status:"completed",method:"stripe"},{id:3,type:"earned",amount:5,description:"Tip from @user123",date:"2024-01-18T16:45:00Z",status:"completed",method:"crypto"},{id:4,type:"withdrawn",amount:-100,description:"Withdrawal to bank account",date:"2024-01-17T11:20:00Z",status:"pending",method:"bank_transfer"},{id:5,type:"added",amount:50,description:"Funds added via credit card",date:"2024-01-16T13:10:00Z",status:"completed",method:"ccbill"}];(0,t.useEffect)((()=>{setTimeout((()=>{i(m),c(_),d(!1)}),1e3)}),[]);const g=(e,t)=>{switch(e){case"earned":return"\ud83d\udcb0";case"spent":return"\ud83d\udcb8";case"withdrawn":return"\ud83c\udfe6";case"added":return"\ud83d\udcb3";default:return"\ud83d\udcb1"}},v=e=>{switch(e){case"earned":return"text-green-400";case"spent":return"text-red-400";case"withdrawn":return"text-blue-400";case"added":return"text-purple-400";default:return"text-gray-400"}},y=e=>{const t=e<0,n=Math.abs(e);return"".concat(t?"-":"+","$").concat(n.toFixed(2))};return l?(0,Hr.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,Hr.jsx)(Header,{}),(0,Hr.jsx)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:(0,Hr.jsxs)("div",{className:"text-center py-12",children:[(0,Hr.jsx)("div",{className:"w-16 h-16 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Loading your wallet..."})]})})]}):(0,Hr.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,Hr.jsx)(Header,{}),(0,Hr.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[(0,Hr.jsxs)("div",{className:"mb-8",children:[(0,Hr.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Digital Wallet"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Manage your funds, earnings, and transactions"})]}),(0,Hr.jsxs)("div",{className:"grid md:grid-cols-4 gap-6 mb-8",children:[(0,Hr.jsx)("div",{className:"bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-6",children:(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("p",{className:"text-green-100 text-sm",children:"Available Balance"}),(0,Hr.jsxs)("p",{className:"text-2xl font-bold text-white",children:["$",r.balance.toFixed(2)]})]}),(0,Hr.jsx)("div",{className:"text-3xl text-green-100",children:"\ud83d\udcb0"})]})}),(0,Hr.jsx)("div",{className:"bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-lg p-6",children:(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("p",{className:"text-yellow-100 text-sm",children:"Pending"}),(0,Hr.jsxs)("p",{className:"text-2xl font-bold text-white",children:["$",r.pendingBalance.toFixed(2)]})]}),(0,Hr.jsx)("div",{className:"text-3xl text-yellow-100",children:"\u23f3"})]})}),(0,Hr.jsx)("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg p-6",children:(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("p",{className:"text-purple-100 text-sm",children:"Total Earnings"}),(0,Hr.jsxs)("p",{className:"text-2xl font-bold text-white",children:["$",r.totalEarnings.toFixed(2)]})]}),(0,Hr.jsx)("div",{className:"text-3xl text-purple-100",children:"\ud83d\udcc8"})]})}),(0,Hr.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-6",children:(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("p",{className:"text-blue-100 text-sm",children:"Total Spent"}),(0,Hr.jsxs)("p",{className:"text-2xl font-bold text-white",children:["$",r.totalSpent.toFixed(2)]})]}),(0,Hr.jsx)("div",{className:"text-3xl text-blue-100",children:"\ud83d\udcb8"})]})})]}),(0,Hr.jsxs)("div",{className:"grid md:grid-cols-3 gap-4 mb-8",children:[(0,Hr.jsx)("button",{onClick:()=>h(!0),className:"p-4 bg-gradient-to-r from-pink-500 to-purple-600 rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all",children:(0,Hr.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Hr.jsx)("div",{className:"text-2xl",children:"\ud83d\udcb3"}),(0,Hr.jsxs)("div",{className:"text-left",children:[(0,Hr.jsx)("div",{className:"font-semibold",children:"Add Funds"}),(0,Hr.jsx)("div",{className:"text-sm opacity-90",children:"Credit card, crypto, bank"})]})]})}),(0,Hr.jsx)("button",{onClick:()=>f(!0),className:"p-4 bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all",children:(0,Hr.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Hr.jsx)("div",{className:"text-2xl",children:"\ud83c\udfe6"}),(0,Hr.jsxs)("div",{className:"text-left",children:[(0,Hr.jsx)("div",{className:"font-semibold",children:"Withdraw"}),(0,Hr.jsx)("div",{className:"text-sm opacity-90",children:"To bank or crypto wallet"})]})]})}),(0,Hr.jsx)("button",{onClick:()=>a("transactions"),className:"p-4 bg-gradient-to-r from-blue-500 to-cyan-600 rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all",children:(0,Hr.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Hr.jsx)("div",{className:"text-2xl",children:"\ud83d\udcca"}),(0,Hr.jsxs)("div",{className:"text-left",children:[(0,Hr.jsx)("div",{className:"font-semibold",children:"View History"}),(0,Hr.jsx)("div",{className:"text-sm opacity-90",children:"All transactions"})]})]})})]}),(0,Hr.jsx)("div",{className:"flex space-x-1 mb-8 bg-gray-800 rounded-lg p-1",children:[{id:"overview",label:"Overview",icon:"\ud83d\udcca"},{id:"transactions",label:"Transactions",icon:"\ud83d\udccb"},{id:"earnings",label:"Earnings",icon:"\ud83d\udcb0"},{id:"settings",label:"Settings",icon:"\u2699\ufe0f"}].map((e=>(0,Hr.jsxs)("button",{onClick:()=>a(e.id),className:"px-4 py-3 rounded-lg transition-all flex items-center space-x-2 ".concat(o===e.id?"bg-pink-500 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"),children:[(0,Hr.jsx)("span",{children:e.icon}),(0,Hr.jsx)("span",{children:e.label})]},e.id)))}),"overview"===o&&(0,Hr.jsx)("div",{className:"space-y-6",children:(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Wallet Overview"}),(0,Hr.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h4",{className:"font-semibold mb-3",children:"Recent Activity"}),(0,Hr.jsx)("div",{className:"space-y-3",children:s.slice(0,3).map((e=>(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Hr.jsx)("div",{className:"text-xl",children:g(e.type,e.method)}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("div",{className:"text-sm font-medium text-white",children:e.description}),(0,Hr.jsx)("div",{className:"text-xs text-gray-400",children:new Date(e.date).toLocaleDateString()})]})]}),(0,Hr.jsx)("div",{className:"font-semibold ".concat(v(e.type)),children:y(e.amount)})]},e.id)))})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h4",{className:"font-semibold mb-3",children:"Payment Methods"}),(0,Hr.jsxs)("div",{className:"space-y-3",children:[(0,Hr.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Hr.jsx)("div",{className:"text-lg",children:"\ud83d\udcb3"}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("div",{className:"text-sm font-medium",children:"Credit Cards"}),(0,Hr.jsx)("div",{className:"text-xs text-gray-400",children:"CCBill, Stripe"})]})]}),(0,Hr.jsx)("div",{className:"text-green-400 text-sm",children:"Active"})]}),(0,Hr.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Hr.jsx)("div",{className:"text-lg",children:"\u20bf"}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("div",{className:"text-sm font-medium",children:"Cryptocurrency"}),(0,Hr.jsx)("div",{className:"text-xs text-gray-400",children:"Bitcoin, Ethereum, USDT"})]})]}),(0,Hr.jsx)("div",{className:"text-green-400 text-sm",children:"Active"})]}),(0,Hr.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Hr.jsx)("div",{className:"text-lg",children:"\ud83c\udfe6"}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("div",{className:"text-sm font-medium",children:"Bank Transfer"}),(0,Hr.jsx)("div",{className:"text-xs text-gray-400",children:"ACH, Wire transfer"})]})]}),(0,Hr.jsx)("div",{className:"text-yellow-400 text-sm",children:"Setup Required"})]})]})]})]})]})}),"transactions"===o&&(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Transaction History"}),(0,Hr.jsxs)("div",{className:"flex flex-wrap gap-4 mb-6",children:[(0,Hr.jsxs)("select",{className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[(0,Hr.jsx)("option",{children:"All Types"}),(0,Hr.jsx)("option",{children:"Earned"}),(0,Hr.jsx)("option",{children:"Spent"}),(0,Hr.jsx)("option",{children:"Withdrawn"}),(0,Hr.jsx)("option",{children:"Added"})]}),(0,Hr.jsxs)("select",{className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[(0,Hr.jsx)("option",{children:"All Methods"}),(0,Hr.jsx)("option",{children:"CCBill"}),(0,Hr.jsx)("option",{children:"Stripe"}),(0,Hr.jsx)("option",{children:"Crypto"}),(0,Hr.jsx)("option",{children:"Bank Transfer"})]}),(0,Hr.jsxs)("select",{className:"px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",children:[(0,Hr.jsx)("option",{children:"Last 30 days"}),(0,Hr.jsx)("option",{children:"Last 3 months"}),(0,Hr.jsx)("option",{children:"Last 6 months"}),(0,Hr.jsx)("option",{children:"All time"})]})]}),(0,Hr.jsx)("div",{className:"space-y-3",children:s.map((e=>(0,Hr.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-700 rounded-lg",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Hr.jsx)("div",{className:"text-2xl",children:g(e.type,e.method)}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("div",{className:"font-medium text-white",children:e.description}),(0,Hr.jsxs)("div",{className:"text-sm text-gray-400",children:[new Date(e.date).toLocaleDateString()," \u2022 ",e.method.toUpperCase()]})]})]}),(0,Hr.jsxs)("div",{className:"text-right",children:[(0,Hr.jsx)("div",{className:"font-semibold ".concat(v(e.type)),children:y(e.amount)}),(0,Hr.jsx)("div",{className:"text-sm ".concat("completed"===e.status?"text-green-400":"pending"===e.status?"text-yellow-400":"text-red-400"),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]})]},e.id)))})]}),"earnings"===o&&(0,Hr.jsx)("div",{className:"space-y-6",children:(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Earnings Breakdown"}),(0,Hr.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 mb-6",children:[(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsx)("div",{className:"text-2xl font-bold text-green-400",children:"$847.20"}),(0,Hr.jsx)("div",{className:"text-gray-400",children:"This Month"})]}),(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsx)("div",{className:"text-2xl font-bold text-purple-400",children:"$2,450.80"}),(0,Hr.jsx)("div",{className:"text-gray-400",children:"Last 3 Months"})]}),(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsx)("div",{className:"text-2xl font-bold text-blue-400",children:"$12,847.00"}),(0,Hr.jsx)("div",{className:"text-gray-400",children:"All Time"})]})]}),(0,Hr.jsxs)("div",{className:"space-y-4",children:[(0,Hr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"Subscriptions"}),(0,Hr.jsx)("span",{className:"text-white font-semibold",children:"$567.30 (67%)"})]}),(0,Hr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"Tips"}),(0,Hr.jsx)("span",{className:"text-white font-semibold",children:"$189.50 (22%)"})]}),(0,Hr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"Content Sales"}),(0,Hr.jsx)("span",{className:"text-white font-semibold",children:"$90.40 (11%)"})]})]})]})}),"settings"===o&&(0,Hr.jsx)("div",{className:"space-y-6",children:(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Wallet Settings"}),(0,Hr.jsxs)("div",{className:"space-y-6",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h4",{className:"font-semibold mb-3",children:"Payment Preferences"}),(0,Hr.jsxs)("div",{className:"space-y-3",children:[(0,Hr.jsxs)("label",{className:"flex items-center",children:[(0,Hr.jsx)("input",{type:"checkbox",className:"mr-3",defaultChecked:!0}),(0,Hr.jsx)("span",{children:"Auto-convert crypto to USD"})]}),(0,Hr.jsxs)("label",{className:"flex items-center",children:[(0,Hr.jsx)("input",{type:"checkbox",className:"mr-3"}),(0,Hr.jsx)("span",{children:"Email notifications for transactions"})]}),(0,Hr.jsxs)("label",{className:"flex items-center",children:[(0,Hr.jsx)("input",{type:"checkbox",className:"mr-3",defaultChecked:!0}),(0,Hr.jsx)("span",{children:"Weekly earnings summary"})]})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h4",{className:"font-semibold mb-3",children:"Security"}),(0,Hr.jsxs)("div",{className:"space-y-3",children:[(0,Hr.jsx)("button",{className:"w-full p-3 bg-gray-700 rounded-lg text-left hover:bg-gray-600 transition-colors",children:(0,Hr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Hr.jsx)("span",{children:"Two-Factor Authentication"}),(0,Hr.jsx)("span",{className:"text-green-400",children:"Enabled"})]})}),(0,Hr.jsx)("button",{className:"w-full p-3 bg-gray-700 rounded-lg text-left hover:bg-gray-600 transition-colors",children:(0,Hr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Hr.jsx)("span",{children:"Transaction PIN"}),(0,Hr.jsx)("span",{className:"text-yellow-400",children:"Setup Required"})]})})]})]})]})]})})]}),u&&(0,Hr.jsx)(si,{onClose:()=>h(!1)}),p&&(0,Hr.jsx)(ci,{onClose:()=>f(!1)})]})},si=e=>{let{onClose:n}=e;const[r,i]=(0,t.useState)(""),[o,a]=(0,t.useState)("ccbill");return(0,Hr.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4",children:[(0,Hr.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white",children:"Add Funds"}),(0,Hr.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-white",children:(0,Hr.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,Hr.jsxs)("form",{onSubmit:e=>{e.preventDefault(),console.log("Adding funds:",{amount:r,method:o}),n()},className:"space-y-6",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Amount ($)"}),(0,Hr.jsx)("input",{type:"number",min:"10",step:"0.01",value:r,onChange:e=>i(e.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500",placeholder:"Enter amount",required:!0}),(0,Hr.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Minimum: $10.00"})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Payment Method"}),(0,Hr.jsx)("div",{className:"space-y-2",children:[{id:"ccbill",name:"Credit/Debit Card (CCBill)",fee:"3.9%",icon:"\ud83d\udcb3"},{id:"stripe",name:"Credit/Debit Card (Stripe)",fee:"2.9%",icon:"\ud83d\udcb3"},{id:"crypto",name:"Cryptocurrency",fee:"0.5%",icon:"\u20bf"},{id:"bank",name:"Bank Transfer",fee:"Free",icon:"\ud83c\udfe6"}].map((e=>(0,Hr.jsxs)("label",{className:"flex items-center p-3 border rounded-lg cursor-pointer transition-colors ".concat(o===e.id?"border-pink-500 bg-pink-500 bg-opacity-10":"border-gray-600 hover:border-gray-500"),children:[(0,Hr.jsx)("input",{type:"radio",name:"method",value:e.id,checked:o===e.id,onChange:e=>a(e.target.value),className:"sr-only"}),(0,Hr.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Hr.jsx)("span",{className:"text-xl",children:e.icon}),(0,Hr.jsx)("span",{className:"text-white",children:e.name})]}),(0,Hr.jsx)("span",{className:"text-sm text-gray-400",children:e.fee})]})]},e.id)))})]}),(0,Hr.jsxs)("div",{className:"flex space-x-4",children:[(0,Hr.jsx)("button",{type:"button",onClick:n,className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"}),(0,Hr.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all",children:"Add Funds"})]})]})]})})},ci=e=>{let{onClose:n}=e;const[r,i]=(0,t.useState)(""),[o,a]=(0,t.useState)("bank");return(0,Hr.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4",children:[(0,Hr.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white",children:"Withdraw Funds"}),(0,Hr.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-white",children:(0,Hr.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,Hr.jsx)("div",{className:"mb-4 p-3 bg-blue-600 bg-opacity-20 border border-blue-600 rounded-lg",children:(0,Hr.jsx)("p",{className:"text-blue-400 text-sm",children:"Available balance: $247.85"})}),(0,Hr.jsxs)("form",{onSubmit:e=>{e.preventDefault(),console.log("Processing withdrawal:",{amount:r,method:o}),n()},className:"space-y-6",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Amount ($)"}),(0,Hr.jsx)("input",{type:"number",min:"20",max:"247.85",step:"0.01",value:r,onChange:e=>i(e.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500",placeholder:"Enter amount",required:!0}),(0,Hr.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Minimum: $20.00"})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Withdrawal Method"}),(0,Hr.jsx)("div",{className:"space-y-2",children:[{id:"bank",name:"Bank Transfer",fee:"Free",time:"1-3 business days",icon:"\ud83c\udfe6"},{id:"crypto",name:"Cryptocurrency",fee:"Network fee",time:"15-30 minutes",icon:"\u20bf"},{id:"paypal",name:"PayPal",fee:"2.9%",time:"Instant",icon:"\ud83d\udcb0"}].map((e=>(0,Hr.jsxs)("label",{className:"flex items-center p-3 border rounded-lg cursor-pointer transition-colors ".concat(o===e.id?"border-pink-500 bg-pink-500 bg-opacity-10":"border-gray-600 hover:border-gray-500"),children:[(0,Hr.jsx)("input",{type:"radio",name:"method",value:e.id,checked:o===e.id,onChange:e=>a(e.target.value),className:"sr-only"}),(0,Hr.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Hr.jsx)("span",{className:"text-xl",children:e.icon}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("div",{className:"text-white",children:e.name}),(0,Hr.jsx)("div",{className:"text-xs text-gray-400",children:e.time})]})]}),(0,Hr.jsx)("span",{className:"text-sm text-gray-400",children:e.fee})]})]},e.id)))})]}),(0,Hr.jsxs)("div",{className:"flex space-x-4",children:[(0,Hr.jsx)("button",{type:"button",onClick:n,className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"}),(0,Hr.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all",children:"Withdraw"})]})]})]})})},li=(e,t)=>{let n;return function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];const a=this;clearTimeout(n),n=setTimeout((()=>e.apply(a,i)),t)}},di=[{id:1,firstName:"Isabella",lastName:"Rose",displayName:"Isabella Rose",username:"@isabella_rose",email:"isabella@example.com",phone:"+1234567890",bio:"Welcome to my exclusive world \u2728 Premium content creator sharing intimate moments and lifestyle content. Join me for daily updates and exclusive content you won't find anywhere else!",profileImage:"https://images.unsplash.com/photo-1701286618296-b40443dc63a9",coverImage:"https://images.pexels.com/photos/7533330/pexels-photo-7533330.jpeg",location:{address:"123 Main St, Los Angeles, CA 90210",city:"Los Angeles",state:"CA",country:"USA",zipCode:"90210"},gender:"female",age:25,isOnline:!0,lastSeen:(new Date).toISOString(),followers:125e3,following:45,posts:247,subscribers:12500,rating:4.9,subscriptionType:"paid",monthlyFee:19.99,bundles:[{months:3,price:54.99,discount:8},{months:6,price:99.99,discount:17},{months:12,price:179.99,discount:25}],socialAccounts:{instagram:"@isabella_rose_official",twitter:"@isabella_rose",tiktok:"@isabella_rose"},bankVerified:!0,idVerified:!0,accountStatus:"active",createdAt:"2023-01-15T10:30:00Z",earnings:{total:45780.5,thisMonth:5240.3,pendingPayout:1250.75},preferences:{darkMode:!0,language:"en",notifications:{push:!0,email:!0,sms:!1}}},{id:2,firstName:"Sophia",lastName:"Dreams",displayName:"Sophia Dreams",username:"@sophia_dreams",email:"sophia@example.com",phone:"+1234567891",bio:"Your favorite girl next door \ud83d\udc95 Custom content available. Let's chat and get to know each other better!",profileImage:"https://images.unsplash.com/photo-1701286842710-5f37edc4b8b4",coverImage:"https://images.pexels.com/photos/2330137/pexels-photo-2330137.jpeg",location:{address:"456 Beach Blvd, Miami, FL 33139",city:"Miami",state:"FL",country:"USA",zipCode:"33139"},gender:"female",age:23,isOnline:!1,lastSeen:"2024-01-20T14:45:00Z",followers:89e3,following:67,posts:189,subscribers:8900,rating:4.7,subscriptionType:"paid",monthlyFee:24.99,bundles:[{months:3,price:69.99,discount:7},{months:6,price:129.99,discount:13},{months:12,price:239.99,discount:20}],socialAccounts:{instagram:"@sophia_dreams_official",twitter:"@sophia_dreams"},bankVerified:!0,idVerified:!0,accountStatus:"active",createdAt:"2023-03-22T09:15:00Z",earnings:{total:32450.25,thisMonth:3890.6,pendingPayout:980.4},preferences:{darkMode:!0,language:"en",notifications:{push:!0,email:!0,sms:!0}}}],ui=(new Date(Date.now()-36e5).toISOString(),new Date(Date.now()+828e5).toISOString(),e=>{let{showSearch:n=!0,className:r=""}=e;const{user:i,logout:o,userType:a,notifications:s}=Qi(),[c,l]=(0,t.useState)(!1),[d,u]=(0,t.useState)(""),[h,p]=(0,t.useState)([]),[f,m]=(0,t.useState)(!1),_=(0,t.useRef)(null),g=(0,t.useCallback)(li((async e=>{if(e.length>2)try{const t=di.filter((t=>t.displayName.toLowerCase().includes(e.toLowerCase())||t.username.toLowerCase().includes(e.toLowerCase())));p(t)}catch(t){console.error("Search error:",t)}else p([])}),300),[]);(0,t.useEffect)((()=>{g(d)}),[d,g]),(0,t.useEffect)((()=>{const e=e=>{_.current&&!_.current.contains(e.target)&&p([])};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]);return(0,Hr.jsx)("header",{className:"bg-black border-b border-gray-800 sticky top-0 z-50 ".concat(r),children:(0,Hr.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,Hr.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,Hr.jsx)("div",{className:"flex items-center",children:(0,Hr.jsxs)("a",{href:"/",className:"flex items-center space-x-3",children:[(0,Hr.jsx)("img",{src:"/eye-candy-logo.svg",alt:"Eye Candy - Interlocking Hearts Logo",className:"h-8 w-auto"}),(0,Hr.jsxs)("div",{className:"flex flex-col",children:[(0,Hr.jsx)("span",{className:"text-red-500 font-bold text-lg leading-none italic",style:{fontFamily:"cursive"},children:"Eye Candy"}),(0,Hr.jsx)("span",{className:"text-gray-400 text-xs italic",style:{fontFamily:"cursive"},children:"Unwrap Me"})]})]})}),n&&(0,Hr.jsxs)("div",{className:"flex-1 max-w-lg mx-8 relative",ref:_,children:[(0,Hr.jsx)("form",{onSubmit:e=>{e.preventDefault(),d.trim()&&(window.location.href="/discover?search=".concat(encodeURIComponent(d)))},children:(0,Hr.jsxs)("div",{className:"relative",children:[(0,Hr.jsx)("input",{type:"text",placeholder:"Search creators...",value:d,onChange:e=>u(e.target.value),className:"w-full px-4 py-2 pl-10 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-pink-500"}),(0,Hr.jsx)("div",{className:"absolute left-3 top-2.5",children:(0,Hr.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})}),h.length>0&&(0,Hr.jsx)("div",{className:"absolute top-full mt-1 w-full bg-gray-800 border border-gray-700 rounded-lg shadow-lg max-h-64 overflow-y-auto z-50",children:h.map((e=>(0,Hr.jsxs)("a",{href:"/profile/".concat(e.id),className:"flex items-center space-x-3 p-3 hover:bg-gray-700 transition-colors",children:[(0,Hr.jsx)("img",{src:e.profileImage,alt:e.displayName,className:"w-10 h-10 rounded-full object-cover"}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("p",{className:"text-white font-medium",children:e.displayName}),(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:e.username})]}),e.isOnline&&(0,Hr.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"})]},e.id)))})]}),(0,Hr.jsxs)("nav",{className:"hidden md:flex space-x-6",children:[(0,Hr.jsx)("a",{href:"/discover",className:"text-gray-300 hover:text-white transition-colors",children:"Discover"}),(0,Hr.jsx)("a",{href:"/categories",className:"text-gray-300 hover:text-white transition-colors",children:"Categories"}),(0,Hr.jsx)("a",{href:"/live",className:"text-gray-300 hover:text-white transition-colors",children:"Live"})]}),(0,Hr.jsx)("div",{className:"flex items-center space-x-4",children:i?(0,Hr.jsxs)(Hr.Fragment,{children:[(0,Hr.jsxs)("div",{className:"relative",children:[(0,Hr.jsxs)("button",{onClick:()=>m(!f),className:"relative p-2 text-gray-400 hover:text-white transition-colors",children:[(0,Hr.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-3.5-3.5a1 1 0 01-.5-.85V9a6 6 0 10-12 0v3.65a1 1 0 01-.5.85L0 17h5m5 0v1a3 3 0 11-6 0v-1m6 0H9"})}),s.length>0&&(0,Hr.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:s.length})]}),f&&(0,Hr.jsx)("div",{className:"absolute right-0 mt-2 w-80 bg-gray-800 border border-gray-700 rounded-lg shadow-lg max-h-96 overflow-y-auto z-50",children:(0,Hr.jsxs)("div",{className:"p-4",children:[(0,Hr.jsx)("h3",{className:"text-white font-semibold mb-3",children:"Notifications"}),0===s.length?(0,Hr.jsx)("p",{className:"text-gray-400 text-center py-4",children:"No new notifications"}):s.map((e=>(0,Hr.jsxs)("div",{className:"mb-3 p-3 bg-gray-700 rounded-lg",children:[(0,Hr.jsx)("p",{className:"text-white text-sm",children:e.message}),(0,Hr.jsx)("p",{className:"text-gray-400 text-xs mt-1",children:e.time})]},e.id)))]})})]}),(0,Hr.jsx)("a",{href:"/messages",className:"p-2 text-gray-400 hover:text-white transition-colors",children:(0,Hr.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,Hr.jsxs)("div",{className:"relative",children:[(0,Hr.jsxs)("button",{onClick:()=>l(!c),className:"flex items-center space-x-2 text-white hover:text-pink-400 transition-colors",children:[(0,Hr.jsx)("img",{src:i.profileImage||"https://images.unsplash.com/photo-1701286618296-b40443dc63a9",alt:"Profile",className:"w-8 h-8 rounded-full object-cover"}),(0,Hr.jsx)("span",{className:"hidden md:block",children:i.displayName||i.firstName}),(0,Hr.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),c&&(0,Hr.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-gray-800 border border-gray-700 rounded-lg shadow-lg z-50",children:[(0,Hr.jsx)("a",{href:"/".concat(a,"-dashboard"),className:"block px-4 py-2 text-gray-300 hover:text-white hover:bg-gray-700",children:"Dashboard"}),(0,Hr.jsx)("a",{href:"/profile-setup",className:"block px-4 py-2 text-gray-300 hover:text-white hover:bg-gray-700",children:"Profile"}),(0,Hr.jsx)("a",{href:"/wallet",className:"block px-4 py-2 text-gray-300 hover:text-white hover:bg-gray-700",children:"Wallet"}),(0,Hr.jsx)("a",{href:"/settings",className:"block px-4 py-2 text-gray-300 hover:text-white hover:bg-gray-700",children:"Settings"}),(0,Hr.jsx)("div",{className:"border-t border-gray-700"}),(0,Hr.jsx)("button",{onClick:o,className:"block w-full text-left px-4 py-2 text-gray-300 hover:text-white hover:bg-gray-700",children:"Logout"})]})]})]}):(0,Hr.jsxs)("div",{className:"flex space-x-3",children:[(0,Hr.jsx)("a",{href:"/login",className:"px-4 py-2 text-white hover:text-pink-400 transition-colors",children:"Login"}),(0,Hr.jsx)("a",{href:"/signup",className:"px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all",children:"Sign Up"})]})})]})})})}),hi=()=>{const{user:e}=Qi(),[n,r]=(0,t.useState)([]),[i,o]=(0,t.useState)(!0);return(0,t.useEffect)((()=>{setTimeout((()=>{r(di.slice(0,3)),o(!1)}),1e3)}),[]),(0,Hr.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,Hr.jsx)(ui,{showSearch:!1}),(0,Hr.jsxs)("section",{className:"relative h-screen flex items-center justify-center overflow-hidden",children:[(0,Hr.jsx)("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat",style:{backgroundImage:"linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1652715256284-6cba3e829a70?crop=entropy&cs=srgb&fm=jpg&ixid=M3w3NTY2NzR8MHwxfHNlYXJjaHwzfHxsaW5nZXJpZSUyMG1vZGVsfGVufDB8fHxibGFja3wxNzUwOTQ3MjExfDA&ixlib=rb-4.1.0&q=85')"}}),(0,Hr.jsxs)("div",{className:"relative z-10 text-center max-w-4xl mx-auto px-4",children:[(0,Hr.jsx)("h1",{className:"text-6xl md:text-8xl font-bold mb-6 bg-gradient-to-r from-pink-400 to-purple-600 bg-clip-text text-transparent drop-shadow-2xl",children:"Eye Candy"}),(0,Hr.jsx)("p",{className:"text-xl md:text-2xl mb-8 text-gray-100 drop-shadow-lg",children:"Premium Content. Exclusive Experiences. Waiting for you."}),(0,Hr.jsx)("p",{className:"text-lg mb-8 text-gray-200 max-w-2xl mx-auto drop-shadow-md",children:"Join thousands of creators and fans in the world's most exclusive content platform. Create, share, and monetize your content with our advanced features and secure payment system."}),(0,Hr.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 justify-center",children:[(0,Hr.jsx)("a",{href:"/signup",className:"px-8 py-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg text-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-2xl",children:"Start Your Journey"}),(0,Hr.jsx)("a",{href:"/discover",className:"px-8 py-4 border-2 border-pink-500 text-pink-400 rounded-lg text-lg font-semibold hover:bg-pink-500 hover:text-white transition-all shadow-lg backdrop-blur-sm bg-black/20",children:"Explore Creators"})]})]}),(0,Hr.jsx)("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce",children:(0,Hr.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})})]}),(0,Hr.jsx)("section",{className:"py-20 bg-gray-900",children:(0,Hr.jsxs)("div",{className:"max-w-7xl mx-auto px-4",children:[(0,Hr.jsxs)("h2",{className:"text-4xl font-bold text-center mb-4",children:["Why Choose ",(0,Hr.jsx)("span",{className:"text-pink-400",children:"Eye Candy"}),"?"]}),(0,Hr.jsx)("p",{className:"text-xl text-gray-400 text-center mb-16 max-w-3xl mx-auto",children:"We provide the most advanced platform for content creators and fans to connect, share, and monetize exclusive content with industry-leading features."}),(0,Hr.jsxs)("div",{className:"grid md:grid-cols-3 gap-8",children:[(0,Hr.jsxs)("div",{className:"text-center p-6 bg-gray-800 rounded-lg hover:bg-gray-750 transition-colors",children:[(0,Hr.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Hr.jsx)("span",{className:"text-2xl",children:"\ud83c\udfa5"})}),(0,Hr.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Premium Content"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Access exclusive content from your favorite creators with unlimited streaming, high-quality videos, and personalized recommendations."})]}),(0,Hr.jsxs)("div",{className:"text-center p-6 bg-gray-800 rounded-lg hover:bg-gray-750 transition-colors",children:[(0,Hr.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Hr.jsx)("span",{className:"text-2xl",children:"\ud83d\udcb0"})}),(0,Hr.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Earn & Refer"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Join our 3-tier affiliate program and earn from referrals. Creators keep 60% of revenue with multiple monetization options."})]}),(0,Hr.jsxs)("div",{className:"text-center p-6 bg-gray-800 rounded-lg hover:bg-gray-750 transition-colors",children:[(0,Hr.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Hr.jsx)("span",{className:"text-2xl",children:"\ud83d\udd12"})}),(0,Hr.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Secure & Private"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Your privacy is our priority with end-to-end encryption, secure payments, and advanced content protection."})]})]})]})}),(0,Hr.jsx)("section",{className:"py-20 bg-black",children:(0,Hr.jsxs)("div",{className:"max-w-7xl mx-auto px-4",children:[(0,Hr.jsxs)("h2",{className:"text-4xl font-bold text-center mb-4",children:["Featured ",(0,Hr.jsx)("span",{className:"text-pink-400",children:"Creators"})]}),(0,Hr.jsx)("p",{className:"text-xl text-gray-400 text-center mb-16",children:"Discover amazing creators and exclusive content"}),i?(0,Hr.jsx)("div",{className:"grid md:grid-cols-3 gap-8",children:[1,2,3].map((e=>(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 animate-pulse",children:[(0,Hr.jsx)("div",{className:"w-full h-48 bg-gray-700 rounded-lg mb-4"}),(0,Hr.jsx)("div",{className:"h-4 bg-gray-700 rounded mb-2"}),(0,Hr.jsx)("div",{className:"h-3 bg-gray-700 rounded w-3/4"})]},e)))}):(0,Hr.jsx)("div",{className:"grid md:grid-cols-3 gap-8",children:n.map((e=>(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg overflow-hidden hover:transform hover:scale-105 transition-all duration-300",children:[(0,Hr.jsxs)("div",{className:"relative",children:[(0,Hr.jsx)("img",{src:e.coverImage,alt:e.displayName,className:"w-full h-48 object-cover"}),(0,Hr.jsx)("div",{className:"absolute top-4 left-4",children:(0,Hr.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat(e.isOnline?"bg-green-500 text-white":"bg-gray-600 text-gray-300"),children:e.isOnline?"Online":"Offline"})}),(0,Hr.jsx)("div",{className:"absolute bottom-4 left-4",children:(0,Hr.jsx)("img",{src:e.profileImage,alt:e.displayName,className:"w-16 h-16 rounded-full border-4 border-white object-cover"})})]}),(0,Hr.jsxs)("div",{className:"p-6",children:[(0,Hr.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold",children:e.displayName}),(0,Hr.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,Hr.jsx)("span",{className:"text-yellow-400",children:"\u2605"}),(0,Hr.jsx)("span",{className:"text-sm text-gray-400",children:e.rating})]})]}),(0,Hr.jsx)("p",{className:"text-gray-400 text-sm mb-2",children:e.username}),(0,Hr.jsx)("p",{className:"text-gray-300 text-sm mb-4 line-clamp-2",children:e.bio}),(0,Hr.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,Hr.jsxs)("div",{className:"text-sm text-gray-400",children:[(0,Hr.jsxs)("span",{children:[e.followers.toLocaleString()," followers"]}),(0,Hr.jsx)("span",{className:"mx-2",children:"\u2022"}),(0,Hr.jsxs)("span",{children:[e.posts," posts"]})]})}),(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("span",{className:"text-lg font-semibold text-pink-400",children:["$",e.monthlyFee,"/month"]}),(0,Hr.jsx)("a",{href:"/profile/".concat(e.id),className:"px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all",children:"View Profile"})]})]})]},e.id)))})]})}),(0,Hr.jsx)("section",{className:"py-20 bg-gray-900",children:(0,Hr.jsx)("div",{className:"max-w-7xl mx-auto px-4",children:(0,Hr.jsxs)("div",{className:"grid md:grid-cols-4 gap-8 text-center",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("div",{className:"text-4xl font-bold text-pink-400 mb-2",children:"1M+"}),(0,Hr.jsx)("div",{className:"text-gray-400",children:"Active Users"})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("div",{className:"text-4xl font-bold text-purple-400 mb-2",children:"50K+"}),(0,Hr.jsx)("div",{className:"text-gray-400",children:"Content Creators"})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("div",{className:"text-4xl font-bold text-green-400 mb-2",children:"$10M+"}),(0,Hr.jsx)("div",{className:"text-gray-400",children:"Creator Earnings"})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("div",{className:"text-4xl font-bold text-blue-400 mb-2",children:"24/7"}),(0,Hr.jsx)("div",{className:"text-gray-400",children:"Support"})]})]})})}),(0,Hr.jsx)("section",{className:"py-20 bg-gradient-to-r from-pink-500 to-purple-600",children:(0,Hr.jsxs)("div",{className:"max-w-4xl mx-auto text-center px-4",children:[(0,Hr.jsx)("h2",{className:"text-4xl font-bold mb-4",children:"Ready to Start Your Journey?"}),(0,Hr.jsx)("p",{className:"text-xl mb-8 opacity-90",children:"Join thousands of creators and fans already earning and enjoying exclusive content on Eye Candy."}),(0,Hr.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 justify-center",children:[(0,Hr.jsx)("a",{href:"/signup",className:"px-8 py-4 bg-white text-purple-600 rounded-lg text-lg font-semibold hover:bg-gray-100 transition-all",children:"Start Creating Today"}),(0,Hr.jsx)("a",{href:"/discover",className:"px-8 py-4 border-2 border-white text-white rounded-lg text-lg font-semibold hover:bg-white hover:text-purple-600 transition-all",children:"Explore Content"})]})]})}),(0,Hr.jsx)("footer",{className:"bg-black border-t border-gray-800 py-12",children:(0,Hr.jsxs)("div",{className:"max-w-7xl mx-auto px-4",children:[(0,Hr.jsxs)("div",{className:"grid md:grid-cols-4 gap-8",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsxs)("div",{className:"flex items-center justify-center space-x-3 mb-4",children:[(0,Hr.jsx)("img",{src:"/eye-candy-logo.svg",alt:"Eye Candy - Interlocking Hearts Logo",className:"h-6 w-auto"}),(0,Hr.jsxs)("div",{className:"flex flex-col",children:[(0,Hr.jsx)("span",{className:"text-red-500 font-bold text-lg leading-none italic",style:{fontFamily:"cursive"},children:"Eye Candy"}),(0,Hr.jsx)("span",{className:"text-gray-400 text-xs italic",style:{fontFamily:"cursive"},children:"Unwrap Me"})]})]}),(0,Hr.jsx)("p",{className:"text-gray-400 mb-4",children:"The world's most exclusive content platform for creators and fans."}),(0,Hr.jsxs)("div",{className:"flex space-x-4",children:[(0,Hr.jsx)("a",{href:"#",className:"text-gray-400 hover:text-pink-400",children:(0,Hr.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{d:"M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"})})}),(0,Hr.jsx)("a",{href:"#",className:"text-gray-400 hover:text-pink-400",children:(0,Hr.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{d:"M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"})})}),(0,Hr.jsx)("a",{href:"#",className:"text-gray-400 hover:text-pink-400",children:(0,Hr.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{d:"M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.174-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.347-.091.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.758-1.378l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.624 0 11.99-5.367 11.99-11.989C24.007 5.367 18.641.001 12.017.001z"})})})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h3",{className:"text-white font-semibold mb-4",children:"For Creators"}),(0,Hr.jsxs)("ul",{className:"space-y-2 text-gray-400",children:[(0,Hr.jsx)("li",{children:(0,Hr.jsx)("a",{href:"/creator-program",className:"hover:text-white",children:"Creator Program"})}),(0,Hr.jsx)("li",{children:(0,Hr.jsx)("a",{href:"/monetization",className:"hover:text-white",children:"Monetization"})}),(0,Hr.jsx)("li",{children:(0,Hr.jsx)("a",{href:"/analytics",className:"hover:text-white",children:"Analytics"})}),(0,Hr.jsx)("li",{children:(0,Hr.jsx)("a",{href:"/resources",className:"hover:text-white",children:"Resources"})})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h3",{className:"text-white font-semibold mb-4",children:"For Fans"}),(0,Hr.jsxs)("ul",{className:"space-y-2 text-gray-400",children:[(0,Hr.jsx)("li",{children:(0,Hr.jsx)("a",{href:"/discover",className:"hover:text-white",children:"Discover"})}),(0,Hr.jsx)("li",{children:(0,Hr.jsx)("a",{href:"/categories",className:"hover:text-white",children:"Categories"})}),(0,Hr.jsx)("li",{children:(0,Hr.jsx)("a",{href:"/live",className:"hover:text-white",children:"Live Streams"})}),(0,Hr.jsx)("li",{children:(0,Hr.jsx)("a",{href:"/premium",className:"hover:text-white",children:"Premium"})})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h3",{className:"text-white font-semibold mb-4",children:"Support"}),(0,Hr.jsxs)("ul",{className:"space-y-2 text-gray-400",children:[(0,Hr.jsx)("li",{children:(0,Hr.jsx)("a",{href:"/help",className:"hover:text-white",children:"Help Center"})}),(0,Hr.jsx)("li",{children:(0,Hr.jsx)("a",{href:"/contact",className:"hover:text-white",children:"Contact Us"})}),(0,Hr.jsx)("li",{children:(0,Hr.jsx)("a",{href:"/safety",className:"hover:text-white",children:"Safety"})}),(0,Hr.jsx)("li",{children:(0,Hr.jsx)("a",{href:"/privacy",className:"hover:text-white",children:"Privacy Policy"})})]})]})]}),(0,Hr.jsx)("div",{className:"border-t border-gray-800 mt-8 pt-8 text-center",children:(0,Hr.jsx)("p",{className:"text-gray-400",children:"\xa9 2025 Eye Candy. All rights reserved."})})]})})]})},pi=()=>{const{login:e,socialLogin:n}=Qi(),[r,i]=(0,t.useState)({email:"",password:"",userType:"member"}),[o,a]=(0,t.useState)(!1),[s,c]=(0,t.useState)(""),[d,u]=(0,t.useState)(!1),h=async e=>{a(!0),c("");try{const t="mock_social_token",r=await n(e,t);r.success?window.location.href="/".concat(r.user.userType,"-dashboard"):c(r.message)}catch(s){c("Social login failed. Please try again.")}a(!1)};return(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsx)("div",{className:"max-w-md w-full mx-4",children:(0,Hr.jsxs)("div",{className:"bg-gray-900 rounded-lg shadow-xl p-8",children:[(0,Hr.jsxs)("div",{className:"text-center mb-8",children:[(0,Hr.jsxs)("div",{className:"flex items-center justify-center space-x-3 mb-4",children:[(0,Hr.jsx)("img",{src:"/eye-candy-logo.svg",alt:"Eye Candy - Interlocking Hearts Logo",className:"h-10 w-auto"}),(0,Hr.jsxs)("div",{className:"flex flex-col",children:[(0,Hr.jsx)("span",{className:"text-red-500 font-bold text-xl leading-none italic",style:{fontFamily:"cursive"},children:"Eye Candy"}),(0,Hr.jsx)("span",{className:"text-gray-400 text-sm italic",style:{fontFamily:"cursive"},children:"Unwrap Me"})]})]}),(0,Hr.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Welcome Back"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Sign in to your account"})]}),s&&(0,Hr.jsx)("div",{className:"mb-4 p-3 bg-red-600 bg-opacity-20 border border-red-600 rounded-lg text-red-400 text-sm",children:s}),(0,Hr.jsxs)("form",{onSubmit:async t=>{t.preventDefault(),a(!0),c("");const n=await e(r.email,r.password,r.userType);n.success?window.location.href="/".concat(r.userType,"-dashboard"):c(n.message),a(!1)},className:"space-y-6",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Account Type"}),(0,Hr.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,Hr.jsxs)("label",{className:"flex items-center p-3 border border-gray-700 rounded-lg cursor-pointer hover:border-pink-500 transition-colors",children:[(0,Hr.jsx)("input",{type:"radio",name:"userType",value:"member",checked:"member"===r.userType,onChange:e=>i(l(l({},r),{},{userType:e.target.value})),className:"text-pink-500 focus:ring-pink-500"}),(0,Hr.jsxs)("div",{className:"ml-3",children:[(0,Hr.jsx)("div",{className:"text-white font-medium",children:"Member"}),(0,Hr.jsx)("div",{className:"text-gray-400 text-xs",children:"$19.95/month"})]})]}),(0,Hr.jsxs)("label",{className:"flex items-center p-3 border border-gray-700 rounded-lg cursor-pointer hover:border-pink-500 transition-colors",children:[(0,Hr.jsx)("input",{type:"radio",name:"userType",value:"performer",checked:"performer"===r.userType,onChange:e=>i(l(l({},r),{},{userType:e.target.value})),className:"text-pink-500 focus:ring-pink-500"}),(0,Hr.jsxs)("div",{className:"ml-3",children:[(0,Hr.jsx)("div",{className:"text-white font-medium",children:"Performer"}),(0,Hr.jsx)("div",{className:"text-gray-400 text-xs",children:"$50/month"})]})]})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email or Phone Number"}),(0,Hr.jsx)("input",{type:"text",required:!0,value:r.email,onChange:e=>i(l(l({},r),{},{email:e.target.value})),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-pink-500 transition-colors",placeholder:"Enter your email or phone number"})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),(0,Hr.jsxs)("div",{className:"relative",children:[(0,Hr.jsx)("input",{type:d?"text":"password",required:!0,value:r.password,onChange:e=>i(l(l({},r),{},{password:e.target.value})),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-pink-500 transition-colors pr-12",placeholder:"Enter your password"}),(0,Hr.jsx)("button",{type:"button",onClick:()=>u(!d),className:"absolute right-3 top-3 text-gray-400 hover:text-white",children:d?(0,Hr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):(0,Hr.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsxs)("label",{className:"flex items-center",children:[(0,Hr.jsx)("input",{type:"checkbox",className:"text-pink-500 focus:ring-pink-500 rounded"}),(0,Hr.jsx)("span",{className:"ml-2 text-sm text-gray-400",children:"Remember me"})]}),(0,Hr.jsx)("a",{href:"/forgot-password",className:"text-sm text-pink-400 hover:text-pink-300",children:"Forgot password?"})]}),(0,Hr.jsx)("button",{type:"submit",disabled:o,className:"w-full py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Signing In...":"Sign In"})]}),(0,Hr.jsxs)("div",{className:"mt-6",children:[(0,Hr.jsxs)("div",{className:"relative",children:[(0,Hr.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,Hr.jsx)("div",{className:"w-full border-t border-gray-700"})}),(0,Hr.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,Hr.jsx)("span",{className:"bg-gray-900 px-2 text-gray-400",children:"Or continue with"})})]}),(0,Hr.jsxs)("div",{className:"mt-6 grid grid-cols-2 gap-3",children:[(0,Hr.jsxs)("button",{onClick:()=>h("google"),disabled:o,className:"w-full inline-flex justify-center py-2 px-4 border border-gray-700 rounded-lg bg-gray-800 text-sm font-medium text-gray-300 hover:bg-gray-700 disabled:opacity-50",children:[(0,Hr.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[(0,Hr.jsx)("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,Hr.jsx)("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,Hr.jsx)("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,Hr.jsx)("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),(0,Hr.jsx)("span",{className:"ml-2",children:"Google"})]}),(0,Hr.jsxs)("button",{onClick:()=>h("facebook"),disabled:o,className:"w-full inline-flex justify-center py-2 px-4 border border-gray-700 rounded-lg bg-gray-800 text-sm font-medium text-gray-300 hover:bg-gray-700 disabled:opacity-50",children:[(0,Hr.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),(0,Hr.jsx)("span",{className:"ml-2",children:"Facebook"})]})]})]}),(0,Hr.jsx)("div",{className:"mt-6 text-center",children:(0,Hr.jsxs)("p",{className:"text-gray-400",children:["Don't have an account?"," ",(0,Hr.jsx)("a",{href:"/signup",className:"text-pink-400 hover:text-pink-300 font-medium",children:"Sign up"})]})})]})})})},fi=()=>(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center text-white",children:[(0,Hr.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Forgot Password"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"This page will be implemented in the next iteration."}),(0,Hr.jsx)("a",{href:"/login",className:"text-pink-400 hover:text-pink-300 mt-4 inline-block",children:"Back to Login"})]})}),mi=()=>(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center text-white",children:[(0,Hr.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Verify OTP"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"This page will be implemented in the next iteration."}),(0,Hr.jsx)("a",{href:"/login",className:"text-pink-400 hover:text-pink-300 mt-4 inline-block",children:"Back to Login"})]})}),_i=()=>(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center text-white",children:[(0,Hr.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Profile Setup"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"This page will be implemented in the next iteration."}),(0,Hr.jsx)("a",{href:"/",className:"text-pink-400 hover:text-pink-300 mt-4 inline-block",children:"Back to Home"})]})}),gi=()=>(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center text-white",children:[(0,Hr.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Bank Verification"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"This page will be implemented in the next iteration."}),(0,Hr.jsx)("a",{href:"/",className:"text-pink-400 hover:text-pink-300 mt-4 inline-block",children:"Back to Home"})]})}),vi=()=>{const{user:e}=Qi(),[n,r]=(0,t.useState)("overview");return(0,Hr.jsxs)("div",{className:"min-h-screen bg-black",children:[(0,Hr.jsx)(ui,{}),(0,Hr.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,Hr.jsxs)("div",{className:"mb-8",children:[(0,Hr.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"Performer Dashboard"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Manage your content, earnings, and profile settings"})]}),(0,Hr.jsx)("div",{className:"flex space-x-1 mb-8 bg-gray-800 rounded-lg p-1",children:[{id:"overview",label:"Overview",icon:"\ud83d\udcca"},{id:"content",label:"Content",icon:"\ud83c\udfa5"},{id:"geolocation",label:"Location Settings",icon:"\ud83c\udf0d"},{id:"analytics",label:"Analytics",icon:"\ud83d\udcc8"},{id:"earnings",label:"Earnings",icon:"\ud83d\udcb0"},{id:"settings",label:"Settings",icon:"\u2699\ufe0f"}].map((e=>(0,Hr.jsxs)("button",{onClick:()=>r(e.id),className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-all ".concat(n===e.id?"bg-gradient-to-r from-pink-500 to-purple-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"),children:[(0,Hr.jsx)("span",{children:e.icon}),(0,Hr.jsx)("span",{children:e.label})]},e.id)))}),(0,Hr.jsxs)("div",{className:"min-h-96",children:[(0,Hr.jsx)(qr,{}),"overview"===n&&(0,Hr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,Hr.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg",children:[(0,Hr.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Revenue Overview"}),(0,Hr.jsx)("div",{className:"text-3xl font-bold text-green-400 mb-2",children:"$2,456"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"This month"})]}),(0,Hr.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg",children:[(0,Hr.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Subscribers"}),(0,Hr.jsx)("div",{className:"text-3xl font-bold text-blue-400 mb-2",children:"1,234"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Active subscribers"})]}),(0,Hr.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg",children:[(0,Hr.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Content Views"}),(0,Hr.jsx)("div",{className:"text-3xl font-bold text-purple-400 mb-2",children:"45.6K"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Total views"})]})]}),"content"===n&&(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"Content Management"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Upload and manage your photos, videos, and live streams."}),(0,Hr.jsx)("div",{className:"mt-6",children:(0,Hr.jsx)("button",{className:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Upload Content"})})]}),"geolocation"===n&&e&&(0,Hr.jsx)("div",{children:(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"\ud83c\udf0d Location & Access Settings"}),(0,Hr.jsx)("p",{className:"text-gray-400 mb-6",children:"Control who can access your profile based on their location and set subscription requirements."}),(0,Hr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,Hr.jsxs)("div",{className:"p-4 bg-gray-700 rounded-lg",children:[(0,Hr.jsx)("h4",{className:"text-white font-medium mb-2",children:"\ud83d\uddfa\ufe0f Geographic Controls"}),(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:"Set which countries, states, or cities can access your profile"})]}),(0,Hr.jsxs)("div",{className:"p-4 bg-gray-700 rounded-lg",children:[(0,Hr.jsx)("h4",{className:"text-white font-medium mb-2",children:"\ud83d\udcb3 Subscription Types"}),(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:"Configure free, monthly, pay-per-visit, or teaser access"})]}),(0,Hr.jsxs)("div",{className:"p-4 bg-gray-700 rounded-lg",children:[(0,Hr.jsx)("h4",{className:"text-white font-medium mb-2",children:"\u23f1\ufe0f Teaser Settings"}),(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:"Set preview duration (15-300 seconds) before payment required"})]}),(0,Hr.jsxs)("div",{className:"p-4 bg-gray-700 rounded-lg",children:[(0,Hr.jsx)("h4",{className:"text-white font-medium mb-2",children:"\ud83d\udeab User Blocking"}),(0,Hr.jsx)("p",{className:"text-gray-400 text-sm",children:"Block users for harassment, inappropriate behavior, etc."})]})]}),(0,Hr.jsx)("div",{className:"text-center",children:(0,Hr.jsx)("a",{href:"/performer/".concat(e.id,"/geolocation-settings"),className:"inline-block px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Configure Location Settings"})})]})}),"earnings"===n&&(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"Earnings Overview"}),(0,Hr.jsxs)("div",{className:"space-y-4",children:[(0,Hr.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-gray-700",children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"This Month"}),(0,Hr.jsx)("span",{className:"text-white font-semibold",children:"$567.89"})]}),(0,Hr.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-gray-700",children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"Last Month"}),(0,Hr.jsx)("span",{className:"text-white font-semibold",children:"$1,234.56"})]}),(0,Hr.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-gray-700",children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"Pending Payout"}),(0,Hr.jsx)("span",{className:"text-green-400 font-semibold",children:"$345.67"})]})]})]}),"settings"===n&&(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"Account Settings"}),(0,Hr.jsxs)("div",{className:"space-y-4",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-gray-300 mb-2",children:"Display Name"}),(0,Hr.jsx)("input",{type:"text",defaultValue:(null===e||void 0===e?void 0:e.displayName)||(null===e||void 0===e?void 0:e.firstName),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500"})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-gray-300 mb-2",children:"Bio"}),(0,Hr.jsx)("textarea",{rows:4,defaultValue:"Your bio here...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500"})]}),(0,Hr.jsx)("button",{className:"px-6 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-all",children:"Save Changes"})]})]})]})]})]})},yi=()=>{const{id:e}=pe(),{user:t}=Qi(),n={id:e,firstName:"Isabella",lastName:"Rose",displayName:"Isabella Rose",username:"@isabella_rose",bio:"Welcome to my exclusive world \u2728 Premium content creator sharing intimate moments and lifestyle content.",profileImage:"https://images.unsplash.com/photo-1701286618296-b40443dc63a9",coverImage:"https://images.pexels.com/photos/7533330/pexels-photo-7533330.jpeg",location:"Los Angeles, CA",followers:125e3,following:45,posts:247,subscribers:12500,rating:4.9,subscriptionType:"paid",monthlyFee:19.99,isOnline:!0,lastSeen:(new Date).toISOString()};return(0,Hr.jsxs)("div",{className:"min-h-screen bg-black",children:[(0,Hr.jsx)(ui,{}),(0,Hr.jsxs)("div",{className:"relative",children:[(0,Hr.jsx)("div",{className:"h-64 md:h-96 bg-cover bg-center relative",style:{backgroundImage:"url(".concat(n.coverImage,")")},children:(0,Hr.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-40"})}),(0,Hr.jsx)("div",{className:"max-w-4xl mx-auto px-4 -mt-20 relative z-10",children:(0,Hr.jsx)("div",{className:"bg-gray-900 rounded-lg p-6 shadow-xl",children:(0,Hr.jsxs)("div",{className:"flex flex-col md:flex-row items-start md:items-end space-y-4 md:space-y-0 md:space-x-6",children:[(0,Hr.jsx)("img",{src:n.profileImage,alt:n.displayName,className:"w-32 h-32 rounded-full border-4 border-pink-500 object-cover"}),(0,Hr.jsxs)("div",{className:"flex-1",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Hr.jsx)("h1",{className:"text-3xl font-bold text-white",children:n.displayName}),n.isOnline&&(0,Hr.jsxs)("span",{className:"flex items-center text-green-400 text-sm",children:[(0,Hr.jsx)("span",{className:"w-2 h-2 bg-green-400 rounded-full mr-1 animate-pulse"}),"Online"]})]}),(0,Hr.jsx)("p",{className:"text-pink-400 text-lg mb-2",children:n.username}),(0,Hr.jsx)("p",{className:"text-gray-300 mb-4",children:n.bio}),(0,Hr.jsxs)("div",{className:"flex space-x-6 text-sm",children:[(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsx)("div",{className:"text-white font-bold",children:n.followers.toLocaleString()}),(0,Hr.jsx)("div",{className:"text-gray-400",children:"Followers"})]}),(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsx)("div",{className:"text-white font-bold",children:n.posts}),(0,Hr.jsx)("div",{className:"text-gray-400",children:"Posts"})]}),(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsx)("div",{className:"text-white font-bold",children:n.subscribers.toLocaleString()}),(0,Hr.jsx)("div",{className:"text-gray-400",children:"Subscribers"})]}),(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsxs)("div",{className:"text-white font-bold",children:[n.rating,"/5"]}),(0,Hr.jsx)("div",{className:"text-gray-400",children:"Rating"})]})]})]}),(0,Hr.jsxs)("div",{className:"flex flex-col space-y-3",children:[(0,Hr.jsxs)("button",{className:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:["Subscribe for $",n.monthlyFee,"/month"]}),(0,Hr.jsx)("button",{className:"px-6 py-3 border border-pink-500 text-pink-400 rounded-lg font-semibold hover:bg-pink-500 hover:text-white transition-all",children:"Send Message"}),(0,Hr.jsx)("button",{className:"px-6 py-3 border border-gray-600 text-gray-400 rounded-lg font-semibold hover:bg-gray-600 hover:text-white transition-all",children:"Send Tip"})]})]})})}),(0,Hr.jsx)("div",{className:"max-w-4xl mx-auto px-4 mt-8",children:(0,Hr.jsxs)("div",{className:"bg-gray-900 rounded-lg p-6",children:[(0,Hr.jsx)("div",{className:"border-b border-gray-700 mb-6",children:(0,Hr.jsxs)("nav",{className:"flex space-x-8",children:[(0,Hr.jsx)("button",{className:"py-2 px-1 border-b-2 border-pink-500 text-pink-400 font-medium",children:"Posts"}),(0,Hr.jsx)("button",{className:"py-2 px-1 border-b-2 border-transparent text-gray-400 hover:text-white",children:"Photos"}),(0,Hr.jsx)("button",{className:"py-2 px-1 border-b-2 border-transparent text-gray-400 hover:text-white",children:"Videos"}),(0,Hr.jsx)("button",{className:"py-2 px-1 border-b-2 border-transparent text-gray-400 hover:text-white",children:"Live"})]})}),(0,Hr.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3,4,5,6].map((e=>(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:[(0,Hr.jsx)("div",{className:"h-48 bg-gradient-to-br from-pink-500 to-purple-600 flex items-center justify-center",children:(0,Hr.jsx)("svg",{className:"w-12 h-12 text-white opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),(0,Hr.jsxs)("div",{className:"p-4",children:[(0,Hr.jsxs)("h3",{className:"text-white font-medium mb-2",children:["Exclusive Content #",e]}),(0,Hr.jsx)("p",{className:"text-gray-400 text-sm mb-3",children:"Premium content available for subscribers only."}),(0,Hr.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Hr.jsx)("span",{className:"text-pink-400 font-semibold",children:"$9.99"}),(0,Hr.jsx)("button",{className:"px-3 py-1 bg-pink-600 text-white rounded text-sm hover:bg-pink-700 transition-all",children:"Unlock"})]})]})]},e)))})]})})]})]})},bi=()=>(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center text-white",children:[(0,Hr.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Store Page"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"This page will be implemented in the next iteration."}),(0,Hr.jsx)("a",{href:"/",className:"text-pink-400 hover:text-pink-300 mt-4 inline-block",children:"Back to Home"})]})}),Ei=()=>(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center text-white",children:[(0,Hr.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Streaming Page"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"This page will be implemented in the next iteration."}),(0,Hr.jsx)("a",{href:"/",className:"text-pink-400 hover:text-pink-300 mt-4 inline-block",children:"Back to Home"})]})}),Si=()=>(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center text-white",children:[(0,Hr.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Messaging"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"This page will be implemented in the next iteration."}),(0,Hr.jsx)("a",{href:"/",className:"text-pink-400 hover:text-pink-300 mt-4 inline-block",children:"Back to Home"})]})}),Ti=()=>(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center text-white",children:[(0,Hr.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Settings"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"This page will be implemented in the next iteration."}),(0,Hr.jsx)("a",{href:"/",className:"text-pink-400 hover:text-pink-300 mt-4 inline-block",children:"Back to Home"})]})}),wi=()=>(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center text-white",children:[(0,Hr.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Admin Login"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"This page will be implemented in the next iteration."}),(0,Hr.jsx)("a",{href:"/",className:"text-pink-400 hover:text-pink-300 mt-4 inline-block",children:"Back to Home"})]})}),Ci=()=>(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center text-white",children:[(0,Hr.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Post Detail"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"This page will be implemented in the next iteration."}),(0,Hr.jsx)("a",{href:"/",className:"text-pink-400 hover:text-pink-300 mt-4 inline-block",children:"Back to Home"})]})}),Ri=()=>(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center text-white",children:[(0,Hr.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Subscription"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"This page will be implemented in the next iteration."}),(0,Hr.jsx)("a",{href:"/",className:"text-pink-400 hover:text-pink-300 mt-4 inline-block",children:"Back to Home"})]})}),ki=()=>{const[e,n]=(0,t.useState)(""),[r,i]=(0,t.useState)(null),[o,a]=(0,t.useState)(!0);(0,t.useEffect)((()=>{const e=new URLSearchParams(window.location.search).get("session_id");e?(n(e),s(e)):a(!1)}),[]);const s=async e=>{try{const t=await fetch("/api/payments/status/".concat(e),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken"))}}),n=await t.json();i(n)}catch(t){console.error("Error checking payment status:",t)}finally{a(!1)}};return o?(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center text-white",children:[(0,Hr.jsx)("div",{className:"w-16 h-16 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,Hr.jsx)("p",{className:"text-lg",children:"Confirming your payment..."})]})}):(0,Hr.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,Hr.jsx)(ui,{}),(0,Hr.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-16 text-center",children:[(0,Hr.jsx)("div",{className:"bg-green-600 bg-opacity-20 border border-green-600 rounded-full w-24 h-24 flex items-center justify-center mx-auto mb-8",children:(0,Hr.jsx)("svg",{className:"w-12 h-12 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,Hr.jsx)("h1",{className:"text-4xl font-bold mb-4",children:"Payment Successful!"}),(0,Hr.jsx)("p",{className:"text-xl text-gray-400 mb-8",children:"Thank you for your purchase. Your payment has been processed successfully."}),r&&(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 mb-8",children:[(0,Hr.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Payment Details"}),(0,Hr.jsxs)("div",{className:"space-y-2 text-left",children:[(0,Hr.jsxs)("div",{className:"flex justify-between",children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"Transaction ID:"}),(0,Hr.jsx)("span",{children:r.transactionId})]}),(0,Hr.jsxs)("div",{className:"flex justify-between",children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"Amount:"}),(0,Hr.jsxs)("span",{children:["$",r.amount]})]}),(0,Hr.jsxs)("div",{className:"flex justify-between",children:[(0,Hr.jsx)("span",{className:"text-gray-400",children:"Date:"}),(0,Hr.jsx)("span",{children:new Date(r.date).toLocaleDateString()})]})]})]}),(0,Hr.jsxs)("div",{className:"space-y-4",children:[(0,Hr.jsx)("a",{href:"/member-dashboard",className:"inline-block px-8 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all",children:"Go to Dashboard"}),(0,Hr.jsx)("div",{children:(0,Hr.jsx)("a",{href:"/discover",className:"text-pink-400 hover:text-pink-300",children:"Discover More Content"})})]})]})]})},Oi=()=>(0,Hr.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,Hr.jsx)(ui,{}),(0,Hr.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-16 text-center",children:[(0,Hr.jsx)("div",{className:"bg-yellow-600 bg-opacity-20 border border-yellow-600 rounded-full w-24 h-24 flex items-center justify-center mx-auto mb-8",children:(0,Hr.jsx)("svg",{className:"w-12 h-12 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,Hr.jsx)("h1",{className:"text-4xl font-bold mb-4",children:"Payment Cancelled"}),(0,Hr.jsx)("p",{className:"text-xl text-gray-400 mb-8",children:"Your payment was cancelled. No charges have been made to your account."}),(0,Hr.jsxs)("div",{className:"space-y-4",children:[(0,Hr.jsx)("a",{href:"/payment",className:"inline-block px-8 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all",children:"Try Again"}),(0,Hr.jsx)("div",{children:(0,Hr.jsx)("a",{href:"/discover",className:"text-pink-400 hover:text-pink-300",children:"Continue Browsing"})})]})]})]}),Ii=()=>(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center text-white",children:[(0,Hr.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Notifications"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"This page will be implemented in the next iteration."}),(0,Hr.jsx)("a",{href:"/",className:"text-pink-400 hover:text-pink-300 mt-4 inline-block",children:"Back to Home"})]})}),Ni=()=>{const{user:e,API:n}=Qi(),[r,i]=(0,t.useState)([]),[o,a]=(0,t.useState)(null),[s,c]=(0,t.useState)([]),[l,d]=(0,t.useState)(""),[u,h]=(0,t.useState)(!1),[p,f]=(0,t.useState)(!1),[m,_]=(0,t.useState)([]),[g,v]=(0,t.useState)(""),[y,b]=(0,t.useState)([]),E=(0,t.useRef)(null),S=(0,t.useRef)(null);(0,t.useEffect)((()=>{e&&w()}),[e]),(0,t.useEffect)((()=>{o&&C(o.id)}),[o]),(0,t.useEffect)((()=>{T()}),[s]);const T=()=>{var e;null===(e=E.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},w=async()=>{try{const t=await Gr.get("".concat(n,"/chat/rooms/").concat(e.id));i(t.data)}catch(t){console.error("Failed to fetch chat rooms:",t)}},C=async e=>{try{h(!0);const t=await Gr.get("".concat(n,"/chat/rooms/").concat(e,"/messages"));c(t.data)}catch(t){console.error("Failed to fetch messages:",t)}finally{h(!1)}};return(0,Hr.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,Hr.jsxs)("div",{className:"flex h-screen",children:[(0,Hr.jsxs)("div",{className:"w-1/3 border-r border-gray-700 bg-gray-900",children:[(0,Hr.jsx)("div",{className:"p-4 border-b border-gray-700",children:(0,Hr.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Hr.jsx)("h2",{className:"text-xl font-semibold",children:"Messages"}),(0,Hr.jsx)("button",{onClick:()=>f(!0),className:"bg-gradient-to-r from-pink-500 to-purple-600 p-2 rounded-lg hover:from-pink-600 hover:to-purple-700",children:"\u2795"})]})}),(0,Hr.jsx)("div",{className:"overflow-y-auto h-full",children:r.map((e=>(0,Hr.jsx)("div",{onClick:()=>a(e),className:"p-4 border-b border-gray-700 cursor-pointer hover:bg-gray-800 ".concat((null===o||void 0===o?void 0:o.id)===e.id?"bg-gray-800":""),children:(0,Hr.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Hr.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold",children:"group_chat"===e.chat_type?"\ud83d\udc65":"\ud83d\udc64"}),(0,Hr.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Hr.jsx)("h3",{className:"text-sm font-medium truncate",children:e.name||"Chat Room ".concat(e.id.slice(0,8))}),(0,Hr.jsxs)("p",{className:"text-xs text-gray-400",children:[e.message_count," messages"]})]})]})},e.id)))})]}),(0,Hr.jsx)("div",{className:"flex-1 flex flex-col",children:o?(0,Hr.jsxs)(Hr.Fragment,{children:[(0,Hr.jsx)("div",{className:"p-4 border-b border-gray-700 bg-gray-900",children:(0,Hr.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Hr.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center text-white",children:"group_chat"===o.chat_type?"\ud83d\udc65":"\ud83d\udc64"}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h3",{className:"font-semibold",children:o.name||"Chat ".concat(o.id.slice(0,8))}),(0,Hr.jsxs)("p",{className:"text-sm text-gray-400",children:[o.participants.length," participants"]})]})]})}),(0,Hr.jsx)("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-800",children:u?(0,Hr.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,Hr.jsx)("div",{className:"text-gray-400",children:"Loading messages..."})}):0===s.length?(0,Hr.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,Hr.jsx)("div",{className:"text-gray-400",children:"No messages yet. Start the conversation!"})}):(0,Hr.jsxs)("div",{children:[s.map((t=>{const n=t.sender_id===e.id;return(0,Hr.jsx)("div",{className:"flex ".concat(n?"justify-end":"justify-start"," mb-4"),children:(0,Hr.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat(n?"bg-gradient-to-r from-pink-500 to-purple-600 text-white":"bg-gray-700 text-gray-100"),children:["image"===t.message_type&&(0,Hr.jsx)("img",{src:t.media_url,alt:"Shared image",className:"max-w-full h-auto rounded mb-2"}),"file"===t.message_type&&(0,Hr.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,Hr.jsx)("div",{className:"text-2xl",children:"\ud83d\udcce"}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("div",{className:"text-sm font-medium",children:t.content}),(0,Hr.jsxs)("div",{className:"text-xs opacity-75",children:[(t.media_size/1024/1024).toFixed(2)," MB"]})]})]}),"text"===t.message_type&&(0,Hr.jsx)("p",{className:"text-sm",children:t.content}),(0,Hr.jsx)("p",{className:"text-xs mt-1 ".concat(n?"text-pink-200":"text-gray-400"),children:(r=t.created_at,new Date(r).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}))})]})},t.id);var r})),(0,Hr.jsx)("div",{ref:E})]})}),(0,Hr.jsx)("form",{onSubmit:async t=>{if(t.preventDefault(),l.trim()&&o)try{const t={sender_id:e.id,message_type:"text",content:l.trim()},r=await Gr.post("".concat(n,"/chat/rooms/").concat(o.id,"/messages"),t);c((e=>[...e,r.data])),d("")}catch(r){console.error("Failed to send message:",r)}},className:"p-4 border-t border-gray-700 bg-gray-900",children:(0,Hr.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Hr.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=S.current)||void 0===e?void 0:e.click()},className:"p-2 text-gray-400 hover:text-white rounded-lg hover:bg-gray-700",children:"\ud83d\udcce"}),(0,Hr.jsx)("input",{type:"file",ref:S,onChange:async t=>{const r=t.target.files[0];if(r&&o)try{const t=new FileReader;t.onload=async t=>{const i=t.target.result,a={sender_id:e.id,message_type:r.type.startsWith("image/")?"image":"file",content:r.name,media_url:i,media_type:r.type,media_size:r.size},s=await Gr.post("".concat(n,"/chat/rooms/").concat(o.id,"/messages"),a);c((e=>[...e,s.data]))},t.readAsDataURL(r)}catch(i){console.error("Failed to upload file:",i)}},className:"hidden",accept:"image/*,video/*,audio/*,.pdf,.doc,.docx"}),(0,Hr.jsx)("input",{type:"text",value:l,onChange:e=>d(e.target.value),placeholder:"Type a message...",className:"flex-1 p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent"}),(0,Hr.jsx)("button",{type:"submit",className:"bg-gradient-to-r from-pink-500 to-purple-600 p-3 rounded-lg hover:from-pink-600 hover:to-purple-700",children:"\u27a4"})]})})]}):(0,Hr.jsx)("div",{className:"flex-1 flex items-center justify-center bg-gray-800",children:(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udcac"}),(0,Hr.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Select a conversation"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Choose a chat from the sidebar to start messaging"})]})})})]}),p&&(0,Hr.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Hr.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg w-96 max-w-full mx-4",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Start New Chat"}),(0,Hr.jsx)("div",{className:"mb-4",children:(0,Hr.jsx)("input",{type:"text",placeholder:"Search users...",value:g,onChange:e=>v(e.target.value),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent"})}),(0,Hr.jsx)("div",{className:"mb-4 max-h-48 overflow-y-auto",children:(0,Hr.jsx)("div",{className:"text-gray-400 text-center py-4",children:"Search functionality will be implemented with user search API"})}),(0,Hr.jsxs)("div",{className:"flex space-x-2",children:[(0,Hr.jsx)("button",{onClick:()=>f(!1),className:"flex-1 p-3 border border-gray-600 rounded-lg text-gray-300 hover:bg-gray-700",children:"Cancel"}),(0,Hr.jsx)("button",{onClick:async()=>{if(0!==m.length)try{const t={chat_type:m.length>1?"group_chat":"direct_message",participants:[e.id,...m.map((e=>e.id))],creator_id:e.id,name:m.length>1?"Group with ".concat(m.map((e=>e.firstName)).join(", ")):null},r=await Gr.post("".concat(n,"/chat/rooms"),t);i((e=>[r.data,...e])),a(r.data),f(!1),_([])}catch(t){console.error("Failed to create chat room:",t)}},disabled:0===m.length,className:"flex-1 p-3 bg-gradient-to-r from-pink-500 to-purple-600 rounded-lg disabled:opacity-50",children:"Create Chat"})]})]})})]})},Ai=()=>{const{user:e,API:n}=Qi(),[r,i]=(0,t.useState)("calendar"),[o,a]=(0,t.useState)([]),[s,c]=(0,t.useState)([]),[d,u]=(0,t.useState)(new Date),[h,p]=(0,t.useState)(!1),[f,m]=(0,t.useState)(!1),[_,g]=(0,t.useState)({title:"",description:"",appointment_type:"video_call",scheduled_start:"",scheduled_end:"",price:0,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}),[v,y]=(0,t.useState)({day_of_week:0,start_time:"09:00",end_time:"17:00",available_types:["video_call"],pricing:{video_call:50,phone_call:30,chat_session:20},timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}),b=[{value:"video_call",label:"Video Call",icon:"\ud83d\udcf9",description:"Face-to-face video consultation"},{value:"phone_call",label:"Phone Call",icon:"\ud83d\udcde",description:"Voice-only consultation"},{value:"chat_session",label:"Chat Session",icon:"\ud83d\udcac",description:"Text-based consultation"},{value:"custom_service",label:"Custom Service",icon:"\u2b50",description:"Custom service offering"},{value:"in_person",label:"In Person",icon:"\ud83e\udd1d",description:"Face-to-face meeting"}],E=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];(0,t.useEffect)((()=>{e&&(S(),"performer"===e.userType&&T())}),[e]);const S=async()=>{try{m(!0);const t="performer"===e.userType?"/performer/".concat(e.id,"/appointments"):"/member/".concat(e.id,"/appointments"),r=await Gr.get("".concat(n).concat(t));a(r.data)}catch(t){console.error("Failed to fetch appointments:",t)}finally{m(!1)}},T=async()=>{try{const t=await Gr.get("".concat(n,"/performer/").concat(e.id,"/availability"));c(t.data)}catch(t){console.error("Failed to fetch availability:",t)}},w=async t=>{t.preventDefault();try{m(!0),await Gr.post("".concat(n,"/performer/").concat(e.id,"/availability"),v),y({day_of_week:0,start_time:"09:00",end_time:"17:00",available_types:["video_call"],pricing:{video_call:50,phone_call:30,chat_session:20},timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}),await T(),alert("Availability added successfully!")}catch(r){console.error("Failed to create availability:",r),alert("Failed to add availability. Please try again.")}finally{m(!1)}},C=async(e,t)=>{try{await Gr.put("".concat(n,"/appointments/").concat(e,"/status"),{status:t}),await S(),alert("Appointment status updated!")}catch(r){console.error("Failed to update appointment status:",r),alert("Failed to update appointment status.")}},R=e=>new Date(e).toLocaleString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return(0,Hr.jsx)("div",{className:"min-h-screen bg-black text-white",children:(0,Hr.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,Hr.jsxs)("div",{className:"mb-8",children:[(0,Hr.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent",children:"Appointment System"}),(0,Hr.jsx)("p",{className:"text-gray-400 mt-2",children:"performer"===(null===e||void 0===e?void 0:e.userType)?"Manage your appointments and availability":"Book appointments with performers"})]}),(0,Hr.jsx)("div",{className:"mb-8",children:(0,Hr.jsxs)("div",{className:"flex space-x-1 bg-gray-800 p-1 rounded-lg",children:[(0,Hr.jsx)("button",{onClick:()=>i("calendar"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("calendar"===r?"bg-gradient-to-r from-pink-500 to-purple-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-700"),children:"\ud83d\udcc5 Calendar"}),"performer"===(null===e||void 0===e?void 0:e.userType)&&(0,Hr.jsx)("button",{onClick:()=>i("availability"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("availability"===r?"bg-gradient-to-r from-pink-500 to-purple-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-700"),children:"\ud83d\udd52 Availability"})]})}),"calendar"===r&&(0,Hr.jsxs)("div",{className:"space-y-6",children:[(0,Hr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white",children:"Appointments Calendar"}),"performer"===e.userType&&(0,Hr.jsx)("button",{onClick:()=>p(!0),className:"bg-gradient-to-r from-pink-500 to-purple-600 px-4 py-2 rounded-lg text-white hover:from-pink-600 hover:to-purple-700",children:"Create Appointment"})]}),(0,Hr.jsx)("div",{className:"bg-gray-800 rounded-lg p-6",children:f?(0,Hr.jsx)("div",{className:"text-center py-8 text-gray-400",children:"Loading appointments..."}):0===o.length?(0,Hr.jsxs)("div",{className:"text-center py-8 text-gray-400",children:["No appointments scheduled. ","performer"===e.userType?"Create your first appointment!":"Book an appointment with a performer!"]}):(0,Hr.jsx)("div",{className:"space-y-4",children:o.map((t=>{var n,r,i;return(0,Hr.jsx)("div",{className:"bg-gray-700 p-4 rounded-lg border border-gray-600",children:(0,Hr.jsxs)("div",{className:"flex justify-between items-start",children:[(0,Hr.jsxs)("div",{className:"flex-1",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Hr.jsx)("span",{className:"text-2xl",children:(null===(n=b.find((e=>e.value===t.appointment_type)))||void 0===n?void 0:n.icon)||"\ud83d\udcc5"}),(0,Hr.jsx)("h4",{className:"text-lg font-semibold text-white",children:t.title}),(0,Hr.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat((i=t.status,{scheduled:"bg-blue-900 text-blue-300",confirmed:"bg-green-900 text-green-300",in_progress:"bg-yellow-900 text-yellow-300",completed:"bg-gray-900 text-gray-300",cancelled:"bg-red-900 text-red-300",no_show:"bg-orange-900 text-orange-300"}[i]||"bg-gray-900 text-gray-300")),children:t.status.replace("_"," ")})]}),(0,Hr.jsx)("p",{className:"text-gray-300 mb-2",children:t.description}),(0,Hr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-400",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("strong",{children:"Start:"})," ",R(t.scheduled_start)]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("strong",{children:"End:"})," ",R(t.scheduled_end)]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("strong",{children:"Type:"})," ",null===(r=b.find((e=>e.value===t.appointment_type)))||void 0===r?void 0:r.label]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("strong",{children:"Price:"})," $",t.price]})]})]}),"performer"===e.userType&&"scheduled"===t.status&&(0,Hr.jsxs)("div",{className:"ml-4 space-x-2",children:[(0,Hr.jsx)("button",{onClick:()=>C(t.id,"confirmed"),className:"bg-green-600 px-3 py-1 rounded text-white text-sm hover:bg-green-700",children:"Confirm"}),(0,Hr.jsx)("button",{onClick:()=>C(t.id,"cancelled"),className:"bg-red-600 px-3 py-1 rounded text-white text-sm hover:bg-red-700",children:"Cancel"})]})]})},t.id)}))})})]}),"availability"===r&&(0,Hr.jsxs)("div",{className:"space-y-6",children:[(0,Hr.jsx)("div",{className:"flex justify-between items-center",children:(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white",children:"Availability Schedule"})}),(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h4",{className:"text-lg font-semibold text-white mb-4",children:"Add Availability Slot"}),(0,Hr.jsxs)("form",{onSubmit:w,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Day of Week"}),(0,Hr.jsx)("select",{value:v.day_of_week,onChange:e=>y(l(l({},v),{},{day_of_week:parseInt(e.target.value)})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500",required:!0,children:E.map(((e,t)=>(0,Hr.jsx)("option",{value:t,children:e},t)))})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Available Types"}),(0,Hr.jsx)("select",{multiple:!0,value:v.available_types,onChange:e=>y(l(l({},v),{},{available_types:Array.from(e.target.selectedOptions,(e=>e.value))})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500",children:b.map((e=>(0,Hr.jsx)("option",{value:e.value,children:e.label},e.value)))})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Start Time"}),(0,Hr.jsx)("input",{type:"time",value:v.start_time,onChange:e=>y(l(l({},v),{},{start_time:e.target.value})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500",required:!0})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"End Time"}),(0,Hr.jsx)("input",{type:"time",value:v.end_time,onChange:e=>y(l(l({},v),{},{end_time:e.target.value})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500",required:!0})]}),(0,Hr.jsx)("div",{className:"md:col-span-2",children:(0,Hr.jsx)("button",{type:"submit",disabled:f,className:"bg-gradient-to-r from-pink-500 to-purple-600 px-6 py-3 rounded-lg text-white hover:from-pink-600 hover:to-purple-700 disabled:opacity-50",children:f?"Adding...":"Add Availability"})})]})]}),(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h4",{className:"text-lg font-semibold text-white mb-4",children:"Current Availability"}),0===s.length?(0,Hr.jsx)("div",{className:"text-center py-8 text-gray-400",children:"No availability set. Add your first availability slot!"}):(0,Hr.jsx)("div",{className:"space-y-3",children:s.map((e=>(0,Hr.jsx)("div",{className:"bg-gray-700 p-4 rounded-lg border border-gray-600",children:(0,Hr.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h5",{className:"font-semibold text-white",children:E[e.day_of_week]}),(0,Hr.jsxs)("p",{className:"text-gray-300",children:[e.start_time," - ",e.end_time]}),(0,Hr.jsxs)("p",{className:"text-sm text-gray-400",children:["Types: ",e.available_types.map((e=>{var t;return null===(t=b.find((t=>t.value===e)))||void 0===t?void 0:t.label})).join(", ")]})]}),(0,Hr.jsxs)("div",{className:"text-right",children:[(0,Hr.jsx)("p",{className:"text-sm text-gray-400",children:"Pricing:"}),Object.entries(e.pricing).map((e=>{var t;let[n,r]=e;return(0,Hr.jsxs)("p",{className:"text-white text-sm",children:[null===(t=b.find((e=>e.value===n)))||void 0===t?void 0:t.label,": $",r]},n)}))]})]})},e.id)))})]})]}),h&&(0,Hr.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Hr.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg w-96 max-w-full mx-4 max-h-screen overflow-y-auto",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Create New Appointment"}),(0,Hr.jsxs)("form",{onSubmit:async t=>{t.preventDefault();try{m(!0);const t=l(l({},_),{},{performer_id:"performer"===e.userType?e.id:_.performer_id,member_id:"member"===e.userType?e.id:_.member_id});await Gr.post("".concat(n,"/appointments"),t),g({title:"",description:"",appointment_type:"video_call",scheduled_start:"",scheduled_end:"",price:0,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}),p(!1),await S(),alert("Appointment created successfully!")}catch(r){console.error("Failed to create appointment:",r),alert("Failed to create appointment. Please try again.")}finally{m(!1)}},className:"space-y-4",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Title"}),(0,Hr.jsx)("input",{type:"text",value:_.title,onChange:e=>g(l(l({},_),{},{title:e.target.value})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500",required:!0})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Type"}),(0,Hr.jsx)("select",{value:_.appointment_type,onChange:e=>g(l(l({},_),{},{appointment_type:e.target.value})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500",children:b.map((e=>(0,Hr.jsx)("option",{value:e.value,children:e.label},e.value)))})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Start Date & Time"}),(0,Hr.jsx)("input",{type:"datetime-local",value:_.scheduled_start,onChange:e=>g(l(l({},_),{},{scheduled_start:e.target.value})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500",required:!0})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"End Date & Time"}),(0,Hr.jsx)("input",{type:"datetime-local",value:_.scheduled_end,onChange:e=>g(l(l({},_),{},{scheduled_end:e.target.value})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500",required:!0})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Price ($)"}),(0,Hr.jsx)("input",{type:"number",value:_.price,onChange:e=>g(l(l({},_),{},{price:parseFloat(e.target.value)})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500",min:"0",step:"0.01",required:!0})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description"}),(0,Hr.jsx)("textarea",{value:_.description,onChange:e=>g(l(l({},_),{},{description:e.target.value})),className:"w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500",rows:"3"})]}),(0,Hr.jsxs)("div",{className:"flex space-x-2",children:[(0,Hr.jsx)("button",{type:"button",onClick:()=>p(!1),className:"flex-1 p-3 border border-gray-600 rounded-lg text-gray-300 hover:bg-gray-700",children:"Cancel"}),(0,Hr.jsx)("button",{type:"submit",disabled:f,className:"flex-1 p-3 bg-gradient-to-r from-pink-500 to-purple-600 rounded-lg disabled:opacity-50",children:f?"Creating...":"Create"})]})]})]})})]})})};var xi=n(1635),Pi=n.n(xi),Di=n(1282);const Li=()=>{const{user:e,API:n}=Qi(),[r,i]=(0,t.useState)("agora"),[o,a]=(0,t.useState)(!1),[s,c]=(0,t.useState)(""),[l,d]=(0,t.useState)(!1),[u,h]=(0,t.useState)(null),[p,f]=(0,t.useState)([]),[m,_]=(0,t.useState)(!1),[g,v]=(0,t.useState)(null),[y,b]=(0,t.useState)(null),[E,S]=(0,t.useState)(null),[T,w]=(0,t.useState)(null),[C,R]=(0,t.useState)(new Map),[k,O]=(0,t.useState)(null),[I,N]=(0,t.useState)(null),A=(0,t.useRef)(null),x=(0,t.useRef)(null),P=(0,t.useRef)(null),D=(0,t.useRef)(null);(0,t.useEffect)((()=>{"performer"===(null===e||void 0===e?void 0:e.userType)&&L()}),[e]);const L=async()=>{try{const t=await Gr.get("".concat(n,"/video/recordings/").concat(e.id));f(t.data.recordings)}catch(t){console.error("Failed to fetch recordings:",t)}},M=async()=>{T&&(await g.unpublish(T),T.close(),await g.publish(E),E.play(A.current),w(null))},j=async()=>{try{const t=(await Gr.post("".concat(n,"/video/jitsi/room"),{room_name:s,user_name:e.username||e.firstName})).data.config;if(N(t),window.JitsiMeetExternalAPI){const e=new window.JitsiMeetExternalAPI("meet.jit.si",{roomName:t.room_name,parentNode:D.current,userInfo:{displayName:t.user_name},configOverwrite:t.config,interfaceConfigOverwrite:t.interface_config});return e.addEventListener("videoConferenceJoined",(()=>{a(!0)})),e.addEventListener("videoConferenceLeft",(()=>{a(!1)})),e}{const e=document.createElement("script");e.src="https://meet.jit.si/external_api.js",e.onload=()=>{j()},document.head.appendChild(e)}}catch(t){console.error("Jitsi initialization failed:",t),alert("Failed to initialize Jitsi meeting")}},U=async()=>{try{_(!0),await Gr.post("".concat(n,"/video/recording/stop/").concat(u)),d(!1),h(null),await L(),alert("Recording stopped successfully!")}catch(e){console.error("Failed to stop recording:",e),alert("Failed to stop recording")}finally{_(!1)}};return(0,Hr.jsx)("div",{className:"min-h-screen bg-black text-white",children:(0,Hr.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,Hr.jsxs)("div",{className:"mb-8",children:[(0,Hr.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent",children:"Live Video Conferencing"}),(0,Hr.jsx)("p",{className:"text-gray-400 mt-2",children:"Multi-provider video conferencing with recording capabilities"})]}),(0,Hr.jsx)("div",{className:"mb-6",children:(0,Hr.jsx)("div",{className:"flex space-x-4",children:["agora","twilio","jitsi"].map((e=>(0,Hr.jsx)("button",{onClick:()=>i(e),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(r===e?"bg-gradient-to-r from-pink-500 to-purple-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),disabled:o,children:e.charAt(0).toUpperCase()+e.slice(1)},e)))})}),(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,Hr.jsx)("input",{type:"text",value:s,onChange:e=>c(e.target.value),placeholder:"Enter room name",className:"flex-1 p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent",disabled:o}),o?(0,Hr.jsx)("button",{onClick:async()=>{switch(l&&await U(),r){case"agora":await(async()=>{g&&(await g.leave(),null===y||void 0===y||y.close(),null===E||void 0===E||E.close(),null===T||void 0===T||T.close(),v(null),b(null),S(null),w(null),R(new Map)),a(!1)})();break;case"twilio":k&&(k.disconnect(),O(null)),a(!1);break;case"jitsi":D.current&&(D.current.innerHTML=""),a(!1)}},className:"bg-red-600 hover:bg-red-700 px-6 py-3 rounded-lg font-medium",children:"Leave Meeting"}):(0,Hr.jsx)("button",{onClick:async()=>{if(s.trim())switch(r){case"agora":await(async()=>{try{const e=Pi().createClient({mode:"rtc",codec:"vp8"}),t=await Gr.post("".concat(n,"/video/agora/token"),{channel:s,uid:0,role:1}),{token:r}=t.data,i=await Pi().createMicrophoneAudioTrack(),o=await Pi().createCameraVideoTrack();await e.join({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:"443",FAST_REFRESH:!0,REACT_APP_BACKEND_URL:"https://0505b05a-3ca5-43b7-aafd-03668f4bbfc0.preview.emergentagent.com"}.REACT_APP_AGORA_APP_ID,s,r,0),await e.publish([i,o]),o.play(A.current),e.on("user-published",(async(t,n)=>{if(await e.subscribe(t,n),"video"===n){const e=document.createElement("div");e.style.width="320px",e.style.height="240px",x.current.appendChild(e),t.videoTrack.play(e)}"audio"===n&&t.audioTrack.play(),R((e=>new Map(e.set(t.uid,t))))})),e.on("user-unpublished",(e=>{R((t=>{const n=new Map(t);return n.delete(e.uid),n}))})),v(e),b(i),S(o),a(!0)}catch(e){console.error("Agora initialization failed:",e),alert("Failed to join Agora meeting")}})();break;case"twilio":await(async()=>{try{const t=await Gr.post("".concat(n,"/video/twilio/token"),{identity:e.username||e.id,room:s}),{token:r}=t.data,i=await(0,Di.connect)(r,{audio:!0,video:{width:640}});i.localParticipant.tracks.forEach((e=>{if(e.track){const t=e.track.attach();A.current.appendChild(t)}})),i.participants.forEach((e=>{e.tracks.forEach((e=>{if(e.track){const t=e.track.attach();x.current.appendChild(t)}}))})),i.on("participantConnected",(e=>{e.tracks.forEach((e=>{if(e.track){const t=e.track.attach();x.current.appendChild(t)}}))})),O(i),a(!0)}catch(t){console.error("Twilio initialization failed:",t),alert("Failed to join Twilio meeting")}})();break;case"jitsi":await j();break;default:alert("Unknown provider")}else alert("Please enter a room name")},className:"bg-green-600 hover:bg-green-700 px-6 py-3 rounded-lg font-medium",disabled:!s.trim(),children:"Join Meeting"})]}),o&&(0,Hr.jsxs)("div",{className:"flex space-x-4",children:["jitsi"!==r&&(0,Hr.jsx)("button",{onClick:async()=>{switch(r){case"agora":T?await M():await(async()=>{try{const e=await Pi().createScreenVideoTrack();await g.unpublish(E),await g.publish(e),e.play(P.current),w(e),e.on("track-ended",(()=>{M()}))}catch(e){console.error("Screen sharing failed:",e)}})();break;case"twilio":await(async()=>{try{const e=await navigator.mediaDevices.getDisplayMedia({video:{frameRate:15}}),t=new window.Twilio.Video.LocalVideoTrack(e.getVideoTracks()[0],{name:"screen"});await k.localParticipant.publishTrack(t),t.attach(P.current),t.on("stopped",(()=>{k.localParticipant.unpublishTrack(t)}))}catch(e){console.error("Twilio screen sharing failed:",e)}})()}},className:"bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg",children:T?"Stop Screen Share":"Share Screen"}),"performer"===(null===e||void 0===e?void 0:e.userType)&&(0,Hr.jsx)(Hr.Fragment,{children:l?(0,Hr.jsx)("button",{onClick:U,className:"bg-red-800 hover:bg-red-900 px-4 py-2 rounded-lg",disabled:m,children:"Stop Recording"}):(0,Hr.jsx)("button",{onClick:async()=>{try{_(!0);const t={session_id:"session_".concat(Date.now()),performer_id:e.id,participants:[e.id],channel:s,room_sid:null===k||void 0===k?void 0:k.sid,uid:0},i=await Gr.post("".concat(n,"/video/recording/start"),{provider:r,session_data:t});h(i.data.recording_id),d(!0),alert("Recording started successfully!")}catch(t){console.error("Failed to start recording:",t),alert("Failed to start recording")}finally{_(!1)}},className:"bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg",disabled:m,children:"Start Recording"})})]})]}),(0,Hr.jsx)("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:"jitsi"===r?(0,Hr.jsx)("div",{ref:D,className:"w-full h-96 bg-gray-900 rounded-lg"}):(0,Hr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Hr.jsxs)("div",{className:"bg-gray-900 rounded-lg overflow-hidden",children:[(0,Hr.jsx)("div",{className:"p-3 bg-gray-700",children:(0,Hr.jsx)("h3",{className:"text-sm font-medium",children:"Local Video"})}),(0,Hr.jsx)("div",{ref:A,className:"w-full h-64 bg-gray-900 flex items-center justify-center",children:!o&&(0,Hr.jsx)("span",{className:"text-gray-500",children:"Join a meeting to see your video"})})]}),(0,Hr.jsxs)("div",{className:"bg-gray-900 rounded-lg overflow-hidden",children:[(0,Hr.jsx)("div",{className:"p-3 bg-gray-700",children:(0,Hr.jsx)("h3",{className:"text-sm font-medium",children:"Remote Participants"})}),(0,Hr.jsx)("div",{ref:x,className:"w-full h-64 bg-gray-900 flex items-center justify-center",children:!o&&(0,Hr.jsx)("span",{className:"text-gray-500",children:"Waiting for participants..."})})]}),T&&(0,Hr.jsxs)("div",{className:"md:col-span-2 bg-gray-900 rounded-lg overflow-hidden",children:[(0,Hr.jsx)("div",{className:"p-3 bg-gray-700",children:(0,Hr.jsx)("h3",{className:"text-sm font-medium",children:"Screen Share"})}),(0,Hr.jsx)("div",{ref:P,className:"w-full h-64 bg-gray-900"})]})]})}),"performer"===(null===e||void 0===e?void 0:e.userType)&&p.length>0&&(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Your Recordings"}),(0,Hr.jsx)("div",{className:"space-y-4",children:p.map((e=>(0,Hr.jsx)("div",{className:"bg-gray-700 p-4 rounded-lg",children:(0,Hr.jsxs)("div",{className:"flex justify-between items-start",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h4",{className:"font-medium",children:e.room_id}),(0,Hr.jsxs)("p",{className:"text-sm text-gray-400",children:["Provider: ",e.provider," | Status: ",e.status]}),(0,Hr.jsxs)("p",{className:"text-sm text-gray-400",children:["Created: ",new Date(e.created_at).toLocaleString()]}),e.duration&&(0,Hr.jsxs)("p",{className:"text-sm text-gray-400",children:["Duration: ",e.duration,"s"]})]}),(0,Hr.jsx)("button",{onClick:()=>(async e=>{try{const t=await Gr.get("".concat(n,"/video/recordings/").concat(e,"/download"));alert("Recording downloaded to: ".concat(t.data.download_path))}catch(t){console.error("Failed to download recording:",t),alert("Failed to download recording")}})(e.recording_id),className:"bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm",disabled:"stopped"!==e.status,children:"Download"})]})},e.recording_id)))})]})]})})},Mi=()=>{const[e,n]=(0,t.useState)({firstName:"",lastName:"",email:"",password:"",confirmPassword:"",userType:"member"}),[r,i]=(0,t.useState)({trial_enabled:!0,performer_trial_days:7,member_trial_days:7}),[o,a]=(0,t.useState)(!1),[s,c]=(0,t.useState)(!1),{login:d}=Qi();(0,t.useEffect)((()=>{u()}),[]);const u=async()=>{try{const e=await Gr.get("".concat("https://0505b05a-3ca5-43b7-aafd-03668f4bbfc0.preview.emergentagent.com","/api/trial-settings/public"));e.data.success&&i({trial_enabled:e.data.trial_enabled,performer_trial_days:e.data.performer_trial_days,member_trial_days:e.data.member_trial_days})}catch(e){console.error("Failed to fetch trial settings:",e)}},h=t=>{n(l(l({},e),{},{[t.target.name]:t.target.value}))},p=()=>"performer"===e.userType?r.performer_trial_days:r.member_trial_days;return(0,Hr.jsxs)("div",{className:"min-h-screen bg-black flex",children:[(0,Hr.jsxs)("div",{className:"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-pink-900 via-purple-900 to-indigo-900 relative overflow-hidden",children:[(0,Hr.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),(0,Hr.jsxs)("div",{className:"relative z-10 flex flex-col justify-center px-12 text-white",children:[(0,Hr.jsxs)("div",{className:"mb-8",children:[(0,Hr.jsxs)("div",{className:"inline-flex items-center space-x-2 bg-gradient-to-r from-pink-500 to-purple-600 px-4 py-2 rounded-full text-sm font-medium mb-4",children:[(0,Hr.jsx)("span",{children:"\ud83c\udf89"}),(0,Hr.jsx)("span",{children:"LIMITED TIME OFFER"})]}),(0,Hr.jsxs)("h1",{className:"text-5xl font-bold mb-4 leading-tight",children:["Start Your",(0,Hr.jsxs)("span",{className:"block bg-gradient-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent",children:[p(),"-Day FREE Trial"]})]}),(0,Hr.jsx)("p",{className:"text-xl text-gray-300 mb-8",children:"Experience all premium features with no credit card required. Cancel anytime during your trial period."})]}),(0,Hr.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-8",children:[(0,Hr.jsxs)("h3",{className:"text-xl font-semibold mb-4",children:["performer"===e.userType?"Performer":"Member"," Trial Includes:"]}),(0,Hr.jsx)("div",{className:"grid grid-cols-1 gap-3",children:("performer"===e.userType?["Premium Analytics & Insights","Advanced Messaging Tools","Live Streaming Capabilities","Content Monetization","Priority Support","Custom Branding"]:["Premium Content Access","HD Streaming Quality","Download Content","Advanced Search","Priority Messaging","Ad-Free Experience"]).map(((e,t)=>(0,Hr.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Hr.jsx)("div",{className:"w-5 h-5 rounded-full bg-green-500 flex items-center justify-center",children:(0,Hr.jsx)("span",{className:"text-white text-xs",children:"\u2713"})}),(0,Hr.jsx)("span",{className:"text-sm",children:e})]},t)))})]}),(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsxs)("div",{className:"text-3xl font-bold text-yellow-400 mb-2",children:["$","performer"===e.userType?"199":"99"," Value"]}),(0,Hr.jsxs)("div",{className:"text-lg text-gray-300",children:[(0,Hr.jsx)("span",{className:"line-through",children:"Regular Price"}),(0,Hr.jsxs)("span",{className:"ml-2 text-green-400 font-bold",children:["FREE for ",p()," days!"]})]})]})]}),(0,Hr.jsx)("div",{className:"absolute top-20 right-20 w-32 h-32 bg-pink-500 rounded-full opacity-20 blur-xl"}),(0,Hr.jsx)("div",{className:"absolute bottom-20 left-20 w-40 h-40 bg-purple-500 rounded-full opacity-20 blur-xl"})]}),(0,Hr.jsx)("div",{className:"w-full lg:w-1/2 flex items-center justify-center px-8 py-12",children:(0,Hr.jsxs)("div",{className:"w-full max-w-md",children:[(0,Hr.jsx)("div",{className:"lg:hidden mb-8 text-center",children:(0,Hr.jsxs)("div",{className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white px-4 py-3 rounded-lg mb-4",children:[(0,Hr.jsxs)("div",{className:"text-lg font-bold",children:[p(),"-Day FREE Trial"]}),(0,Hr.jsxs)("div",{className:"text-sm opacity-90",children:["No credit card required",(0,Hr.jsxs)("span",{className:"block text-xs mt-1",children:["Regular price: $","performer"===e.userType?"29.99":"19.99","/month"]})]})]})}),(0,Hr.jsxs)("div",{className:"text-center mb-8",children:[(0,Hr.jsx)("h2",{className:"text-3xl font-bold text-white mb-2",children:"Join Eye Candy"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Create your account and start your free trial instantly"})]}),(0,Hr.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),e.password===e.confirmPassword)if(e.password.length<6)alert("Password must be at least 6 characters long");else try{a(!0);const t=await Gr.post("".concat("https://0505b05a-3ca5-43b7-aafd-03668f4bbfc0.preview.emergentagent.com","/api/signup"),e);t.data.access_token&&(await d(t.data),window.location.href="performer"===e.userType?"/performer/dashboard":"/member/dashboard")}catch(i){var n,r;alert((null===(n=i.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.detail)||"Signup failed. Please try again.")}finally{a(!1)}else alert("Passwords do not match")},className:"space-y-6",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:"Account Type"}),(0,Hr.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,Hr.jsxs)("button",{type:"button",onClick:()=>n(l(l({},e),{},{userType:"member"})),className:"p-4 rounded-lg border-2 transition-all ".concat("member"===e.userType?"border-purple-500 bg-purple-900/30 text-white":"border-gray-600 bg-gray-800 text-gray-300 hover:border-gray-500"),children:[(0,Hr.jsx)("div",{className:"text-2xl mb-2",children:"\ud83d\udc64"}),(0,Hr.jsx)("div",{className:"font-medium",children:"Member"}),(0,Hr.jsxs)("div",{className:"text-xs opacity-75",children:[r.member_trial_days," days FREE",(0,Hr.jsx)("span",{className:"text-gray-400",children:" (reg. $19.99/mo)"})]})]}),(0,Hr.jsxs)("button",{type:"button",onClick:()=>n(l(l({},e),{},{userType:"performer"})),className:"p-4 rounded-lg border-2 transition-all ".concat("performer"===e.userType?"border-pink-500 bg-pink-900/30 text-white":"border-gray-600 bg-gray-800 text-gray-300 hover:border-gray-500"),children:[(0,Hr.jsx)("div",{className:"text-2xl mb-2",children:"\u2b50"}),(0,Hr.jsx)("div",{className:"font-medium",children:"Performer"}),(0,Hr.jsxs)("div",{className:"text-xs opacity-75",children:[r.performer_trial_days," days FREE",(0,Hr.jsx)("span",{className:"text-gray-400",children:" (reg. $29.99/mo)"})]})]})]})]}),(0,Hr.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"First Name"}),(0,Hr.jsx)("input",{type:"text",name:"firstName",value:e.firstName,onChange:h,className:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent",required:!0})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Last Name"}),(0,Hr.jsx)("input",{type:"text",name:"lastName",value:e.lastName,onChange:h,className:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent",required:!0})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email"}),(0,Hr.jsx)("input",{type:"email",name:"email",value:e.email,onChange:h,className:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent",required:!0})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),(0,Hr.jsxs)("div",{className:"relative",children:[(0,Hr.jsx)("input",{type:s?"text":"password",name:"password",value:e.password,onChange:h,className:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent pr-12",required:!0,minLength:6}),(0,Hr.jsx)("button",{type:"button",onClick:()=>c(!s),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white",children:s?"\ud83d\udc41\ufe0f":"\ud83d\udc41\ufe0f\u200d\ud83d\udde8\ufe0f"})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Confirm Password"}),(0,Hr.jsx)("input",{type:s?"text":"password",name:"confirmPassword",value:e.confirmPassword,onChange:h,className:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent",required:!0})]}),r.trial_enabled&&(0,Hr.jsxs)("div",{className:"bg-gradient-to-r from-green-900/30 to-blue-900/30 rounded-lg p-4 border border-green-500/30",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,Hr.jsx)("span",{className:"text-green-400",children:"\u2728"}),(0,Hr.jsx)("span",{className:"text-sm font-medium text-white",children:"Free Trial Activated"})]}),(0,Hr.jsxs)("p",{className:"text-xs text-gray-300",children:["Your ",p(),"-day free trial will start immediately after signup. No payment required. Cancel anytime."]})]}),(0,Hr.jsx)("button",{type:"submit",disabled:o,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white py-4 px-6 rounded-lg font-bold text-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:o?(0,Hr.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,Hr.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,Hr.jsx)("span",{children:"Creating Account..."})]}):(0,Hr.jsxs)(Hr.Fragment,{children:["Start My ",p(),"-Day FREE Trial"]})}),(0,Hr.jsx)("div",{className:"text-center pt-4 border-t border-gray-700",children:(0,Hr.jsxs)("p",{className:"text-gray-400 text-sm",children:["Already have an account?"," ",(0,Hr.jsx)("a",{href:"/login",className:"text-pink-400 hover:text-pink-300 font-medium",children:"Sign in here"})]})})]}),(0,Hr.jsx)("div",{className:"mt-8 text-center",children:(0,Hr.jsxs)("div",{className:"flex items-center justify-center space-x-6 text-gray-500 text-xs",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,Hr.jsx)("span",{children:"\ud83d\udd12"}),(0,Hr.jsx)("span",{children:"Secure & Safe"})]}),(0,Hr.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,Hr.jsx)("span",{children:"\u2705"}),(0,Hr.jsx)("span",{children:"No Hidden Fees"})]}),(0,Hr.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,Hr.jsx)("span",{children:"\u26a1"}),(0,Hr.jsx)("span",{children:"Instant Access"})]})]})})]})})]})},ji=()=>{const{user:e,API:n}=Qi(),[r,i]=(0,t.useState)({performers:[],pagination:{current_page:1,total_pages:1,total_count:0},filters_applied:{}}),[o,a]=(0,t.useState)({query:"",country:"",state:"",city:"",radius_km:50,min_age:18,max_age:65,gender:[],sexual_preference:[],ethnicity:[],online_only:!1,verified_only:!1,sort_by:"popularity",sort_order:"desc",page:1,limit:20}),[s,c]=(0,t.useState)({genders:[],sexual_preferences:[],ethnicities:[],body_types:[],hair_colors:[],eye_colors:[],sort_options:[]}),[d,u]=(0,t.useState)(!1),[h,p]=(0,t.useState)([]),[f,m]=(0,t.useState)(!1);(0,t.useEffect)((()=>{_(),g()}),[]);const _=async()=>{try{const e=await Gr.get("".concat(n,"/performers/filters"));e.data.success&&c(e.data.filter_options)}catch(e){console.error("Failed to fetch filter options:",e)}},g=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;try{m(!0);const t=await Gr.post("".concat(n,"/performers/search"),e);t.data.success&&i({performers:t.data.performers,pagination:t.data.pagination,filters_applied:t.data.filters_applied})}catch(t){console.error("Search failed:",t),i({performers:[],pagination:{current_page:1,total_pages:1,total_count:0},filters_applied:{}})}finally{m(!1)}},v=(e,t)=>{const n=l(l({},o),{},{[e]:t,page:1});a(n),"query"===e?(clearTimeout(window.searchTimeout),window.searchTimeout=setTimeout((()=>g(n)),500)):g(n)},y=(e,t)=>{const n=o[e]||[],r=n.includes(t)?n.filter((e=>e!==t)):[...n,t];v(e,r)},b=e=>{const t=l(l({},o),{},{page:e});a(t),g(t)},E=()=>{const e={query:"",country:"",state:"",city:"",radius_km:50,min_age:18,max_age:65,gender:[],sexual_preference:[],ethnicity:[],online_only:!1,verified_only:!1,sort_by:"popularity",sort_order:"desc",page:1,limit:20};a(e),g(e)},S=e=>e.display_location||"Location not specified",T=e=>e.replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase())),w=e=>e.charAt(0).toUpperCase()+e.slice(1);return(0,Hr.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,Hr.jsx)("div",{className:"bg-gradient-to-r from-pink-900/20 to-purple-900/20 border-b border-gray-800",children:(0,Hr.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[(0,Hr.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent",children:"Find Performers"}),(0,Hr.jsx)("p",{className:"text-gray-400 mt-2",children:"Discover amazing performers in your area and beyond"})]})}),(0,Hr.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,Hr.jsxs)("div",{className:"mb-8",children:[(0,Hr.jsx)("div",{className:"mb-6",children:(0,Hr.jsxs)("div",{className:"relative",children:[(0,Hr.jsx)("input",{type:"text",value:o.query,onChange:e=>v("query",e.target.value),placeholder:"Search by name, bio, or specialties...",className:"w-full p-4 pl-12 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent"}),(0,Hr.jsx)("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400",children:"\ud83d\udd0d"})]})}),(0,Hr.jsxs)("div",{className:"flex flex-wrap gap-4 mb-6",children:[(0,Hr.jsx)("button",{onClick:()=>v("online_only",!o.online_only),className:"px-4 py-2 rounded-lg border transition-colors ".concat(o.online_only?"bg-green-600 border-green-500 text-white":"bg-gray-800 border-gray-600 text-gray-300 hover:border-gray-500"),children:"\ud83d\udfe2 Online Only"}),(0,Hr.jsx)("button",{onClick:()=>v("verified_only",!o.verified_only),className:"px-4 py-2 rounded-lg border transition-colors ".concat(o.verified_only?"bg-blue-600 border-blue-500 text-white":"bg-gray-800 border-gray-600 text-gray-300 hover:border-gray-500"),children:"\u2713 Verified Only"}),(0,Hr.jsxs)("select",{value:o.sort_by,onChange:e=>v("sort_by",e.target.value),className:"px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-pink-500",children:[(0,Hr.jsx)("option",{value:"popularity",children:"Most Popular"}),(0,Hr.jsx)("option",{value:"rating",children:"Highest Rated"}),(0,Hr.jsx)("option",{value:"newest",children:"Newest"}),(0,Hr.jsx)("option",{value:"last_active",children:"Recently Active"}),(0,Hr.jsx)("option",{value:"alphabetical",children:"A-Z"})]}),(0,Hr.jsx)("button",{onClick:()=>u(!d),className:"px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-gray-300 hover:border-gray-500 transition-colors",children:"\ud83d\udd27 Advanced Filters"}),(Object.values(r.filters_applied).some(Boolean)||o.query)&&(0,Hr.jsx)("button",{onClick:E,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white transition-colors",children:"Clear All"})]}),d&&(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 mb-6 border border-gray-700",children:[(0,Hr.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Advanced Filters"}),(0,Hr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h4",{className:"font-medium mb-3 text-pink-400",children:"\ud83d\udccd Location"}),(0,Hr.jsxs)("div",{className:"space-y-3",children:[(0,Hr.jsx)("input",{type:"text",value:o.country,onChange:e=>v("country",e.target.value),placeholder:"Country",className:"w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"}),(0,Hr.jsx)("input",{type:"text",value:o.state,onChange:e=>v("state",e.target.value),placeholder:"State/Province",className:"w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"}),(0,Hr.jsx)("input",{type:"text",value:o.city,onChange:e=>v("city",e.target.value),placeholder:"City",className:"w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h4",{className:"font-medium mb-3 text-purple-400",children:"\ud83d\udc64 Demographics"}),(0,Hr.jsxs)("div",{className:"space-y-3",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"text-sm text-gray-400 mb-1 block",children:"Age Range"}),(0,Hr.jsxs)("div",{className:"flex space-x-2",children:[(0,Hr.jsx)("input",{type:"number",value:o.min_age,onChange:e=>v("min_age",parseInt(e.target.value)),min:"18",max:"99",className:"w-1/2 p-2 bg-gray-700 border border-gray-600 rounded text-white",placeholder:"Min"}),(0,Hr.jsx)("input",{type:"number",value:o.max_age,onChange:e=>v("max_age",parseInt(e.target.value)),min:"18",max:"99",className:"w-1/2 p-2 bg-gray-700 border border-gray-600 rounded text-white",placeholder:"Max"})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"text-sm text-gray-400 mb-1 block",children:"Gender"}),(0,Hr.jsx)("div",{className:"space-y-1",children:s.genders.map((e=>(0,Hr.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,Hr.jsx)("input",{type:"checkbox",checked:o.gender.includes(e),onChange:()=>y("gender",e),className:"text-pink-500"}),(0,Hr.jsx)("span",{className:"text-sm",children:T(e)})]},e)))})]})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h4",{className:"font-medium mb-3 text-yellow-400",children:"\ud83d\udc96 Preferences"}),(0,Hr.jsxs)("div",{className:"space-y-3",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"text-sm text-gray-400 mb-1 block",children:"Sexual Preference"}),(0,Hr.jsx)("div",{className:"space-y-1",children:s.sexual_preferences.map((e=>(0,Hr.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,Hr.jsx)("input",{type:"checkbox",checked:o.sexual_preference.includes(e),onChange:()=>y("sexual_preference",e),className:"text-pink-500"}),(0,Hr.jsx)("span",{className:"text-sm",children:w(e)})]},e)))})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"text-sm text-gray-400 mb-1 block",children:"Ethnicity"}),(0,Hr.jsx)("div",{className:"space-y-1",children:s.ethnicities.map((e=>(0,Hr.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,Hr.jsx)("input",{type:"checkbox",checked:o.ethnicity.includes(e),onChange:()=>y("ethnicity",e),className:"text-pink-500"}),(0,Hr.jsx)("span",{className:"text-sm",children:T(e)})]},e)))})]})]})]})]})]})]}),(0,Hr.jsxs)("div",{className:"mb-8",children:[(0,Hr.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,Hr.jsx)("div",{children:(0,Hr.jsxs)("h2",{className:"text-xl font-semibold",children:["Search Results",r.pagination.total_count>0&&(0,Hr.jsxs)("span",{className:"text-gray-400 ml-2",children:["(",r.pagination.total_count," performers found)"]})]})})}),f?(0,Hr.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[...Array(8)].map(((e,t)=>(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg overflow-hidden animate-pulse",children:[(0,Hr.jsx)("div",{className:"h-48 bg-gray-700"}),(0,Hr.jsxs)("div",{className:"p-4",children:[(0,Hr.jsx)("div",{className:"h-4 bg-gray-700 rounded mb-2"}),(0,Hr.jsx)("div",{className:"h-3 bg-gray-700 rounded w-2/3 mb-2"}),(0,Hr.jsx)("div",{className:"h-3 bg-gray-700 rounded w-1/2"})]})]},t)))}):0===r.performers.length?(0,Hr.jsxs)("div",{className:"text-center py-12",children:[(0,Hr.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udd0d"}),(0,Hr.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"No performers found"}),(0,Hr.jsx)("p",{className:"text-gray-400 mb-4",children:"Try adjusting your search criteria or filters"}),(0,Hr.jsx)("button",{onClick:E,className:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 px-6 py-2 rounded-lg",children:"Clear All Filters"})]}):(0,Hr.jsxs)(Hr.Fragment,{children:[(0,Hr.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8",children:r.performers.map((e=>(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg overflow-hidden hover:bg-gray-750 transition-colors",children:[(0,Hr.jsxs)("div",{className:"relative h-48 bg-gray-700",children:[e.profile_image?(0,Hr.jsx)("img",{src:e.profile_image,alt:e.stage_name,className:"w-full h-full object-cover"}):(0,Hr.jsx)("div",{className:"w-full h-full flex items-center justify-center text-4xl",children:"\ud83d\udc64"}),e.is_online&&(0,Hr.jsx)("div",{className:"absolute top-2 right-2 bg-green-500 text-white px-2 py-1 rounded-full text-xs font-medium",children:"\ud83d\udfe2 Online"}),e.is_verified&&(0,Hr.jsx)("div",{className:"absolute top-2 left-2 bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-medium",children:"\u2713 Verified"})]}),(0,Hr.jsxs)("div",{className:"p-4",children:[(0,Hr.jsx)("h3",{className:"font-semibold text-lg mb-1",children:e.stage_name}),(0,Hr.jsxs)("p",{className:"text-sm text-gray-400 mb-2",children:["\ud83d\udccd ",S(e)]}),(0,Hr.jsxs)("div",{className:"flex flex-wrap gap-2 mb-3",children:[(0,Hr.jsxs)("span",{className:"bg-gray-700 px-2 py-1 rounded text-xs",children:[e.age," years"]}),(0,Hr.jsx)("span",{className:"bg-gray-700 px-2 py-1 rounded text-xs",children:T(e.gender)}),(0,Hr.jsx)("span",{className:"bg-gray-700 px-2 py-1 rounded text-xs",children:w(e.sexual_preference)}),e.ethnicity&&(0,Hr.jsx)("span",{className:"bg-gray-700 px-2 py-1 rounded text-xs",children:T(e.ethnicity)})]}),(0,Hr.jsxs)("div",{className:"flex justify-between items-center text-xs text-gray-400 mb-3",children:[(0,Hr.jsxs)("span",{children:["\ud83d\udc41\ufe0f ",e.total_views," views"]}),(0,Hr.jsxs)("span",{children:["\u2b50 ",e.average_rating.toFixed(1)," (",e.rating_count,")"]})]}),e.bio&&(0,Hr.jsx)("p",{className:"text-sm text-gray-300 mb-3 line-clamp-2",children:e.bio}),(0,Hr.jsx)("button",{className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white py-2 px-4 rounded-lg transition-all",children:"View Profile"})]})]},e.id)))}),r.pagination.total_pages>1&&(0,Hr.jsxs)("div",{className:"flex justify-center items-center space-x-2",children:[(0,Hr.jsx)("button",{onClick:()=>b(r.pagination.current_page-1),disabled:!r.pagination.has_prev,className:"px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700",children:"Previous"}),(0,Hr.jsx)("div",{className:"flex space-x-1",children:[...Array(Math.min(5,r.pagination.total_pages))].map(((e,t)=>{const n=t+1;return(0,Hr.jsx)("button",{onClick:()=>b(n),className:"px-3 py-2 rounded-lg ".concat(n===r.pagination.current_page?"bg-gradient-to-r from-pink-500 to-purple-600 text-white":"bg-gray-800 border border-gray-600 hover:bg-gray-700"),children:n},n)}))}),(0,Hr.jsx)("button",{onClick:()=>b(r.pagination.current_page+1),disabled:!r.pagination.has_next,className:"px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700",children:"Next"})]})]})]})]})]})},Ui=()=>(0,Hr.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,Hr.jsx)(ui,{}),(0,Hr.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,Hr.jsxs)("div",{className:"text-center mb-8",children:[(0,Hr.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Help & Support"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Get assistance with your Eye Candy account"})]}),(0,Hr.jsxs)("div",{className:"bg-gray-900 rounded-lg p-6 mb-6",children:[(0,Hr.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Frequently Asked Questions"}),(0,Hr.jsxs)("div",{className:"space-y-4",children:[(0,Hr.jsxs)("div",{className:"border-b border-gray-800 pb-4",children:[(0,Hr.jsx)("h3",{className:"font-medium text-pink-400 mb-2",children:"How do I subscribe to a creator?"}),(0,Hr.jsx)("p",{className:"text-gray-300",children:'To subscribe to a creator, visit their profile page and click the "Subscribe" button. You\'ll be prompted to select a subscription plan and complete the payment process.'})]}),(0,Hr.jsxs)("div",{className:"border-b border-gray-800 pb-4",children:[(0,Hr.jsx)("h3",{className:"font-medium text-pink-400 mb-2",children:"What payment methods are accepted?"}),(0,Hr.jsx)("p",{className:"text-gray-300",children:"Eye Candy accepts credit/debit cards through CCBill and Stripe, as well as various cryptocurrencies. All payment information is securely processed and we never store your full card details."})]}),(0,Hr.jsxs)("div",{className:"border-b border-gray-800 pb-4",children:[(0,Hr.jsx)("h3",{className:"font-medium text-pink-400 mb-2",children:"How do I become a creator?"}),(0,Hr.jsx)("p",{className:"text-gray-300",children:'To become a creator, sign up for an account and select "Performer" as your account type. You\'ll need to complete the verification process, set up your profile, and add your banking information to receive payments.'})]}),(0,Hr.jsxs)("div",{className:"border-b border-gray-800 pb-4",children:[(0,Hr.jsx)("h3",{className:"font-medium text-pink-400 mb-2",children:"How do payouts work for creators?"}),(0,Hr.jsx)("p",{className:"text-gray-300",children:"Creators receive 60% of all revenue generated from subscriptions and tips. Payouts are processed twice a month, and you can track your earnings in the Wallet section of your dashboard."})]}),(0,Hr.jsxs)("div",{className:"border-b border-gray-800 pb-4",children:[(0,Hr.jsx)("h3",{className:"font-medium text-pink-400 mb-2",children:"Can I cancel my subscription?"}),(0,Hr.jsx)("p",{className:"text-gray-300",children:"Yes, you can cancel your subscription at any time from your account settings. You'll continue to have access until the end of your current billing period."})]})]})]}),(0,Hr.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,Hr.jsxs)("div",{className:"bg-gray-900 rounded-lg p-6",children:[(0,Hr.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Contact Support"}),(0,Hr.jsx)("p",{className:"text-gray-400 mb-4",children:"Need more help? Our support team is available 24/7 to assist you."}),(0,Hr.jsxs)("form",{className:"space-y-4",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Your Name"}),(0,Hr.jsx)("input",{type:"text",className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-pink-500",placeholder:"Enter your name"})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email Address"}),(0,Hr.jsx)("input",{type:"email",className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-pink-500",placeholder:"Enter your email"})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Issue Type"}),(0,Hr.jsxs)("select",{className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-pink-500",children:[(0,Hr.jsx)("option",{children:"Account Issues"}),(0,Hr.jsx)("option",{children:"Payment Problems"}),(0,Hr.jsx)("option",{children:"Creator Support"}),(0,Hr.jsx)("option",{children:"Technical Issues"}),(0,Hr.jsx)("option",{children:"Other"})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Message"}),(0,Hr.jsx)("textarea",{className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-pink-500 h-32",placeholder:"Describe your issue in detail"})]}),(0,Hr.jsx)("button",{type:"submit",className:"w-full py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Submit Request"})]})]}),(0,Hr.jsxs)("div",{className:"bg-gray-900 rounded-lg p-6",children:[(0,Hr.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Quick Links"}),(0,Hr.jsxs)("div",{className:"space-y-3",children:[(0,Hr.jsx)("a",{href:"#",className:"block p-3 bg-gray-800 rounded-lg hover:bg-gray-750 transition-colors",children:(0,Hr.jsxs)("div",{className:"flex items-center",children:[(0,Hr.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center mr-3",children:(0,Hr.jsx)("span",{className:"text-white text-lg",children:"\ud83d\udcda"})}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h3",{className:"font-medium text-white",children:"Knowledge Base"}),(0,Hr.jsx)("p",{className:"text-sm text-gray-400",children:"Browse our detailed guides and tutorials"})]})]})}),(0,Hr.jsx)("a",{href:"#",className:"block p-3 bg-gray-800 rounded-lg hover:bg-gray-750 transition-colors",children:(0,Hr.jsxs)("div",{className:"flex items-center",children:[(0,Hr.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center mr-3",children:(0,Hr.jsx)("span",{className:"text-white text-lg",children:"\ud83d\udd12"})}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h3",{className:"font-medium text-white",children:"Privacy & Security"}),(0,Hr.jsx)("p",{className:"text-sm text-gray-400",children:"Learn about our privacy practices"})]})]})}),(0,Hr.jsx)("a",{href:"#",className:"block p-3 bg-gray-800 rounded-lg hover:bg-gray-750 transition-colors",children:(0,Hr.jsxs)("div",{className:"flex items-center",children:[(0,Hr.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center mr-3",children:(0,Hr.jsx)("span",{className:"text-white text-lg",children:"\ud83d\udcdd"})}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h3",{className:"font-medium text-white",children:"Terms of Service"}),(0,Hr.jsx)("p",{className:"text-sm text-gray-400",children:"Review our terms and conditions"})]})]})}),(0,Hr.jsx)("a",{href:"#",className:"block p-3 bg-gray-800 rounded-lg hover:bg-gray-750 transition-colors",children:(0,Hr.jsxs)("div",{className:"flex items-center",children:[(0,Hr.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center mr-3",children:(0,Hr.jsx)("span",{className:"text-white text-lg",children:"\ud83d\udcb0"})}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h3",{className:"font-medium text-white",children:"Billing & Payments"}),(0,Hr.jsx)("p",{className:"text-sm text-gray-400",children:"Get help with payment issues"})]})]})}),(0,Hr.jsx)("a",{href:"#",className:"block p-3 bg-gray-800 rounded-lg hover:bg-gray-750 transition-colors",children:(0,Hr.jsxs)("div",{className:"flex items-center",children:[(0,Hr.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center mr-3",children:(0,Hr.jsx)("span",{className:"text-white text-lg",children:"\ud83c\udfa5"})}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("h3",{className:"font-medium text-white",children:"Creator Resources"}),(0,Hr.jsx)("p",{className:"text-sm text-gray-400",children:"Tools and tips for content creators"})]})]})})]})]})]})]})]}),Vi=e=>{let{onLocationSelect:n,selectedLocations:r=[],excludeMode:i=!1}=e;const[o]=(0,t.useState)([{code:"US",name:"United States",states:[{code:"CA",name:"California",cities:["Los Angeles","San Francisco","San Diego"]},{code:"NY",name:"New York",cities:["New York City","Buffalo","Albany"]},{code:"TX",name:"Texas",cities:["Houston","Dallas","Austin"]},{code:"FL",name:"Florida",cities:["Miami","Orlando","Tampa"]}]},{code:"CA",name:"Canada",states:[{code:"ON",name:"Ontario",cities:["Toronto","Ottawa","Hamilton"]},{code:"BC",name:"British Columbia",cities:["Vancouver","Victoria","Surrey"]}]},{code:"GB",name:"United Kingdom",states:[{code:"ENG",name:"England",cities:["London","Manchester","Birmingham"]},{code:"SCT",name:"Scotland",cities:["Edinburgh","Glasgow","Aberdeen"]}]},{code:"AU",name:"Australia",states:[{code:"NSW",name:"New South Wales",cities:["Sydney","Newcastle","Wollongong"]},{code:"VIC",name:"Victoria",cities:["Melbourne","Geelong","Ballarat"]}]}]),[a,s]=(0,t.useState)(""),[c,l]=(0,t.useState)(""),[d,u]=(0,t.useState)(""),[h,p]=(0,t.useState)(""),[f,m]=(0,t.useState)("country");return(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:i?"Exclude Locations":"Allow Locations"}),(0,Hr.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Location Type"}),(0,Hr.jsxs)("select",{value:f,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500",children:[(0,Hr.jsx)("option",{value:"country",children:"Country"}),(0,Hr.jsx)("option",{value:"state",children:"State/Province"}),(0,Hr.jsx)("option",{value:"city",children:"City"}),(0,Hr.jsx)("option",{value:"zip_code",children:"ZIP Code"})]})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Country"}),(0,Hr.jsxs)("select",{value:a,onChange:e=>{s(e.target.value),l(""),u("")},className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500",children:[(0,Hr.jsx)("option",{value:"",children:"Select Country"}),o.map((e=>(0,Hr.jsx)("option",{value:e.code,children:e.name},e.code)))]})]}),("state"===f||"city"===f)&&(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"State/Province"}),(0,Hr.jsxs)("select",{value:c,onChange:e=>{l(e.target.value),u("")},className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500",disabled:!a,children:[(0,Hr.jsx)("option",{value:"",children:"Select State"}),(()=>{const e=o.find((e=>e.code===a));return(null===e||void 0===e?void 0:e.states)||[]})().map((e=>(0,Hr.jsx)("option",{value:e.code,children:e.name},e.code)))]})]}),"city"===f&&(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"City"}),(0,Hr.jsxs)("select",{value:d,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500",disabled:!c,children:[(0,Hr.jsx)("option",{value:"",children:"Select City"}),(()=>{const e=o.find((e=>e.code===a)),t=null===e||void 0===e?void 0:e.states.find((e=>e.code===c));return(null===t||void 0===t?void 0:t.cities)||[]})().map((e=>(0,Hr.jsx)("option",{value:e,children:e},e)))]})]}),"zip_code"===f&&(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"ZIP Code"}),(0,Hr.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),placeholder:"Enter ZIP code",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500"})]})]}),(0,Hr.jsx)("button",{onClick:()=>{var e;if(!a)return;let t={type:f,value:"",displayName:"",isAllowed:!i};switch(f){case"country":t.value=a,t.displayName=(null===(e=o.find((e=>e.code===a)))||void 0===e?void 0:e.name)||a;break;case"state":if(!c)return;t.value=c;const n=o.find((e=>e.code===a)),r=null===n||void 0===n?void 0:n.states.find((e=>e.code===c));t.displayName="".concat((null===r||void 0===r?void 0:r.name)||c,", ").concat((null===n||void 0===n?void 0:n.name)||a);break;case"city":if(!d)return;t.value=d;const i=o.find((e=>e.code===a)),s=null===i||void 0===i?void 0:i.states.find((e=>e.code===c));t.displayName="".concat(d,", ").concat((null===s||void 0===s?void 0:s.name)||c,", ").concat((null===i||void 0===i?void 0:i.name)||a);break;case"zip_code":if(!h)return;t.value=h,t.displayName="ZIP: ".concat(h);break;default:return}n(t),l(""),u(""),p("")},className:"w-full py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg font-medium hover:from-pink-600 hover:to-purple-700 transition-all",children:i?"Add Exclusion":"Add Location"}),r.length>0&&(0,Hr.jsxs)("div",{className:"mt-6",children:[(0,Hr.jsx)("h4",{className:"text-lg font-medium text-white mb-3",children:i?"Excluded Locations:":"Allowed Locations:"}),(0,Hr.jsx)("div",{className:"space-y-2",children:r.map(((e,t)=>(0,Hr.jsxs)("div",{className:"flex items-center justify-between bg-gray-700 rounded-lg p-3",children:[(0,Hr.jsx)("span",{className:"text-white",children:e.displayName}),(0,Hr.jsx)("button",{onClick:()=>n(e,!0),className:"text-red-400 hover:text-red-300 transition-colors",children:(0,Hr.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t)))})]})]})},Fi=e=>{let{value:t,onChange:n,locations:r}=e;return(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"Subscription Type"}),(0,Hr.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{value:"free",label:"Free Access",description:"Anyone can view your profile for free",icon:"\ud83c\udd93"},{value:"monthly",label:"Monthly Subscription",description:"Users need a monthly subscription to view your profile",icon:"\ud83d\udcc5"},{value:"per_visit",label:"Pay Per Visit",description:"Users pay a one-time fee to view your profile",icon:"\ud83d\udcb0"},{value:"teaser",label:"Teaser Mode",description:"Users get a limited preview before paying",icon:"\ud83d\udc40"}].map((e=>(0,Hr.jsxs)("label",{className:"flex items-start p-4 border rounded-lg cursor-pointer transition-all ".concat(t===e.value?"border-pink-500 bg-pink-500 bg-opacity-10":"border-gray-600 hover:border-gray-500"),children:[(0,Hr.jsx)("input",{type:"radio",name:"subscriptionType",value:e.value,checked:t===e.value,onChange:e=>n(e.target.value),className:"text-pink-500 focus:ring-pink-500 mt-1"}),(0,Hr.jsxs)("div",{className:"ml-3 flex-1",children:[(0,Hr.jsxs)("div",{className:"flex items-center",children:[(0,Hr.jsx)("span",{className:"text-2xl mr-2",children:e.icon}),(0,Hr.jsx)("div",{className:"text-white font-medium",children:e.label})]}),(0,Hr.jsx)("div",{className:"text-gray-400 text-sm mt-1",children:e.description})]})]},e.value)))}),r.length>0&&(0,Hr.jsx)("div",{className:"mt-4 p-4 bg-gray-700 rounded-lg",children:(0,Hr.jsxs)("p",{className:"text-sm text-gray-300",children:["This subscription type will apply to: ",r.map((e=>e.displayName)).join(", ")]})})]})},Bi=e=>{let{settings:n,onSettingsChange:r}=e;const[i,o]=(0,t.useState)((null===n||void 0===n?void 0:n.enabled)||!1),[a,s]=(0,t.useState)((null===n||void 0===n?void 0:n.duration_seconds)||30),[c,l]=(0,t.useState)((null===n||void 0===n?void 0:n.message)||"Preview time expired! Subscribe to continue viewing my profile.");(0,t.useEffect)((()=>{r({enabled:i,duration_seconds:a,message:c})}),[i,a,c]);return(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"Teaser Settings"}),(0,Hr.jsxs)("div",{className:"space-y-4",children:[(0,Hr.jsxs)("label",{className:"flex items-center",children:[(0,Hr.jsx)("input",{type:"checkbox",checked:i,onChange:e=>o(e.target.checked),className:"text-pink-500 focus:ring-pink-500 rounded"}),(0,Hr.jsx)("span",{className:"ml-2 text-white",children:"Enable teaser mode"})]}),i&&(0,Hr.jsxs)(Hr.Fragment,{children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Teaser Duration"}),(0,Hr.jsx)("select",{value:a,onChange:e=>s(parseInt(e.target.value)),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500",children:[{value:15,label:"15 seconds"},{value:30,label:"30 seconds"},{value:45,label:"45 seconds"},{value:60,label:"1 minute"},{value:90,label:"1.5 minutes"},{value:120,label:"2 minutes"},{value:180,label:"3 minutes"},{value:300,label:"5 minutes"}].map((e=>(0,Hr.jsx)("option",{value:e.value,children:e.label},e.value)))})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Expiry Message"}),(0,Hr.jsx)("textarea",{value:c,onChange:e=>l(e.target.value),rows:3,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500",placeholder:"Message shown when teaser expires..."})]}),(0,Hr.jsx)("div",{className:"p-4 bg-blue-500 bg-opacity-10 border border-blue-500 rounded-lg",children:(0,Hr.jsxs)("div",{className:"flex items-start",children:[(0,Hr.jsx)("svg",{className:"w-5 h-5 text-blue-400 mt-0.5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("p",{className:"text-blue-400 font-medium",children:"Teaser Mode Info"}),(0,Hr.jsxs)("p",{className:"text-gray-300 text-sm mt-1",children:["Users will see your profile for ",a," seconds, then need to subscribe to continue viewing. Each user gets one teaser session per visit."]})]})]})})]})]})]})},Wi=e=>{let{performerId:n}=e;const{API:r}=Qi(),[i,o]=(0,t.useState)([]),[a,s]=(0,t.useState)({userId:"",reason:"harassment",notes:""}),[c,d]=(0,t.useState)(!1),u=[{value:"harassment",label:"Harassment"},{value:"bad_language",label:"Bad Language"},{value:"inappropriate_behavior",label:"Inappropriate Behavior"},{value:"spam",label:"Spam"},{value:"other",label:"Other"}],h=(0,t.useCallback)((async()=>{try{const e=await fetch("".concat(r,"/performer/").concat(n,"/blocked-users"));if(e.ok){const t=await e.json();o(t)}}catch(e){console.error("Failed to fetch blocked users:",e)}}),[r,n]);(0,t.useEffect)((()=>{n&&h()}),[n,h]);return(0,Hr.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[(0,Hr.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"User Blocking"}),(0,Hr.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"User ID or Username"}),(0,Hr.jsx)("input",{type:"text",value:a.userId,onChange:e=>s(l(l({},a),{},{userId:e.target.value})),placeholder:"Enter user ID or username to block",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500"})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Reason for Blocking"}),(0,Hr.jsx)("select",{value:a.reason,onChange:e=>s(l(l({},a),{},{reason:e.target.value})),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500",children:u.map((e=>(0,Hr.jsx)("option",{value:e.value,children:e.label},e.value)))})]}),(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Additional Notes (optional)"}),(0,Hr.jsx)("textarea",{value:a.notes,onChange:e=>s(l(l({},a),{},{notes:e.target.value})),rows:2,placeholder:"Additional details about this block...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-pink-500"})]}),(0,Hr.jsx)("button",{onClick:async()=>{if(a.userId.trim()){d(!0);try{(await fetch("".concat(r,"/performer/").concat(n,"/block-user"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({blocked_user_id:a.userId,reason:a.reason,notes:a.notes})})).ok&&(s({userId:"",reason:"harassment",notes:""}),h())}catch(e){console.error("Failed to block user:",e)}d(!1)}},disabled:c||!a.userId.trim(),className:"w-full py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Blocking...":"Block User"})]}),i.length>0&&(0,Hr.jsxs)("div",{children:[(0,Hr.jsxs)("h4",{className:"text-lg font-medium text-white mb-3",children:["Blocked Users (",i.length,")"]}),(0,Hr.jsx)("div",{className:"space-y-3",children:i.map((e=>{var t;return(0,Hr.jsxs)("div",{className:"flex items-center justify-between bg-gray-700 rounded-lg p-4",children:[(0,Hr.jsxs)("div",{className:"flex-1",children:[(0,Hr.jsx)("div",{className:"text-white font-medium",children:e.blocked_user_id}),(0,Hr.jsxs)("div",{className:"text-gray-400 text-sm",children:["Reason: ",(null===(t=u.find((t=>t.value===e.reason)))||void 0===t?void 0:t.label)||e.reason]}),e.notes&&(0,Hr.jsxs)("div",{className:"text-gray-400 text-sm mt-1",children:["Notes: ",e.notes]}),(0,Hr.jsxs)("div",{className:"text-gray-500 text-xs mt-1",children:["Blocked: ",new Date(e.created_at).toLocaleDateString()]})]}),(0,Hr.jsx)("button",{onClick:()=>(async e=>{try{(await fetch("".concat(r,"/performer/").concat(n,"/unblock-user/").concat(e),{method:"DELETE"})).ok&&h()}catch(t){console.error("Failed to unblock user:",t)}})(e.blocked_user_id),className:"px-4 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700 transition-all",children:"Unblock"})]},e.id)}))})]}),0===i.length&&(0,Hr.jsxs)("div",{className:"text-center py-8",children:[(0,Hr.jsx)("svg",{className:"w-12 h-12 text-gray-500 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"})}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"No blocked users"})]})]})},Gi=e=>{let{performerId:n}=e;const{API:r}=Qi(),[i,o]=(0,t.useState)([]),[a,s]=(0,t.useState)([]),[c,d]=(0,t.useState)("free"),[u,h]=(0,t.useState)({}),[p,f]=(0,t.useState)(!1),m=function(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])t?s((t=>t.filter(((t,n)=>n!==e)))):o((t=>t.filter(((t,n)=>n!==e))));else{const n=l(l({},e),{},{subscriptionType:c});t?s((e=>[...e,n])):o((e=>[...e,n]))}};return(0,Hr.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,Hr.jsxs)("div",{className:"mb-8",children:[(0,Hr.jsx)("h2",{className:"text-3xl font-bold text-white mb-2",children:"Geo-Location & Access Settings"}),(0,Hr.jsx)("p",{className:"text-gray-400",children:"Control who can access your profile based on their location and set subscription requirements."})]}),(0,Hr.jsx)(Vi,{onLocationSelect:(e,t)=>m(e,t,!1),selectedLocations:i,excludeMode:!1}),(0,Hr.jsx)(Fi,{value:c,onChange:d,locations:i}),"teaser"===c&&(0,Hr.jsx)(Bi,{settings:u,onSettingsChange:h}),(0,Hr.jsx)(Vi,{onLocationSelect:(e,t)=>m(e,t,!0),selectedLocations:a,excludeMode:!0}),(0,Hr.jsx)(Wi,{performerId:n}),(0,Hr.jsx)("div",{className:"flex justify-end",children:(0,Hr.jsx)("button",{onClick:async()=>{f(!0);try{const e=[...i.map((e=>({location_type:e.type,location_value:e.value,is_allowed:!0,subscription_type:e.subscriptionType}))),...a.map((e=>({location_type:e.type,location_value:e.value,is_allowed:!1,subscription_type:"free"})))];for(const t of e)await fetch("".concat(r,"/performer/").concat(n,"/location-preferences"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});(i.some((e=>"teaser"===e.subscriptionType))||"teaser"===c)&&await fetch("".concat(r,"/performer/").concat(n,"/teaser-settings"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),alert("Settings saved successfully!")}catch(e){console.error("Failed to save settings:",e),alert("Failed to save settings. Please try again.")}f(!1)},disabled:p,className:"px-8 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Saving...":"Save Settings"})})]})},Hi=()=>{const{user:e}=Qi(),{performerId:t}=pe();return e&&"performer"===e.userType&&e.id===t?(0,Hr.jsxs)("div",{className:"min-h-screen bg-black",children:[(0,Hr.jsx)(ui,{}),(0,Hr.jsx)("div",{className:"py-8",children:(0,Hr.jsx)(Gi,{performerId:t})})]}):(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center text-white",children:[(0,Hr.jsx)("h1",{className:"text-2xl font-bold mb-4 text-red-400",children:"Access Denied"}),(0,Hr.jsx)("p",{className:"text-gray-400 mb-6",children:"You can only access your own geo-location settings."}),(0,Hr.jsx)("a",{href:"/",className:"text-pink-400 hover:text-pink-300",children:"\u2190 Back to Home"})]})})},zi=e=>{let{remainingSeconds:n,onExpired:r,message:i}=e;const[o,a]=(0,t.useState)(n);(0,t.useEffect)((()=>{a(n)}),[n]),(0,t.useEffect)((()=>{if(o<=0)return void r();const e=setInterval((()=>{a((e=>e<=1?(r(),0):e-1))}),1e3);return()=>clearInterval(e)}),[o,r]);return(0,Hr.jsxs)("div",{className:"fixed top-0 left-0 right-0 bg-gradient-to-r from-pink-600 to-purple-600 text-white p-4 z-50 shadow-lg",children:[(0,Hr.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[(0,Hr.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Hr.jsxs)("div",{className:"flex items-center",children:[(0,Hr.jsx)("svg",{className:"w-6 h-6 mr-2 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,Hr.jsx)("span",{className:"font-semibold",children:"Preview Mode"})]}),(0,Hr.jsx)("div",{className:"text-xl font-bold",children:(e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t,":").concat(n.toString().padStart(2,"0"))})(o)})]}),(0,Hr.jsx)("button",{className:"px-4 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all text-sm font-medium",children:"Subscribe Now"})]}),(0,Hr.jsx)("div",{className:"mt-2 h-1 bg-white bg-opacity-30 rounded-full overflow-hidden",children:(0,Hr.jsx)("div",{className:"h-full bg-white transition-all duration-1000 ease-linear",style:{width:"".concat((n-o)/n*100,"%")}})})]})},Ki=e=>{let{reason:t,message:n,subscriptionRequired:r,onSubscribe:i}=e;return(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:(0,Hr.jsx)("div",{className:"max-w-md w-full text-center",children:(0,Hr.jsxs)("div",{className:"bg-gray-900 rounded-lg p-8 shadow-xl",children:[(()=>{switch(t){case"location_blocked":return(0,Hr.jsxs)("svg",{className:"w-16 h-16 text-red-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]});case"user_blocked":return(0,Hr.jsx)("svg",{className:"w-16 h-16 text-red-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"})});case"subscription_required":case"teaser_expired":return(0,Hr.jsx)("svg",{className:"w-16 h-16 text-yellow-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})});default:return(0,Hr.jsx)("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L5.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}})(),(0,Hr.jsx)("h2",{className:"text-2xl font-bold text-white mb-4",children:(()=>{switch(t){case"location_blocked":return"Not Available in Your Location";case"user_blocked":return"Access Restricted";case"subscription_required":return"Subscription Required";case"teaser_expired":return"Preview Expired";default:return"Access Denied"}})()}),(0,Hr.jsx)("p",{className:"text-gray-400 mb-6",children:n}),(()=>{if("user_blocked"===t||"location_blocked"===t)return null;if(r){const e={monthly:"Subscribe Monthly",per_visit:"Pay for Access",teaser:"Start Preview"};return(0,Hr.jsx)("button",{onClick:i,className:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:e[r]||"Subscribe"})}return null})(),(0,Hr.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-700",children:(0,Hr.jsx)("a",{href:"/",className:"text-pink-400 hover:text-pink-300 transition-colors",children:"\u2190 Back to Home"})})]})})})},qi=e=>{let{performerId:n,children:r}=e;const{user:i,API:o}=Qi(),[a,s]=(0,t.useState)("checking"),[c,l]=(0,t.useState)(null),[d,u]=(0,t.useState)(null),[h,p]=(0,t.useState)(!1),f=(0,t.useCallback)((async()=>{try{const e=await fetch("".concat(o,"/detect-location"),{method:"POST"});if(!e.ok)throw new Error("Location detection failed");const t=await e.json();u(t.location);const r=await fetch("".concat(o,"/check-profile-access"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({performer_id:n,user_id:(null===i||void 0===i?void 0:i.id)||null,location:t.location})});if(!r.ok)throw new Error("Access check failed");const a=await r.json();l(a),s(a.allowed?"allowed":"denied")}catch(e){console.error("Access check error:",e),s("error")}}),[o,n,null===i||void 0===i?void 0:i.id]);(0,t.useEffect)((()=>{f()}),[f]);const m=()=>{p(!0),s("denied")},_=()=>{window.location.href="/subscription/".concat(n)};if("checking"===a)return(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse",children:(0,Hr.jsx)("svg",{className:"w-8 h-8 text-white animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Hr.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})})}),(0,Hr.jsx)("p",{className:"text-white text-lg",children:"Checking access permissions..."}),d&&(0,Hr.jsxs)("p",{className:"text-gray-400 text-sm mt-2",children:["Detected location: ",d.city,", ",d.country]})]})});if("error"===a)return(0,Hr.jsx)(Ki,{reason:"error",message:"Unable to verify access permissions. Please try again later."});if("denied"===a||h){var g;const e=h?"teaser_expired":null!==c&&void 0!==c&&null!==(g=c.reason)&&void 0!==g&&g.includes("blocked")?c.reason.includes("User")?"user_blocked":"location_blocked":"subscription_required";return(0,Hr.jsx)(Ki,{reason:e,message:(null===c||void 0===c?void 0:c.message)||"Access to this profile is not available.",subscriptionRequired:null===c||void 0===c?void 0:c.subscription_required,onSubscribe:_})}return"teaser"===(null===c||void 0===c?void 0:c.access_level)&&(null===c||void 0===c?void 0:c.teaser_remaining_seconds)>0?(0,Hr.jsxs)("div",{children:[(0,Hr.jsx)(zi,{remainingSeconds:c.teaser_remaining_seconds,onExpired:m,message:c.message}),(0,Hr.jsxs)("div",{style:{paddingTop:"80px"},children:[" ",r]})]}):r},Yi=()=>{const e="test-performer-123";return(0,Hr.jsxs)("div",{className:"min-h-screen bg-black",children:[(0,Hr.jsx)(ui,{}),(0,Hr.jsxs)("div",{className:"py-8",children:[(0,Hr.jsx)("div",{className:"max-w-4xl mx-auto px-4 mb-6",children:(0,Hr.jsxs)("div",{className:"bg-blue-600 bg-opacity-20 border border-blue-500 rounded-lg p-4",children:[(0,Hr.jsx)("h2",{className:"text-blue-400 font-bold mb-2",children:"\ud83e\uddea Test Page - Geo-Location Components"}),(0,Hr.jsx)("p",{className:"text-gray-300 text-sm",children:"This is a test page to demonstrate the geo-location and access control features. All components are functional and connected to the backend APIs."}),(0,Hr.jsxs)("p",{className:"text-gray-400 text-xs mt-2",children:["Test Performer ID: ",e]})]})}),(0,Hr.jsx)(Gi,{performerId:e})]})]})},Ji=()=>{const{id:e}=pe();return(0,Hr.jsx)(qi,{performerId:e,children:(0,Hr.jsx)(yi,{})})},Xi=(0,t.createContext)(),Qi=()=>{const e=(0,t.useContext)(Xi);if(!e)throw new Error("useUser must be used within a UserProvider");return e},Zi="".concat("https://0505b05a-3ca5-43b7-aafd-03668f4bbfc0.preview.emergentagent.com","/api");Gr.interceptors.request.use((e=>{const t=localStorage.getItem("authToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),(e=>Promise.reject(e))),Gr.interceptors.response.use((e=>e),(e=>{var t;return 401===(null===(t=e.response)||void 0===t?void 0:t.status)&&(localStorage.removeItem("authToken"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)}));const $i=function(){const[e,n]=(0,t.useState)(null),[r,i]=(0,t.useState)(null),[o,a]=(0,t.useState)(!0),[s,c]=(0,t.useState)([]),[l,d]=(0,t.useState)(navigator.onLine);(0,t.useEffect)((()=>{(async()=>{try{const t=localStorage.getItem("authToken"),r=localStorage.getItem("user");if(t&&r){const t=JSON.parse(r);n(t),i(t.userType);try{const e=await Gr.get("".concat(Zi,"/auth/verify"));if(!e.data.valid)throw new Error("Invalid token");n(e.data.user),i(e.data.user.userType)}catch(e){console.error("Token verification failed:",e),h()}}}catch(e){console.error("User initialization error:",e),h()}finally{a(!1)}})()}),[]),(0,t.useEffect)((()=>{const e=()=>d(!0),t=()=>d(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}}),[]),(0,t.useEffect)((()=>{if(e&&l){const t=new WebSocket("ws://localhost:8001/ws?userId=".concat(e.id,"&token=").concat(localStorage.getItem("authToken")));return t.onmessage=e=>{const t=JSON.parse(e.data);u(t)},t.onclose=()=>{console.log("WebSocket connection closed")},()=>{t.close()}}}),[e,l]);const u=e=>{if("notification"===e.type)c((t=>[...t,e.payload]))},h=()=>{localStorage.removeItem("authToken"),localStorage.removeItem("user"),n(null),i(null),c([])},p={user:e,userType:r,isLoading:o,notifications:s,isOnline:l,login:async(e,t,r)=>{try{const o=await Gr.post("".concat(Zi,"/auth/login"),{email:e,password:t,userType:r}),{token:a,user:s}=o.data;return localStorage.setItem("authToken",a),localStorage.setItem("user",JSON.stringify(s)),n(s),i(s.userType),{success:!0,user:s}}catch(s){var o,a;return console.error("Login error:",s),{success:!1,message:(null===(o=s.response)||void 0===o||null===(a=o.data)||void 0===a?void 0:a.message)||"Login failed"}}},signup:async e=>{try{return{success:!0,message:"Account created successfully. Please verify your email.",data:(await Gr.post("".concat(Zi,"/auth/signup"),e)).data}}catch(r){var t,n;return console.error("Signup error:",r),{success:!1,message:(null===(t=r.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Signup failed"}}},socialLogin:async(e,t)=>{try{const r=await Gr.post("".concat(Zi,"/auth/social-login"),{provider:e,accessToken:t}),{token:o,user:a}=r.data;return localStorage.setItem("authToken",o),localStorage.setItem("user",JSON.stringify(a)),n(a),i(a.userType),{success:!0,user:a}}catch(a){var r,o;return console.error("Social login error:",a),{success:!1,message:(null===(r=a.response)||void 0===r||null===(o=r.data)||void 0===o?void 0:o.message)||"Social login failed"}}},logout:h,updateUser:e=>{n(e),localStorage.setItem("user",JSON.stringify(e))},clearNotification:e=>{c((t=>t.filter((t=>t.id!==e))))},API:Zi};return o?(0,Hr.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,Hr.jsxs)("div",{className:"text-center",children:[(0,Hr.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse",children:(0,Hr.jsx)("span",{className:"text-white font-bold text-2xl",children:"E"})}),(0,Hr.jsx)("p",{className:"text-white text-lg",children:"Loading Eye Candy..."})]})}):(0,Hr.jsx)(Xi.Provider,{value:p,children:(0,Hr.jsxs)("div",{className:"App",children:[!l&&(0,Hr.jsx)("div",{className:"fixed top-0 left-0 right-0 bg-red-600 text-white text-center py-2 z-50",children:"You are offline. Some features may not work properly."}),(0,Hr.jsx)(ht,{children:(0,Hr.jsxs)(Ae,{children:[(0,Hr.jsx)(Ie,{path:"/",element:(0,Hr.jsx)(hi,{})}),(0,Hr.jsx)(Ie,{path:"/login",element:(0,Hr.jsx)(pi,{})}),(0,Hr.jsx)(Ie,{path:"/signup",element:e?(0,Hr.jsx)(Oe,{to:"/dashboard"}):(0,Hr.jsx)(Mi,{})}),(0,Hr.jsx)(Ie,{path:"/forgot-password",element:(0,Hr.jsx)(fi,{})}),(0,Hr.jsx)(Ie,{path:"/verify-otp",element:(0,Hr.jsx)(mi,{})}),(0,Hr.jsx)(Ie,{path:"/discover",element:(0,Hr.jsx)(Yr,{})}),(0,Hr.jsx)(Ie,{path:"/search",element:(0,Hr.jsx)(ji,{})}),(0,Hr.jsx)(Ie,{path:"/performer-search",element:(0,Hr.jsx)(ji,{})}),(0,Hr.jsx)(Ie,{path:"/profile/:id",element:(0,Hr.jsx)(yi,{})}),(0,Hr.jsx)(Ie,{path:"/post/:id",element:(0,Hr.jsx)(Ci,{})}),(0,Hr.jsx)(Ie,{path:"/payment-success",element:(0,Hr.jsx)(ki,{})}),(0,Hr.jsx)(Ie,{path:"/payment-cancelled",element:(0,Hr.jsx)(Oi,{})}),(0,Hr.jsx)(Ie,{path:"/help",element:(0,Hr.jsx)(Ui,{})}),(0,Hr.jsx)(Ie,{path:"/test-geolocation",element:(0,Hr.jsx)(Yi,{})}),(0,Hr.jsx)(Ie,{path:"/admin/login",element:(0,Hr.jsx)(wi,{})}),(0,Hr.jsx)(Ie,{path:"/admin/dashboard",element:"admin"===(null===e||void 0===e?void 0:e.role)?(0,Hr.jsx)(zr,{}):(0,Hr.jsx)(Oe,{to:"/admin/login"})}),(0,Hr.jsx)(Ie,{path:"/profile-setup",element:e?(0,Hr.jsx)(_i,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/bank-verification",element:e?(0,Hr.jsx)(gi,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/messages",element:e?(0,Hr.jsx)(Si,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/chat",element:e?(0,Hr.jsx)(Ni,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/appointments",element:e?(0,Hr.jsx)(Ai,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/video-conference",element:e?(0,Hr.jsx)(Li,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/settings",element:e?(0,Hr.jsx)(Ti,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/notifications",element:e?(0,Hr.jsx)(Ii,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/wallet",element:e?(0,Hr.jsx)(ai,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/subscription/:id",element:e?(0,Hr.jsx)(Ri,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/payment",element:e?(0,Hr.jsx)(oi,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/member-dashboard",element:"member"===(null===e||void 0===e?void 0:e.userType)?(0,Hr.jsx)(Jr,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/performer-dashboard",element:"performer"===(null===e||void 0===e?void 0:e.userType)?(0,Hr.jsx)(vi,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/performer/:performerId/geolocation-settings",element:"performer"===(null===e||void 0===e?void 0:e.userType)?(0,Hr.jsx)(Hi,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/store/:id",element:"performer"===(null===e||void 0===e?void 0:e.userType)?(0,Hr.jsx)(bi,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/stream/:id",element:"performer"===(null===e||void 0===e?void 0:e.userType)?(0,Hr.jsx)(Ei,{}):(0,Hr.jsx)(Oe,{to:"/login"})}),(0,Hr.jsx)(Ie,{path:"/profile/:id",element:(0,Hr.jsx)(Ji,{})}),(0,Hr.jsx)(Ie,{path:"*",element:(0,Hr.jsx)(Oe,{to:"/"})})]})})]})})};r.createRoot(document.getElementById("root")).render((0,Hr.jsx)(t.StrictMode,{children:(0,Hr.jsx)($i,{})}))})()})();
//# sourceMappingURL=main.d696e5fc.js.map